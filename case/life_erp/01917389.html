======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2017-08-23T15:55:29Z</b><br><b>마지막 답변자 : Jay Shin</b><br><b>마지막 수정 일자 : 2017-09-06T05:04:48Z</b><br><b>id : 500A000000Y3CcmIAF</b><br>======================<br><br><b><font size=15>
제목  : 서버에서 특정 프로세스가 수행이될 때 여러개의 CPU 중 1개 CPU만 사용하는 현상에 대해서 문의드리려고 합니다.
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>서버에서 특정 프로세스(첨부 이미지 PPMSCL01_gw_170823.PNG참조)가 수행이될 때 여러개의 CPU 중 1개 CPU만 사용하는 현상에 대해서 프로세스가 어떻게 동작하는 중인지 문의드리려고 합니다.<br><br>아래는 해당 시간대의 sar 수집 정보이고 추가로 top으로 cpu별 사용 정보도 캡쳐하여 보내드립니다.<br>dropbox.redhat.com에 PPMSCL01SL_strace_gw_170823 의 strace 파일 및 sosreport 도 업로드하였습니다.<br><br>root@PPMSCL01SL /var/log/sa # sar -u -f ./sa23 -s 21:22:00 -e 21:47:00<br>Linux 3.10.0-327.53.1.el7.x86_64 (PPMSCL01SL)   08/23/17        _x86_64_        (16 CPU)<br>21:22:01        CPU     %user     %nice   %system   %iowait    %steal     %idle<br>21:23:01        all      6.74      0.00      0.75      0.01      0.00     92.50<br>21:24:01        all      6.65      0.00      0.75      0.01      0.00     92.59<br>21:25:01        all      6.66      0.00      0.69      0.01      0.00     92.64<br>21:26:01        all      6.67      0.00      0.77      0.01      0.00     92.55<br>21:27:01        all      6.80      0.00      0.73      0.01      0.00     92.46<br>21:28:01        all      6.72      0.00      0.67      0.01      0.00     92.60<br>21:29:01        all      7.51      0.00      0.75      0.00      0.00     91.75<br>21:30:01        all      6.71      0.00      0.71      0.00      0.00     92.58<br>21:31:01        all      6.42      0.00      0.83      0.02      0.00     92.73<br>21:32:01        all      6.27      0.00      0.92      0.09      0.00     92.72<br>21:33:01        all      6.56      0.00      0.80      0.10      0.00     92.54<br>21:34:01        all      6.85      0.00      0.78      0.01      0.00     92.36<br>21:35:01        all      7.42      0.00      2.17      0.02      0.00     90.38<br>21:36:01        all      6.98      0.00      1.09      0.01      0.00     91.91<br>21:37:01        all      6.79      0.00      0.82      0.01      0.00     92.38<br>21:38:01        all      6.94      0.00      0.90      0.01      0.00     92.14<br>21:39:01        all      6.70      0.00      1.02      0.01      0.00     92.27<br>21:40:01        all      6.68      0.00      1.14      0.01      0.00     92.17<br>21:41:01        all      6.87      0.00      0.91      0.01      0.00     92.21<br>21:42:01        all      6.96      0.00      0.94      0.01      0.00     92.09<br>21:43:01        all      6.92      0.00      0.87      0.01      0.00     92.19<br>21:44:01        all      6.95      0.00      0.96      0.02      0.00     92.07<br>21:45:01        all      6.89      0.00      0.90      0.01      0.00     92.20<br>21:46:01        all      6.47      0.00      0.85      0.01      0.00     92.67<br>Average:        all      6.80      0.00      0.90      0.02      0.00     92.28<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PPMSCL01SL</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000KHa5kIAD"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-09-01T04:21:04Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-09-01T04:21:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>본 기술 문의의 상태를 처리완료 상태로 변경하고자 합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 본 기술 문의를 *재개*하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2017-09-01T04:21:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KH50AIAT"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-30T05:55:33Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-30T05:55:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin<br>Technical Support Engineer<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2017-08-30T05:55:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KSfTkIAL"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-28T07:41:59Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-28T07:41:59Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>PPMSCL01SL_170828_case.tar.gz으로 드롭박스에 업데이트 했습니다.<br>sosreport와 sar데이터를 압축하였습니다.<br><br>배치 1200건 (single thread) 8/27 16:12 ~ 17:23 10프로 사용<br>배치 1200건 (multi thread) 8/27 18:23 ~ 19:28 10프로 사용<br>배치 1600건 (single thread) 8/27 20:50 ~ 20:55 100프로 사용<br><br>약 400건의 배치작업이 더 발생한것으로 cpu사용률이 100프로가 된 이유와<br>100프로 사용량을 나타낸 산술방식이 무엇인지 말씀 부탁드립니다.<br><br>DMIDECODE<br>  BIOS:<br>    Vend: HP    Vers: P89    Date: 02/17/2017    BIOS Rev: 2.40    FW Rev:   2.53<br>  System:<br>    Prod: ProLiant DL380 Gen9<br>  CPU:<br>    2 of 2 CPU sockets populated, 4 cores/8 threads per CPU<br>    8 total cores, 16 total threads<br>    Vers: Intel(R) Xeon(R) CPU E5-2637 v3 @ 3.50GHz<br>  Memory:<br>    Total: 131072 MiB (128 GiB)<br><br>OS<br>  Hostname: PPMSCL01SL<br>  Distro:   [redhat-release] Red Hat Enterprise Linux Server release 7.2 (Maipo)<br>  Kernel:<br>    Booted kernel:  3.10.0-327.53.1.el7.x86_64<br>    Booted kernel cmdline:<br>      root=UUID=a6295f2a-a473-4281-9c63-194226ac5074 ro crashkernel=512M rhgb quiet<br>      LANG=en_US.UTF-8 nmi_watchdog=0 transparent_hugepage=never elevator=deadline<br>      rdloaddriver=hpsa rdloaddriver=qla2xxx nosoftlockup intel_idle.max_cstate=0<br>      processor.max_cstate=1 intel_pstate=disable mce=ignore_ce<br>    Taint-check: 12289  (see https://access.redhat.com/solutions/40594)<br>       0  PROPRIETARY_MODULE: Proprietary module has been loaded<br>      12  OOT_MODULE: Out-of-tree module has been loaded<br>      13  UNSIGNED_MODULE: Unsigned module has been loaded<br>    - - - - - - - - - - - - - - - - - - -<br>  Sys time:  Mon Aug 28 15:00:22 KST 2017<br>  Boot time: 2017. 08. 27. (일) 00:53:20 UTC  (epoch: 1503795200)<br>  Uptime:    1 day,  5:07,  4 users<br>  LoadAvg:   [16 CPU] 0.20 (1%), 0.12 (1%), 0.07 (0%)<br>  /proc/stat:<br>    procs_running: 1   procs_blocked: 0    processes [Since boot]: 1417404<br>    cpu [Utilization since boot]:<br>      us 0%, ni 0%, sys 0%, idle 99%, iowait 0%, irq 0%, sftirq 0%, steal 0%<br><br><br>KDUMP CONFIG<br>  kexec-tools rpm version:<br>    kexec-tools-2.0.7-38.el7.x86_64<br>  Service enablement:<br>    UNIT  STATE<br>  kdump initrd/initramfs:<br>    20210863 Jul 23 20:19 initramfs-3.10.0-327.53.1.el7.x86_64kdump.img<br>  Memory reservation config:<br>    /proc/cmdline { crashkernel=512M }<br>  Actual memory reservation per /proc/iomem:<br>      14000000-33ffffff : Crash kernel<br>  kdump.conf:<br>    raw /dev/vg9/DUMP<br>    core_collector makedumpfile -c -d 31 -F<br>    kdump_pre /usr/bin/kdump_delay.sh<br>    fence_kdump_args -p 7410 -f auto -c 30 -i 1<br>    fence_kdump_nodes 172.18.21.32<br>  Panic sysctls:<br>    kernel.sysrq [bitmask] =  &quot;1&quot;  (all SysRqs allowed)<br>    kernel.panic [secs] =  0  (no autoreboot on panic)<br>    kernel.hung_task_panic =  0<br>    kernel.panic_on_oops =  1<br>    kernel.panic_on_io_nmi =  1<br>    kernel.panic_on_unrecovered_nmi =  1<br>    kernel.panic_on_stackoverflow =  0<br>    kernel.softlockup_panic =  0<br>    kernel.unknown_nmi_panic =  1<br>    kernel.nmi_watchdog =  0<br>    vm.panic_on_oom [0-2] =  0  (no panic)<br><br>08:53:01 PM     all      3.25      0.00      2.23      0.01      0.00      0.00      0.52      0.00      0.00     93.99<br>08:53:01 PM       0      4.62      0.00      2.35      0.00      0.00      0.00      0.69      0.00      0.00     92.33<br>08:53:01 PM       1      4.44      0.00      2.41      0.00      0.00      0.00      0.68      0.00      0.00     92.47<br>08:53:01 PM       2      6.03      0.00      3.27      0.00      0.00      0.00      1.02      0.00      0.00     89.67<br>08:53:01 PM       3      4.67      0.00      2.64      0.02      0.00      0.00      0.69      0.00      0.00     91.99<br>08:53:01 PM       4      3.67      0.00      2.17      0.17      0.00      0.00      0.41      0.00      0.00     93.59<br>08:53:01 PM       5      3.34      0.00      2.34      0.00      0.00      0.00      0.49      0.00      0.00     93.83<br>08:53:01 PM       6      3.34      0.00      2.53      0.00      0.00      0.00      0.34      0.00      0.00     93.79<br>08:53:01 PM       7      2.90      0.00      2.03      0.00      0.00      0.00      0.42      0.00      0.00     94.65<br>08:53:01 PM       8      2.47      0.00      1.67      0.00      0.00      0.00      0.24      0.00      0.00     95.63<br>08:53:01 PM       9      2.35      0.00      1.87      0.00      0.00      0.00      0.24      0.00      0.00     95.54<br>08:53:01 PM      10      2.42      0.00      2.97      0.02      0.00      0.00      1.63      0.00      0.00     92.95<br>08:53:01 PM      11      2.28      0.00      1.91      0.00      0.00      0.00      0.30      0.00      0.00     95.51<br>08:53:01 PM      12      2.58      0.00      1.90      0.00      0.00      0.00      0.32      0.00      0.00     95.20<br>08:53:01 PM      13      2.72      0.00      2.27      0.00      0.00      0.00      0.31      0.00      0.00     94.70<br>08:53:01 PM      14      2.20      0.00      1.83      0.00      0.00      0.00      0.27      0.00      0.00     95.70<br>08:53:01 PM      15      2.01      0.00      1.59      0.00      0.00      0.00      0.22      0.00      0.00     96.19<br>08:54:01 PM     all      5.55      0.00      2.05      0.01      0.00      0.00      0.70      0.00      0.00     91.69<br>08:54:01 PM       0      4.33      0.00      2.09      0.00      0.00      0.00      0.66      0.00      0.00     92.92<br>08:54:01 PM       1      4.10      0.00      1.98      0.00      0.00      0.00      0.62      0.00      0.00     93.30<br>08:54:01 PM       2      5.46      0.00      2.97      0.03      0.00      0.00      0.88      0.00      0.00     90.66<br>08:54:01 PM       3      4.31      0.00      2.09      0.00      0.00      0.00      0.57      0.00      0.00     93.02<br>08:54:01 PM       4      3.98      0.00      1.96      0.19      0.00      0.00      0.42      0.00      0.00     93.46<br>08:54:01 PM       5      3.54      0.00      1.93      0.00      0.00      0.00      0.46      0.00      0.00     94.08<br>08:54:01 PM       6      3.18      0.00      2.16      0.00      0.00      0.00      0.34      0.00      0.00     94.32<br>08:54:01 PM       7      3.19      0.00      1.79      0.00      0.00      0.00      0.47      0.00      0.00     94.54<br>08:54:01 PM       8      2.51      0.00      1.53      0.00      0.00      0.00      0.24      0.00      0.00     95.72<br>08:54:01 PM       9      2.43      0.00      1.68      0.00      0.00      0.00      0.20      0.00      0.00     95.69<br>08:54:01 PM      10     40.11      0.00      4.51      0.00      0.00      0.00      4.93      0.00      0.00     50.45<br>08:54:01 PM      11      2.19      0.00      1.50      0.00      0.00      0.00      0.30      0.00      0.00     96.01<br>08:54:01 PM      12      2.67      0.00      1.59      0.00      0.00      0.00      0.29      0.00      0.00     95.46<br>08:54:01 PM      13      2.59      0.00      1.86      0.00      0.00      0.00      0.34      0.00      0.00     95.22<br>08:54:01 PM      14      2.32      0.00      1.68      0.02      0.00      0.00      0.24      0.00      0.00     95.74<br>08:54:01 PM      15      2.07      0.00      1.47      0.00      0.00      0.00      0.20      0.00      0.00     96.26<br>08:54:01 PM     CPU      %usr     %nice      %sys   %iowait    %steal      %irq     %soft    %guest    %gnice     %idle<br>08:55:01 PM     all      6.85      0.00      1.09      0.01      0.00      0.00      0.42      0.00      0.00     91.64<br>08:55:01 PM       0      1.89      0.00      0.85      0.00      0.00      0.00      0.22      0.00      0.00     97.03<br>08:55:01 PM       1      1.44      0.00      0.85      0.00      0.00      0.00      0.18      0.00      0.00     97.52<br>08:55:01 PM       2      1.69      0.00      1.14      0.00      0.00      0.00      0.20      0.00      0.00     96.96<br>08:55:01 PM       3      1.57      0.00      0.87      0.00      0.00      0.00      0.20      0.00      0.00     97.35<br>08:55:01 PM       4      2.75      0.00      1.32      0.18      0.00      0.00      0.30      0.00      0.00     95.44<br>08:55:01 PM       5      2.25      0.00      1.04      0.00      0.00      0.00      0.27      0.00      0.00     96.43<br>08:55:01 PM       6      2.31      0.00      1.17      0.00      0.00      0.00      0.25      0.00      0.00     96.27<br>08:55:01 PM       7      2.45      0.00      1.04      0.00      0.00      0.00      0.28      0.00      0.00     96.23<br>08:55:01 PM       8      1.12      0.00      0.70      0.00      0.00      0.00      0.08      0.00      0.00     98.09<br>08:55:01 PM       9      1.06      0.00      0.89      0.00      0.00      0.00      0.08      0.00      0.00     97.97<br>08:55:01 PM      10     84.81      0.00      3.31      0.00      0.00      0.00      4.09      0.00      0.00      7.80<br>08:55:01 PM      11      0.99      0.00      0.80      0.00      0.00      0.00      0.07      0.00      0.00     98.14<br>08:55:01 PM      12      1.32      0.00      0.77      0.00      0.00      0.00      0.10      0.00      0.00     97.81<br>08:55:01 PM      13      1.33      0.00      1.06      0.02      0.00      0.00      0.15      0.00      0.00     97.45<br>08:55:01 PM      14      1.07      0.00      0.79      0.00      0.00      0.00      0.10      0.00      0.00     98.04<br>08:55:01 PM      15      1.17      0.00      0.74      0.00      0.00      0.00      0.07      0.00      0.00     98.02<br><br>09:54:01 AM kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty<br>08:50:01 PM 125039324   6345596      4.83      2160   3041324  55233228     20.80   1474964   2595344        84<br>08:51:01 PM 125039644   6345276      4.83      2160   3041384  55227864     20.79   1474520   2595336        80<br>08:52:01 PM 125028472   6356448      4.84      2160   3041472  55243672     20.80   1481520   2595348       108<br>08:53:01 PM 125009712   6375208      4.85      2160   3041540  55257756     20.80   1494452   2595340        76<br>08:54:01 PM 124982552   6402368      4.87      2160   3042004  55284388     20.81   1519996   2595764        76<br>08:55:01 PM 124714984   6669936      5.08      2160   3042068  55375640     20.85   1605500   2595772        80<br><br>09:54:01 AM   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked<br>08:50:01 PM         0       593      0.02      0.14      0.26         0<br>08:51:01 PM         0       586      0.01      0.11      0.25         0<br>08:52:01 PM         1       592      0.12      0.12      0.24         0<br>08:53:01 PM         1       594      0.89      0.34      0.31         0<br>08:54:01 PM         4       598      1.48      0.60      0.40         0<br>08:55:01 PM         2       602      1.11      0.65      0.43         0<br><br>&gt; 배치 1200건 (single thread) 8/27 16:12 ~ 17:23 10프로 사용<br>  23-12 = 11분<br>&gt; 배치 1200건 (multi thread) 8/27 18:23 ~ 19:28 10프로 사용<br>  28-23 = 5분<br>&gt; 배치 1600건 (single thread) 8/27 20:50 ~ 20:55 100프로 사용<br>  55-50-5분<br><br>분석 결과 시스템 자원 사용에 별다른 이상 점은 확인할 수 없었으며,<br>해당 시점에 한개의 CPU 의 사용율만이 증가되는 것을 확인하였습니다.<br>해당 현상은 애플리케이션의 처리 방법등에 관한 사항으로 보여집니다.<br><br>시스템 콜 분석은 아래 문서를 통해 수집이 가능합니다.<br>평상시 10퍼센트 사용시에 아래 작업을 수행하고 1분 가량 수집해주시고, 100퍼센트 사용시에 아래 작업을 수행하고 1분 가량 수집해서 보내주시면<br>해당 시점에 시스템 콜 사용량을 확인해보도록 하겠습니다.<br><br># perf record -a -g<br><br>https://access.redhat.com/solutions/386343<br><br>허나, 본 증상은 배치작업시에 프로그램 자체 로직 혹은 파일 IO 등에 따라 CPU 사용이 달라질 수도 있을 것으로 보입니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-08-28T07:41:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KSfMyIAL"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-28T07:31:37Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-28T07:31:37Z</b><br><br>참고적으로 SAP 기술번호는 403544입니다<br><br><publishedDate>2017-08-28T07:31:37Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KSejBIAT"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-28T06:31:59Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-28T06:31:59Z</b><br><br>PPMSCL01SL_170828_case.tar.gz으로 드롭박스에 업데이트 했습니다.<br>sosreport와 sar데이터를 압축하였습니다.<br><br>배치 1200건 (single thread) 8/27 16:12 ~ 17:23 10프로 사용<br>배치 1200건 (multi thread) 8/27 18:23 ~ 19:28 10프로 사용<br>배치 1600건 (single thread) 8/27 20:50 ~ 20:55 100프로 사용<br><br>약 400건의 배치작업이 더 발생한것으로 cpu사용률이 100프로가 된 이유와<br>100프로 사용량을 나타낸 산술방식이 무엇인지 말씀 부탁드립니다.<br><br>또한 제가 올려드린 파일을 현 케이스에 링크 부탁드립니다.<br>감사합니다.<br><br><publishedDate>2017-08-28T06:31:59Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KScemIAD"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-27T23:36:49Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-27T23:36:49Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>100건 처리시의 cpu 사용량과 200건 처리시의 cpu 사용량이 차이가 나는 시점의 sar 데이터와 sosreport를 올려주시면<br>추가적으로 시스템 자원 사용량에 대한 분석을 진행해보도록 하겠습니다.<br>예) 08:00 100건 처리시 cpu 사용량 10%<br>   08:20 200건 처리시 cpu 사용량 100%<br>   08:50 에 sosreport 수집<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-08-27T23:36:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KSOVTIA5"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-25T09:33:55Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-25T09:33:55Z</b><br><br>답변 감사합니다. 또 다른  한가지 질문있습니다.<br>어플리케이션에서 100건일때는 10프로의 cpu를 사용하는것으로 보이는데 <br>200건일 경우에 갑작스레 100프로의 사용률을 보이는 것으로 보입니다.<br>이에 sar나 top에서 보여지는 cpu사용률에 대한 계산 방식이 어떻게 되는지 설명 부탁드립니다.<br><br><publishedDate>2017-08-25T09:33:55Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KSM0tIAH"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-25T05:07:44Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-25T05:07:44Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>문의하신 방법은 제가 아는 한도내에서는 존재하지 않습니다.<br>병렬 처리(멀티 프로세싱)을 위해서는 멀티 쓰레드 혹은 멀티 프로세스 방식으로 프로그램이 제작되어야하며<br>자원 점유/연산을 위한 mutex, semaphore 등 락킹 관련 로직도 포함되어야합니다.<br><br>답변이 되셨으면 좋겠습니다. <br><br>[참고 문서]<br>멀티스레딩<br>https://ko.wikipedia.org/wiki/%EB%A9%80%ED%8B%B0%EC%8A%A4%EB%A0%88%EB%94%A9<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-08-25T05:07:44Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KSLvFIAX"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-25T04:54:54Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-25T04:54:54Z</b><br><br>어플리케이션이 개발할때 싱글프로세스로 개발한 환경을 멀티프로세스 방식으로 어플리케이션이 동작하도록 할수 있는 방법이 있나요?<br><br><publishedDate>2017-08-25T04:54:54Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KS4CiIAL"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-24T04:31:31Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-24T04:31:31Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>커널의 연산에 따라서, 여유있는 CPU 에 할당 받을 것으로 생각되며, 이는 시스템 상황에 따라서, 달라질 것으로 보입니다.<br>프로세스 기동시에 특정 CPU 를 할당 받아서 동작중이라면, 특별하게 context switch 를 하는 경우가 아니면, 꾸준하게 동일한 CPU 가 사용될 것으로 생각됩니다.<br><br>[테스트]<br><br>1. 일반 환경 테스트용 프로세스 기동 전<br>%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu1  :  1.0 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu2  :  1.0 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu3  :  2.0 us,  1.0 sy,  0.0 ni, 97.1 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu4  :  3.9 us,  1.0 sy,  0.0 ni, 95.1 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu5  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu6  :  3.0 us,  0.0 sy,  0.0 ni, 97.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu7  :  0.0 us,  1.0 sy,  0.0 ni, 99.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br><br>2. 테스트 프로세스 기동 시작<br>%Cpu4  :100.0 us,  0.0 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  -- 최초 시작<br><br>3. 테스트 프로세스 기동 중 일시 정지(suspend, Ctrl+z)<br>%Cpu0  :  5.1 us,  1.0 sy,  0.0 ni, 93.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu1  :  1.0 us,  1.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu2  :  4.0 us,  0.0 sy,  0.0 ni, 96.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu3  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu4  :  3.1 us,  0.0 sy,  0.0 ni, 96.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu5  :  2.0 us,  0.0 sy,  0.0 ni, 98.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu6  :  4.0 us,  2.0 sy,  0.0 ni, 93.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>%Cpu7  :  2.0 us,  1.0 sy,  0.0 ni, 97.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br><br>4. 테스트 프로세스 기동중 일시 정지 및 재개 여러번 반복 - 동일 cpu 인 경우도 있고, 다른 cpu 로 할당받는 경우도 있음.<br><br>%Cpu7  : 99.0 us,  1.0 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  -- 최초 시작<br>%Cpu1  :100.0 us,  0.0 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  -- 일시정지후 재개<br><br>5. 프로세스 종료 후 재 시작 및 일시정지 후 재개<br>%Cpu2  :100.0 us,  0.0 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  -- 최초 시작<br>%Cpu4  :100.0 us,  0.0 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st  --일시정지후 재개<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-08-24T04:31:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KS46BIAT"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-24T04:14:30Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-24T04:14:30Z</b><br><br>프로세스가 수행 될 때 여러개의 CPU 중 1개 CPU를 할당할때 랜덤으로 할당받는지?<br>아니면 특정 CPU를 할당받는지 궁금합니다. 답변 부탁드리겠습니다.<br><br><publishedDate>2017-08-24T04:14:30Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KS30KIAT"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-24T01:33:27Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-24T01:33:27Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>strace 에서는 recvfrom() writev() epoll_wait 함수의 사용등이 사용되고 있으며, 아래 통계를 확인하였습니다.<br>함수의 사용으로 보아 패킷 수신 후에 저장하고 대기하는 과정이 반복되고 있는 것으로 추정됩니다.<br><br>% time     seconds  usecs/call     calls    errors syscall<br>------ ----------- ----------- --------- --------- ----------------<br> 38.11    0.027677           1     30094           writev<br> 37.95    0.027560           0    106792           recvfrom<br> 23.78    0.017268         523        33           epoll_wait<br>  0.08    0.000058           1        66           write<br>  0.06    0.000045           1        33           close<br>  0.02    0.000017           1        33           accept<br>  0.00    0.000002           2         1           select<br>  0.00    0.000002           1         2           epoll_ctl<br>  0.00    0.000001           0        33           poll<br>------ ----------- ----------- --------- --------- ----------------<br>100.00    0.072630                137087           total<br><br>  Top CPU-using processes:<br>    USER      PID     %CPU  %MEM  VSZ-MiB  RSS-MiB  TTY     STAT  START  TIME    COMMAND<br>    ppmadm    74175   62.5  1.4   5793     1924     ?       Ssl   Aug23  90:36   en.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>    ppmadm    74176   18.2  0.0   147      68       ?       Ss    Aug23  26:29   gw.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS -no_abap &lt;&lt;---------<br>    ppmadm    74174   0.1   0.0   96       34       ?       Ss    Aug23  0:12    ms.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br><br><br>[ps alxwww 결과]<br>1 20473  74161      1  20   0  55764  2728 wait   Ss   ?          0:00 sapstart pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>4     0  74169  70086  20   0 292224 61920 pipe_w S+   pts/14     0:03 /usr/bin/python /sbin/sosreport<br>0 20473  74174  74161  20   0  97952 35184 ep_pol Ss   ?          0:12 ms.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>0 20473  74175  74161  20   0 5932192 1970232 hrtime Ssl ?       90:37 en.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>0 20473  74176  74161  20   0 150420 69372 -      Ss   ?         26:29 gw.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS -no_abap &lt;&lt;--------<br>1     0  74476      2  20   0      0     0 worker S    ?          0:00 [kworker/2:0]<br><br>[ps auxwwwm 결과]<br>ppmadm    74161  0.0  0.0  55764  2728 ?        -    Aug23   0:00 sapstart pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>ppmadm        -  0.0    -      -     - -        Ss   Aug23   0:00 -<br>root      74169  9.0  0.0 292224 61924 pts/14   -    00:44   0:03 /usr/bin/python /sbin/sosreport<br>root          -  9.0    -      -     - -        S+   00:44   0:03 -<br><br>+------ ms.sapPPM_ASCS50 프로세스는 싱글 프로세스 기반으로 제작된 애플리케이션으로 보여지며 1개의 프로세스만 동작 중인 것으로 보입니다.<br>+-ppmadm    74174  0.1  0.0  97952 35184 ?        -    Aug23   0:12 ms.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>+-ppmadm        -  0.1    -      -     - -        Ss   Aug23   0:12 -<br><br>+------ en.sapPPM_ASCS50 프로세스는 멀티 스레드 기반으로 제작된 애플리케이션으로 보여지며 1개의 프로세스에 10개의 쓰레드가 동작 중인 것으로 보입니다.<br>+- ppmadm    74175 62.5  1.4 5932192 1970232 ?     -    Aug23  90:37 en.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS<br>|  ppmadm        -  0.0    -      -     - -        Ssl  Aug23   0:02 -<br>|  ppmadm        -  0.0    -      -     - -        Ssl  Aug23   0:00 -<br>|  ppmadm        - 14.1    -      -     - -        Rsl  Aug23  20:30 -<br>|  ppmadm        -  0.0    -      -     - -        Ssl  Aug23   0:00 -<br>|  ppmadm        -  7.2    -      -     - -        Ssl  Aug23  10:25 -<br>|  ppmadm        -  7.2    -      -     - -        Ssl  Aug23  10:26 -<br>|  ppmadm        -  7.1    -      -     - -        Ssl  Aug23  10:18 -<br>|  ppmadm        -  6.9    -      -     - -        Ssl  Aug23  10:00 -<br>|  ppmadm        - 19.9    -      -     - -        Rsl  Aug23  28:53 -<br>+- ppmadm        -  0.0    -      -     - -        Ssl  Aug23   0:00 -<br><br><br>+------ gw.sapPPM_ASCS50 프로세스는 싱글 프로세스 기반으로 제작된 애플리케이션으로 보여지며 1개의 프로세스만 동작 중인 것으로 보입니다.<br>+- ppmadm    74176 18.2  0.0 150420 69372 ?        -    Aug23  26:29 gw.sapPPM_ASCS50 pf=/usr/sap/PPM/SYS/profile/PPM_ASCS50_PPMSSCS -no_abap &lt;&lt;--------<br>+- ppmadm        - 18.2    -      -     - -        Rs   Aug23  26:29 -<br><br>단일 프로세스는 단일 CPU 를 사용하게되며, 단일 프로세스가 다중 프로세스를 사용하게 하려면, 멀티 스레드 기반으로 제작되어야 할 것입니다.<br>혹은, 해당 애플리케이션 설정에 다중 스레드로 동작하는 설정이 있는지도 제조사에 확인해 볼 필요가 있습니다.<br>따라서, 고객께서 문의하신 서버에서 특정 프로세스가 수행이될 때 여러개의 CPU 중 1개 CPU만 gw.sapPPM_ASCS50 에 사용되는 현상은 지극히 정상적인 현상인 것으로 보입니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-08-24T01:33:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>