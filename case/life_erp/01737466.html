======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-11-10T00:12:29Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-01-09T11:04:59Z</b><br><b>id : 500A000000VmB6gIAF</b><br>======================<br><br><b><font size=15>
제목  : [BUG] Pacemaker Cluster 의 Stonith Monitor 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>이번 프로젝트 가용성 테스트 중 이상한 점이 발견되어 문의 드립니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>프로젝트의 클러스터 환경은 VMWare 기반과 HP DL380Gen9 물리머신 환경으로 나눠지는데요,<br><br>가상화 환경에서는 fence_vmware_soap 이 주기적으로 vCenter 와 통신하여 Stonith Health 를 체크하여 문제가 있을 시 Error 를 감지합니다.<br><br>하지만, 어제 테스트 한 HP 물리 머신의 경우 Fence Network 를 모두 절체 하여도 Stonith Health 를 감지 못하고 계속해서 status 가 정상으로 나오는 문제를 발견하였습니다.<br><br>(서버 쪽 iLO 와 통신하는 물리적 케이블을 모두 절체 하였습니다.)<br><br>물리 시스템은 Stonith 장치는 fence_ipmi (iLO) 를 이용하여 구성하였습니다.<br><br>이 문제에 대해 확인 부탁 드립니다.<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>관련 물리머신 기반 클러스터 sosreport 를 아래와 같은 파일명으로 dropbox.redhat.com 에 업로드 하였습니다.<br><br>sosreport-PPMSCL01SL-20161109215337.tar.xz<br>sosreport-PPMSCL02SL-20161109215348.tar.xz<br>sosreport-LOG-PPMSCL01SL-20161109215337.tar.gz<br>sosreport-LOG-PPMSCL02SL-20161109215348.tar.gz<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Defect / Bug</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 4 (Low)</b><br>======================<br><comment id="a0aA000000IUMHnIAP"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-12-12T06:53:54Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-12-12T06:53:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>버그 1397889 &quot;false-positive monitoring operation result of fence_ipmilan stonith resource&quot;<br>현재 픽스 된 것으로 보이며 fence-agents-4.0.11-47.el7_3.2 버전으로 업데이트 하시고 테스트 진행 부탁<br>드립니다. <br><br>RHBA-2016:2930: https://rhn.redhat.com/errata/RHBA-2016-2930.html<br><br>Download Link: <br>https://access.redhat.com/downloads/content/rhel---7/x86_64/2456/fence-agents-all/4.0.11-47.el7_3.2/x86_64/fd431d51/package<br><br>테스트 해보시고 이슈가 해결 되었는지 결과를 공유 부탁드립니다. <br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2016-12-12T06:53:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ICdObIAL"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-11-14T06:17:01Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-11-14T06:17:00Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>fence_ipmilan 에서 지정 한 IP로 통신 하지 못해도 fencing monitor 동작이 성공 되는 <br>이슈는 fence-agetns의 버그 Bug 1390915 로 인하여 발생 한 것으로 확인 되었습니다. <br><br>[Bug 1390915] false-positive monitoring operation result of fence_ipmilan stonith resource<br>- https://bugzilla.redhat.com/show_bug.cgi?id=1390915<br> <br><br>현재 해당 버그의 패치가 나온 상태이며 upstream 에서 이미 픽스 되었다고 합니다. <br>레드햇에서 현재 해당 패치에 대해 테스트 하고 있으며 관련 하여 새로운 소식이 <br>있으면 바로 공유 드리도록 하겠습니다. <br>======================<br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2016-11-14T06:17:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ICKxkIAH"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-11-11T02:19:58Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-11-11T02:19:58Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>지금까지 sosreport 에서 확인 된 내용을 아래와 같이 공유 해 드립니다. <br><br>1. fencing 망을 절체 하신 시점을 아래와 같이 확인 되었습니다. <br><br>Nov  9 18:28:09 PPMSCL02SL kernel: pcieport 0000:80:01.0: ens6f3: Link is down<br>Nov  9 18:28:09 PPMSCL02SL kernel: bond3: link status definitely down for interface ens6f3, disabling it<br>Nov  9 18:28:10 PPMSCL02SL hp-ams[2455]: CRITICAL: Network Adapter Link Down (Chassis 6, Slot 6, Port 4)<br>Nov  9 18:28:15 PPMSCL02SL kernel: pcieport 0000:00:03.0: ens3f2: Link is down<br>Nov  9 18:28:15 PPMSCL02SL kernel: bond3: link status definitely down for interface ens3f2, disabling it<br>Nov  9 18:28:15 PPMSCL02SL kernel: bond3: now running without any active interface!<br><br><br>2. 하지만 pacemaker 로그에서 아래와 같은 메시지만 발생 하고 fencing 망 절체 된 것을 <br>   인식 하지 못했습니다. 즉 monitor 동작 대신 action 값이 metadata로 되었습니다. <br><br>Nov 09 18:28:48 [30596] PPMSCL02SL stonith-ng:     info: make_args:     Substituting action 'metadata' for requested operation 'monitor'<br><br><br>fence_ipmilan 의 man 페이지를 보시면 monitor 과 metadata의 차이점은 아래와 <br>같습니다. <br><br>~~~<br>monitor        Check the health of fence device<br>metadata       Display the XML metadata describing this resource.<br>~~~<br><br>즉 action이 metadata로 변경 되었으니 fencing 망 절체 되어도 에러가 발생 하지 않았습니다. <br><br><br>[Action Plan]<br><br>1. fence_ipmilan상태 확인시 monitor 대신 metadata 확인을 하는게 정상인지 확인 (Red Hat)<br>2. 만약 정상이 아니라면 monitor action 으로 변경 할수 있는지 확인 (Red Hat)<br>======================<br>관련 하여 업데이트 사항이 있으면 바로 공유 드리도록 하겠습니다. <br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2016-11-11T02:19:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>이번 프로젝트 가용성 테스트 중 이상한 점이 발견되어 문의 드립니다.</issue><environment>프로젝트의 클러스터 환경은 VMWare 기반과 HP DL380Gen9 물리머신 환경으로 나눠지는데요,<br><br>가상화 환경에서는 fence_vmware_soap 이 주기적으로 vCenter 와 통신하여 Stonith Health 를 체크하여 문제가 있을 시 Error 를 감지합니다.<br><br>하지만, 어제 테스트 한 HP 물리 머신의 경우 Fence Network 를 모두 절체 하여도 Stonith Health 를 감지 못하고 계속해서 status 가 정상으로 나오는 문제를 발견하였습니다.<br><br>(서버 쪽 iLO 와 통신하는 물리적 케이블을 모두 절체 하였습니다.)<br><br>물리 시스템은 Stonith 장치는 fence_ipmi (iLO) 를 이용하여 구성하였습니다.<br><br>이 문제에 대해 확인 부탁 드립니다.</environment><timeFramesAndUrgency>관련 물리머신 기반 클러스터 sosreport 를 아래와 같은 파일명으로 dropbox.redhat.com 에 업로드 하였습니다.<br><br>sosreport-PPMSCL01SL-20161109215337.tar.xz<br>sosreport-PPMSCL02SL-20161109215348.tar.xz<br>sosreport-LOG-PPMSCL01SL-20161109215337.tar.gz<br>sosreport-LOG-PPMSCL02SL-20161109215348.tar.gz</timeFramesAndUrgency><cep>false</cep></case>