======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2017-09-25T02:56:01Z</b><br><b>마지막 답변자 : Jay Shin</b><br><b>마지막 수정 일자 : 2017-09-29T06:28:56Z</b><br><b>id : 500A000000YQyDWIA1</b><br>======================<br><br><b><font size=15>
제목  : DBKMML01SL Kernel Panic 의 건
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>2017-09-24 11:22:10 경 Kernel 에서 알 수 없는 panic 이 발생하여 vmcore 가 생성되었습니다.<br><br>해당 서버의 용도는 Backup 이며, 시스템에 NetBackup 이 설치되어 있는 시스템 입니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>관련 문제를 찾다보니 아래 redhat solutions 페이지를 찾게 되었습니다.<br><br>https://access.redhat.com/solutions/2647381<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>현재 사용중인 Kernel 의 버전이 EUS 3.10.0-327.53.1.el7.x86_64 인데요,<br><br>위 솔루션 페이지를 보니 kernel-3.10.0-327.55.1.el7.x86_64 이상으로 업데이트 해야 하는 것으로 확인이 되고 있습니다.<br><br>정확하게 이러한 문제가 발생하는 원인과, Package Update 외 다른 workaround 가 있는지에 대해 확인 부탁드립니다.<br><br>감사합니다.<br><br>해결 기간이나 업무에 미치는 영향에 대한 정보를 제공해 주시겠습니까?<br><br>관련 데이터를 dropbox.redhat.com/incoming 에 아래와 같은 파일로 업로드 하였습니다.<br><br>DBKMML01SL_vmcore.zip<br>sosreport-DBKMML01SL-20170925114057.tar.xz<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.3</b><br><b>타입  : Defect / Bug</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>DBKMML01SL</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000KduPAIAZ"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-09-29T06:28:53Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-09-29T06:28:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>본 기술 문의의 상태를 처리완료 상태로 변경하고자 합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 본 기술 문의를 *재개*하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2017-09-29T06:28:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KZADsIAP"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-09-27T07:20:46Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-09-27T07:20:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin<br>Technical Support Engineer<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2017-09-27T07:20:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KYbfDIAT"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-09-25T05:51:12Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-09-25T05:51:12Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>그렇다면, Stack Guard 문제를 해결한 3.10.0-327.55.3.el7 혹은 <br>최신 버전인 3.10.0-327.59.2.el7 를 적용하시면 되겠습니다.<br>https://rhn.redhat.com/errata/RHSA-2017-2706.html<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-09-25T05:51:12Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KYbQwIAL"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2017-09-25T05:23:07Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2017-09-25T05:23:07Z</b><br><br>안녕하세요.<br><br>올해 6월 JVM Stack Guard flaw 비정상 종료 관련 케이스를 오픈 하였었는데요,<br>(https://access.redhat.com/support/cases/#/case/01879711)<br><br>3.10.0-327.55.2 Kernel 을 적용하려 했으나, JVM 비정상 문제 이슈로 3.10.0-327.53.1 을 적용하였습니다.<br><br>JVM 관련 https://access.redhat.com/solutions/3091371 페이지를 확인 해 보니,<br><br>해결된 버전이 For RHEL 7.2 : Upgrade to kernel-3.10.0-327.55.3.el7 from Errata RHBA-2017:1711 or later 로 확인이 되는데요, <br><br>그렇다면 이번 Panic 이슈와 JVM 이슈가 모두 해결 된 버전은 kernel-3.10.0-327.55.3.el7 이상으로 적용하면 되는지요?<br><br>확인 부탁 드립니다. 감사합니다.<br><br><publishedDate>2017-09-25T05:23:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KYaqoIAD"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-09-25T03:45:55Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-09-25T03:45:55Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>보내주신 vmcore 를 분석한 결과, 앞서 확인하신 kbase 문서에서 설명하는 커널 버그에 의한 시스템 패닉이 확인됩니다.<br><br>Kernel panic or soft lockup in netlink_compare in Red Hat Enterprise Linux 7 <br>https://access.redhat.com/solutions/2647381<br><br>이미 다른 고객에서도 동일한 문제가 발생되어, 당시에 EUS 고객에 대한 hotfix 가 제공되었으며, 이후 정식 출시된 바 있습니다.<br>버그질라 및 kbase 를 확인한 결과 커널 코드 변경 패치가 적용된 3.10.0-327.55.1.el7 로 업그레이드 혹은 커널 다운그레이드를 제외하고는<br>본 문제를 회피하기 위한 워크어라운드가 존재하지 않습니다.<br><br>고객과 협의하여 커널 업그레이드가 가능하실지 고려해보시기 바랍니다.<br><br>아래는 분석 결과입니다.<br><br>      KERNEL: /cores/retrace/repos/kernel/x86_64/usr/lib/debug/lib/modules/3.10.0-327.53.1.el7.x86_64/vmlinux<br>    DUMPFILE: /cores/retrace/tasks/889600451/crash/vmcore  [PARTIAL DUMP]<br>        CPUS: 16<br>        DATE: Mon Sep 25 11:19:39 2017<br>      UPTIME: 69 days, 14:51:15<br>LOAD AVERAGE: 0.00, 0.01, 0.05<br>       TASKS: 803<br>    NODENAME: DBKMML01SL<br>     RELEASE: 3.10.0-327.53.1.el7.x86_64<br>     VERSION: #1 SMP Tue Mar 14 10:49:09 EDT 2017<br>     MACHINE: x86_64  (3495 Mhz)<br>      MEMORY: 127.9 GB<br>       PANIC: &quot;general protection fault: 0000 [#1] SMP &quot;<br>         PID: 1924<br>     COMMAND: &quot;bpcompatd&quot;<br>        TASK: ffff881c22cd4500  [THREAD_INFO: ffff8819bd3c8000]<br>         CPU: 4<br>       STATE: TASK_RUNNING (PANIC)<br><br>crash&gt; bt<br>PID: 1924   TASK: ffff881c22cd4500  CPU: 4   COMMAND: &quot;bpcompatd&quot;<br> #0 [ffff8819bd3cb828] machine_kexec at ffffffff81051e9b<br> #1 [ffff8819bd3cb888] crash_kexec at ffffffff810f2a42<br> #2 [ffff8819bd3cb958] oops_end at ffffffff8163fb08<br> #3 [ffff8819bd3cb980] die at ffffffff8101859b<br> #4 [ffff8819bd3cb9b0] do_general_protection at ffffffff8163f3fe<br> #5 [ffff8819bd3cb9e0] general_protection at ffffffff8163eca8<br>    [exception RIP: netlink_compare+11]<br>    RIP: ffffffff8155633b  RSP: ffff8819bd3cba98  RFLAGS: 00010246<br>    RAX: 0000000000000000  RBX: 4f5f4c5331305544  RCX: 00000000b5827e58<br>    RDX: 0000000000000784  RSI: ffff8819bd3cbae8  RDI: 4f5f4c53313050bc<br>    RBP: ffff8819bd3cbad0   R8: ffff8819bd3cbae4   R9: ffff881fff3195e0<br>    R10: ffffffff81518717  R11: ffffea0056aec280  R12: ffff881fd2952000<br>    R13: ffff8819bd3cbae8  R14: ffffffff81556330  R15: ffff881f338b1bc0<br>    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018<br> #6 [ffff8819bd3cbaa0] rhashtable_lookup_compare at ffffffff81308490<br> #7 [ffff8819bd3cbad8] netlink_lookup at ffffffff81556c6e<br> #8 [ffff8819bd3cbb08] netlink_getsockbyportid at ffffffff8155800f<br> #9 [ffff8819bd3cbb20] netlink_alloc_skb at ffffffff8155807f<br>#10 [ffff8819bd3cbb58] netlink_dump at ffffffff81558303<br>#11 [ffff8819bd3cbb88] netlink_recvmsg at ffffffff81558745<br>#12 [ffff8819bd3cbc18] sock_recvmsg at ffffffff81511d6f<br>#13 [ffff8819bd3cbd88] ___sys_recvmsg at ffffffff8151207e<br>#14 [ffff8819bd3cbf00] __sys_recvmsg at ffffffff81512c31<br>#15 [ffff8819bd3cbf70] sys_recvmsg at ffffffff81512c82<br>#16 [ffff8819bd3cbf80] system_call_fastpath at ffffffff81647209<br>    RIP: 00007f21f7e491e0  RSP: 00007ffe9c17dc10  RFLAGS: 00000217<br>    RAX: 000000000000002f  RBX: ffffffff81647209  RCX: ffffffffffffffff<br>    RDX: 0000000000000000  RSI: 00007ffe9c17dbb0  RDI: 0000000000000004<br>    RBP: 00007ffe9c17dc20   R8: 00007ffe9c17db70   R9: 000000000000000c<br>    R10: 0000000000000000  R11: 0000000000000246  R12: ffffffff81512c82<br>    R13: ffff8819bd3cbf78  R14: 0000000000000784  R15: 00007ffe9c17dbb0<br>    ORIG_RAX: 000000000000002f  CS: 0033  SS: 002b<br><br>crash&gt; whatis netlink_compare<br>bool netlink_compare(void *, void *);<br>crash&gt; dis -rl ffffffff8155633b | tail<br>/usr/src/debug/kernel-3.10.0-327.53.1.el7/linux-3.10.0-327.53.1.el7.x86_64/net/netlink/af_netlink.c: 1022<br>0xffffffff81556330 &lt;netlink_compare&gt;:<br>nopl   0x0(%rax,%rax,1) [FTRACE NOP]<br>0xffffffff81556335 &lt;netlink_compare+5&gt;:<br>push   %rbp<br>0xffffffff81556336 &lt;netlink_compare+6&gt;:<br>xor    %eax,%eax<br>/usr/src/debug/kernel-3.10.0-327.53.1.el7/linux-3.10.0-327.53.1.el7.x86_64/net/netlink/af_netlink.c: 1026<br>0xffffffff81556338 &lt;netlink_compare+8&gt;:<br>mov    0x8(%rsi),%edx   &lt;&lt;-- x-&gt;portid <br>0xffffffff8155633b &lt;netlink_compare+11&gt;:<br>cmp    %edx,0x300(%rdi) &lt;&lt;-- nlk_sk(sk)-&gt;portid<br><br>crash&gt; struct -o netlink_sock.portid<br>struct netlink_sock {<br>  [0x300] u32 portid;<br>}<br><br>crash&gt; px 0xffff8819bd3cbae8+0x08<br>$3 = 0xffff8819bd3cbaf0<br>crash&gt; rd 0xffff8819bd3cbaf0<br>ffff8819bd3cbaf0:  ffff881500000784                    ........<br><br>crash&gt; netlink_compare_arg.portid 0xffff8819bd3cbae8<br>  portid = 0x784<br><br>RDX: 0000000000000784<br><br><br>RDI 주소가 올바르지 않아 시스템이 크래시되었습니다.<br><br>RDI: 4f5f4c53313050bc<br><br>crash&gt; dis -rl ffffffff81308490 | tail<br>0xffffffff81308478 &lt;rhashtable_lookup_compare+56&gt;:<br>mov    0x8(%rbx,%rax,8),%rbx<br>0xffffffff8130847d &lt;rhashtable_lookup_compare+61&gt;:<br>test   %rbx,%rbx<br>0xffffffff81308480 &lt;rhashtable_lookup_compare+64&gt;:<br>je     0xffffffff8130849c &lt;rhashtable_lookup_compare+92&gt;<br>/usr/src/debug/kernel-3.10.0-327.53.1.el7/linux-3.10.0-327.53.1.el7.x86_64/lib/rhashtable.c: 42<br>0xffffffff81308482 &lt;rhashtable_lookup_compare+66&gt;:<br>mov    %rbx,%rdi<br>0xffffffff81308485 &lt;rhashtable_lookup_compare+69&gt;:<br>sub    0x30(%r12),%rdi &lt;&lt;---<br>/usr/src/debug/kernel-3.10.0-327.53.1.el7/linux-3.10.0-327.53.1.el7.x86_64/lib/rhashtable.c: 443<br>0xffffffff8130848a &lt;rhashtable_lookup_compare+74&gt;:<br>mov    %r13,%rsi<br>0xffffffff8130848d &lt;rhashtable_lookup_compare+77&gt;:<br>callq  *%r14<br>0xffffffff81308490 &lt;rhashtable_lookup_compare+80&gt;:<br>test   %al,%al<br><br>RBX: 4f5f4c5331305544 R12: ffff881fd2952000<br><br>crash&gt; px 0xffff881fd2952000-0x30<br>$2 = 0xffff881fd2951fd0<br>crash&gt; rd 0xffff881fd2951fd0<br>ffff881fd2951fd0:  0000000000000000                    ........<br><br><br>434 void *rhashtable_lookup_compare(const struct rhashtable *ht, const void *key    ,<br>435                                 bool (*compare)(void *, void *), void *arg)<br>436 {<br>437         const struct bucket_table *tbl = rht_dereference_rcu(ht-&gt;tbl, ht);<br>438         struct rhash_head *he;<br>439         u32 hash;<br>440 <br>441         hash = key_hashfn(ht, key, ht-&gt;p.key_len);<br>442         rht_for_each_rcu(he, tbl-&gt;buckets[hash], ht) {<br>443                 if (!compare(rht_obj(ht, he), arg))<br>444                         continue;<br>445                 return (void *) he - ht-&gt;p.head_offset; &lt;&lt;-------------------<br>446         }<br>447 <br>448         return NULL;<br>449 }<br><br>1021 static bool netlink_compare(void *ptr, void *arg)<br>1022 {<br>1023         struct netlink_compare_arg *x = arg;<br>1024         struct sock *sk = ptr;<br>1025 <br>1026         return nlk_sk(sk)-&gt;portid == x-&gt;portid &amp;&amp;  &lt;&lt;----------------<br>1027                net_eq(sock_net(sk), x-&gt;net);<br>1028 }<br><br>crash&gt; rhashtable 0xffff881fd2952000<br>struct rhashtable {<br>  tbl = 0xffff881f338b1bc0, <br>  nelems = 7, <br>  shift = 4, <br>  p = {<br>    nelem_hint = 0, <br>    key_len = 4, <br>    key_offset = 768, <br>    head_offset = 1160, <br>    hash_rnd = 288509522, <br>    max_shift = 16, <br>    min_shift = 2, <br>    hashfn = 0xffffffff815560d0 &lt;jhash&gt;, <br>    obj_hashfn = 0x0, <br>    grow_decision = 0xffffffff813083f0 &lt;rht_grow_above_75&gt;, <br>    shrink_decision = 0xffffffff81308410 &lt;rht_shrink_below_30&gt;, <br>    mutex_is_held = 0xffffffff81556220 &lt;lockdep_nl_sk_hash_is_held&gt;<br>  }<br>}<br><br>crash&gt; rhashtable.tbl 0xffff881fd2952000<br>  tbl = 0xffff881f338b1bc0<br><br>crash&gt; bucket_table 0xffff881f338b1bc0<br>struct bucket_table {<br>  size = 16, <br>  buckets = 0xffff881f338b1bc8<br>}<br><br>crash&gt; struct -o netlink_sock.portid<br>struct netlink_sock {<br>  [0x300] u32 portid;<br>}<br><br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-09-25T03:45:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>2017-09-24 11:22:10 경 Kernel 에서 알 수 없는 panic 이 발생하여 vmcore 가 생성되었습니다.<br><br>해당 서버의 용도는 Backup 이며, 시스템에 NetBackup 이 설치되어 있는 시스템 입니다.</issue><environment>관련 문제를 찾다보니 아래 redhat solutions 페이지를 찾게 되었습니다.<br><br>https://access.redhat.com/solutions/2647381</environment><periodicityOfIssue>현재 사용중인 Kernel 의 버전이 EUS 3.10.0-327.53.1.el7.x86_64 인데요,<br><br>위 솔루션 페이지를 보니 kernel-3.10.0-327.55.1.el7.x86_64 이상으로 업데이트 해야 하는 것으로 확인이 되고 있습니다.<br><br>정확하게 이러한 문제가 발생하는 원인과, Package Update 외 다른 workaround 가 있는지에 대해 확인 부탁드립니다.<br><br>감사합니다.</periodicityOfIssue><timeFramesAndUrgency>관련 데이터를 dropbox.redhat.com/incoming 에 아래와 같은 파일로 업로드 하였습니다.<br><br>DBKMML01SL_vmcore.zip<br>sosreport-DBKMML01SL-20170925114057.tar.xz</timeFramesAndUrgency><cep>false</cep></case>