======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-01-26T13:25:52Z</b><br><b>마지막 답변자 : JINKOO HAN</b><br><b>마지막 수정 일자 : 2016-03-04T09:11:04Z</b><br><b>id : 500A000000TR06NIAT</b><br>======================<br><br><b><font size=15>
제목  : [OpenTEXT] 품질계 VMWare 환경 RHEL6.6 OOM 상황에 따른 시스템 Hang 상태 및 vmcore 생성 실패 원인 분석의 건
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>작년에 구축했던 품질계 OpenTEXT 시스템 (VMWare 기반 RHEL6.6) 에 Out of Memory 상황이 발생하여 시스템 Hang 상태가 발생하였습니다.<br><br>VMWare CLI 에서 NMI Signal 을 발생시켜 Kdump 로 진입을 하였으나, 초기 덤프 생성에서 Kdump Kernel 마저 Panic 상태로 빠져 덤프수집에 실패하였습니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>/var/log/messages  파일의 최근 부팅 기록 시점 뒤 시간을 보니 Jan 25 18:42:01 부터 이미 시스템에 문제가 있었던 것 같습니다.<br><br>재부팅 후 makedumpfile 명령을 이용하여 vmcore 파일을 수집하였으나, 정상적인 코어 파일인지는 불분명 한 상황입니다.<br><br>덤프 파일은 dropbox.redhat.com/incoming 에 현재 생성되는 케이스 번호로 업로드 하겠습니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.6</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000GciRQIAZ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-03-04T09:11:02Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-03-04T09:11:01Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스는 추가 업데이트가 없어서 케이스를 &quot;Close&quot;하도록 하겠습니다.<br><br>추가 문의 사항이 있으시면 케이스를 &quot;re0open&quot;하셔도 되며, 새로운 문의사항이 있으시면 새로운 케이스를 오픈하시면 해당 케이스를 통해서 지원하도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-03-04T09:11:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ga7u0IAB"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-24T02:02:40Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-24T02:02:40Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스와 관련되어 추가 문의사항이 있으시면 케이스에 업데이트 바랍니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-02-24T02:02:40Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GXqzTIAT"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-15T04:07:27Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-15T04:07:27Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>vmballoon에 대한 자세한 내용은 VMware 측에 문의하시는 것이 더 자세한 답변을 받으실 수 있으십니다.<br><br><br>일단 제가 알고 있는 것을 기반으로 설명을 드리면,<br>balloon은 guest에서 host로 메모리를 넘겨주기 위해서 동작하는 Driver로써 메모리를 hypervisor(host)를 위해서 할당할 수 있는 역할을 하는 것으로 알고 있습니다.<br><br>또한, 해당 ballon 기능은 기본적으로 메모리를 할당하기 위한 목표(target)이 있는 것으로, <br><br>아래와 같이 해당 시스템은 baloon에서 메모리를 37GB 정도 현재 사용중에 있으며, target은 51GB로써 메모리를 추가적으로 14GB 더 확보해야 하는 상태를 가지고 있었던 것으로 이해하시면 됩니다.<br><br>36.58 GiB allocated in balloon<br>50.91 GiB was the target to allocate<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-15T04:07:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GXbO5IAL"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2016-02-15T02:25:19Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2016-02-15T02:25:18Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>OPENTEXT 서버의 hang 현상 관련 분석 내용은 확인하였습니다.<br><br>확인 중에 한가지 문의드릴 점은<br><br>아래 vmballon의 size 관련 분석 내역 중 size(allocate)와 target이 어떤 것을 의미하는 것인지에 대해서 문의드리려고 합니다.<br><br>crash&gt; vmballoon.size,target ffffffffa014d600<br>  size = 9590603<br>  target = 13346743<br>  <br>crash&gt; !bc -q<br>scale=2<br>9590603*4/2^20<br>36.58<br>13346743*4/2^20<br>50.91<br><br>36.58 GiB allocated in balloon<br>50.91 GiB was the target to allocate<br><br><publishedDate>2016-02-15T02:25:18Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GXKZeIAP"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-12T01:58:42Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-12T01:58:42Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>저희 커널분야의 전문 엔지니어(Daniel)로 부터의 본 이슈에 대한 업데이트 내용을 정리하여 드립니다.<br><br>우선 해당 시스템은 말씀하셨던 것 처럼, 80G의 메모리 시스템의 메모리를 모두 점유하는 상황이 발생하게 되었고 그로 인하여 OOM(Out of Memory)가 발생하게 되었습니다.<br><br>--------------------------------------------------------------------------<br>      UPTIME: 6 days, 05:07:12    <br>LOAD AVERAGE: 169.92, 169.75, 170.19    &lt;--- high load<br>       TASKS: 513<br>    NODENAME: SLQDOCAL01<br>     RELEASE: 2.6.32-504.23.4.el6.x86_64<br><br>crash&gt; kmem -i<br>                 PAGES        TOTAL      PERCENTAGE<br>    TOTAL MEM  20533451      78.3 GB         ----<br>         FREE    88814     346.9 MB    0% of TOTAL MEM<br>         USED  20444637        78 GB   99% of TOTAL MEM     &lt;--- fully utilized<br>       SHARED      111       444 KB    0% of TOTAL MEM<br>      BUFFERS      108       432 KB    0% of TOTAL MEM<br>       CACHED        0            0    0% of TOTAL MEM<br>         SLAB    33825     132.1 MB    0% of TOTAL MEM<br><br>   TOTAL SWAP  4194303        16 GB         ----<br>    SWAP USED   410592       1.6 GB    9% of TOTAL SWAP<br>    SWAP FREE  3783711      14.4 GB   90% of TOTAL SWAP<br><br> COMMIT LIMIT  14461028      55.2 GB         ----<br>    COMMITTED  1758332       6.7 GB   12% of TOTAL LIMIT<br>--------------------------------------------------------------------------<br><br><br>그래서 가장 메모리를 많이 찾이하고 있는 서을 확인해보면,<br><br>보시는 것처럼 vmballon이 현재 36GB를 사용하고 있고 할당을 50G까지를 target을 하고 있습니다.<br><br><br>36.58 GiB allocated in balloon<br>50.91 GiB was the target to allocate<br><br>crash&gt; bt 1549<br>PID: 1549   TASK: ffff88141a34c040  CPU: 0   COMMAND: &quot;vmmemctl&quot;<br> #0 [ffff88141a98db10] schedule at ffffffff815299d0<br> #1 [ffff88141a98dbe8] schedule_timeout at ffffffff8152a8a2<br> #2 [ffff88141a98dc98] schedule_timeout_uninterruptible at ffffffff8152aa0e<br> #3 [ffff88141a98dca8] __alloc_pages_nodemask at ffffffff8113463f<br> #4 [ffff88141a98dde8] alloc_pages_current at ffffffff8116c9aa<br> #5 [ffff88141a98de18] OS_ReservedPageAlloc at ffffffffa01e27b4 [vmmemctl]<br> #6 [ffff88141a98de28] Balloon_QueryAndExecute at ffffffffa01e33a5 [vmmemctl]<br> #7 [ffff88141a98de88] init_module at ffffffffa01e2a05 [vmmemctl]<br> #8 [ffff88141a98dee8] kthread at ffffffff8109e78e<br> #9 [ffff88141a98df48] kernel_thread at ffffffff8100c28a<br><br><br>해당 bmballon은 vmmemctl에서 수행되는 것으로 해당 vmmemctl에 관련된 VMware 쪽으로 해당 부분의 분석을 요청하시고 패치여부를 확인하여 업데이트 하시기 바랍니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-02-12T01:58:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GXKBmIAP"><br>======================<br><b>생성계정 : Kwon, Daniel</b><br><b>생성날짜 : 2016-02-12T00:53:09Z</b><br><b>마지막 답변자 : Kwon, Daniel</b><br><b>마지막 수정 일자 : 2016-02-12T00:53:09Z</b><br><br>Hi,<br><br>This is Daniel Kwon from Kernel team. I'm working with the case owner to support your case.<br><br>From the vmcore, we see that the system had no free memory in the physical memory, so the system was highly busy to find/reclaim pages for the requests.<br><br>--------------------------------------------------------------------------<br>      UPTIME: 6 days, 05:07:12    <br>LOAD AVERAGE: 169.92, 169.75, 170.19    &lt;--- high load<br>       TASKS: 513<br>    NODENAME: SLQDOCAL01<br>     RELEASE: 2.6.32-504.23.4.el6.x86_64<br><br>crash&gt; kmem -i<br>                 PAGES        TOTAL      PERCENTAGE<br>    TOTAL MEM  20533451      78.3 GB         ----<br>         FREE    88814     346.9 MB    0% of TOTAL MEM<br>         USED  20444637        78 GB   99% of TOTAL MEM     &lt;--- fully utilized<br>       SHARED      111       444 KB    0% of TOTAL MEM<br>      BUFFERS      108       432 KB    0% of TOTAL MEM<br>       CACHED        0            0    0% of TOTAL MEM<br>         SLAB    33825     132.1 MB    0% of TOTAL MEM<br><br>   TOTAL SWAP  4194303        16 GB         ----<br>    SWAP USED   410592       1.6 GB    9% of TOTAL SWAP<br>    SWAP FREE  3783711      14.4 GB   90% of TOTAL SWAP<br><br> COMMIT LIMIT  14461028      55.2 GB         ----<br>    COMMITTED  1758332       6.7 GB   12% of TOTAL LIMIT<br>--------------------------------------------------------------------------<br><br>By checking the memory usages from the application, we see that it's used very small amount of the memory and nothing significant amount was consumed from application side.<br><br>--------------------------------------------------------------------------<br>crash&gt; ps -G | tail -n +2 | cut -b2- | gawk '{mem += $8} END {print &quot;total &quot; mem/1048576 &quot;GB&quot;}'<br>total 0.000183105GB<br>--------------------------------------------------------------------------<br><br>As it's running on VMWare, I have checked a possible memory consumption from vmware_balloon module.<br><br>--------------------------------------------------------------------------<br>crash&gt; sym balloon<br>ffffffffa014d600 (b) balloon [vmware_balloon]<br><br>crash&gt; vmballoon.size,target ffffffffa014d600<br>  size = 9590603<br>  target = 13346743<br>  <br>crash&gt; !bc -q<br>scale=2<br>9590603*4/2^20<br>36.58<br>13346743*4/2^20<br>50.91<br><br>36.58 GiB allocated in balloon<br>50.91 GiB was the target to allocate<br><br>crash&gt; bt 1549<br>PID: 1549   TASK: ffff88141a34c040  CPU: 0   COMMAND: &quot;vmmemctl&quot;<br> #0 [ffff88141a98db10] schedule at ffffffff815299d0<br> #1 [ffff88141a98dbe8] schedule_timeout at ffffffff8152a8a2<br> #2 [ffff88141a98dc98] schedule_timeout_uninterruptible at ffffffff8152aa0e<br> #3 [ffff88141a98dca8] __alloc_pages_nodemask at ffffffff8113463f<br> #4 [ffff88141a98dde8] alloc_pages_current at ffffffff8116c9aa<br> #5 [ffff88141a98de18] OS_ReservedPageAlloc at ffffffffa01e27b4 [vmmemctl]<br> #6 [ffff88141a98de28] Balloon_QueryAndExecute at ffffffffa01e33a5 [vmmemctl]<br> #7 [ffff88141a98de88] init_module at ffffffffa01e2a05 [vmmemctl]<br> #8 [ffff88141a98dee8] kthread at ffffffff8109e78e<br> #9 [ffff88141a98df48] kernel_thread at ffffffff8100c28a<br>--------------------------------------------------------------------------<br><br>It's showing that 36.58GiB was already taken by balloon and it's trying to allocate 50GiB in total. This ballooning is happening when the VMware ESX server needs to use that memory for other virtual guests or for hypervisor itself. You may want to get consult from VMware for a possible way to avoid this situation. You can find our document regarding this in the below article.<br><br>Unaccounted memory usage when running Red Hat Enterprise Linux as a VMware guest<br>https://access.redhat.com/solutions/43729<br><br>Please let us know if you have any questions. Thanks.<br><br>Best regards,<br>Daniel Kwon<br>Software Maintenance Engineer, GSS, Red Hat Asia Pacific<br><br><publishedDate>2016-02-12T00:53:09Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GXJuHIAX"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-02-12T00:07:48Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-02-12T00:07:47Z</b><br><br>안녕하세요.<br><br>이번 시스템 장애 분석에 필요한 sosreport 도 추가로 첨부 업로드 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-02-12T00:07:47Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GXBtSIAX"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-02-11T14:04:55Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-02-11T14:04:55Z</b><br><br>안녕하세요. <br><br>dropbox.redhat.com/incoming 에 01573000_vmcore_20160211 파일명으로 업로드 하였습니다.<br><br>확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-02-11T14:04:55Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GX7viIAD"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-11T06:13:43Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-11T06:13:43Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>vmcore_01573000.zip 해당 파일은 기존에 업로드 주셨으며, 해당 파일은 정상적이지 못한 상태의 파일이어서 해당 vmcore로는 분석이 어려운 상황입니다.<br>======================<br>업무에 참고하시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2016-02-11T06:13:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GX7qYIAT"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-02-11T05:59:32Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-02-11T05:59:32Z</b><br><br>안녕하세요.<br><br>오늘 동일한 시스템에 동일한 문제로 시스템이 Hang 상태로 멈춰 vmcore 를 정상적으로 생성하였습니다.<br><br>/var/log/messages 및 sar 데이터를 확인하였으나, 2016-02-07 자정 경부터 시스템 로깅이 안 된걸로 봐서 그때 이미 oom 상태로 문제가 발생 했을거라 판단 됩니다.<br><br>vmcore 를 01573000_vmcore 이름으로 dropbox 에 저녁 때 업로드 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-02-11T05:59:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GX6vEIAT"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-11T02:15:17Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-11T02:15:17Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스와 관련되어 추가 업데이트가 있으시면 케이스에 업데이트 바랍니다.<br>또한, 문제가 해결된 경우에는 해당 케이스를 'Close'해주시면 됩니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-11T02:15:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G8ivTIAR"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-01-28T00:23:26Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-01-28T00:23:25Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 보내주신 vmcore를 확인한 결과, 아무런 내용이 기록되지 못한 파일입니다.<br><br>해당 vmcore로는 분석이 어려우며, 특별한 로그가 기재가 되지 않은 상태입니다.<br>======================<br>그리고 현재 sar 데이터 수집 여부도 확인 한 번 부탁드리며, 차후 장애시 상태 정보를 위해서 임시적으로 sar 수집시간을 3분 정도로 변경하여 수집하시는 것을 권유 드립니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-01-28T00:23:25Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G8UovIAF"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-01-27T00:35:32Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-01-27T00:35:32Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>현재 케이스를 접수하였으며, 올려주신 데이터를 확인 후 다시 안내드리도록 하겠습니다.<br><br>그리고 현재 severity가 2로 설정되어 잇으나, Red Hat Severity 정책상 본 케이스는 2-&gt;3으로 조절하도록 하겠습니다.<br>Severity가 2에서 3으로 변경되더라도 현재 제가 본 케이스를 처리할 예정입니다.<br><br><br>업무에 참고하시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2016-01-27T00:35:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G8LdBIAV"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-01-26T13:29:35Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-01-26T13:29:35Z</b><br><br>덤프 파일을 dropbox.redhat.com/incoming 에 vmcore_01573000.zip 파일명으로 업로드 하였습니다.<br><br>감사합니다.<br><br><publishedDate>2016-01-26T13:29:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br></comments><br>