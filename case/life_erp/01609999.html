======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-04-01T02:16:15Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-04-26T10:08:38Z</b><br><b>id : 500A000000U62SbIAJ</b><br>======================<br><br><b><font size=15>
제목  : vmware 환경 xfs I/O error 건 (재오픈)
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>지난 번 진행했던 vmware 환경 xfs I/O error 건에 대한 케이스를 다시 오픈 합니다.<br><br>https://access.redhat.com/support/cases/#/case/01583053<br><br>간략히 요약하자면 <br><br>Hitachi GAD 환경에서 Storage 가용성 테스트 중 발견 된 이슈이며,<br><br>VMWare 기반 RHEL 의 SCSI 단절로 인해 OS 가 Hang 상태로 빠지는 문제 입니다.<br><br>첨부 해 드리는 VMWare Console 화면의 파일시스템/SCSI 관련 에러 메세지의 자세한 내용 설명과 <br><br>VMWare 환경에서 open vmtoolsd 를 사용했을 때 설정되는 disk timeout 180Sec 값의 의미 확인 부탁드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000DjYluIAF"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-04-12T05:38:27Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-04-12T05:38:27Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>넵! 업데이트 감사합니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-04-12T05:38:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gq6uVIAR"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-04-12T03:54:45Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-04-12T03:54:45Z</b><br><br>안녕하세요.<br><br>5월중 VMware + RHEL + Hitachi GAD 가용성 테스트를 진행 할 것 같습니다.<br><br>이전 테스트 준비 단계에서 협의되는 내용이 있으면 추가로 정보를 올리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-04-12T03:54:45Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GmpMxIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-04-01T06:06:23Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-04-01T06:08:50Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스에 첨부된 파일을 기준(VMware console에서 확인된 로그)으로만 우선 말씀드리면, <br><br>아래 로그는 block device에 I/O를 업데이트 요청을 하였으나 Error가 반환된 것이라고 이해하시면 될 것 같습니다.<br><br>&quot;blk_update_request: I/O error, dev sda, sector xxxxx&quot;<br><br><br>2442 bool blk_update_request(struct request *req, int error, unsigned int nr_bytes)<br>2443 {<br>2444     int total_bytes;<br>2445 <br>2446     trace_block_rq_complete(req-&gt;q, req, nr_bytes);<br>2447 <br><br>[...]<br><br>2462     if (error &amp;&amp; req-&gt;cmd_type == REQ_TYPE_FS &amp;&amp;<br>2463         !(req-&gt;cmd_flags &amp; REQ_QUIET)) {<br>2464         char *error_type;<br>2465 <br>2466         switch (error) {<br>2467         case -ENOLINK:<br>2468             error_type = &quot;recoverable transport&quot;;<br>2469             break;<br>2470         case -EREMOTEIO:<br>2471             error_type = &quot;critical target&quot;;<br>2472             break;<br>2473         case -EBADE:<br>2474             error_type = &quot;critical nexus&quot;;<br>2475             break;<br>2476         case -ENOSPC:<br>2477             error_type = &quot;critical space allocation&quot;;<br>2478             break;<br>2479         case -ENODATA:<br>2480             error_type = &quot;critical medium&quot;;<br>2481             break;<br>2482         case -EIO:<br>2483         default:<br>2484             error_type = &quot;I/O&quot;;<br>2485             break;<br>2486         }<br>2487         printk_ratelimited(KERN_ERR &quot;%s: %s error, dev %s, sector %llu\n&quot;,<br>2488                    __func__, error_type, req-&gt;rq_disk ?<br>2489                    req-&gt;rq_disk-&gt;disk_name : &quot;?&quot;,<br>2490                    (unsigned long long)blk_rq_pos(req));<br><br><br>즉, 위의 메시지에서는 /dev/sda 디바이스의 block device에 I/O가 정상적으로 이뤄지지 못하고 Error가 발생한 것만 알수 있는 로그입니다.<br><br><br>그래서 이전 케이스의 sosreport와 log들을 보았을떄..<br><br>해당 로그가 발생하기 전 아래와 같은 로그를 확인할 수 잇습니다.<br><br>16801 Feb  2 14:03:45 PECCAL02SL kernel: qla2xxx [0000:44:00.1]-500b:2: LOOP DOWN detected (2 7 0 0).<br>16802 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:1:0: rejecting I/O to offline device<br>16803 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:1:0: [sdf] killing request<br>16804 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: rejecting I/O to offline device<br>16805 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: [sdc] killing request<br>16806 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: [sdc] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK<br>16807 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: [sdc] CDB: Write(10) 2a 00 09 00 cc 60 00 04 00 00<br>16808 Feb  2 14:03:50 PECCAL02SL kernel: blk_update_request: I/O error, dev sdc, sector 151047264<br>16809 Feb  2 14:03:50 PECCAL02SL kernel: device-mapper: multipath: Failing path 8:32.<br>16810 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:1:0: rejecting I/O to offline device<br>16811 Feb  2 14:03:50 PECCAL02SL kernel: device-mapper: multipath: Failing path 8:80.<br><br><br>즉, blk_update_request 에러 발생 이전에 SCSI Error가 발생한 것을 알수 있고<br><br>16804 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: rejecting I/O to offline device<br>16805 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: [sdc] killing request<br>16806 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: [sdc] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK<br>16807 Feb  2 14:03:50 PECCAL02SL kernel: sd 2:0:0:0: [sdc] CDB: Write(10) 2a 00 09 00 cc 60 00 04 00 00<br><br>또 그 이전에는 FC 모듈에 이상이 있는 것이 확인됩니다.<br><br>16801 Feb  2 14:03:45 PECCAL02SL kernel: qla2xxx [0000:44:00.1]-500b:2: LOOP DOWN detected (2 7 0 0).<br><br> 532 /**<br> 533  * qla2x00_async_event() - Process aynchronous events.<br> 534  * @ha: SCSI driver HA context<br> 535  * @mb: Mailbox registers (0 - 3)<br> 536  */<br> 537 void<br> 538 qla2x00_async_event(scsi_qla_host_t *vha, struct rsp_que *rsp, uint16_t *mb)<br> 539 {<br><br>[...]<br><br> 713     case MBA_LOOP_DOWN:     /* Loop Down Event */<br> 714         mbx = (IS_QLA81XX(ha) || IS_QLA8031(ha))<br> 715             ? RD_REG_WORD(&amp;reg24-&gt;mailbox4) : 0;<br> 716         mbx = (IS_P3P_TYPE(ha)) ? RD_REG_WORD(&amp;reg82-&gt;mailbox_out[4])<br> 717             : mbx;<br> 718         ql_log(ql_log_info, vha, 0x500b,<br> 719             &quot;LOOP DOWN detected (%x %x %x %x).\n&quot;,<br> 720             mb[1], mb[2], mb[3], mbx);<br> 721 <br>...<br><br><br> 776 #define MBA_LOOP_DOWN       0x8012  /* FC Loop Down. */<br><br><br>즉, 이전의 케이스를 분석해볼때는 FC의 이상으로 SCSI Layer에서의 이상이 발견되며 또한 그 결과로 I/O의 Error가 발생되고 있다고 분석됩니다.<br><br><br>FC의 이상이어서 해당 시스템의 정보를 확인 해 본결과,<br>해당 시스템은 VMware가 아닌 물리적 시스템인 것으로 보입니다.<br><br>  System:<br>    Mfr:  HP<br>    Prod: ProLiant DL580 Gen9<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-04-01T06:06:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gmov5IAB"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-04-01T04:43:00Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-04-01T04:43:00Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>지난 케이스와 함께 확인 후, 다시 답변드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-04-01T04:43:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>지난 번 진행했던 vmware 환경 xfs I/O error 건에 대한 케이스를 다시 오픈 합니다.<br><br>https://access.redhat.com/support/cases/#/case/01583053<br><br>간략히 요약하자면 <br><br>Hitachi GAD 환경에서 Storage 가용성 테스트 중 발견 된 이슈이며,<br><br>VMWare 기반 RHEL 의 SCSI 단절로 인해 OS 가 Hang 상태로 빠지는 문제 입니다.<br><br>첨부 해 드리는 VMWare Console 화면의 파일시스템/SCSI 관련 에러 메세지의 자세한 내용 설명과 <br><br>VMWare 환경에서 open vmtoolsd 를 사용했을 때 설정되는 disk timeout 180Sec 값의 의미 확인 부탁드립니다.<br><br>감사합니다.</issue><cep>false</cep></case>