======================<br><b>생성계정 : 삼성생명 타임게이트</b><br><b>생성날짜 : 2017-09-11T03:51:56Z</b><br><b>마지막 답변자 : Jake Jaewook Shin</b><br><b>마지막 수정 일자 : 2017-09-27T15:35:20Z</b><br><b>id : 500A000000Y0GH6IAN</b><br>======================<br><br><b><font size=15>
제목  : Rear backup 실행시 grub.conf 변경관련
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하십니까 타임게이트 오선우입니다<br><br>고객사에서 Rear를 cronjob을 통해 특정 날짜에 Rear백업을 실시하고 있습니다<br><br>그러던중 Rear백업이 실행된 시점에 grub.conf가 변경이 되었고 설정되어 있던 옵션들이 다 빠져버렸습니다<br><br>1. rear백업시 grub.conf가 변경되는것이 맞나요? 변경이 되더라도 시스템에 영향을 주면 안될꺼 같은데요 이유가 무엇인지요?<br><br>2. 앞으로 이런 현상을 방지하려면 어떠한 방법이 있고 절차는 어떻게 되는지 확인 부탁드립니다<br><br>sosreport와 관련 파일들 dropbox에 업로드하였습니다 분석 부탁드립니다<br>파일명은 sosreport.zip입니다<br>통화가 필요하시면 연락부탁드립니다<br>타임게이트 / 오선우 / 책임 / 010-4630-3171 /sw.oh@time-gate.com<br>감사합니다<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>DECCAL01SL</hostname><br><br><br><comment id="a0aA000000KZKQ3IAP"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-27T15:35:19Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-27T15:35:19Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>해당 케이스는 마지막 안내 커멘트 이후, 추가 문의하신 내용없이 일정 시간이 경과되어<br>이상으로 close 처리하도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-27T15:35:19Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KXZBZIA5"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-19T13:49:22Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-19T13:49:22Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>현재 해당 케이스의 상황이 어떠신지 확인 부탁드립니다.<br>일정시간 업데이트가 없으실 경우, 해당 케이스는 close 처리됩니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-19T13:49:22Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KW0MRIA1"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-12T04:49:58Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-12T04:49:57Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>일부 문의 내용이 누락되어 추가 커멘트 드립니다.<br><br>&gt; 아울러 rear설정부분인 GRUB_RESCUE=y을 삭제하고자 합니다.  <br>&gt; GRUB_RESCUE 값을 삭제 한다고 하여 백업에 문제가 되는지 확인 부탁드립니다.<br><br>추가로 상기 부분은 백업을 위해서라기보다도 로컬 시스템의 grub 메뉴에 rear 부팅을 추가하는 것이므로<br>삭제하신다고 백업에 문제가 될 것으로 보이지 않습니다.<br><br>또한, grubby 가 아닌 /etc/default/grub 자체를 수정하신 후, grub2-mkconfig 으로 생성하는 방법을 이용하신다면<br>GRUB_RESCUE 를 사용하셔도 기존 수정하신 값이 남아 있을 것이므로 해당 부분도 고려하시면 좋을 것 같습니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-12T04:49:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KVyvRIAT"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-12T01:03:54Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-12T04:44:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>문의하신 내용에 대하여 안내드리면 다음과 같습니다.<br><br>&gt; 1.  grub.cfg에서 변경된 부분이 rear 메뉴엔트리 부분 추가된것과 command line부분인지요? 그 외에 더 변경사항이 있는지요?<br><br>네, 테스트 결과 메뉴얼 대로이며 그 외에 다른 변경 부분은 확인 되지 않습니다.<br><br>&gt; 2. grub.cfg의 수정은  /usr/share/rear/output/default/94_grub2_rescue.sh 스크립트에 의해서 변경되는것인지요?<br>&gt;   (위 스크립트에서 grub2-mkconfig를 사용하는것으로 보입니다. )<br><br>네, 940_grub2_rescue.sh 을 말씀하시는 것으로 보이며 스크립트 주석 및 내용, strace 내용상 해당 쉘이 사용되는 것으로 보입니다.<br><br>&gt; 3. GRUB_RESCUE=y 설정 시에 /boot/grub2/grub.cfg의 내용이 바뀌면 grub2-mkconfig를 수행하게 되는것이 맞는지요?<br>&gt;   (백업 수행은 여러번 했으나 한번만 바뀌고 그 이후 변경부분이 없어서 문의드립니다.)<br><br>네, 테스트 결과 인식하신 바에 문제 없어 보입니다.<br><br>&gt; 4. /proc/cmdline이 변경이 되어 원복을 하고자 한다면 /etc/default/grub에서  GRUB_CMDLINE_LINUX을 기존 내용으로 변경한 후에 <br>&gt;   grub2-mkconfig -o /boot/grub2/grub.cfg로 한 후 리부팅하여야 하는지요?<br><br>네, boot 파라메터의 경우, 부팅시 적용되므로 리부팅하시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-12T01:03:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KVyfiIAD"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-12T00:32:24Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-12T00:32:23Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>우선 요청하신 파일은 해당 케이스에 첨부시켜 놓았습니다.<br>참조하세요~<br><br>감사합니다.<br><br><publishedDate>2017-09-12T00:32:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KVxnCIAT"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-09-11T22:00:51Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-09-11T22:00:50Z</b><br><br>기존에는 grubby명령을 통해서 변경하였습니다.<br>rear에서  GRUB_RESCUE=y 옵션으로 grub.cfg의 내용을 변경한것으로 보여집니다.<br><br>저희 쪽에서는 grub2-mkconfig -o /boot/grub2/grub.cfg 명령어를 실행하지는 않았습니다.<br><br><publishedDate>2017-09-11T22:00:50Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KVtinIAD"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-11T16:52:21Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-11T16:52:21Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>&gt;&gt; 그러던중 Rear백업이 실행된 시점에 grub.conf가 변경이 되었고 설정되어 있던 옵션들이 다 빠져버렸습니다<br>&gt; grub.conf 를 어떻게 변경하셨나요?<br>&gt; /etc/default/grub 를 변경한 후, 다음과 같이 변경하셨는지요?<br>&gt; # grub2-mkconfig -o /boot/grub2/grub.cfg<br>&gt; 아니면 /boot/grub2/grub.cfg 를 직접 변경하셨는지요.<br><br>상기 부분에 제가 다소 오해의 소지가 있게 글을 남겼네요,<br>정정드리면 기존에 빠져버린 옵션의 변경(설정) 방법에 대해 문의드린 것입니다.<br>RHEL7 에서는 다음 KCS 및 메뉴얼상에서도 제공드리지만 /etc/sysconfig/grub 또는 /etc/default/grub 를 변경후,<br>grub2-mkconfig 를 통해 생성해야합니다.<br><br>관련 링크:<br>How to manually modify the boot parameter in grub before the system boots <br>- https://access.redhat.com/solutions/32726<br><br>따라서, 애초에 설정하셨던 옵션을 어떻게 설정하셨는지에 대해 확인 요청드린 것입니다.<br>이 부분만 확인부탁드립니다.<br><br>추가 커멘트하신 내용에 대해서는 금일 확인 후 연락드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-11T16:52:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KVt6IIAT"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-09-11T16:14:32Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-09-11T16:14:32Z</b><br><br>변경된 부분이 <br>/etc/grub.d/01_users의 내용이 변경된것 같고 <br>아래 두개의 화일이 생성된 것으로 보입니다.<br>/boot/rear-initrd.cgz <br>/boot/rear-kernel <br><br>현재까지 발견된 변경부분을 정리하자면....... <br>1. /boot/grub2/grub.cfg파일의 내용 변경 <br>    -&gt;  cmdline 부분과 rear menuentry값 추가  (/boot/grub2/grub.cfg.old생성)<br><br>2. /etc/grub.d/01_users의 내용이 <br>---기존 ---<br>#!/bin/sh -e<br>cat &lt;&lt; EOF<br>if [ -f \${prefix}/user.cfg ]; then<br>  source \${prefix}/user.cfg<br>  if [ -n \${GRUB2_PASSWORD} ]; then<br>    set superusers=&quot;root&quot;<br>    export superusers<br>    password_pbkdf2 root \${GRUB2_PASSWORD}<br>  fi<br>fi<br>EOF<br><br>---변경 ---<br>#!/bin/sh<br>cat &lt;&lt; EOF<br>set superusers=&quot;rearadmin&quot;<br>password_pbkdf2 rearadmin REAR<br>EOF<br><br>3. 2개의 파일이 생성<br>/boot/rear-initrd.cgz <br>/boot/rear-kernel<br><br><publishedDate>2017-09-11T16:14:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KVsExIAL"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-09-11T15:24:27Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-09-11T15:24:27Z</b><br><br>답변 감사합니다.<br><br>정리하여 다시 말씀드리겠습니다.<br>우선 grub-mkconfig명령을 사용한적은 없습니다.<br>단지 rear로 백업을 받았고 최초인지는 모르나 한번 /boot/grub2/grub.cfg가 변경이 된것으로 보이고 <br>그 grub는 /etc/default/grub의 내용을 가지고 grub.cfg 를 생성한 것으로 보입니다.<br>이에 rear 의 설정중 GRUB_RESCUE=y가 설정 되어 있어 말씀 주셨듯이 grub의 메뉴엔트리 값을 변경하고자 grub을 재생성 한것으로 보입니다.<br>이에 저는 궁금한 사항이<br><br>1.  grub.cfg에서 변경된 부분이 rear 메뉴엔트리 부분 추가된것과 command line부분인지요? 그 외에 더 변경사항이 있는지요?<br><br>2. grub.cfg의 수정은  /usr/share/rear/output/default/94_grub2_rescue.sh 스크립트에 의해서 변경되는것인지요?<br>   (위 스크립트에서 grub2-mkconfig를 사용하는것으로 보입니다. )<br><br>3. GRUB_RESCUE=y 설정 시에 /boot/grub2/grub.cfg의 내용이 바뀌면 grub2-mkconfig를 수행하게 되는것이 맞는지요?<br>   (백업 수행은 여러번 했으나 한번만 바뀌고 그 이후 변경부분이 없어서 문의드립니다.)<br><br>4. /proc/cmdline이 변경이 되어 원복을 하고자 한다면 /etc/default/grub에서  GRUB_CMDLINE_LINUX을 기존 내용으로 변경한 후에 <br>   grub2-mkconfig -o /boot/grub2/grub.cfg로 한 후 리부팅하여야 하는지요?<br><br>위 4가지의 사항에 대해서 답변 부탁드립니다.<br><br>아울러 rear설정부분인 GRUB_RESCUE=y을 삭제하고자 합니다.  <br><br>GRUB_RESCUE 값을 삭제 한다고 하여 백업에 문제가 되는지 확인 부탁드립니다.<br><br>또한 드롭박스에 업로드 한 파일 링크 부탁드립니다.<br><br><publishedDate>2017-09-11T15:24:27Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KVq3DIAT"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-11T13:38:09Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-11T13:38:09Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>추가로 rear 패키지상의 GRUB_RESCUE 옵션의 정의는 다음과 같습니다.<br><br>##<br># GRUB_RESCUE [ GRUB_RESCUE_USER ]<br>#<br># Add a ReaR rescue/recovery system to the GRUB/GRUB2 bootloader of the currently running system.<br># It adds kernel and the ReaR initrd to the bootloader directory in the currently running system and<br># adds a 'Relax-and-Recover' GRUB/GRUB2 menue entry to boot that locally installed ReaR rescue system.<br>##<br><br>즉, 해당 옵션에 의해 ReaR 레스큐/리커버리 시스템이 GRUB/GRUB2 부트로더에 더해지고, Relax-and-Recover 메뉴 엔트리도 추가됩니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-11T13:38:09Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KVpgpIAD"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-11T13:21:52Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-11T13:21:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>&gt; 그러던중 Rear백업이 실행된 시점에 grub.conf가 변경이 되었고 설정되어 있던 옵션들이 다 빠져버렸습니다<br><br>grub.conf 를 어떻게 변경하셨나요?<br>/etc/default/grub 를 변경한 후, 다음과 같이 변경하셨는지요?<br><br># grub2-mkconfig -o /boot/grub2/grub.cfg<br><br>아니면 /boot/grub2/grub.cfg 를 직접 변경하셨는지요.<br><br>우선 확인 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-11T13:21:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KVksyIAD"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-09-11T06:31:55Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-09-11T06:31:55Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>저는 신재욱 차장이라고 하며 앞으로 해당 케이스를 담당하게 되었습니다.<br><br>현재 케이스 내용을 살펴보는 중이며, 관련하여 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-11T06:31:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>