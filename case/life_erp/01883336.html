======================<br><b>생성계정 : 삼성생명 타임게이트</b><br><b>생성날짜 : 2017-07-04T09:06:18Z</b><br><b>마지막 답변자 : 삼성생명 타임게이트</b><br><b>마지막 수정 일자 : 2017-07-17T00:42:31Z</b><br><b>id : 500A000000XUBPUIA5</b><br>======================<br><br><b><font size=15>
제목  : c-state와 p-state에  대한 최대성능 관련 이슈
</font></b><br><br>======================<br><b>사전문의<br></b><br>고객은 최대 퍼포먼스로 사용을 원하고 있으며 OS단에서 확인하는 방법등을 문의해오고 있습니다<br>c-state관련 아래 파라미터 2개만 바꾸면 최대 퍼포먼스를 내는 환경이 되는 것인지 확인 부탁드립니다<br><br>intel_idle.max_cstate=0 값과 processor.max_cstate=1 <br><br>위의 값을 적용하면  c-state를 사용하지 않고 최대성능을 낸다고 말씀 주셨고 <br>잘 적용 되어 있는지 확인하는 방법으로 (아래 고객이 문의해온 내용의 결과값을 보게 되면) <br><br>turbostat이라는 명령에서 c1/c3/c6 stat에 있는 부분들이 모두 c0 상태로 유지가되게되고<br>powertop에서는 c1/c3/c6에 있는 부분들이 모두 poll 상태가 되면 잘 적용 되어 있는것인지 궁금합니다. <br>아울러 확인하는 방법으로 이외  다른 방법이 있는지 확인 부탁드립니다.<br><br>또한, 최대 퍼포먼스로 p-state 사용하지 않기 위해서 어떠한 설정을 해주어야 하며<br>이를 확인하는 방법은 무엇이 있는 지 확인 부탁드립니다.<br><br>추가적으로 실제로 하드웨어단에서 해당 옵션(c-state,p-state) disable 했을 경우 <br>os에서 파라미터 변경하여 꼭 적용해야 하는것인지 문의 드립니다.<br><br>감사합니다<br>======================<br><br>하기 고객이 문의해온 내용입니다 참고 부탁드립니다<br> =-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-<br>작업 계획서에서 안정화 작업 관련 C-state값 설정 관련 후 확인관련해서 문의드리려고 하는데요.<br> <br>intel_idle.max_cstate=0 값과 processor.max_cstate=1 값 적용 시의 cpu 상태 변화에 대해서 문의드리려고 합니다.<br>아래 command의 결과는 PECCAL01SL(ECC AP 서버 1)의 turbostat과 powertop 정보인데요.<br> <br>위의 설정을 kernel에 적용하였을 때 turbostat에서는 c1/c3/c6 stat에 있는 부분들이 모두 c0 상태로 유지가되게되고<br>powertop에서는 c1/c3/c6에 있는 부분들이 모두 poll 상태에 들어가있게 되는지 문의드리려고 합니다.<br>(아니면 다른 확인 방법이 있는지도 문의드립니다.)<br> <br>추가로 아래 HP에서 설정하는 low-latency 설정 관련해서 추가되는 부분이 있는데<br>For UEFI configurations (Gen9 and DL580 Gen8) 부분에 보면 intel_idle.max_cstate=0 부분 이외에 추가로<br>nosoftlockup과 mce=ignore_ce 값이 있는데 해당 부분에 대한 확인도 부탁드리려고 합니다.<br> <br>이번 안정화 작업의 목표는 단순 C-state 설정이 아닌<br>HP Gen9(380/580) + redhat os에서 c-state와 p-state 값의 적절한 설정을 통해서 cpu의 최대 performance를 나오게 하는 것입니다.<br> <br>HW쪽(HP)도 확인 중이지만 OS쪽에서도 추가 p-state 설정 관련해서도 확인 부탁드립니다.<br> <br> - turbostat<br><br>     CPU Avg_MHz   %Busy Bzy_MHz TSC_MHz     SMI  CPU%c1  CPU%c3  CPU%c6  CPU%c7 CoreTmp  PkgTmp PkgWatt RAMWatt   PKG_%   RAM_%<br>       -    2198   68.18    3224    2821       0   27.16    1.70    2.96    0.00      46      46  476.14   49.92    0.00    0.00<br>       0    2412   74.04    3258    2851       0   24.30    0.94    0.72    0.00      45      45  118.72   12.42    0.00    0.00<br>      40    2627   80.72    3255    2848       0   17.62<br>       1    2779   85.41    3254    2847       0    7.17    3.47    3.95    0.00      45<br>      41    1117   34.33    3253    2847       0   58.25<br>       2    2757   84.74    3253    2846       0   11.23    1.76    2.26    0.00      44<br>      42    1400   43.03    3253    2846       0   52.95<br>       3    2535   77.94    3253    2846       0   16.15    2.89    3.03    0.00      41<br>      43    1735   53.35    3253    2846       0   40.73<br>       4    2532   77.87    3252    2846       0   18.00    1.96    2.17    0.00      40<br> <br> - powertop<br> <br>          Package   |             Core    |            CPU 0       CPU 40<br>POLL        0.0%    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>C1E-HSW     2.3%    | C1E-HSW     4.3%    | C1E-HSW     6.0%    0.4 ms  2.5%    0.7 ms<br>C3-HSW      7.7%    | C3-HSW     11.0%    | C3-HSW     15.1%    0.4 ms  6.9%    1.5 ms<br>C6-HSW     27.6%    | C6-HSW      7.0%    | C6-HSW      7.6%    0.6 ms  6.4%    1.0 ms<br>                    |             Core    |            CPU 1       CPU 41<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     1.7%    | C1E-HSW     1.4%    0.4 ms  2.0%    5.2 ms<br>                    | C3-HSW      5.9%    | C3-HSW      8.2%    0.6 ms  3.6%    2.7 ms<br>                    | C6-HSW     37.7%    | C6-HSW      7.2%    0.6 ms 68.2%    5.7 ms<br>                    |             Core    |            CPU 2       CPU 42<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     2.0%    | C1E-HSW     2.3%    0.5 ms  1.7%    1.3 ms<br>                    | C3-HSW     12.7%    | C3-HSW     10.1%    0.6 ms 15.2%    3.7 ms<br>                    | C6-HSW     18.0%    | C6-HSW      5.3%    0.6 ms 30.7%    4.2 ms<br>                    |             Core    |            CPU 3       CPU 43<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     2.0%    | C1E-HSW     2.2%    0.5 ms  1.7%    1.8 ms<br>                    | C3-HSW      3.4%    | C3-HSW      4.1%    0.4 ms  2.7%    2.8 ms<br>                    | C6-HSW     36.2%    | C6-HSW      2.9%    0.4 ms 69.5%    6.5 ms<br>                    |             Core    |            CPU 4       CPU 44<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     3.5%    | C1E-HSW     1.5%    0.3 ms  5.4%    1.4 ms<br>                    | C3-HSW      5.2%    | C3-HSW      9.0%    0.9 ms  1.3%    0.3 ms<br>                    | C6-HSW      4.9%    | C6-HSW      9.6%    1.7 ms  0.3%    0.3 ms<br>                    |             Core    |            CPU 5       CPU 45<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     1.0%    | C1E-HSW     2.0%    1.1 ms  0.0%    0.0 ms<br>                    | C3-HSW      4.7%    | C3-HSW      8.8%    0.8 ms  0.6%    1.2 ms<br>                    | C6-HSW     31.5%    | C6-HSW     18.3%    1.2 ms 44.8%   13.7 ms<br>                    |             Core    |            CPU 6       CPU 46<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     1.3%    | C1E-HSW     2.7%    0.8 ms  0.0%    0.0 ms<br>                    | C3-HSW      4.0%    | C3-HSW      6.5%    0.9 ms  1.5%    2.0 ms<br>                    | C6-HSW     49.3%    | C6-HSW     13.5%    1.1 ms 85.0%    9.7 ms<br> <br><br> <br> - <br>참고 내용<br>https://h50146.www5.hpe.com/products/software/oe/linux/mainstream/support/whitepaper/pdfs/c01804533-2014-nov.pdf<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Usage / Documentation Help</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>all</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000JvEsYIAV"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-07-15T00:54:41Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-07-15T00:54:41Z</b><br><br>답변 감사드립니다.<br><br><publishedDate>2017-07-15T00:54:41Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JuW8hIAF"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-12T05:41:59Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-12T05:41:58Z</b><br><br>김지민 선임님,<br><br>문의사항이 충분히 해소되었다고 하시면 이 기술지원 케이스는 종료 처리하겠습니다.<br>추후 문의 사항 있으시면 새롭게 기술 지원 문의 하시기 바랍니다.<br><br>고맙습니다.<br>허 경 드림.<br><br>(kim, jimin에 회신)<br>&gt; 안녕하세요 <br>&gt; <br>&gt; SDS 김지민 선임입니다.<br>&gt; <br>&gt; 상세한 답변 감사드립니다.<br><br><publishedDate>2017-07-12T05:41:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JuVeuIAF"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-07-12T04:39:12Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-07-12T04:39:12Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>상세한 답변 감사드립니다.<br><br><publishedDate>2017-07-12T04:39:12Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JuUO2IAN"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-12T00:53:14Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-12T00:53:14Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>문의 내용 중간에 답변을 넣었습니다.<br><br>(kim, jimin에 회신)<br>&gt; 안녕하세요 <br>&gt; <br>&gt; 답변 감사드립니다.<br>&gt; <br>&gt; intel_pstate=disable 값의 의미에 대해서 한번만 더 문의드려도될까요?<br>&gt; <br>&gt; intel_pstate를 사용하지 않는의미 같은데 한번 문의드리려고 합니다.<br>&gt; OS에서 아래와 같이 /etc/sysconfig/cpupower 파일을 입력하고 cpupower service를 가동하였습니다.<br>&gt; <br>&gt; root@TBKMML01SL /etc/sysconfig # cat cpupower<br>&gt; # See 'cpupower help' and cpupower(1) for more info<br>&gt; CPUPOWER_START_OPTS=&quot;frequency-set -g performance&quot;<br>&gt; CPUPOWER_STOP_OPTS=&quot;frequency-set -g ondemand&quot;<br>&gt; <br>&gt; 가동후 상태를 확인해보면 아래와 같이 limits가 1.20 GHz - 2.40GHz가 되어있고<br>&gt; governor의 상태가 performance로 되어있으면 이범위안에서 선택하여 사용한다는 설명처럼 보이는데요.<br>&gt; <br><br>네, 맞습니다.<br><br>&gt; root@TBKMML01SL / # cpupower frequency-info<br>&gt; analyzing CPU 0:<br>&gt;   driver: pcc-cpufreq<br>&gt;   CPUs which run at the same hardware frequency: 0<br>&gt;   CPUs which need to have their frequency coordinated by software: 0<br>&gt;   hardware limits: 1.20 GHz - 2.40 GHz<br>&gt;   available cpufreq governors: conservative, userspace, powersave, ondemand, performance<br>&gt;   current policy: frequency should be within 1.20 GHz and 2.40 GHz.<br>&gt;                   The governor &quot;performance&quot; may decide which speed to use<br>&gt;                   within this range.<br>&gt;  current CPU frequency is 2.59 GHz (asserted by call to hardware).<br>&gt;  boost state support:<br>&gt;    Supported: yes<br>&gt;    Active: yes<br>&gt;<br>&gt; 실제로 powertop의 결과에서도 1.2GHz에 대한 사용량이 보여서 항상 2.4GHz를 유지하는 것이 아닌가해서 <br>&gt;<br>performance 상태라고 해서 항상 최대 frequency로 동작하지는 않습니다.<br><br>또한, 문의하신 내용을 보면 frequency driver는 pcc-cpufreq 으로 설정되어 있는 것으로 확인됩니다.<br>intel_pstate=disable kernel parameter의 적용을 이것을 좀 더 명확하게 지정하는 것입니다. <br><br>&gt; CPUPOWER_START_OPTS=&quot;frequency-set -g performance&quot; 추가로<br>&gt; CPUPOWER_START_OPTS=&quot;frequency-set -g performance --min ?? --max ??&quot; min과 max 값을 만약 2400000로 동일하게 설정하는 것이<br>&gt; 그냥 performance 상태일 때와의 차이가 있는지 문의드리려고 합니다.<br><br>--min --max 값을 별도로 설정하지 않으면 hardware limit에 따라 자동 설정되는 것입니다. --min --max 값을 지정할 경우 사용자가 frequecy 범위를 지정할 수 있게 됩니다. 물론 hardware limit 범위 내에서만 지정할 수 있습니다.<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2017-07-12T00:53:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JuIimIAF"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-07-11T11:01:20Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-07-11T11:01:20Z</b><br><br>안녕하세요 <br><br>답변 감사드립니다.<br><br>intel_pstate=disable 값의 의미에 대해서 한번만 더 문의드려도될까요?<br><br>intel_pstate를 사용하지 않는의미 같은데 한번 문의드리려고 합니다.<br><br>OS에서 아래와 같이 /etc/sysconfig/cpupower 파일을 입력하고 cpupower service를 가동하였습니다.<br><br>root@TBKMML01SL /etc/sysconfig # cat cpupower<br># See 'cpupower help' and cpupower(1) for more info<br>CPUPOWER_START_OPTS=&quot;frequency-set -g performance&quot;<br>CPUPOWER_STOP_OPTS=&quot;frequency-set -g ondemand&quot;<br><br>가동후 상태를 확인해보면 아래와 같이 limits가 1.20 GHz - 2.40GHz가 되어있고<br>governor의 상태가 performance로 되어있으면 이범위안에서 선택하여 사용한다는 설명처럼 보이는데요.<br><br>root@TBKMML01SL / # cpupower frequency-info<br>analyzing CPU 0:<br>  driver: pcc-cpufreq<br>  CPUs which run at the same hardware frequency: 0<br>  CPUs which need to have their frequency coordinated by software: 0<br>  hardware limits: 1.20 GHz - 2.40 GHz<br>  available cpufreq governors: conservative, userspace, powersave, ondemand, performance<br>  current policy: frequency should be within 1.20 GHz and 2.40 GHz.<br>                  The governor &quot;performance&quot; may decide which speed to use<br>                  within this range.<br>  current CPU frequency is 2.59 GHz (asserted by call to hardware).<br>  boost state support:<br>    Supported: yes<br>    Active: yes<br><br>실제로 powertop의 결과에서도 1.2GHz에 대한 사용량이 보여서 항상 2.4GHz를 유지하는 것이 아닌가해서 <br><br>CPUPOWER_START_OPTS=&quot;frequency-set -g performance&quot; 추가로<br>CPUPOWER_START_OPTS=&quot;frequency-set -g performance --min ?? --max ??&quot; min과 max 값을 만약 2400000로 동일하게 설정하는 것이<br>그냥 performance 상태일 때와의 차이가 있는지 문의드리려고 합니다.<br><br>아래는 powertop과 cpufreq 정보입니다.<br><br>PowerTOP 2.3      Overview   Idle stats   Frequency stats   Device stats   Tunables<br><br><br>            Package |             Core    |            CPU 0       CPU 16<br>Idle        96.6%   | Idle       100.0%   | Idle       100.0%      100.0%<br>1200 MHz     1.4%   | 2.40 GHz     0.0%   | 2.40 GHz     0.0%<br>2.40 GHz     2.0%   | 1200 MHz     0.0%   | 1200 MHz     0.0%<br><br>                    |             Core    |            CPU 1       CPU 17<br>                    | Idle       100.0%   | Idle       100.0%      100.0%<br>                    | 2.40 GHz     0.0%   | 2.40 GHz     0.0%<br>                    |                     |<br><br>                    |             Core    |            CPU 2       CPU 18<br>                    | Idle        96.6%   | Idle        96.6%      100.0%<br>                    | 1200 MHz     1.4%   | 1200 MHz     1.4%<br>                    | 2.40 GHz     2.0%   | 2.40 GHz     2.0%<br><br>                    |             Core    |            CPU 3       CPU 19<br>                    | Idle       100.0%   | Idle       100.0%      100.0%<br>                    | 2.40 GHz     0.0%   | 2.40 GHz     0.0%<br>                    | 1200 MHz     0.0%   | 1200 MHz     0.0%<br><br>                    |             Core    |            CPU 4       CPU 20<br>                    | Idle       100.0%   | Idle       100.0%      100.0%<br>                    | 1200 MHz     0.0%   | 1200 MHz     0.0%<br>                    | 2.40 GHz     0.0%   | 2.40 GHz     0.0%<br><br>                    |             Core    |            CPU 5       CPU 21<br><br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat scaling_governor<br>performance<br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat scaling_max_freq<br>2400000<br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat scaling_min_freq<br>1200000<br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat scaling_cur_freq<br>2400000<br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat cpuinfo_cur_freq<br>2592000<br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat cpuinfo_max_freq<br>2400000<br>root@TBKMML01SL /sys/devices/system/cpu/cpu0/cpufreq # cat cpuinfo_min_freq<br>1200000<br><br>감사합니다.<br><br><publishedDate>2017-07-11T11:01:20Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JuFudIAF"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-11T07:04:59Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-11T07:04:59Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>문의 하신 내용에 대합 답변드립니다. <br><br>(In reply to kim, jimin)<br>&gt; 안녕하세요 답변 감사드립니다.<br>&gt; <br>&gt; 추가로 한가지 확인 부탁드릴 값은<br>&gt; processor.max_cstate 값인데 intel_idle 를 사용하지 않을 경우 기본 ACPI Idle C-State 모듈로 알고있는데<br>&gt; 이 값에 들어가는 범위와 cstate의 관계에 대해서 확인을 한번 부탁드리려고 합니다.<br>&gt; <br>&gt; processor.max_cstate가 ACPI Idle C-state 모듈의 단계여서 0이 C0 라면 <br>&gt; Low Latency만을 고려했을 때 아래와 같은 커널 값 설정이 intel_idle을 사용하지 않으면서 기본 ACPI idle 모듈을 통한 C0 설정값인지 문의드립니다.<br>&gt; <br>&gt; intel_idle.max_cstate=0 processor.max_cstate=0<br><br>intel_idle.max_cstate를 0으로 설정하는 것이 acpi idle 모듈을 사용한다는 의미이며 processor.max_cstate는 인텔이 아닌 프로세서에도 범용으로 적용하는 설정값입니다. 참고로 processor.max_cstate 값은 0으로 설정하여도 커널 코드에서 1로 지정됩니다. <br><br>kernel-3.10.0-327.el7/drivers/acpi/processor_idle.c<br>...&lt;snip&gt;...<br>static int acpi_processor_setup_cpuidle_cx(struct acpi_processor *pr,<br>                                           struct cpuidle_device *dev)<br>{<br>        int i, count = CPUIDLE_DRIVER_STATE_START;<br>        struct acpi_processor_cx *cx;<br><br>        if (!pr-&gt;flags.power_setup_done)<br>                return -EINVAL;<br><br>        if (pr-&gt;flags.power == 0) {<br>                return -EINVAL;<br>        }<br><br>        if (!dev)<br>                return -EINVAL;<br><br>        dev-&gt;cpu = pr-&gt;id;<br><br>        if (max_cstate == 0)<br>                max_cstate = 1;<br><br>        for (i = 1; i &lt; ACPI_PROCESSOR_MAX_POWER &amp;&amp; i &lt;= max_cstate; i++) {<br>                cx = &amp;pr-&gt;power.states[i];<br><br>                if (!cx-&gt;valid)<br>                        continue;<br><br>#ifdef CONFIG_HOTPLUG_CPU<br>                if ((cx-&gt;type != ACPI_STATE_C1) &amp;&amp; (num_online_cpus() &gt; 1) &amp;&amp;<br>                    !pr-&gt;flags.has_cst &amp;&amp;<br>                    !(acpi_gbl_FADT.flags &amp; ACPI_FADT_C2_MP_SUPPORTED))<br>                        continue;<br>#endif<br>                per_cpu(acpi_cstate[count], dev-&gt;cpu) = cx;<br><br>                count++;<br>                if (count == CPUIDLE_STATE_MAX)<br>                        break;<br>        }<br><br>        dev-&gt;state_count = count;<br><br>        if (!count)<br>                return -EINVAL;<br><br>        return 0;<br>}<br>...&lt;snip&gt;...<br><br>또한 intel_pstate=disable 항목에 대한 문의도 있었는데, 이와 관련한 설명이 있는 KSC 문서를 확인하였습니다. <br>사실상 성능에 큰 차이가 나지는 않겠지만, cpu frequency를 항상 최대로 유지하고자 하신다면 tuned를 비활성화하고 kernel parameter에 intel_pstate=disable 항목을 추가하여야 합니다.<br><br>intel_idle.max_cstate=0 processor.max_cstate=1 intel_pstate=disable<br><br>자세한 설명은 아래 KCS 문서를 참고하시기 바랍니다. <br><br>Maximum CPU frequency is not maintained<br>https://access.redhat.com/solutions/2895271<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2017-07-11T07:04:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JuE13IAF"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-07-11T02:39:37Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-07-11T02:39:37Z</b><br><br>안녕하세요 답변 감사드립니다.<br><br>추가로 한가지 확인 부탁드릴 값은<br>processor.max_cstate 값인데 intel_idle 를 사용하지 않을 경우 기본 ACPI Idle C-State 모듈로 알고있는데<br>이 값에 들어가는 범위와 cstate의 관계에 대해서 확인을 한번 부탁드리려고 합니다.<br><br>processor.max_cstate가 ACPI Idle C-state 모듈의 단계여서 0이 C0 라면 <br>Low Latency만을 고려했을 때 아래와 같은 커널 값 설정이 intel_idle을 사용하지 않으면서 기본 ACPI idle 모듈을 통한 C0 설정값인지 문의드립니다.<br><br>intel_idle.max_cstate=0 processor.max_cstate=0<br><br><publishedDate>2017-07-11T02:39:37Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jtz3TIAR"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-10T06:31:39Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-10T06:31:38Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>문의하신 내용에 대해 답변을 문의 내용 중간에 적었습니다.<br><br>(In reply to kim, jimin)<br>&gt; 안녕하세요 <br>&gt; <br>&gt; SDS 김지민 선임입니다.<br>&gt; <br>&gt; 1. p-state<br>&gt; HP x86 DL380(580) Gen9 제품군의 경우<br>&gt; 아래와 같이 전원관리 관련 BIOS 설정을 통해서 OS 상에서 제어(driver 동작)할 수 있게 됩니다.<br>&gt; HP에서는 BIOS에서 최대로 설정하거나 OS에서 최대로 설정하거나 사용자의 선택으로 guide를 받았고 OS에서 설정하는 것으로 하려고 합니다.<br>&gt; <br>&gt; Power Management → Advanced Power Options → Collaborative Power Control → Disabled <br>다시 알려주신데로 Enabled로 사용하셔야 OS에서 조정이 가능합니다.<br><br>&gt; <br>&gt; 2. c-state<br>&gt; c-state관려해서는 문의 사항이 있습니다. kernel option에 idle=poll(cpu가 idle일 때도 항상 poll 상태로)을 설정할 경우 <br>&gt; turbostat 결과에서 %Busy 상태로 모두 100%가 되는데요.<br>&gt; <br>&gt; 첫번째 문의 사항은 <br>&gt; %Busy 상태는 c0 상태처럼 보이는데 일반적으로라면 c1 상태보다 더 성능에 있어서는 괜찮은 상태가 아닌지해서 문의드립니다.<br><br>intel_idle.max_cstate를 0으로 설정하는 것은 c0 상태로만 두겠다는 뜻이며 intel_idle 드라이버를 사용하지 않는다는 의미입니다.<br>커널 Documentation의 kernel-parameter.txt 파일에 보면 아래와 같이 설명하고 있습니다.<br>        intel_idle.max_cstate=  [KNL,HW,ACPI,X86]<br>                        0       disables intel_idle and fall back on acpi_idle.<br>                        1 to 6  specify maximum depth of C-state.<br><br>latency 성능에는 유리합니다. 다만 이로인해서 전력 절감에는 효과적이지 않습니다.<br><br>&gt; <br>&gt; 추가로  두번째 문의 사항은 idle=poll 설정했을 때 아래와 같이 HT이 enable 되어있을 경우 performance가 degrade 된다는 메세지가 있는데<br>&gt; (참고로 현재 SAP의 권고로 AP 서버의 경우는 Hyperthreading은 모두 enable 상태 입니다.)<br>&gt; idle=poll 상태와 HT을 같이 적용하면 어떤 상황으로 문제가 되는지 문의드리려고 합니다.<br><br>https://access.redhat.com/solutions/792343 문서에서 언급하는데로 Hyperthreading 과 idle=poll을 함께 사용하는 것을 권장하지 않습니다.<br><br>위의 문서는 6.4버전인데 이 내용이 다른 버전에는 적용되지 않는것인가요?<br>이 사항은 특정 버전에서만 적용되는 사항이 아니라 버전에 상관 없이 두 가지 기술의 목적이 상충하기 때문입니다. <br>하이퍼쓰레딩은 물리적인 core를 논리적인 쓰레드로 구분하여 번갈아 가며 사용하는 것인데 반해 polling을 하게 되면 한쪽에서 계속 물리 코어를 점유하려고 하게 되기 때문에 성능이 반감될 가능성이 있습니다.<br><br>&gt; <br>&gt; Jul  6 15:57:10 DEWBWL0BSL kernel: process: WARNING: polling idle and HT enabled, performance may degrade<br>&gt; <br>&gt; root@DEWBWL0BSL / # grubby --update-kernel=ALL --args=&quot;idle=poll&quot;<br>&gt; <br>&gt; root@DEWBWL0BSL / # cat /proc/cmdline<br>&gt; BOOT_IMAGE=/vmlinuz-3.10.0-327.el7.x86_64 root=UUID=c5cb55e<br><br><publishedDate>2017-07-10T06:31:38Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JtsrKIAR"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-07-08T03:25:35Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-07-08T03:25:35Z</b><br><br>https://access.redhat.com/solutions/792343<br>위 의 내용을 보면 링크가 하이퍼쓰래드와 idle=poll을 같이 쓰지 말라고 나와 있습니다.<br>idle = poll 커널 매개 변수가 설정되고 하이퍼 스레딩이 사용 가능한 경우 성능의 저하가 발생될수 있고<br>idle = poll과 하이퍼쓰레드를 동시에 사용하는 것은 권장되지 않는다고 나와 있습니다.<br><br>위의 문서는 6.4버전인데 이 내용이 다른 버전에는 적용되지 않는것인가요?<br><br><publishedDate>2017-07-08T03:25:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JtgxLIAR"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-07-07T06:43:12Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-07-07T06:43:12Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br>제가 잘못 올린 것 같아서 HP HW에서 OS쪽에서 CPU Power를 관리하도록 BIOS에서 설정해주는 값은 Collaborative Power Control이 Enabled 입니다.<br><br>1. p-state<br>HP x86 DL380(580) Gen9 제품군의 경우<br>아래와 같이 전원관리 관련 BIOS 설정을 통해서 OS 상에서 제어(driver 동작)할 수 있게 됩니다.<br>HP에서는 BIOS에서 최대로 설정하거나 OS에서 최대로 설정하거나 사용자의 선택으로 guide를 받았고 OS에서 설정하는 것으로 하려고 합니다.<br><br>Power Management → Advanced Power Options → Collaborative Power Control → Enabled<br><br><publishedDate>2017-07-07T06:43:12Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jtgo2IAB"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-07-07T06:29:22Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-07-07T06:29:21Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>1. p-state<br>HP x86 DL380(580) Gen9 제품군의 경우<br>아래와 같이 전원관리 관련 BIOS 설정을 통해서 OS 상에서 제어(driver 동작)할 수 있게 됩니다.<br>HP에서는 BIOS에서 최대로 설정하거나 OS에서 최대로 설정하거나 사용자의 선택으로 guide를 받았고 OS에서 설정하는 것으로 하려고 합니다.<br><br>Power Management → Advanced Power Options → Collaborative Power Control → Disabled <br><br>2. c-state<br>c-state관려해서는 문의 사항이 있습니다. kernel option에 idle=poll(cpu가 idle일 때도 항상 poll 상태로)을 설정할 경우 <br>turbostat 결과에서 %Busy 상태로 모두 100%가 되는데요.<br><br>첫번째 문의 사항은 <br>%Busy 상태는 c0 상태처럼 보이는데 일반적으로라면 c1 상태보다 더 성능에 있어서는 괜찮은 상태가 아닌지해서 문의드립니다.<br><br>추가로  두번째 문의 사항은 idle=poll 설정했을 때 아래와 같이 HT이 enable 되어있을 경우 performance가 degrade 된다는 메세지가 있는데<br>(참고로 현재 SAP의 권고로 AP 서버의 경우는 Hyperthreading은 모두 enable 상태 입니다.)<br>idle=poll 상태와 HT을 같이 적용하면 어떤 상황으로 문제가 되는지 문의드리려고 합니다.<br><br>Jul  6 15:57:10 DEWBWL0BSL kernel: process: WARNING: polling idle and HT enabled, performance may degrade<br><br>root@DEWBWL0BSL / # grubby --update-kernel=ALL --args=&quot;idle=poll&quot;<br><br>root@DEWBWL0BSL / # cat /proc/cmdline<br>BOOT_IMAGE=/vmlinuz-3.10.0-327.el7.x86_64 root=UUID=c5cb55e1-be5f-40b7-99a0-8bb4ceb216a9 ro crashkernel=512M rhgb quiet LANG=en_US.UTF-8 nmi_watchdog=0 transparent_hugepage=never elevator=deadline rdloaddriver=hpsa rdloaddriver=qla2xxx intel_idle.max_cstate=0 processor.max_cstate=1 idle=poll<br><br>root@DEWBWL0BSL / # turbostat<br>     CPU Avg_MHz   %Busy Bzy_MHz TSC_MHz     SMI  CPU%c1  CPU%c3  CPU%c6  CPU%c7 CoreTmp  PkgTmp PkgWatt RAMWatt   PKG_%   RAM_%<br>       -    3596  100.00    3596    3496       0    0.00    0.00    0.00    0.00      63      63  112.06    6.22    0.00    0.00<br>       0    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      43      45   55.57    3.13    0.00    0.00<br>       8    3596  100.00    3596    3496      41    0.00<br>       1    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      41<br>       9    3596  100.00    3596    3496      41    0.00<br>       2    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      41<br>      10    3596  100.00    3596    3496      41    0.00<br>       3    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      41<br>      11    3596  100.00    3596    3496      41    0.00<br>       4    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      62      63   56.49    3.09    0.00    0.00<br>      12    3596  100.00    3596    3496      41    0.00<br>       5    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      62<br>      13    3596  100.00    3596    3496      41    0.00<br>       6    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      63<br>      14    3596  100.00    3596    3496      41    0.00<br>       7    3596  100.00    3596    3496      41    0.00    0.00    0.00    0.00      62<br><br><publishedDate>2017-07-07T06:29:21Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JteY4IAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-07-07T00:02:23Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-07-07T00:02:23Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>&gt; 커널모듈이 적제 되지 않는 이유는 무엇이며 적제된것과 안된것의 차이는 무엇인지요?<br><br>해당 기능은 intel의 CPU특징으로 cpu를 제어하는 기능이 커널모듈에서 작동하는 것이기 때문입니다.<br>======================<br>감사합니다.<br><br><publishedDate>2017-07-07T00:02:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JpNEiIAN"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-07-06T16:33:13Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-07-06T16:33:13Z</b><br><br>커널모듈이 적제 되지 않는 이유는 무엇이며 적제된것과 안된것의 차이는 무엇인지요?<br><br>p-state의 기능을 bios상에서 on시키면 cpufreq_stats을 로드 시키는것은 아닌지요?<br><br><publishedDate>2017-07-06T16:33:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JpHR7IAN"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-06T10:25:20Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-06T10:25:20Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>cpufreq_stats kernel module이 로드되어 있지 않아서 확인이 안되는 것으로 보입니다.<br>아래 명령으로 해당 kernel module을 적재하신 후에 반영이 되는지 확인해보시기 바랍니다.<br><br># modprobe cpufreq_stats<br># cpupower frequecy-info<br><br>(In reply to Huh, Kyung)<br>&gt; 다시 보내 주신 sosreport 파일에서 아래와 같이 확인하였습니다.<br>&gt; <br>&gt; cpupower idle-info 에서는 idle driver가 intel_idle이라고 표시가 제대로 되고 있는데, cpufreq driver는 저희가 제공하지 않는 driver가 동작하거나 없는 것 같습니다. <br>&gt; 좀 더 확인해보겠습니다.<br>&gt; <br>&gt; [khuh@khuh processor]$ cat cpupower_frequency-info<br>&gt; analyzing CPU 0:<br>&gt;   no or unknown cpufreq driver is active on this CPU<br>&gt;   boost state support:<br>&gt;     Supported: yes<br>&gt;     Active: yes<br>&gt; <br>&gt; [khuh@khuh processor]$ head cpupower_idle-info<br>&gt; CPUidle driver: intel_idle<br>&gt; CPUidle governor: menu<br>&gt; <br>&gt; Analyzing CPU 0:<br>&gt; Number of idle states: 5<br>&gt; Available idle states: POLL C1-HSW C1E-HSW C3-HSW C6-HSW<br>&gt; POLL:<br>&gt; Flags/Description: CPUIDLE CORE POLL IDLE<br>&gt; Latency: 0<br>&gt; Usage: 40529<br>&gt; <br>&gt; <br>&gt; (In reply to 타임게이트, 타임게이트)<br>&gt; &gt; 파일이 잘못 전송되었습니다. 확인 부탁드립니다.<br>&gt; &gt; 감사합니다.<br><br><publishedDate>2017-07-06T10:25:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JpHLJIA3"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-06T10:16:57Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-06T10:16:57Z</b><br><br>RHEL 6 도 유사하게 적용가능할 것으로 보입니다. 하지만 정확하게 적용하기 위하여 RHEL 6 버전의 Power Management Guide 문서를 참고하셔서 적용하실 것을 권장합니다.<br><br>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Power_Management_Guide/index.html<br><br>(In reply to 타임게이트, 타임게이트)<br>&gt; 답변감사합니다.<br>&gt; 금주에 cstat작업을 진행하고 하는데요.<br>&gt; rhel6.7 rhel6.5 버전의 서버군에도 작업이 필요할것으로 보입니다.<br>&gt; <br>&gt; 6.7 과 6.5도 7.2와 마찬가지로 진행을 하면되는 부분인지 질문드립니다.<br><br><publishedDate>2017-07-06T10:16:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JpHHbIAN"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-06T10:12:43Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-06T10:12:43Z</b><br><br>큰 차이는 없을 것 같습니다만, 항상 최대로 사용하시길 원하신다면 둘 다 설정하시면 될 것 같습니다.<br>--min, --max는 기본적으로 하드웨어서 지원가능한 최저치와 최대치가 설정됩니다.<br><br>(In reply to 타임게이트, 타임게이트)<br>&gt; P-state 설정시 cpupower 명령을 이용하여 performance 모드를 진행하는것이랑 --min --max 값을 최대값으로 fix하여 설정하는 것이랑 차이가 있는지 확인 부탁드립니다<br><br><publishedDate>2017-07-06T10:12:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JpHDKIA3"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-06T10:06:32Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-06T10:06:32Z</b><br><br>다시 보내 주신 sosreport 파일에서 아래와 같이 확인하였습니다.<br><br>cpupower idle-info 에서는 idle driver가 intel_idle이라고 표시가 제대로 되고 있는데, cpufreq driver는 저희가 제공하지 않는 driver가 동작하거나 없는 것 같습니다. <br>좀 더 확인해보겠습니다.<br><br>[khuh@khuh processor]$ cat cpupower_frequency-info<br>analyzing CPU 0:<br>  no or unknown cpufreq driver is active on this CPU<br>  boost state support:<br>    Supported: yes<br>    Active: yes<br><br>[khuh@khuh processor]$ head cpupower_idle-info<br>CPUidle driver: intel_idle<br>CPUidle governor: menu<br><br>Analyzing CPU 0:<br>Number of idle states: 5<br>Available idle states: POLL C1-HSW C1E-HSW C3-HSW C6-HSW<br>POLL:<br>Flags/Description: CPUIDLE CORE POLL IDLE<br>Latency: 0<br>Usage: 40529<br><br><br>(In reply to 타임게이트, 타임게이트)<br>&gt; 파일이 잘못 전송되었습니다. 확인 부탁드립니다.<br>&gt; 감사합니다.<br><br><publishedDate>2017-07-06T10:06:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JpB0QIAV"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-07-06T07:52:33Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-07-06T07:52:33Z</b><br><br>답변감사합니다.<br>금주에 cstat작업을 진행하고 하는데요.<br>rhel6.7 rhel6.5 버전의 서버군에도 작업이 필요할것으로 보입니다.<br><br>6.7 과 6.5도 7.2와 마찬가지로 진행을 하면되는 부분인지 질문드립니다.<br><br><publishedDate>2017-07-06T07:52:33Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jp8VmIAJ"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-07-06T02:27:12Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-07-06T02:27:11Z</b><br><br>P-state 설정시 cpupower 명령을 이용하여 performance 모드를 진행하는것이랑 --min --max 값을 최대값으로 fix하여 설정하는 것이랑 차이가 있는지 확인 부탁드립니다<br><br><publishedDate>2017-07-06T02:27:11Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jp8QrIAJ"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-07-06T02:14:11Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-07-06T02:14:11Z</b><br><br>파일이 잘못 전송되었습니다. 확인 부탁드립니다.<br>감사합니다.<br><br><publishedDate>2017-07-06T02:14:11Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jov4LIAR"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-05T08:46:12Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-05T08:46:12Z</b><br><br>보내주신 sosreport 파일을 확인해보니 VMware에서 작동 중인 가상 머신으로 확인하였습니다.<br><br>  System:<br>    Mfr:  VMware, Inc.<br>    Prod: VMware Virtual Platform<br>    Vers: None<br>    Ser:  VMware-42 3c 71 5f 86 a7 97 90-f5 7e 9e e3 30 48 56 11<br>    UUID: 423C715F-86A7-9790-F57E-9EE330485611<br><br>intel_pstate 는 물리 시스템에서만 적용 가능합니다.<br><br>가상시스템이기 때문에 cpupower idle-info 명령의 결과를 보면 CPUidle driver가 acpi_idle 로 적용되는 것 같습니다.<br><br>[khuh@khuh processor]$ pwd<br>/home/khuh/Case/01883336/sosreport-DECMAL01SL-20170622113151/sos_commands/processor<br>[khuh@khuh processor]$ cat cpupower_idle-info<br>CPUidle driver: acpi_idle<br>CPUidle governor: menu<br><br>Analyzing CPU 0:<br>CPU 0: No idle states<br><br>물리시스템에서 확인을 하면 아래와 같이 출력됩니다.<br><br>~]# cpupower idle-info<br>CPUidle driver: intel_idle<br>CPUidle governor: menu<br>analyzing CPU 0:<br><br>Number of idle states: 5<br>Available idle states: POLL C1-HSW C1E-HSW C3-HSW C6-HSW<br>POLL:<br>Flags/Description: CPUIDLE CORE POLL IDLE<br>Latency: 0<br>Usage: 88<br>Duration: 203811<br>C1-HSW:<br>Flags/Description: MWAIT 0x00<br>Latency: 2<br>Usage: 166713<br>Duration: 12180136736<br>C1E-HSW:<br>Flags/Description: MWAIT 0x01<br>Latency: 10<br>Usage: 5774<br>Duration: 3209438<br>C3-HSW:<br>Flags/Description: MWAIT 0x10<br>Latency: 33<br>Usage: 7188<br>Duration: 21631390<br>C6-HSW:<br>Flags/Description: MWAIT 0x20<br>Latency: 133<br>Usage: 78703<br>Duration: 10445307651<br><br>허 경 드림.<br><br><publishedDate>2017-07-05T08:46:12Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JouM0IAJ"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2017-07-05T07:32:06Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2017-07-05T07:32:06Z</b><br><br>실제 운영장비에서  아래 명령어를 확인해보면 driver부분에 intel_pstate 부분이 나오지 않습니다<br><br>예)))~]# cpupower frequency-info<br>analyzing CPU 0:<br>  driver: intel_pstate<br><br>이건 실제로 P-state 상태가 어떻게 동작중인지 확인하는 방법 가이드 부탁드립니다<br><br>실제 운영중인 서버 sosreport 파일 첨부드립니다<br><br><publishedDate>2017-07-05T07:32:06Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JotebIAB"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-05T06:26:02Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-05T06:26:01Z</b><br><br>Q-3) 한가지 cpupower.service 를 실행해도 같은 효과를 볼수 있는건가요?<br><br>A-3) cpupower.service를 설정하실 경우 /etc/sysconfig/cpupower에 설정에 따라 서비스 시작/종료 시 적용할 governor를 지정해 줄 수 있습니다.<br><br>~]# cat /etc/sysconfig/cpupower<br># See 'cpupower help' and cpupower(1) for more info<br>CPUPOWER_START_OPTS=&quot;frequency-set -g performance&quot;<br>CPUPOWER_STOP_OPTS=&quot;frequency-set -g ondemand&quot;<br><br><publishedDate>2017-07-05T06:26:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JotZmIAJ"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-05T06:19:11Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-05T06:19:11Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>추가로 질문하신 내용에 대해 답변드립니다.<br><br>Q-1) C-stat 같은 경우 적용하여 사용하면 될꺼 같은데요<br>P-stat 같은경우 방식이 intel_pstat와 acpi_cpufreq 두 종류가 있고 boot parameter에 intel_pstate=disable 적용할 경우 <br>ACPI CPUfreq 드라이버를 통해 제어하는 것으로 변경된다고 제가 이해했는데요 이렇게 이해하면 되는건가요?<br><br>A-1) 네, 그렇습니다.<br><br>Q-2) 저희의 목표는 최고의 퍼퍼먼스를 낼수 있도록 설정하는것이 목표인데요 <br>ACPI_cpufreq로 변경된다고 가정하면 실제로 성능을 고려할때 intel_pstate를 disable 하는것이  더 높은 성능을 내는것이 맞는지요?<br><br>A-2) intel_pstate=disable 을 적용하는 것 보다는 cpupower frequency-set --governor performance 를 적용하는 것이 좋을 것 같습니다.<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2017-07-05T06:19:11Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JotaKIAR"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2017-07-05T06:19:08Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2017-07-05T06:19:08Z</b><br><br>한가지 cpupower.service 를 실행해도 같은 효과를 볼수 있는건가요?<br><br><publishedDate>2017-07-05T06:19:08Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JotI1IAJ"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2017-07-05T05:34:39Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2017-07-05T05:34:39Z</b><br><br>안녕하십니까 답변  감사합니다<br><br>몇가지 궁금한 사항이 있습니다<br><br>C-stat 같은 경우 적용하여 사용하면 될꺼 같은데요<br>P-stat 같은경우 방식이 intel_pstat와 acpi_cpufreq 두 종류가 있고 boot parameter에 intel_pstate=disable 적용할 경우 <br>ACPI CPUfreq 드라이버를 통해 제어하는 것으로 변경된다고 제가 이해했는데요 이렇게 이해하면 되는건가요?<br><br>저희의 목표는 최고의 퍼퍼먼스를 낼수 있도록 설정하는것이 목표인데요 <br>ACPI_cpufreq로 변경된다고 가정하면 실제로 성능을 고려할때 intel_pstate를 disable 하는것이  더 높은 성능을 내는것이 맞는지요?<br><br><publishedDate>2017-07-05T05:34:39Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Josc5IAB"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2017-07-05T03:24:06Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2017-07-05T03:24:06Z</b><br><br>안녕하세요? <br>레드햇 Senior Technical Account Manager 허경입니다.<br><br>문의하신 내용에 대하여 답변드립니다.<br><br>1. C-states<br><br>C-states에 대한 설명과 적용 방법은 아래 문서를 참고하시기 바랍니다.<br>What are CPU &quot;C-states&quot; and how to disable them if needed?<br>https://access.redhat.com/solutions/202743<br><br>아래는 적용 전/후 turbostat, powertop 에서 달라지는 부분을 정리한 내용입니다.<br><br>cstate 관련 boot parameter 적용 전 <br><br>~]# turbostat<br>     CPU Avg_MHz   %Busy Bzy_MHz TSC_MHz     SMI  CPU%c1  CPU%c3  CPU%c6  CPU%c7 CoreTmp  PkgTmp PkgWatt RAMWatt   PKG_%   RAM_%<br>       -       2    0.07    2666    2397       0    0.15    0.18   99.60    0.00      47      54   14.91    2.24    0.00    0.00<br>       0       0    0.02    2095    2397       0    0.05    0.01   99.91    0.00      44      54   14.91    2.24    0.00    0.00<br>       6       0    0.02    1676    2397       0    0.06<br>       1      12    0.40    3088    2397       0    0.05    1.02   98.53    0.00      47<br>       7       0    0.00    1710    2397       0    0.45<br>       2       0    0.01    1999    2397       0    0.16    0.01   99.83    0.00      47<br>       8       2    0.08    2259    2397       0    0.09<br>       3       1    0.03    2106    2397       0    0.07    0.04   99.86    0.00      44<br>       9       1    0.03    2631    2397       0    0.08<br>       4       1    0.08    1529    2397       0    0.35    0.02   99.54    0.00      45<br>      10       5    0.16    2872    2397       0    0.27<br>       5       0    0.02    1636    2397       0    0.06    0.00   99.92    0.00      46<br>      11       0    0.01    2363    2397       0    0.07<br><br>cstate 관련 boot parameter 적용 후 <br><br>~]# turbostat<br>     CPU Avg_MHz   %Busy Bzy_MHz TSC_MHz     SMI  CPU%c1  CPU%c3  CPU%c6  CPU%c7 CoreTmp  PkgTmp PkgWatt RAMWatt   PKG_%   RAM_%<br>       -       1    0.03    2600    2397       0   99.97    0.00    0.00    0.00      55      62   27.24    2.22    0.00    0.00<br>       0       0    0.00    2591    2397       0  100.00    0.00    0.00    0.00      52      62   27.24    2.22    0.00    0.00<br>       6       0    0.01    2602    2397       0   99.99<br>       1       8    0.29    2600    2397       0   99.71    0.00    0.00    0.00      53<br>       7       0    0.01    2600    2397       0   99.99<br>       2       1    0.05    2600    2397       0   99.95    0.00    0.00    0.00      55<br>       8       0    0.00    2600    2397       0  100.00<br>       3       0    0.01    2597    2397       0   99.99    0.00    0.00    0.00      53<br>       9       0    0.01    2601    2397       0   99.99<br>       4       0    0.01    2601    2397       0   99.99    0.00    0.00    0.00      54<br>      10       0    0.00    2602    2397       0  100.00<br>       5       0    0.01    2600    2397       0   99.99    0.00    0.00    0.00      54<br>      11       0    0.01    2600    2397       0   99.99<br><br>CPU%c1 비율이 대부분을 차지하게 됨 즉, c1 state를 항상 유지하는 결과<br><br>cstate 관련 boot parameter 적용 전 powertop의 Idle stats<br><br>PowerTOP 2.3      Overview   Idle stats   Frequency stats   Device stats   Tunables<br><br>          Package   |             Core    |            CPU 0<br>   CPU 6<br>POLL        0.0%    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>C1E-HSW     0.3%    | C1E-HSW     0.0%    | C1E-HSW     0.0%    0.0 ms  0.0%    0.1 ms<br>C3-HSW      1.2%    | C3-HSW<br>  0.0%    | C3-HSW<br>0.0%    0.2 ms  0.1%    0.3 ms<br>C6-HSW     95.8%    | C6-HSW     95.2%    | C6-HSW     91.1%  219.7 ms 99.2%  113.3 ms<br><br>                    |             Core    |            CPU 1<br>   CPU 7<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     1.3%    | C1E-HSW     2.7%  106.3 ms  0.0%    0.0 ms<br>                    | C3-HSW<br>  0.5%    | C3-HSW<br>1.0%   25.2 ms  0.0%    0.6 ms<br>                    | C6-HSW     96.3%    | C6-HSW     95.7%   78.8 ms 96.9%  228.0 ms<br><br>                    |             Core    |            CPU 2<br>   CPU 8<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     0.0%    | C1E-HSW     0.0%    0.0 ms  0.0%    0.2 ms<br>                    | C3-HSW<br>  0.1%    | C3-HSW<br>0.1%   11.9 ms  0.0%    0.3 ms<br>                    | C6-HSW     99.2%    | C6-HSW     98.5%  198.7 ms 99.9%  117.5 ms<br><br>                    |             Core    |            CPU 3<br>   CPU 9<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     0.0%    | C1E-HSW     0.0%    0.3 ms  0.0%    0.2 ms<br>                    | C3-HSW<br>  5.3%    | C3-HSW<br>0.0%    0.5 ms 10.5%  297.2 ms<br>                    | C6-HSW     94.0%    | C6-HSW     98.5%  129.0 ms 89.4%  223.8 ms<br><br>                    |             Core    |            CPU 4<br>   CPU 10<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     0.6%    | C1E-HSW     0.0%    0.0 ms  1.2%   76.0 ms<br>                    | C3-HSW<br>  1.3%    | C3-HSW<br>0.0%    1.3 ms  2.5%   82.4 ms<br>                    | C6-HSW     98.0%    | C6-HSW    100.0%  125.0 ms 96.1%  177.5 ms<br><br>                    |             Core    |            CPU 5<br>   CPU 11<br>                    | POLL        0.0%    | POLL        0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C1E-HSW     0.0%    | C1E-HSW     0.0%    0.0 ms  0.0%    0.0 ms<br>                    | C3-HSW<br>  0.1%    | C3-HSW<br>0.1%    6.6 ms  0.0%    0.2 ms<br>                    | C6-HSW     92.3%    | C6-HSW     97.8%   65.3 ms 86.8% 1071.9 ms<br><br>cstate 관련 boot parameter 적용 후 powertop의 Idle stats<br><br>cstate 변경이 없기 때문에 POLL, C1E-HSW, C3-HSW, C6-HSW과 같은 정보를 아예 표시하지 않게 됩니다.<br><br>PowerTOP 2.3      Overview   Idle stats   Frequency stats   Device stats   Tunables<br><br><br>          Package   |             Core    |            CPU 0<br>   CPU 6<br><br>                    |             Core    |            CPU 1<br>   CPU 7<br><br>                    |             Core    |            CPU 2<br>   CPU 8<br><br>                    |             Core    |            CPU 3<br>   CPU 9<br><br>                    |             Core    |            CPU 4<br>   CPU 10<br><br>                    |             Core    |            CPU 5<br>   CPU 11<br><br>2. P-state<br><br>P-state<br>Currently, Intel P-state is used by default for supported CPUs. Users can switch to using ACPI CPUfreq by adding the following to the kernel command line:<br><br>intel_pstate=disable <br><br>출처 : https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Power_Management_Guide/cpufreq_governors.html<br><br>boot parameter에 intel_pstate=disable 적용할 경우 ACPI CPUfreq 드라이버를 통해 제어하는 것으로 변경됩니다.<br>최신 프로세서에서 제공하는 기능이고 RHEL7에서 intel p-state 기능을 제어할 수 있도록 p-state 드라이버를 제공하는 것이기 때문에 비활성화하는 것보다는 적절히 설정하여 활용하는 것이 바람직합니다.<br><br>cpupower 도구를 이용하여 적용과 확인이 가능합니다.<br><br>cpupower 명령을 이용하여 적용가능한 cpufreq governor를 확인 가능<br> # cpupower frequency-info<br><br>cpupower 명령을 이용하여 적용가능한 cpufreq governor로 설정 가능<br> # cpupower frequency-set --governor performance <br><br>[root@dell-per430-05 intel_pstate]# cpupower frequency-set --governor performance<br>Setting cpu: 0<br>Setting cpu: 1<br>Setting cpu: 2<br>Setting cpu: 3<br>Setting cpu: 4<br>Setting cpu: 5<br>Setting cpu: 6<br>Setting cpu: 7<br>Setting cpu: 8<br>Setting cpu: 9<br>Setting cpu: 10<br>Setting cpu: 11<br>[root@dell-per430-05 intel_pstate]# cpupower frequency-info<br>analyzing CPU 0:<br>  driver: intel_pstate<br>  CPUs which run at the same hardware frequency: 0<br>  CPUs which need to have their frequency coordinated by software: 0<br>  maximum transition latency:  Cannot determine or is not supported.<br>  hardware limits: 1.20 GHz - 3.20 GHz<br>  available cpufreq governors: performance powersave<br>  current policy: frequency should be within 1.20 GHz and 3.20 GHz.<br>                  The governor &quot;performance&quot; may decide which speed to use<br>                  within this range.<br>  current CPU frequency: 2.29 GHz (asserted by call to hardware)<br>  boost state support:<br>    Supported: yes<br>    Active: yes<br><br>[root@dell-per430-05 intel_pstate]# cpupower frequency-set --governor powersave<br>Setting cpu: 0<br>Setting cpu: 1<br>Setting cpu: 2<br>Setting cpu: 3<br>Setting cpu: 4<br>Setting cpu: 5<br>Setting cpu: 6<br>Setting cpu: 7<br>Setting cpu: 8<br>Setting cpu: 9<br>Setting cpu: 10<br>Setting cpu: 11<br>~]# cpupower frequency-info<br>analyzing CPU 0:<br>  driver: intel_pstate<br>  CPUs which run at the same hardware frequency: 0<br>  CPUs which need to have their frequency coordinated by software: 0<br>  maximum transition latency:  Cannot determine or is not supported.<br>  hardware limits: 1.20 GHz - 3.20 GHz<br>  available cpufreq governors: performance powersave<br>  current policy: frequency should be within 1.20 GHz and 3.20 GHz.<br>                  The governor &quot;powersave&quot; may decide which speed to use<br>                  within this range.<br>  current CPU frequency: 2.13 GHz (asserted by call to hardware)<br>  boost state support:<br>    Supported: yes<br>    Active: yes<br><br>좀 더 상세한 내용을 확인하려면 아래 문서를 참조하십시오.<br> https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Power_Management_Guide/cpufreq_governors.html <br><br>OS boot parameter를 변경하지 않고 조정하려면 tuned를 이용하여 할 수 있습니다.<br>tuned의 기본 프로파일 중 performance 관련 프로파일을 이용하여 비슷한 효과를 볼 수 있습니다.<br><br>~]# tuned-adm list<br>Available profiles:<br>- balanced                    - General non-specialized tuned profile<br>- desktop                     - Optmize for the desktop use-case<br>- latency-performance         - Optimize for deterministic performance at the cost of increased power consumption<br>- network-latency             - Optimize for deterministic performance at the cost of increased power consumption, focused on low latency network performance<br>- network-throughput          - Optimize for streaming network throughput.  Generally only necessary on older CPUs or 40G+ networks.<br>- powersave                   - Optimize for low power consumption<br>- throughput-performance      - Broadly applicable tuning that provides excellent performance across a variety of common server workloads.  This is the default profile for RHEL7.<br>- virtual-guest               - Optimize for running inside a virtual guest.<br>- virtual-host                - Optimize for running KVM guests<br>Current active profile: virtual-host<br><br>~]# turbostat<br>     CPU Avg_MHz   %Busy Bzy_MHz TSC_MHz     SMI  CPU%c1  CPU%c3  CPU%c6  CPU%c7 CoreTmp  PkgTmp PkgWatt RAMWatt   PKG_%   RAM_%<br>       -       8    0.26    2948    2397       0    8.83    0.47   90.44    0.00      56      64   16.81    2.22    0.00    0.00<br>       0       1    0.04    2453    2397       0   16.41    0.13   83.42    0.00      54      64   16.81    2.22    0.00    0.00<br>       6       5    0.22    2538    2397       0   16.23<br>       1      42    1.41    3006    2397       0    5.53    2.14   90.92    0.00      55<br>       7       0    0.01    2589    2397       0    6.92<br>       2       2    0.09    2089    2397       0    1.07    0.13   98.70    0.00      56<br>       8      21    0.66    3114    2397       0    0.50<br>       3      13    0.42    3041    2397       0    0.23    0.04   99.31    0.00      55<br>       9       4    0.12    3055    2397       0    0.53<br>       4       1    0.05    2715    2397       0    0.24    0.34   99.37    0.00      54<br>      10       1    0.03    2089    2397       0    0.26<br>       5       1    0.03    2597    2397       0   29.01    0.02   70.94    0.00      56<br>      11       0    0.01    2716    2397       0   29.03<br>^C<br>~]# tuned-adm profile latency-performance<br>~]# tuned-adm list<br>Available profiles:<br>- balanced                    - General non-specialized tuned profile<br>- desktop                     - Optmize for the desktop use-case<br>- latency-performance         - Optimize for deterministic performance at the cost of increased power consumption<br>- network-latency             - Optimize for deterministic performance at the cost of increased power consumption, focused on low latency network performance<br>- network-throughput          - Optimize for streaming network throughput.  Generally only necessary on older CPUs or 40G+ networks.<br>- powersave                   - Optimize for low power consumption<br>- throughput-performance      - Broadly applicable tuning that provides excellent performance across a variety of common server workloads.  This is the default profile for RHEL7.<br>- virtual-guest               - Optimize for running inside a virtual guest.<br>- virtual-host                - Optimize for running KVM guests<br>Current active profile: latency-performance<br>~]# turbostat<br>     CPU Avg_MHz   %Busy Bzy_MHz TSC_MHz     SMI  CPU%c1  CPU%c3  CPU%c6  CPU%c7 CoreTmp  PkgTmp PkgWatt RAMWatt   PKG_%   RAM_%<br>       -       5    0.19    2600    2397       0   99.81    0.00    0.00    0.00      58      65   27.34    2.21    0.00    0.00<br>       0       0    0.01    2593    2397       0   99.99    0.00    0.00    0.00      56      65   27.34    2.21    0.00    0.00<br>       6       6    0.22    2600    2397       0   99.78<br>       1      34    1.32    2600    2397       0   98.68    0.00    0.00    0.00      56<br>       7       0    0.00    2605    2397       0  100.00<br>       2       0    0.01    2600    2397       0   99.99    0.00    0.00    0.00      57<br>       8       3    0.10    2600    2397       0   99.90<br>       3      13    0.49    2600    2397       0   99.51    0.00    0.00    0.00      56<br>       9       0    0.00    2595    2397       0  100.00<br>       4       3    0.10    2600    2397       0   99.90    0.00    0.00    0.00      57<br>      10       0    0.02    2599    2397       0   99.98<br>       5       1    0.03    2600    2397       0   99.97    0.00    0.00    0.00      58<br>      11       0    0.01    2599    2397       0   99.99<br>^C<br><br>더 자세한 사항은 전원 관리, 성능 조정, 자원 관리와 관련하여 고객 포털에서 제공하는 아래 문서를 참고하시기 바랍니다.<br><br>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Power_Management_Guide/index.html<br>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Performance_Tuning_Guide/index.html<br>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Resource_Management_Guide/index.html<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2017-07-05T03:24:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>