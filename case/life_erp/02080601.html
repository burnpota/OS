======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2018-04-18T04:04:49Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-05-09T10:02:47Z</b><br><b>id : 500A000000aP2UpIAK</b><br>======================<br><br><b><font size=15>
제목  : ifconfig 결과에서 error나 drop값 clear하는 방법 문ㅇ
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>아래와 같이 서버들의 네트워크 상태 정보 중에서 <br><br>packet 관련해서 error나 dropped가 발생한 내역이 보이는데<br>혹시 해당 내역에 대해서 clear 하는 방법을 문의드리려고 합니다.<br><br>이유는 OS 정기 점검 시 해당 내역에 대해서 확인을 하는데 clear가 되지 않으면<br><br>계속 검출이 되어서 혹시 다시 0으로 만드는 방법이 있는지 문의드리려고 합니다.<br><br>root@PBKMML01SL /root # cat /etc/redhat-release<br>Red Hat Enterprise Linux Server release 7.2 (Maipo)<br><br>root@PBKMML01SL /root # ifconfig<br>bond0: flags=5187&lt;UP,BROADCAST,RUNNING,MASTER,MULTICAST&gt;  mtu 1500<br>        inet 100.254.142.190  netmask 255.255.255.0  broadcast 100.254.142.255<br>        ether f4:e9:d4:8a:55:62  txqueuelen 0  (Ethernet)<br>        RX packets 728962666  bytes 169144822307 (157.5 GiB)<br>        RX errors 0  dropped 4  overruns 0  frame 0<br>        TX packets 1890520452  bytes 2610799587554 (2.3 TiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>=== 생략 ===<br><br>root@SLPAUSDL01 / # cat /etc/redhat-release<br>Red Hat Enterprise Linux Server release 6.6 (Santiago)<br><br>root@SLPAUSDL01 / # ifconfig<br>bond0     Link encap:Ethernet  HWaddr 28:80:23:AD:2D:6C<br>          inet addr:100.254.121.94  Bcast:100.254.121.255  Mask:255.255.255.0<br>          UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1<br>          RX packets:9838381375 errors:480 dropped:0 overruns:0 frame:248<br>          TX packets:9012091092 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:0<br>          RX bytes:6580348363571 (5.9 TiB)  TX bytes:9951946530264 (9.0 TiB)<br><br>=== 생략 ===<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PBKMML01SL</hostname><br><br><br><comment id="a0aA000000MPWoPIAX"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-04-23T02:32:19Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-04-23T02:32:19Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>네트워크 패킷 관련 통계 정보는 각각의 인터페이스 장치 별로 누적되는 것이기 때문에 bonding 인터페이스에 대한 통계와 bonding으로 구성되어 있는 물리적 인터페이스에 대한 통계는 각각 존재합니다.<br>bonding 인터페이스의 통계는 물리 인터페이스의 통계를 대신하여 보여주는 것은 아닙니다.<br>따라서, 모든 인터페이스의 통계를 리셋하기 위해서는 각 인터페이스가 사용하고 있는 커널 모듈을 내렸다가 올리는 작업을 진행할 수 밖에 없습니다.<br><br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-04-23T02:32:19Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MPBynIAH"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-04-20T04:23:13Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-04-20T04:23:13Z</b><br><br>안녕하세요<br><br>상세 답변 감사드립니다.<br><br>1가지 문의드릴 것이 문의드렸던 서버에서 <br><br>bond0는 p4p2 / p7p1 2개의 물리 port로 구성이 되어있는데요.<br><br>bond0의 drop 값이 4인데 p4p2와 p7p1에서는 해당 내역이 표시가 되지 않는 것 처럼 보여서 문의드립니다.<br>실제 Active 인 p4p2에서도 표시가 되야할 것 같은데 bonding 구성이 되어있으면 bonding device 기준으로만 표시가 되는 것인지 해서 문의드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-04-20T04:23:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MOt6kIAD"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2018-04-19T05:11:28Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2018-04-19T07:15:55Z</b><br><br>안녕하세요? Red Hat 송 창 안 입니다.<br>문의 주신 내용에 대해서 답변 하도록 하겠습니다.<br><br>앞서 가이드 드린 내용과 같이 bonding 인터페이스 관련 status만 clear 만 가능합니다.<br>만약 시스템에 해당하는 해당하는 전체 인터페이스들에 대해서 status값에 대해서 clear를 하려고 하는 경우는<br>각각의 NIC에 해당하는 인터페이스의 디바이스를 찾아서 clear 하는 것이 필요 합니다.<br><br>저는 아래와 같이 제가 가진 테스트 시스템에서 테스트를 진행을 하였습니다.  <br>1. ifconfig 명령어를 통해 해당하는 인터페이스를 확인<br><br># ifconfig<br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.64.168.124  netmask 255.255.255.0  broadcast 10.64.168.255<br>        inet6 fe80::5054:ff:fee8:b245  prefixlen 64  scopeid 0x20&lt;link&gt;<br>        ether 52:54:00:e8:b2:45  txqueuelen 1000  (Ethernet)<br>        RX packets 50828  bytes 70362780 (67.1 MiB)<br>        RX errors 0  dropped 6  overruns 0  frame 0<br>        TX packets 27718  bytes 2086762 (1.9 MiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536<br>        inet 127.0.0.1  netmask 255.0.0.0<br>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;<br>        loop  txqueuelen 1  (Local Loopback)<br>        RX packets 4  bytes 344 (344.0 B)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 4  bytes 344 (344.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br>2. 해당 인터페이스의 드라이버 명칭을 확인 합니다.<br># ethtool -i eth0<br>driver: virtio_net &lt;--------- 드라이버 이름은 virtio_net 입니다.<br>version: 1.0.0<br>firmware-version: <br>bus-info: 0000:00:03.0<br>supports-statistics: no<br>supports-test: no<br>supports-eeprom-access: no<br>supports-register-dump: no<br>supports-priv-flags: no<br><br>3. 해당하는 kernel 모듈이 어떤 내용이 있는지 확인하여, driver 명과 일치 여부를 파악합니다.<br># lsmod | grep virtio_net<br>virtio_net             28096  0 <br>virtio_ring            22746  5 virtio_blk,virtio_net,virtio_pci,virtio_balloon,virtio_console<br>virtio                 14959  5 virtio_blk,virtio_net,virtio_pci,virtio_balloon,virtio_console<br><br>4.해당 커널 모듈에 대해서 unloading 과정을 진행 합니다. -r 옵션은 해당 커널 모듈에 대해서 remove를 뜻하며,  <br>#modprobe -r virtio_net<br><br>5.만약 해당 과정에 대해서 좀더 자세히 확인 하고자 하신다면, 아래에서 -v 옵션을 추가하며, 자세히라는 파라메터를 뜻합니다.<br>#modprobe -v -r virtio_net<br><br>주의!!, 해당 커널 모듈을 unloading 하는 경우, 그 인터페이스를 사용하고 있던 어플리케이션들의 프로세스 상태가 &quot;Interruptible sleep&quot; 바뀌게 되며, <br>때에 따라서는 사용하는 어플리케이션에 대해서 장애 상황이 벌어 질수 있습니다. , <br>따라서 예기치 않는 장애에 대해서 문제가 있을 수 있기 때문에, 해당 인터페이스에 대해서 사용하는 어플리케이션에 대해서 종료 후 , 유지보수 시간에 이 내용을 진행하는 것을 권고 드립니다.<br><br>아래는 이런 상황에 대해서 테스트 한 내용을 언급한 설명 입니다.<br>(1) 시점 인 modprobe -r virtio_net 을 입력 했을 때의 해당 인터페이스를 사용중인 프로세스 상태는 &quot;+S&quot; 로 바뀌며, 이 뜻은 Interruptible sleep을 뜻하며, +는  foregroud 상태를 뜻합니다.<br>(2) 시점 인 modprobe virtio_net를 입력 한 이후 부터, &quot;R&quot; 상태로 바뀌어 동작이 진행 되게 됩니다. 하지만 테스트 한 ping 프로그램은 간단한 유틸리티 이며, 좀 더 복잡한 어플리 케이션인 경우<br>     상황이 틀려질 수 있음을 참고 부탁드립니다.<br><br>&lt;콘솔1&gt;<br>#modprobe -r virtio_net<br>#modprobe virtio_net<br><br>&lt;터미널2&gt;<br># ping google.com<br>PING google.com (74.125.204.138) 56(84) bytes of data.<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=1 ttl=41 time=66.9 ms<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=2 ttl=41 time=65.8 ms<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=3 ttl=41 time=65.9 ms<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=4 ttl=41 time=66.0 ms<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=5 ttl=41 time=65.9 ms<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=6 ttl=41 time=65.8 ms &lt;---- modprobe -r virtio_net 시점(1)<br>....<br>ping: sendmsg: Network is unreachable                                               &lt;---- modprobe virtio_net 시점(2)<br>ping: sendmsg: Network is unreachable                                               &lt;---- sendmsg 함수가 해당 인터페이스로 ping packet을 보낼 수 없기 때문에<br>ping: sendmsg: Network is unreachable                                                     Network is unreachable 에러 메세지<br>ping: sendmsg: Network is unreachable<br>ping: sendmsg: Network is unreachable<br>....<br>64 bytes from ti-in-f138.1e100.net (74.125.204.138): icmp_seq=112 ttl=41 time=65.8 ms<br><br><br>6. 다시 커널모듈을 다시 loading을 하는 과정을 진행 합니다.  -v 옵션을 추가하며, 자세히라는 파라메터를 뜻합니다.<br>이 경우 최종적으로 insmod를 이용하여,  커널 모듈을 loading 하게 됩니다. <br>물론 insmod 명령을 사용하여 커널 모듈을 loading 할 수도 있지만 종속성은 해결되지 않기 때문에,  항상 modprobe를 사용하여 모듈을로드해야합니다.<br>#modprobe -v virtio_net<br><br>7. ifup 명령을 통해, interface up을 합니다.<br>#ifup eth0<br><br>8. ifconfig 명령어를 통해, 해당 인터페이스의 상태를 확인 합니다. 아래에 저는 '0' 으로 clear 되지 않는 이유는 해당 인터페이스에 대해서 <br>   계속 테스트 프로그램인 ping에 대해서 트래픽이 발생 했기 때문입니다.<br><br># ifconfig<br>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 10.64.168.124  netmask 255.255.255.0  broadcast 10.64.168.255<br>        inet6 fe80::5054:ff:fee8:b245  prefixlen 64  scopeid 0x20&lt;link&gt;<br>        ether 52:54:00:e8:b2:45  txqueuelen 1000  (Ethernet)<br>        RX packets 31259  bytes 3304366 (3.1 MiB)<br>        RX errors 0  dropped 35  overruns 0  frame 0<br>        TX packets 4465  bytes 555935 (542.9 KiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br><br>감사합니다.<br>송 창 안 드림.<br><br><publishedDate>2018-04-19T05:11:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LW3dwIAD"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-04-18T07:09:15Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-04-18T07:09:15Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>답변 감사드립니다.<br><br>알려주신 방법으로 보면<br><br>1. reboot 하는 방법과<br><br>2. nic module을 reload하는 방법이 있는 것 처럼 보이는데<br><br>2번 절차에 대해서 문의를 드리면 bonding이 구성되어 있는 device에 대해서는 아래와 같은 식으로 하면 되는지 문의드립니다.<br><br>ifdown bond0 → modprobe -r bonding → modprobe bonding → ifup bond0<br><br>추가로 문의드릴 점은 bond0에 대한 dropped 항목이 증가하면 해당 device들도 증가해야할 것 같은데<br>p4p2, p7p1 device들은 변동이 없어서 문의드립니다.<br><br>root@PBKMML01SL /root # ethtool -i bond0<br>driver: bonding<br>version: 3.7.1<br>firmware-version: 2<br>bus-info:<br>supports-statistics: no<br>supports-test: no<br>supports-eeprom-access: no<br>supports-register-dump: no<br>supports-priv-flags: no<br><br> - 서비스망 down이므로 콘솔 작업 필요<br><br>root@PBKMML01SL /root # ifdown bond0<br>root@PBKMML01SL /root # modprobe -r bonding<br>root@PBKMML01SL /root # modprobe bonding<br>root@PBKMML01SL /root # ifup bond0<br><br> - device<br>root@PBKMML01SL /root # ifconfig<br>bond0: flags=5187&lt;UP,BROADCAST,RUNNING,MASTER,MULTICAST&gt;  mtu 1500<br>        inet ...  netmask 255.255.255.0  broadcast ...<br>        ether f4:e9:d4:8a:55:62  txqueuelen 0  (Ethernet)<br>        RX packets 729837824  bytes 169379198287 (157.7 GiB)<br>        RX errors 0  dropped 4  overruns 0  frame 0<br>        TX packets 1891979105  bytes 2612761351239 (2.3 TiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>==== 생략 ====<br><br>p4p2: flags=6211&lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST&gt;  mtu 1500<br>        ether f4:e9:d4:8a:55:62  txqueuelen 1000  (Ethernet)<br>        RX packets 723872905  bytes 168976971104 (157.3 GiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 1892142807  bytes 2612985390911 (2.3 TiB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>        device interrupt 101  memory 0xc8000000-c87fffff<br>==== 생략 ====<br><br>p7p1: flags=6211&lt;UP,BROADCAST,RUNNING,SLAVE,MULTICAST&gt;  mtu 1500<br>        ether f4:e9:d4:8a:55:62  txqueuelen 1000  (Ethernet)<br>        RX packets 6011315  bytes 410655359 (391.6 MiB)<br>        RX errors 0  dropped 0  overruns 0  frame 0<br>        TX packets 0  bytes 0 (0.0 B)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>        device interrupt 61  memory 0x93000000-937fffff<br><br> - bonding 구성 내역<br>root@PBKMML01SL /root # cat /proc/net/bonding/bond0<br>Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)<br><br>Bonding Mode: fault-tolerance (active-backup)<br>Primary Slave: None<br>Currently Active Slave: p4p2<br>MII Status: up<br>MII Polling Interval (ms): 100<br>Up Delay (ms): 0<br>Down Delay (ms): 0<br><br>Slave Interface: p4p2<br>MII Status: up<br>Speed: 10000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: f4:e9:d4:8a:55:62<br>Slave queue ID: 0<br><br>Slave Interface: p7p1<br>MII Status: up<br>Speed: 10000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: f4:e9:d4:8a:58:b0<br>Slave queue ID: 0<br><br>감사합니다.<br><br><publishedDate>2018-04-18T07:09:15Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LW2BPIA1"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-04-18T04:38:14Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-04-18T04:38:14Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>문의하신 ifconfig 명령 결과에 출력되는 통계를 리셋하기위해서는 시스템을 재부팅하거나 네트워크 인터페이스 카드의 커널 모듈을 내렸다가 다시 올려야만 합니다.<br>아래 문서 참고하셔서 적절한 시기에 적용하시는 것이 좋을 것 같습니다.<br><br>How to reset 'TX', 'RX' counters seen in 'ifconfig' command output and 'ethtool' statistics ?<br>https://access.redhat.com/solutions/125793<br><br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-04-18T04:38:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>