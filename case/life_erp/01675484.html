======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2016-07-28T01:22:15Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-08-13T10:11:18Z</b><br><b>id : 500A000000Us1UmIAJ</b><br>======================<br><br><b><font size=15>
제목  : netstat -ano 결과에서 timewait 관련
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요<br><br>SDS 상암센터 김지민 선임입니다.<br><br>netstat -ano 결과에서 timewait session 들에 대한 문의를 드리려고 하는데요.<br>장애가 발생하여 긴급한 건은 아니고 그냥 문의를 드리려고 합니다.<br><br>아래와 같이 netstat -ano 결과에서 tcp 관련 session이 종료가 될 때 timewait값이 60으로 정해져서 60초 후 완벽히 close가 되는 것 처럼 보이는데요.<br><br>timewait (60) 값은 심우택 차장님 통해서 확인했을 때 redhat kernel에서 정해진 값이어서 따로 parameter는 없는 것으로 확인하였고 추가로 문의드릴 점은 timewait 값을 적절하게 관리하기 위한 parameter 들에 대해서 확인을 부탁드리려고 합니다. 검색을 통해서 찾아봤는데 문의하는 것이 제일 정확할 것 같아서 문의드렸습니다.<br><br>root@PECCAL01SL / # netstat -ano | grep -i time<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State       Timer<br>tcp        0      0 100.254.142.21:39901    100.254.142.123:3350    TIME_WAIT   timewait (47.05/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.146.156:58571   TIME_WAIT   timewait (39.35/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.145.233:53094   TIME_WAIT   timewait (36.23/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.146.156:58618   TIME_WAIT   timewait (46.81/0/0)<br>tcp        0      0 100.254.142.21:894      100.254.180.52:24347    TIME_WAIT   timewait (41.89/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.146.156:58331   TIME_WAIT   timewait (14.95/0/0)<br>tcp        0      0 100.254.142.21:899      100.254.180.52:24347    TIME_WAIT   timewait (42.01/0/0)<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>추가로 OS에서 확인이 필요한 사항이 있으시면 알려주시면 됩니다.<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>N/A<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>N/A<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 4 (Low)</b><br>======================<br><comment id="a0aA000000HWsSAIA1"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2016-07-29T05:10:35Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2016-07-29T05:10:52Z</b><br><br>안녕하세요? Red Hat Technical Account Manager 송 창 안 입니다.<br><br>Q1. netstat -ano 결과에서 tcp 관련 session이 종료가 될 때 timewait값이 60으로 정해져서 60초 후 완벽히 close가 되는 것 처럼 보이는데요.<br>   timewait (60) 값은 심우택 차장님 통해서 확인했을 때 redhat kernel에서 정해진 값이어서 따로 parameter는 없는 것으로 확인하였습니다.<br>A. 앞서 이해하신 내용과 마찬가지로 커널에서는 아래와 같이 코드에 명시되 어 있으며, 그 값에 대해서는 하드코딩이 되어 있기 때문에 <br>   조정은 불가능 한것으로 판단 됩니다. 아래에서는 앞서 설명한 제 설명애 대한 내용입니다. <br><br>&quot;include/net/tcp.h&quot;<br>#define TCP_TIMEWAIT_LEN (60*HZ) /* how long to wait to destroy TIME-WAIT<br>                                  * state, about 60 seconds     */<br>#define TCP_FIN_TIMEOUT TCP_TIMEWAIT_LEN<br>                                 /* BSD style FIN_WAIT2 deadlock breaker.<br>                                  * It used to be 3min, new value is 60sec,<br>                                  * to combine FIN-WAIT-2 timeout with<br>                                  * TIME-WAIT timer.<br>                                  */<br><br>Q2.추가로 문의드릴 점은 timewait 값을 적절하게 관리하기 위한 parameter 들에 대해서 확인을 부탁드리려고 합니다. 검색을 통해서 찾아봤는데 문의하는 것이 제일 정확할 것 같아서 문의드렸습니다.<br><br>A. 정확히 설명 드린다면, timewait 값을 적절히 관리 할 수 있는 방법은 없는 것으로 판단 됩니다. TIME_WAIT 는 오래된 중복된 세그먼트를 정리해주는 중요한 역활을 하며, TCP 패킷의 오작동을 막아주는 중요한 구실한 하는 기능입니다. 따라서, timewait 현상들은 서버에 성능 저하를 발생하지 않으며, 만약 TIME_WAINT 상태의 4만개의 inbound 연결이 있다면, 실제 메모리는 10MB 안쪽에 해당 되기 때문에, 저의 판단에서는 서버에 큰 영향을 끼치지 않는 것으로 판단 됩니다. 하지만 튜닝이 필요 하고자 하시다면, 다음 내용을 권해드리고 싶습니다.<br><br>* TIME_WAIT 상태일 때 시스템 상황을 완화 시킬 수 있는 커널 파라메터 <br>커널 파라메터 중 TCP 타임스템프 설정 와  TCP TIME_WAIT Socket Recycle 설정 를 활성화 합니다. 현재 TIME_WAIT 소켓들에 대해서 새로운 연결로 부터 재사용 가능하게 합니다. 하지만, 만약 NAT 디바이스로 오는 연결이 경우에는 Session Drop이 발생이 발생이 가능 하니 판단후, 적용이 필요합니다.<br>net.ipv4.tcp_timestamps = 1<br>net.ipv4.tcp_tw_recycle = 1<br><br>제가 설명한 내용은 다음 저희 고객 포탈 정보 내용을 포함하고 있습니다.<br>https://access.redhat.com/solutions/24154<br><br>감사합니다.<br><br>송 창 안 드림.<br><br><publishedDate>2016-07-29T05:10:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HWNRiIAP"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2016-07-28T08:56:40Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2016-07-28T08:56:40Z</b><br><br>안녕하세요?<br>Red Hat Technical Account Manager 송 창 안 입니다.<br><br>문의 주신 내용에 대해서 확인 중에 있으며, 확인 후 정리하여 드리도록 하겠습니다.<br>감사합니다.<br><br>송 창 안 드림.<br><br><publishedDate>2016-07-28T08:56:40Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>SDS 상암센터 김지민 선임입니다.<br><br>netstat -ano 결과에서 timewait session 들에 대한 문의를 드리려고 하는데요.<br>장애가 발생하여 긴급한 건은 아니고 그냥 문의를 드리려고 합니다.<br><br>아래와 같이 netstat -ano 결과에서 tcp 관련 session이 종료가 될 때 timewait값이 60으로 정해져서 60초 후 완벽히 close가 되는 것 처럼 보이는데요.<br><br>timewait (60) 값은 심우택 차장님 통해서 확인했을 때 redhat kernel에서 정해진 값이어서 따로 parameter는 없는 것으로 확인하였고 추가로 문의드릴 점은 timewait 값을 적절하게 관리하기 위한 parameter 들에 대해서 확인을 부탁드리려고 합니다. 검색을 통해서 찾아봤는데 문의하는 것이 제일 정확할 것 같아서 문의드렸습니다.<br><br>root@PECCAL01SL / # netstat -ano | grep -i time<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State       Timer<br>tcp        0      0 100.254.142.21:39901    100.254.142.123:3350    TIME_WAIT   timewait (47.05/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.146.156:58571   TIME_WAIT   timewait (39.35/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.145.233:53094   TIME_WAIT   timewait (36.23/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.146.156:58618   TIME_WAIT   timewait (46.81/0/0)<br>tcp        0      0 100.254.142.21:894      100.254.180.52:24347    TIME_WAIT   timewait (41.89/0/0)<br>tcp        0      0 100.254.142.21:22       100.252.146.156:58331   TIME_WAIT   timewait (14.95/0/0)<br>tcp        0      0 100.254.142.21:899      100.254.180.52:24347    TIME_WAIT   timewait (42.01/0/0)</issue><environment>추가로 OS에서 확인이 필요한 사항이 있으시면 알려주시면 됩니다.</environment><periodicityOfIssue>N/A</periodicityOfIssue><timeFramesAndUrgency>N/A</timeFramesAndUrgency><cep>false</cep></case>