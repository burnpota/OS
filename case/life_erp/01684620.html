======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-08-14T04:26:07Z</b><br><b>마지막 답변자 : Meiyan Zheng</b><br><b>마지막 수정 일자 : 2016-08-17T06:49:11Z</b><br><b>id : 500A000000V2ZlRIAV</b><br>======================<br><br><b><font size=15>
제목  : Pacemaker Cluster Resource active on 2 nodes attempting recovery 이슈 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>현재 삼성생명 프로젝트에 SAP SCS/ERS 용도의 RHCS 가 구축되어 운영중입니다.<br><br>안정화 작업 중 특정 클러스터 그룹에서 장애 조치 후 원래 상태로 복원하는 과정에서 Resource 가 Stop-&gt;Start 되는 현상이 발견되어 문의 드립니다.<br><br>같은 종류의 SCS/ERS 클러스터 가 총 12세트가 있는데, 유독 1세트에서만 위와 같은 현상이 발견되었습니다.<br>(설정은 모두 동일 합니다.)<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>우선 위 문제가 발견 된 시나리오를 말씀드리면 아래와 같습니다.<br><br>1. Node1 Panic 후 Node2 에서 fence_kdump 작동 후 Resource Failover (리소스 : node2 active)<br><br>2. Node1 Reboot 후 pcs cluster start 로 클러스터 구동<br> -&gt; 리소스 스크립트(PEPSSCS_script)가 node1, node2 모두 started 되었다가, stop 후 다시 node2 에서 started 됨.<br><br>3. pcs resource move 명령으로 Node1 수동 옮김 (정상)<br><br>결과적으로 장애 난 노드의 클러스터를 시작하면 그대로 있어야 할 리소스 스크립트가 stop -&gt; start 되고 있습니다.<br><br>클러스터 구축 초기 이와 같은 문제가 있어 constraint score 를 적절히 조절하여 문제를 해결했었습니다.<br><br>하지만 지금과 같은 상황은 모든 클러스터 구축 노드의 score 값이 동일한데 불구하고 PEPSCL 클러스터에서만 이와 같은 현상이 발견되고 있습니다.<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>위 문제가 발견 되었을시 로그를 보면 아래와 같은 메세지가 기록되어 있습니다.<br><br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]: warning: Action 10 (PEPSSCS_script_monitor_0) on PEPSCL01SL-HB failed (target: 7 vs. rc: 0): Error<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Transition aborted by PEPSSCS_script_monitor_0 'create' on PEPSCL01SL-HB: Event failed (magic=0:0;10:11:7:6298102a-82e2-4856-afb5-57004a041096, cib=0.117.29, source=match_graph_event:381, 0)<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]: warning: Action 10 (PEPSSCS_script_monitor_0) on PEPSCL01SL-HB failed (target: 7 vs. rc: 0): Error<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 8: probe_complete probe_complete-PEPSCL01SL-HB on PEPSCL01SL-HB - no waiting<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Transition 11 (Complete=10, Pending=0, Fired=0, Skipped=2, Incomplete=5, Source=/var/lib/pacemaker/pengine/pe-input-185.bz2): Stopped<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Resource PEPSSCS_script (ocf::MySAP) is active on 2 nodes attempting recovery<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]: warning: See http://clusterlabs.org/wiki/FAQ#Resource_is_Too_Active for more information.<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Move    PEPSSCS_script#011(Started PEPSCL01SL-HB -&gt; PEPSCL02SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   ping:1#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   vmware_stonith2#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Calculated Transition 12: /var/lib/pacemaker/pengine/pe-error-13.bz2<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Resource PEPSSCS_script (ocf::MySAP) is active on 2 nodes attempting recovery<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]: warning: See http://clusterlabs.org/wiki/FAQ#Resource_is_Too_Active for more information.<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Move    PEPSSCS_script#011(Started PEPSCL01SL-HB -&gt; PEPSCL02SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   ping:1#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   vmware_stonith2#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Calculated Transition 13: /var/lib/pacemaker/pengine/pe-error-14.bz2<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 13: stop PEPSSCS_script_stop_0 on PEPSCL02SL-HB (local)<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 12: stop PEPSSCS_script_stop_0 on PEPSCL01SL-HB<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 37: start vmware_stonith2_start_0 on PEPSCL01SL-HB<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 27: start ping:1_start_0 on PEPSCL01SL-HB<br>Aug 13 00:04:46 PEPSCL02SL logger: EXCUTE : su - pepadm -c /home/pepadm/STOP_SCS.sh<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>PEPSCL 클러스터 2개 노드의 sosreport 를 dropbox.redhat.com 에 업로드 하겠습니다.<br><br>업로드 후 별도로 comment 하겠습니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 4 (Low)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000G6L97IAF"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-08-17T06:49:11Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-08-17T06:49:11Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>먼저 이슈가 잘 해결 되었다니 다행 입니다. 말씀 하신 대로 일단 본 케이스를 종료 처리를 해 드리도록 <br>하겠습니다. pacemaker 관련 테스트중 추가적인 문의 사항이 있으시면 새로운 케이스를 오픈 해 주시기 바랍니다. <br><br><br>즐거운 하루 되시기 바랍니다. <br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2016-08-17T06:49:11Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G6K3hIAF"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-08-17T04:05:43Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-08-17T04:05:43Z</b><br><br>안녕하세요.<br><br>초기 구동되는 Resource Monitor Script 설정이 잘못되어 양쪽에서 Started 되는 현상이 있었음을 확인하였습니다.<br><br>가용성 테스트 기간 중 추가 이슈가 발생 시 다시 케이스 오픈하도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-08-17T04:05:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HfZcvIAF"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-08-17T01:21:29Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-08-17T01:21:29Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>PEPSCL 클러스터 2개 노드의 sosreport를 dropbox.redhat.com 에 업로드 해 주시겠다고 하셨는데 <br>업로드 파일의 파일명을 케이스 코멘트로 명시 해 주시기 바랍니다. <br><br>가능 하시면, 동일 작업을 하신 기타 클러스터 세트의 sosreport도 같이 보내 주실수 있다면 문제점 <br>파악에 큰 도움이 될수 있을 것 같습니다. <br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2016-08-17T01:21:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HfAfvIAF"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-08-15T02:01:29Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-08-15T02:01:29Z</b><br><br>Dear Customer, <br><br>As today is public holiday in South Korea, you will get support from next business day.<br>Thank you for you understanding! <br><br><br>Best Regards,<br>Meiyan Zheng <br>Global Support Services<br>Red Hat, Inc<br><br><publishedDate>2016-08-15T02:01:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>현재 삼성생명 프로젝트에 SAP SCS/ERS 용도의 RHCS 가 구축되어 운영중입니다.<br><br>안정화 작업 중 특정 클러스터 그룹에서 장애 조치 후 원래 상태로 복원하는 과정에서 Resource 가 Stop-&gt;Start 되는 현상이 발견되어 문의 드립니다.<br><br>같은 종류의 SCS/ERS 클러스터 가 총 12세트가 있는데, 유독 1세트에서만 위와 같은 현상이 발견되었습니다.<br>(설정은 모두 동일 합니다.)</issue><environment>우선 위 문제가 발견 된 시나리오를 말씀드리면 아래와 같습니다.<br><br>1. Node1 Panic 후 Node2 에서 fence_kdump 작동 후 Resource Failover (리소스 : node2 active)<br><br>2. Node1 Reboot 후 pcs cluster start 로 클러스터 구동<br> -&gt; 리소스 스크립트(PEPSSCS_script)가 node1, node2 모두 started 되었다가, stop 후 다시 node2 에서 started 됨.<br><br>3. pcs resource move 명령으로 Node1 수동 옮김 (정상)<br><br>결과적으로 장애 난 노드의 클러스터를 시작하면 그대로 있어야 할 리소스 스크립트가 stop -&gt; start 되고 있습니다.<br><br>클러스터 구축 초기 이와 같은 문제가 있어 constraint score 를 적절히 조절하여 문제를 해결했었습니다.<br><br>하지만 지금과 같은 상황은 모든 클러스터 구축 노드의 score 값이 동일한데 불구하고 PEPSCL 클러스터에서만 이와 같은 현상이 발견되고 있습니다.</environment><periodicityOfIssue>위 문제가 발견 되었을시 로그를 보면 아래와 같은 메세지가 기록되어 있습니다.<br><br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]: warning: Action 10 (PEPSSCS_script_monitor_0) on PEPSCL01SL-HB failed (target: 7 vs. rc: 0): Error<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Transition aborted by PEPSSCS_script_monitor_0 'create' on PEPSCL01SL-HB: Event failed (magic=0:0;10:11:7:6298102a-82e2-4856-afb5-57004a041096, cib=0.117.29, source=match_graph_event:381, 0)<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]: warning: Action 10 (PEPSSCS_script_monitor_0) on PEPSCL01SL-HB failed (target: 7 vs. rc: 0): Error<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 8: probe_complete probe_complete-PEPSCL01SL-HB on PEPSCL01SL-HB - no waiting<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Transition 11 (Complete=10, Pending=0, Fired=0, Skipped=2, Incomplete=5, Source=/var/lib/pacemaker/pengine/pe-input-185.bz2): Stopped<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Resource PEPSSCS_script (ocf::MySAP) is active on 2 nodes attempting recovery<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]: warning: See http://clusterlabs.org/wiki/FAQ#Resource_is_Too_Active for more information.<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Move    PEPSSCS_script#011(Started PEPSCL01SL-HB -&gt; PEPSCL02SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   ping:1#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   vmware_stonith2#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Calculated Transition 12: /var/lib/pacemaker/pengine/pe-error-13.bz2<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Resource PEPSSCS_script (ocf::MySAP) is active on 2 nodes attempting recovery<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]: warning: See http://clusterlabs.org/wiki/FAQ#Resource_is_Too_Active for more information.<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Move    PEPSSCS_script#011(Started PEPSCL01SL-HB -&gt; PEPSCL02SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   ping:1#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:  notice: Start   vmware_stonith2#011(PEPSCL01SL-HB)<br>Aug 13 00:04:46 PEPSCL02SL pengine[57858]:   error: Calculated Transition 13: /var/lib/pacemaker/pengine/pe-error-14.bz2<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 13: stop PEPSSCS_script_stop_0 on PEPSCL02SL-HB (local)<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 12: stop PEPSSCS_script_stop_0 on PEPSCL01SL-HB<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 37: start vmware_stonith2_start_0 on PEPSCL01SL-HB<br>Aug 13 00:04:46 PEPSCL02SL crmd[57859]:  notice: Initiating action 27: start ping:1_start_0 on PEPSCL01SL-HB<br>Aug 13 00:04:46 PEPSCL02SL logger: EXCUTE : su - pepadm -c /home/pepadm/STOP_SCS.sh</periodicityOfIssue><timeFramesAndUrgency>PEPSCL 클러스터 2개 노드의 sosreport 를 dropbox.redhat.com 에 업로드 하겠습니다.<br><br>업로드 후 별도로 comment 하겠습니다.<br><br>감사합니다.</timeFramesAndUrgency><cep>false</cep></case>