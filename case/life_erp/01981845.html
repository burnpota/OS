======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2017-11-28T07:15:01Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-12-15T11:04:25Z</b><br><b>id : 500A000000Z4FLVIA3</b><br>======================<br><br><b><font size=15>
제목  : LUN 회수 절차 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>아래 DECCAL01SL 서버에서 아래와 같이 multipath 구성된 3개의 LUN이있습니다.<br><br>root@DECCAL01SL /root # multipath -ll | grep PSAP<br>PSAP100G003 (360060e8007c76f000030c76f00002002) dm-2 HITACHI ,OPEN-V<br>PSAP100G002 (360060e8007c76f000030c76f00002001) dm-5 HITACHI ,OPEN-V<br>PSAP100G001 (360060e8007c76f000030c76f00002000) dm-9 HITACHI ,OPEN-V<br><br>스토리지에서 해당 LUN들을 회수하려고 하는데요. <br><br>회수 절차 관련해서 문의드리려고 합니다.<br><br>대략적으로 아래와 같을 것 같은데 <br><br>OS에서 LUN device에 대해서 삭제 같은 부분까지 수행이 가능한지 문의드리려고 합니다.<br><br><br>1. 해당 LUN으로 구성된 파일시스템 umount <br>root@DECCAL01SL /root # df -Ph | grep LLDECCSAP<br>/dev/mapper/LLDECCSAPVG-usr_sap              10G  222M  9.8G   3% /usr/sap<br>/dev/mapper/LLDECCSAPVG-oracle              2.0G  215M  1.8G  11% /oracle<br>/dev/mapper/LLDECCSAPVG-usr_sap_REC         200G   55G  146G  28% /usr/sap/REC<br>/dev/mapper/LLDECCSAPVG-APP                  30G   33M   30G   1% /APP<br><br>2. 해당하는 LV 삭제<br>root@DECCAL01SL /root # lvs | grep LLDECCSAP<br>  APP         LLDECCSAPVG -wi-ao----  30.00g<br>  oracle      LLDECCSAPVG -wi-ao----   2.00g<br>  usr_sap     LLDECCSAPVG -wi-ao----  10.00g<br>  usr_sap_REC LLDECCSAPVG -wi-ao---- 200.00g<br><br>3. 해당하는 VG 삭제<br>root@DECCAL01SL /root # vgs<br>  VG          #PV #LV #SN Attr   VSize   VFree<br>  LLDECCSAPVG   3   4   0 wz--n- 299.99g 57.99g<br>  vg0           1   2   0 wz--n- 129.57g 99.57g<br>  vg9          14   2   0 wz--n-   1.37t     0<br><br>4. 해당하는 PV 삭제<br>root@DECCAL01SL /root # pvs | grep LLDECC<br>  /dev/mapper/PSAP100G001 LLDECCSAPVG lvm2 a--  100.00g 57.99g<br>  /dev/mapper/PSAP100G002 LLDECCSAPVG lvm2 a--  100.00g     0<br>  /dev/mapper/PSAP100G003 LLDECCSAPVG lvm2 a--  100.00g     0<br><br>5. multipath.conf 수정<br>root@DECCAL01SL /root # cat /etc/multipath.conf | grep -i psap -a3<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002000<br>                alias   PSAP100G001<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002001<br>                alias   PSAP100G002<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002002<br>                alias   PSAP100G003<br>       }<br><br>        multipath {<br><br>6. multipath flush 수행 (multipath -f)<br><br>7. multipath daemon reload (systemctl reload multipathd)<br><br>8. 스토리지에서 LUN 회수<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>DECCAL01SL</hostname><br><br><br><comment id="a0aA000000L5hDMIAZ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-11-30T07:52:02Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-11-30T07:52:01Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>나머지 부분은 그대로 진행하시고, 위의 5번을 아래와 같이 추가 진행하시면 될거 같습니다.<br><br>5. multipath.conf 내에 해당 path 들 삭제<br><br>$ multipath -f PSAP100G001<br>$ multipath -f PSAP100G002<br>$ multipath -f PSAP100G003<br>$ blockdev --flushbufs   /dev/mapper/PSAP100G001<br>$ blockdev --flushbufs   /dev/mapper/PSAP100G002<br>$ blockdev --flushbufs   /dev/mapper/PSAP100G003<br><br>root@DECCAL01SL' /root # cat /etc/multipath.conf | grep -i psap -a3<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002000<br>                alias   PSAP100G001<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002001<br>                alias   PSAP100G002<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002002<br>                alias   PSAP100G003<br>       }<br><br>        multipath {<br><br>감사합니다.<br><br><publishedDate>2017-11-30T07:52:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5fDcIAJ"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-11-30T03:35:31Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-11-30T03:35:31Z</b><br><br>안녕하세요 <br><br>답변 감사드립니다.<br><br>그럼 device path delete 절차를 추가하면 아래와 같이 작업을 하면 될까요?<br><br>1. 해당 LUN으로 구성된 파일시스템 umount <br>root@DECCAL01SL' /root # df -Ph | grep LLDECCSAP<br>/dev/mapper/LLDECCSAPVG-usr_sap              10G  222M  9.8G   3% /usr/sap<br>/dev/mapper/LLDECCSAPVG-oracle              2.0G  215M  1.8G  11% /oracle<br>/dev/mapper/LLDECCSAPVG-usr_sap_REC         200G   55G  146G  28% /usr/sap/REC<br>/dev/mapper/LLDECCSAPVG-APP                  30G   33M   30G   1% /APP<br><br>2. 해당하는 LV 삭제<br>root@DECCAL01SL' /root # lvs | grep LLDECCSAP<br>  APP         LLDECCSAPVG -wi-ao----  30.00g<br>  oracle      LLDECCSAPVG -wi-ao----   2.00g<br>  usr_sap     LLDECCSAPVG -wi-ao----  10.00g<br>  usr_sap_REC LLDECCSAPVG -wi-ao---- 200.00g<br><br>3. 해당하는 VG 삭제<br>root@DECCAL01SL' /root # vgs<br>  VG          #PV #LV #SN Attr   VSize   VFree<br>  LLDECCSAPVG   3   4   0 wz--n- 299.99g 57.99g<br>  vg0           1   2   0 wz--n- 129.57g 99.57g<br>  vg9          14   2   0 wz--n-   1.37t     0<br><br>4. 해당하는 PV 삭제<br>root@DECCAL01SL' /root # pvs | grep LLDECC<br>  /dev/mapper/PSAP100G001 LLDECCSAPVG lvm2 a--  100.00g 57.99g<br>  /dev/mapper/PSAP100G002 LLDECCSAPVG lvm2 a--  100.00g     0<br>  /dev/mapper/PSAP100G003 LLDECCSAPVG lvm2 a--  100.00g     0<br><br>5. multipath.conf 수정<br>root@DECCAL01SL' /root # cat /etc/multipath.conf | grep -i psap -a3<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002000<br>                alias   PSAP100G001<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002001<br>                alias   PSAP100G002<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002002<br>                alias   PSAP100G003<br>       }<br><br>        multipath {<br><br>6. multipath flush 수행 (multipath -f)<br><br>7. multipath daemon reload (systemctl reload multipathd)<br><br>(추가 절차) 8. device path 제거 작업 (echo 1 &gt; /sys/block/(해당 path)/device/delete)<br><br>9. 스토리지에서 LUN 회수<br><br><publishedDate>2017-11-30T03:35:31Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5Mn0IAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-11-29T02:30:46Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-11-29T02:30:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>아래의 참고문서[1]에 기술된 Procedure 를 활용하시면 리부팅하지 않고 LUN 을 시스템으로부터 제거하실 수 있을것입니다.<br><br>[ 참고문서 ]<br><br>[1] Can a SAN disk be removed from multipath without rebooting on Red Hat Enterprise Linux?<br>- https://access.redhat.com/solutions/20063<br><br>감사합니다.<br><br><publishedDate>2017-11-29T02:30:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>SDS 김지민 선임입니다.<br><br>아래 DECCAL01SL 서버에서 아래와 같이 multipath 구성된 3개의 LUN이있습니다.<br><br>root@DECCAL01SL /root # multipath -ll | grep PSAP<br>PSAP100G003 (360060e8007c76f000030c76f00002002) dm-2 HITACHI ,OPEN-V<br>PSAP100G002 (360060e8007c76f000030c76f00002001) dm-5 HITACHI ,OPEN-V<br>PSAP100G001 (360060e8007c76f000030c76f00002000) dm-9 HITACHI ,OPEN-V<br><br>스토리지에서 해당 LUN들을 회수하려고 하는데요. <br><br>회수 절차 관련해서 문의드리려고 합니다.<br><br>대략적으로 아래와 같을 것 같은데 <br><br>OS에서 LUN device에 대해서 삭제 같은 부분까지 수행이 가능한지 문의드리려고 합니다.<br><br><br>1. 해당 LUN으로 구성된 파일시스템 umount <br>root@DECCAL01SL /root # df -Ph | grep LLDECCSAP<br>/dev/mapper/LLDECCSAPVG-usr_sap              10G  222M  9.8G   3% /usr/sap<br>/dev/mapper/LLDECCSAPVG-oracle              2.0G  215M  1.8G  11% /oracle<br>/dev/mapper/LLDECCSAPVG-usr_sap_REC         200G   55G  146G  28% /usr/sap/REC<br>/dev/mapper/LLDECCSAPVG-APP                  30G   33M   30G   1% /APP<br><br>2. 해당하는 LV 삭제<br>root@DECCAL01SL /root # lvs | grep LLDECCSAP<br>  APP         LLDECCSAPVG -wi-ao----  30.00g<br>  oracle      LLDECCSAPVG -wi-ao----   2.00g<br>  usr_sap     LLDECCSAPVG -wi-ao----  10.00g<br>  usr_sap_REC LLDECCSAPVG -wi-ao---- 200.00g<br><br>3. 해당하는 VG 삭제<br>root@DECCAL01SL /root # vgs<br>  VG          #PV #LV #SN Attr   VSize   VFree<br>  LLDECCSAPVG   3   4   0 wz--n- 299.99g 57.99g<br>  vg0           1   2   0 wz--n- 129.57g 99.57g<br>  vg9          14   2   0 wz--n-   1.37t     0<br><br>4. 해당하는 PV 삭제<br>root@DECCAL01SL /root # pvs | grep LLDECC<br>  /dev/mapper/PSAP100G001 LLDECCSAPVG lvm2 a--  100.00g 57.99g<br>  /dev/mapper/PSAP100G002 LLDECCSAPVG lvm2 a--  100.00g     0<br>  /dev/mapper/PSAP100G003 LLDECCSAPVG lvm2 a--  100.00g     0<br><br>5. multipath.conf 수정<br>root@DECCAL01SL /root # cat /etc/multipath.conf | grep -i psap -a3<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002000<br>                alias   PSAP100G001<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002001<br>                alias   PSAP100G002<br>       }<br><br>        multipath {<br>                wwid    360060e8007c76f000030c76f00002002<br>                alias   PSAP100G003<br>       }<br><br>        multipath {<br><br>6. multipath flush 수행 (multipath -f)<br><br>7. multipath daemon reload (systemctl reload multipathd)<br><br>8. 스토리지에서 LUN 회수</issue><cep>false</cep></case>