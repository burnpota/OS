======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2017-03-24T15:56:05Z</b><br><b>마지막 답변자 : 삼성생명 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-20T07:53:50Z</b><br><b>id : 500A000000WkQ1sIAF</b><br>======================<br><br><b><font size=15>
제목  : network session disconnect issue between DB and AP under heavy load (FS-PM (PPMSAL) Migration 과정 Network Session 단절 이슈)
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br><br>현재 프로젝트 과정에서 HP-UX Oracle DB &lt;-&gt; FS-PM (AP) Migration 처리 작업이 있습니다.<br><br>이 작업이 진행될 때 DB Session 이 끊어졌다 다시 연결되는 문제가 발견 되었습니다.<br><br>관련 분석 자료 데이터 (sosreport 등) 를 dropbox.redhat.com 에 <br><br>파일명 PPMSAL03SL_RedHat_Case_20170324.zip 으로 업로드 하였습니다.<br><br>========================================<br><br>현재 Migration 이 진행되는 Interface 는 bond0 (ens2f0, ens5f1) 이며<br><br>현재 처리되는 Bonding Active Port 는 ens2f0 입니다.<br><br>/proc/interrupt 에서 ens2f0 device 를 보니 <br><br>Interrupt 가 CPU Core 30-39, 70-79 에서만 발생되는 것을 확인 하였습니다.<br><br>이를 토대로 확인해 보니 NUMA 배치가 아래와 같이 확인 되었습니다.<br><br>root@PPMSAL03SL # lscpu<br>Architecture:          x86_64<br>CPU op-mode(s):        32-bit, 64-bit<br>Byte Order:            Little Endian<br>CPU(s):                80<br>On-line CPU(s) list:   0-79<br>Thread(s) per core:    2<br>Core(s) per socket:    10<br>Socket(s):             4<br>NUMA node(s):          4<br>Vendor ID:             GenuineIntel<br>CPU family:            6<br>Model:                 63<br>Model name:            Intel(R) Xeon(R) CPU E7-8891 v3 @ 2.80GHz<br>Stepping:              4<br>CPU MHz:               2793.110<br>BogoMIPS:              5610.97<br>Virtualization:        VT-x<br>L1d cache:             32K<br>L1i cache:             32K<br>L2 cache:              256K<br>L3 cache:              46080K<br>NUMA node0 CPU(s):     0-9,40-49<br>NUMA node1 CPU(s):     10-19,50-59<br>NUMA node2 CPU(s):     20-29,60-69<br>NUMA node3 CPU(s):     30-39,70-79 &lt;== 해당 노드<br><br>이를 바탕으로 ens2f0 인터페이스의 interrupt 는 NUMA node3 CPU(s) 에서 이루어 진다고 확인 되었습니다.<br><br>========================================<br><br>다음으로 sar 의 runq 및 Load Avg 를 확인해 보니 Migration 이 이루어 지는 시간대 매우 높은 Load 를 확인 하였습니다.<br><br>11:00:01      runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked<br>11:01:01           81      2106     89.20     90.38     90.90         0<br>11:02:01           86      2099     89.68     90.28     90.83         0<br>11:03:01          100      2103     91.02     90.55     90.88         5<br>11:04:01           95      2097     92.62     91.11     91.06         2<br>11:05:01           92      2112     92.19     91.31     91.13         3<br>11:06:01           95      2109     90.68     91.12     91.08         1<br>11:07:01           91      2106     89.32     90.67     90.93         2<br>11:08:01           85      2099     90.25     90.68     90.92         0<br>11:09:01           88      2106     91.09     90.86     90.97        18<br><br>평균 runq avg 는 90, load avg 는 90, blocked  avg 5~20 정도로 높게 확인이 되고 있습니다.<br><br>========================================<br><br>프로세스 사용율 또한 대부분 높지만, 특히 ens2f0 의 Interrupt 가 처리되는 NUMA node3 이 좀더 높은 사용율이 확인 되었습니다.<br><br>11:01:01         30     80.86      0.00     14.32      0.62      0.00      4.20<br>11:01:01         31     79.00      0.00     15.36      0.67      0.00      4.96<br>11:01:01         32     79.73      0.00     13.91      0.73      0.00      5.63<br>11:01:01         33     78.31      0.00     16.56      0.57      0.00      4.56<br>11:01:01         34     77.23      0.00     17.20      0.58      0.00      4.98<br>11:01:01         35     78.39      0.00     16.27      0.60      0.00      4.74<br>11:01:01         36     75.59      0.00     18.99      0.52      0.00      4.89<br>11:01:01         37     74.19      0.00     19.55      0.48      0.00      5.78<br>11:01:01         38     77.27      0.00     17.86      0.52      0.00      4.34<br>11:01:01         39     73.54      0.00     20.83      0.49      0.00      5.14<br>...<br>11:01:01         70     75.96      0.00     18.75      0.58      0.00      4.71<br>11:01:01         71     76.25      0.00     18.43      0.59      0.00      4.73<br>11:01:01         72     75.70      0.00     18.65      0.58      0.00      5.06<br>11:01:01         73     77.09      0.00     18.37      0.53      0.00      4.01<br>11:01:01         74     76.49      0.00     18.96      0.58      0.00      3.96<br>11:01:01         75     77.38      0.00     18.65      0.48      0.00      3.49<br>11:01:01         76     80.55      0.00     15.96      0.58      0.00      2.90<br>11:01:01         77     79.28      0.00     16.66      0.45      0.00      3.61<br>11:01:01         78     78.11      0.00     18.49      0.50      0.00      2.91<br>11:01:01         79     76.24      0.00     18.85      0.48      0.00      4.43<br><br>========================================<br><br>현재, irqbalance 의 모드가 IRQBALANCE_ONESHOT=yes 로 되어 있어<br><br>부팅 시 최초 1회 실행되고 Daemon 이 Inactive 되어 있는데요, 이를 활성화 할 때 성능 개선에 긍정적 영향이 있는지 궁금합니다.<br><br>그리고 위와 같이 매우 heavy Load 시스템에서 NUMA 아키텍쳐를 BIOS 상에서 Disable 하여 사용할 때 네트워크 인터페이스의 Interrupt 를 분산할 수 있는지 여부도 확인 부탁드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Feature / Enhancement Request</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags><tag><name>networking</name></tag><tag><name>performance</name></tag></tags><br><comment id="a0aA000000JKB7MIAX"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-04-24T06:18:07Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-04-24T06:20:11Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>전화통화를 통해 몇차례 말씀 나누었습니다만,<br><br>저희 내부 엔지니어들의 의견으로는<br>NUMA, irqbalance 등은 일반적으로는 켜는 것이 도움이 될 것으로 보이지만<br>사용하시는 환경에 따라 다를 수 있으므로 직접적인 테스트가 필요할 것이라는 의견이었습니다.  <br><br>또한, 네트워크 모니터링 측면에서는 다음 링크가 도움이 되실 것 같아 연계 드립니다.<br><br>How to begin Network debugging <br>- https://access.redhat.com/articles/1311173<br><br>감사합니다.<br><br><publishedDate>2017-04-24T06:18:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JD9WpIAL"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2017-04-10T11:28:35Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2017-04-10T11:28:34Z</b><br><br>안녕하세요.<br><br>4월 중순 이후에 추가로 Migration TEST 일정이 잡혀 있습니다.<br><br>테스트 수행 시 모니터링을 하면서 시스템 상태를 수집하려고 하는데요,<br><br>통상적으로 수집하는 명령 외 CEE 에서 별도로 요청할 만한 수집 명령이 있다면 조언 부탁 드립니다.<br><br>(perf, netstat, 기타 등)<br><br>감사합니다.<br><br><publishedDate>2017-04-10T11:28:34Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JAo0NIAT"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-03-29T01:20:49Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-03-29T01:20:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>아직 연계 받은 내용이 없습니다.<br>다시 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-29T01:20:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JAVLDIA5"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-03-28T01:38:23Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-03-28T01:38:23Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>현재까지 연계 받은 내용을 토대로 일단 내부 엔지니어링팀과의 협력 요청을<br>진행중에 있습니다.<br><br>유용한 정보를 연계 받는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-28T01:38:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JADh4IAH"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-03-27T02:12:36Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-03-27T02:12:35Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>sosreport 는 드랍박스에 올려주신 파일을 확인하였습니다.<br>조사후 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-27T02:12:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JADJkIAP"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-03-27T01:22:20Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-03-27T01:22:19Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>시스템의 정확한 상황을 확인하기 위해 해당 시스템의 sosreport 를 수집 후 업로드 가능하실지요.<br><br>sosreport 는 무엇이고, 어떻게 수집 해야 되는지에 대해 다음 링크에서 참고 하실 수 있습니다.<br>- https://access.redhat.com/knowledge/ko/solutions/82033<br><br>내부 연계 등이 필요할 경우 해당 파일을 토대로 진행할 수 있습니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-27T01:22:19Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JADJBIA5"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-03-27T01:20:42Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-03-27T01:20:42Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>저는 신재욱이라고 하며 앞으로 이 케이스를 담당하게 되었습니다.<br><br>현재 이 케이스의 내용을 살펴보는 중이며, 관련하여 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-27T01:20:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>