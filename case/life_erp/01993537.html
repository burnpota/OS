======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2017-12-14T06:34:00Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-01-22T11:06:52Z</b><br><b>id : 500A000000ZN98yIAD</b><br>======================<br><br><b><font size=15>
제목  : partprobe 수행 시 error 상황 관련 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>서버에서 partprobe 수행 후 오류 관련해서 문의를 드리려고 합니다.<br><br>신규 파티션을 생성한 disk가 있었는데<br>파티션 생성 후 partprobe를 수행했을 경우에는 사용하고 있는 device에 대해서는 resource busy 상태로 error가 발생하는 것 같습니다.<br><br>partprobe 수행 시 해당 device만 설정하였을 경우 해당 device만 수행이 되었을 지 문의드리려고 합니다.<br><br>추가로 검색을  해봤는데 kaprtx(https://access.redhat.com/solutions/25692) 방식으로 파티션 생성 후 매핑해주는 방법이 있는 것 같은데<br>kpartx와 partprobe의 차이점이 있는지 문의드리려고 합니다.<br><br> - 신규 파티션 생성<br>root@SLPIDADL01 /etc # fdisk -cu  /dev/mapper/DG_DATA7<br>Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel<br>Building a new DOS disklabel with disk identifier 0x088b27fc.<br>Changes will remain in memory only, until you decide to write them.<br>After that, of course, the previous content won't be recoverable.<br><br>Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)<br><br>Command (m for help): p<br><br>Disk /dev/mapper/DG_DATA7: 536.9 GB, 536871567360 bytes<br>255 heads, 63 sectors/track, 65270 cylinders, total 1048577280 sectors<br>Units = sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x088b27fc<br><br>                Device Boot      Start         End      Blocks   Id  System<br><br>Command (m for help): n<br>Command action<br>   e   extended<br>   p   primary partition (1-4)<br>p<br>Partition number (1-4): 1<br>First sector (2048-1048577279, default 2048):<br>Using default value 2048<br>Last sector, +sectors or +size{K,M,G} (2048-1048577279, default 1048577279):<br>Using default value 1048577279<br><br>Command (m for help): p<br><br>Disk /dev/mapper/DG_DATA7: 536.9 GB, 536871567360 bytes<br>255 heads, 63 sectors/track, 65270 cylinders, total 1048577280 sectors<br>Units = sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x088b27fc<br><br>                Device Boot      Start         End      Blocks   Id  System<br>/dev/mapper/DG_DATA7p1            2048  1048577279   524287616   83  Linux<br><br>Command (m for help): w<br>The partition table has been altered!<br><br>Calling ioctl() to re-read partition table.<br><br>WARNING: Re-reading the partition table failed with error 22: Invalid argument.<br>The kernel still uses the old table. The new table will be used at<br>the next reboot or after you run partprobe(8) or kpartx(8)<br>Syncing disks.<br><br> - partprobe 수행<br>root@SLPIDADL01 / # partprobe<br>Warning: WARNING: the kernel failed to re-read the partition table on /dev/sda (Device or resource busy).  As a result, it may not reflect all of your changes until after reboot.<br>Warning: WARNING: the kernel failed to re-read the partition table on /dev/sdb (Device or resource busy).  As a result, it may not reflect all of your changes until after reboot.<br>device-mapper: remove ioctl on DG_DATA6p1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/DG_DATA6 (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on DG_DATA6p1 failed: Device or resource busy<br>device-mapper: remove ioctl on DG_DATA6p1 failed: Device or resource busy<br>device-mapper: remove ioctl on BACKUP1_STGp1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/BACKUP1_STG (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on BACKUP1_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on BACKUP1_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on DG_DATA5p1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/DG_DATA5 (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on DG_DATA5p1 failed: Device or resource busy<br>device-mapper: remove ioctl on DG_DATA5p1 failed: Device or resource busy<br>device-mapper: remove ioctl on BACKUP2_STGp1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/BACKUP2_STG (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on BACKUP2_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on BACKUP2_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on ORA_DATA2p1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/ORA_DATA2 (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on ORA_DATA2p1 failed: Device or resource busy<br>device-mapper: remove ioctl on ORA_DATA2p1 failed: Device or resource busy<br>device-mapper: remove ioctl on BACKUP3_STGp1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/BACKUP3_STG (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on BACKUP3_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on BACKUP3_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on DATA11_STGp1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/DATA11_STG (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on DATA11_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on DATA11_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on DATA10_STGp1 failed: Device or resource busy<br>Warning: parted was unable to re-read the partition table on /dev/mapper/DATA10_STG (Device or resource busy).  This means Linux won't know anything about the modifications you made.<br>device-mapper: create ioctl on DATA10_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on DATA10_STGp1 failed: Device or resource busy<br>device-mapper: remove ioctl on DATA9_STGp1 failed: Device or resource busy<br>=== 생략 ===<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.6</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPIDADL01</hostname><br><br><br><comment id="a0aA000000LDoeuIAD"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-19T01:58:04Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-19T01:58:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; 첫번째는 partprobe를 사용하여 multipath 디바이스에 대해서는 사용하면 문제가 발생할 수 도 있는 것인지 문의드립니다.<br>&gt; 아니면 partprobe를 통해서도 multipath 디바이스에 대한 partition 생성 절차가 있는지 문의드립니다.<br><br>파티션은 fdisk로 생성하시면 됩니다.<br>partprobe는 커널측에 파티션 변경을 알리며 kpartx는 멀티패스에 파티션 변경을 알리게 됩니다.<br>파티션 생성후 partprobe를 실행하시고 다음 kpartx를 실행하시면 될것으로 보입니다.<br><br>참고문서:<br>How do I configure Device Mapper Multipath on my iSCSI LUNS?<br>https://access.redhat.com/solutions/16976<br><br>&gt; 두번째는 /dev/mapper/DG_DATA7p1이라는 multipath 디바이스에 대한 partition 생성 시에는 <br>&gt; https://access.redhat.com/solutions/25692 정보를 참조하여 아래와 같이 수행하면 되는지 문의드립니다.<br><br>네, 상기 문서를 참고하셔서 파티션을 생성하실수 있으십니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-19T01:58:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LDXkPIAX"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-12-18T01:35:33Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-12-18T01:35:33Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다. <br><br>답변 감사드립니다.<br><br>몇가지 문의 사항이 있는데요.<br><br>첫번째는 partprobe를 사용하여 multipath 디바이스에 대해서는 사용하면 문제가 발생할 수 도 있는 것인지 문의드립니다.<br>아니면 partprobe를 통해서도 multipath 디바이스에 대한 partition 생성 절차가 있는지 문의드립니다.<br><br>=== 생략 ===<br>DG_DATA7 (360060e8006d5e6000000d5e600006024) dm-68 HITACHI,OPEN-V<br>size=500G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='round-robin 0' prio=1 status=active<br>  |- 12:0:0:28 sdbg 67:160 active ready running<br>  `- 15:0:0:28 sdbi 67:192 active ready running<br>=== 생략 ===<br><br>root@SLPIDADL01 /root # fdisk /dev/mapper/DG_DATA7<br><br>WARNING: DOS-compatible mode is deprecated. It's strongly recommended to<br>         switch off the mode (command 'c') and change display units to<br>         sectors (command 'u').<br><br>Command (m for help): p<br><br>Disk /dev/mapper/DG_DATA7: 536.9 GB, 536871567360 bytes<br>234 heads, 51 sectors/track, 87864 cylinders<br>Units = cylinders of 11934 * 512 = 6110208 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk identifier: 0x088b27fc<br><br>                Device Boot      Start         End      Blocks   Id  System<br>/dev/mapper/DG_DATA7p1               1       87865   524287616   83  Linux<br><br>Command (m for help): q<br><br><br>두번째는 /dev/mapper/DG_DATA7p1이라는 multipath 디바이스에 대한 partition 생성 시에는 <br>https://access.redhat.com/solutions/25692 정보를 참조하여 아래와 같이 수행하면 되는지 문의드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-18T01:35:33Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LCvK9IAL"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-14T06:57:26Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-14T06:57:26Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; partprobe 수행 시 해당 device만 설정하였을 경우 해당 device만 수행이 되었을 지 문의드리려고 합니다.<br><br>partprobe로 파티션을 다시 읽어 올때 만일 디바이스위에 있는 파일시스템이 사용중에 있다면 <br>고객님과 같은 이슈가 발생됩니다.<br>일반적으로 아래와 같이 파티션을 변경한 디바이스에만 partprobe 작업을 해주시면 됩니다.<br><br># partprobe /dev/sdb<br><br>&gt; kpartx와 partprobe의 차이점이 있는지 문의드리려고 합니다.<br><br>kpartx는 멀티패스 디바이스에 파티션을 생성시 사용하는 명령어이며<br>partprobe는 주로 단일 패스인 다바이스에 사용하게 됩니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-14T06:57:26Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>