======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-11-21T01:52:21Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-01-28T11:02:36Z</b><br><b>id : 500A000000VnBxvIAF</b><br>======================<br><br><b><font size=15>
제목  : Pacemaker pingd 서비스 장애감지로 인한 Failover 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>이번 통합 테스트 기간에 네트워크 스위치 가용성 테스트를 진행하였습니다.<br><br>프로젝트에 구축 된 Pacemaker 에 pingd 라는 Resource 모니터링을 사용 중인데요,<br><br>네트워크 스위치 테스트 때문에 발생했는지는 모르겠으나, 짧은 시간에 여러 번 Resource failover 가 발생하여 문의를 드리려고 합니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>아래 발췌 한 로그를 보시면 11월 17일 오후 4시와 오후 9시 경 failover 가 발생한 것을 확인하였습니다.<br><br>오후 4시경에는 아래와 같습니다.<br><br>root@SLPEAICL01 /var/log/cluster # cat corosync.log-20161118 | grep -i -e pingd -e SCS_script_stop | grep -i -e &quot;Sent update&quot; -e Update<br>Nov 17 16:36:37 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 7 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 7 for pingd: OK (0)<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 7 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 7 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:36:44 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 8 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 8 for pingd: OK (0)<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 8 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 8 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:39:39 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 16:39:40 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 9 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 9 for pingd: OK (0)<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 9 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 9 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 16:39:46 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 16:39:47 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 10 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 10 for pingd: OK (0)<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 10 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 10 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:39:52 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=48, rc=0, cib-update=9358, confirmed=true)<br>Nov 17 16:46:04 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 16:46:05 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 11 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 11 for pingd: OK (0)<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 11 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 11 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 16:47:16 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 16:47:17 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 12 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 12 for pingd: OK (0)<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 12 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 12 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:47:48 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=52, rc=0, cib-update=9362, confirmed=true)<br><br>실제로 동일한 여러 클러스터 노드 및 NFS 서비스 등에서 connection 에러가 발생하였으며, 정상적으로 failover 가 이뤄 졌습니다.<br><br>하지만 아래 오후 9시 경 로그를 보면,<br><br>Nov 17 21:29:41 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 21:29:42 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 13 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 13 for pingd: OK (0)<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 13 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 13 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 21:29:48 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 21:29:49 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 14 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 14 for pingd: OK (0)<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 14 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 14 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 21:29:54 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=54, rc=0, cib-update=9384, confirmed=true)<br>Nov 17 21:52:10 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 15 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 15 for pingd: OK (0)<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 15 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 15 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 21:52:17 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 16 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 16 for pingd: OK (0)<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 16 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 16 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 21:52:22 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=56, rc=0, cib-update=9389, confirmed=true)<br><br>같은 시간대에 여러 번 장애가 발생하여 failover 되었습니다.<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>다른 클러스터 노드에서는 오후 21:52 경에만 발생하였으나, 해당 노드는 (SLPEAICL01, SLPEAICL02) 같은 시간대에 여러 번 장애 감지가 되었습니다.<br><br>궁금한 점은 아래와 같습니다.<br><br>1. 현재 클러스터의 pingd 설정에 문제가 없는지 여부,<br>2. 이번에 발생한 failover 가 pingd 모니터로 감지되어 전환 되었는지 여부,<br>3. pingd 의 monitor interval 이 현재 5초로 되어 있는데, 이 값이 너무 민감하여 잦은 failover 가 될 수 있을지 여부가 궁금합니다.<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>해당 클러스터 노드의 분석 데이터를 dropbox.redhat.com 에 아래 파일명으로 업로드 하였습니다.<br><br>sosreport-LOG-SLPEAICL01-20161121095447.tar.gz<br>sosreport-LOG-SLPEAICL02-20161121095442.tar.gz<br>sosreport-SLPEAICL01-20161121095447.tar.xz<br>sosreport-SLPEAICL02-20161121095442.tar.xz<br><br>확인 부탁 드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 4 (Low)</b><br><br><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-01-13T00:30:37Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-01-13T00:30:36Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>확인한 결과, pingd의 attempts의 수중에 한 번만 성공을 해도 성공으로 인식하는 동작방식이 맞는 것으로 확인하였습니다.<br><br>attempts의 값을 늘리는 것과관련되어서는 특별한 side-effect는 없으며, 다만 서비스 네트워크의 단절을 인식해야 할 시간을 고려해서 attempts를 조절하시는 것이 좋을 것 같습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2017-01-13T00:30:36Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IcJpUIAV"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-01-05T01:51:25Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-01-05T01:51:25Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>현재 저희 전문엔지니어가 관련되어 확인중에 있어서 해당 부분이 정리되는대로 바라 업데이트 드릴 수 있도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2017-01-05T01:51:25Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IXdc5IAD"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-01-03T00:55:00Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-01-03T00:54:59Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>&gt; 그렇다면, 현재 설정이 attempts 기본 값 3인데요, 이 값을 15 정도로 늘리게 되면 너무 민감하게 반응하지 않을 것 같은데요,<br><br>저희 전문엔지니어와 의논해 본 결과, 해당 시도 값을 늘리는 것은 그렇게 바람직만은 하지 않은 것으로 확인됩니다. 그 이유는 시도값을 늘리늠으로써 모니터링 오퍼레이션의 fail의 확률이 더 많이 나타날 수 있기 때문입니다. 대신 잦은 네트워크의 단절과 같은 문제가 있을 수 있는 경우에는 timeout을 증가시키는 것을 검토하는 방법이 있습니다. 다만, 고객사의 환경에 맞춰서 네트워크의 상태에 따라서 이러한 부분을 적용하는 것이 필요합니다.<br><br><br>그래서 저희 전문 엔지니어와의 토의한 결과는 attempt를 3에서 15로 늘리는 것보다는 필요하다면 timeout을 조금 늘려보는 것을 권유드리고 싶습니다. <br>======================<br>감사합니다.<br><br><publishedDate>2017-01-03T00:54:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IV6u4IAD"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-12-15T05:01:07Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-12-15T05:01:07Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>문의 주신내용들과 유선통화를 기반으로 문의주신 내용들에 대해서 확인 후, 업데이트 드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-12-15T05:01:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IV5XxIAL"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-12-15T02:07:59Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-12-15T02:07:59Z</b><br><br>[root@node01 ~]# pcs resource update ping ocf:pacemaker:ping dampen=&quot;5s&quot; timeout=&quot;3s&quot; attempts=&quot;15&quot;<br>[root@node01 ~]# pcs resource update ping op monitor interval=5s<br><br>[root@node01 ~]# pcs resource show ping<br> Resource: ping (class=ocf provider=pacemaker type=ping)<br>  Attributes: dampen=5s multiplier=10 host_list=192.168.200.1 timeout=3s attempts=15<br>  Operations: start interval=0s timeout=60 (ping-start-interval-0s)<br>              stop interval=0s timeout=20 (ping-stop-interval-0s)<br>              monitor interval=5s (ping-monitor-interval-5s)<br><br>일단 위와 같이 설정을 추가로 업데이트 해서 진행하였습니다.<br><br>여기서 중요한 부분이 attempts 항목인 듯 싶네요.<br><br>ping -n -W 5 -c 20 192.168.200.1 이렇게 핑을 쏜다고 가정할 때, attempts 값이 -c 20 에 해당 됩니다.<br><br>테스트 결과 20 카운트 중 한번이라도 성공하게 되면 return 0 이며, 모두 실패했을 경우만 return 1 입니다.<br><br>그런데, 이 attempts 의 기본값이 3 입니다.<br><br>기본 값 3으로 설정 된 경우 Gateway 가 무조건 3초 안에 fail-over 되어야 하는데,<br><br>interval 5 초 까지 포함한다 해도 최대 8초 안에는 fail-over 가 되어 VIP 핑이 정상적으로 나가야 리소스는 무사 합니다.<br><br>실제 dampen, timeout 은 fail-over 감지에 영향이 없는것으로 확인 되었구요,<br><br>제가 생각할 때 attempts 15 정도가 적당할 듯 한데, 이것은 네트워크 장비의 넘어가는 시간과 비교해 봐야 겠군요.<br><br>[샘플 시나리오]<br><br>1. 현재 ping check 15 카운트가 지나고 있는 상황에서 10 카운트에서 장애가 발생하면, 현재 ping check 는 유효 합니다.<br><br>2. 다음 ping check 15가 시작되고 5 카운트가 지나는 상황에서 ping 이 정상화 되면 ping check 는 유효합니다.<br><br>3. 하지만, 다음 ping check 15가 시작되었는데, 15 카운트까지 ping 이 정상화가 안되면 ping check 는 FAIL 입니다.<br><br>4. 종합해 보자면, FAIL 이 나는 상황은 정확하게 시간을 잴수는 없지만, 최대 30초 이내 감지 됩니다. (이전 15 카운트 + 현재 15 카운트)<br>    - 아마도 이전 15 카운트에서 언제 ping 이 끊겼냐가 중요하겠네요.<br><br>그렇다면, 현재 설정이 attempts 기본 값 3인데요, 이 값을 15 정도로 늘리게 되면 너무 민감하게 반응하지 않을 것 같은데요,<br><br>CEE 의 의견을 듣고 싶습니다.<br><br>감사합니다.<br><br><publishedDate>2016-12-15T02:07:59Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IIsT6IAL"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-11-25T00:59:22Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-11-25T00:59:22Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>'pingd'의 설정이나 5초에 대한 설정 값에 대해서 특별히 문제가 없는 것으로 확인되며 구성과 관련되어 특별한 이슈는 없습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-11-25T00:59:22Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IIWYNIA5"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-11-23T01:00:28Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-11-23T01:00:28Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br><br>지금 몇가지 확인중에 있어서 확인되는대로 바로 업데이트 드리겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-11-23T01:00:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000II2koIAD"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-11-21T02:24:31Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-11-21T02:24:31Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>올려주신 데이터는 다운로드 받았으며, 올려주신 로그들을 확인 후 다시 업데이트 드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-11-21T02:24:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000II2idIAD"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-11-21T02:17:10Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-11-21T02:17:10Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>현재 올려주신 데이터를 다운로드 중에 있으며, 다운로드 후 다시 업데이트 드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-11-21T02:17:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>이번 통합 테스트 기간에 네트워크 스위치 가용성 테스트를 진행하였습니다.<br><br>프로젝트에 구축 된 Pacemaker 에 pingd 라는 Resource 모니터링을 사용 중인데요,<br><br>네트워크 스위치 테스트 때문에 발생했는지는 모르겠으나, 짧은 시간에 여러 번 Resource failover 가 발생하여 문의를 드리려고 합니다.</issue><environment>아래 발췌 한 로그를 보시면 11월 17일 오후 4시와 오후 9시 경 failover 가 발생한 것을 확인하였습니다.<br><br>오후 4시경에는 아래와 같습니다.<br><br>root@SLPEAICL01 /var/log/cluster # cat corosync.log-20161118 | grep -i -e pingd -e SCS_script_stop | grep -i -e &quot;Sent update&quot; -e Update<br>Nov 17 16:36:37 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 7 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 7 for pingd: OK (0)<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 7 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 16:36:42 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 7 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:36:44 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 8 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 8 for pingd: OK (0)<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 8 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 16:36:49 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 8 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:39:39 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 16:39:40 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 9 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 9 for pingd: OK (0)<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 9 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 16:39:45 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 9 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 16:39:46 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 16:39:47 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 10 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 10 for pingd: OK (0)<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 10 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 16:39:52 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 10 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:39:52 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=48, rc=0, cib-update=9358, confirmed=true)<br>Nov 17 16:46:04 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 16:46:05 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 11 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 11 for pingd: OK (0)<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 11 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 16:46:10 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 11 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 16:47:16 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 16:47:17 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 12 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 12 for pingd: OK (0)<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 12 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 16:47:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 12 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 16:47:48 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=52, rc=0, cib-update=9362, confirmed=true)<br><br>실제로 동일한 여러 클러스터 노드 및 NFS 서비스 등에서 connection 에러가 발생하였으며, 정상적으로 failover 가 이뤄 졌습니다.<br><br>하지만 아래 오후 9시 경 로그를 보면,<br><br>Nov 17 21:29:41 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 10 -&gt; 0 from SLPEAICL02-HB<br>Nov 17 21:29:42 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 13 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 13 for pingd: OK (0)<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 13 for pingd[SLPEAICL02-HB]=0: OK (0)<br>Nov 17 21:29:47 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 13 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 21:29:48 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL02-HB]: 0 -&gt; 10 from SLPEAICL02-HB<br>Nov 17 21:29:49 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 14 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 14 for pingd: OK (0)<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 14 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 21:29:54 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 14 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 21:29:54 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=54, rc=0, cib-update=9384, confirmed=true)<br>Nov 17 21:52:10 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 10 -&gt; 0 from SLPEAICL01-HB<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 15 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 15 for pingd: OK (0)<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 15 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 21:52:15 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 15 for pingd[SLPEAICL01-HB]=0: OK (0)<br>Nov 17 21:52:17 [38900] SLPEAICL01      attrd:     info: attrd_peer_update:     Setting pingd[SLPEAICL01-HB]: 0 -&gt; 10 from SLPEAICL01-HB<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: write_attribute:       Sent update 16 with 2 changes for pingd, id=&lt;n/a&gt;, set=(null)<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 16 for pingd: OK (0)<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 16 for pingd[SLPEAICL02-HB]=10: OK (0)<br>Nov 17 21:52:22 [38900] SLPEAICL01      attrd:     info: attrd_cib_callback:    Update 16 for pingd[SLPEAICL01-HB]=10: OK (0)<br>Nov 17 21:52:22 [38902] SLPEAICL01       crmd:   notice: process_lrm_event:     Operation PEAISCS_script_stop_0: ok (node=SLPEAICL01-HB, call=56, rc=0, cib-update=9389, confirmed=true)<br><br>같은 시간대에 여러 번 장애가 발생하여 failover 되었습니다.</environment><periodicityOfIssue>다른 클러스터 노드에서는 오후 21:52 경에만 발생하였으나, 해당 노드는 (SLPEAICL01, SLPEAICL02) 같은 시간대에 여러 번 장애 감지가 되었습니다.<br><br>궁금한 점은 아래와 같습니다.<br><br>1. 현재 클러스터의 pingd 설정에 문제가 없는지 여부,<br>2. 이번에 발생한 failover 가 pingd 모니터로 감지되어 전환 되었는지 여부,<br>3. pingd 의 monitor interval 이 현재 5초로 되어 있는데, 이 값이 너무 민감하여 잦은 failover 가 될 수 있을지 여부가 궁금합니다.</periodicityOfIssue><timeFramesAndUrgency>해당 클러스터 노드의 분석 데이터를 dropbox.redhat.com 에 아래 파일명으로 업로드 하였습니다.<br><br>sosreport-LOG-SLPEAICL01-20161121095447.tar.gz<br>sosreport-LOG-SLPEAICL02-20161121095442.tar.gz<br>sosreport-SLPEAICL01-20161121095447.tar.xz<br>sosreport-SLPEAICL02-20161121095442.tar.xz<br><br>확인 부탁 드립니다.<br><br>감사합니다.</timeFramesAndUrgency><cep>false</cep></case>