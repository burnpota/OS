======================<br><b>생성계정 : 타임 게이트</b><br><b>생성날짜 : 2016-10-26T09:02:20Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-11-19T11:04:15Z</b><br><b>id : 500A000000VXidJIAT</b><br>======================<br><br><b><font size=15>
제목  : Request to analyze tcpdump(tcpdump 분석 요청 드립니다.)
</font></b><br><br>======================<br><actionPlan>## Issue<br><br>Client system PPOSAL01SL connects to server system PECCAL01SL on TCP port 8000<br><br>Every now and then, a session breaks after 3-5 minutes<br><br>## Environment<br><br>TZ=&quot;Asia/Seoul&quot;<br><br>#### PPOSAL01SL<br><br>VMware VM, 12x VCPU, 288 GiB RAM<br>RHEL 7.2 with 3.10.0-327.el7.x86_64<br><br>eno16780032 - 00:50:56:bc:7f:e8 - 100.254.143.141/24<br>vmxnet3, a few drops<br><br>no irqbalance<br><br>#### PECCAL01SL<br><br>HP DL580 Gen9, 80x E7-8891 v3, 1 TiB RAM<br>RHEL 7.2 with 3.10.0-327.el7.x86_64<br><br>no irqbalance though several are spread (irqb oneshot?)<br><br>bond0 - 00:11:0a:6b:27:bc - 100.254.142.21/24<br>ens2f0 + ens5f1 (ixgbe) in active-backup bond0, no errors<br><br>## Summary<br><br>It appears the &quot;icman&quot; server application is sitting idle after receiving a client request, a middlebox then times out the idle TCP session with TCP Reset<br><br>## Action Plan<br><br>* Debug &quot;icman&quot; server application with application vendor</actionPlan><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>PPOSAL01SL에서 PECCAL01SL으로 8000번 포트를 이용하여 서비스에 접속하는데 <br>약 3~5분 사이에 세션이 끊기는 증상이<br>발생하고 있습니다.<br><br>이에 접속 tcpdump를 캡처해서 보았으나 특이사항이 없어보이는것으로 판단됩니다.<br><br>ftp로 약 100메가 가량의 화일 tcpdump_161026.zip를 첨부하였으니<br>확인 후 연락 부탁드립니다.<br>파일안에는 PECCAL01SL, PPOSAL01SL sosreport와 각 호스트의 tcpdump가 첨부되어 있습니다.<br><br>고객정보<br>회사명 : 삼성생명  <br>성명 : 석윤식 <br>직급 : 수석보<br>전화번호 : 010-9017-1274 <br> <br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><br><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-11-03T00:58:15Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-11-03T00:58:14Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>현 단계에서는 어플리케이션 벤더의 조사가 필요하며<br>특별히 저희 측에서 요청 드릴 자료는 없습니다.<br><br>감사합니다.<br><br><publishedDate>2016-11-03T00:58:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IAE6IIAX"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2016-11-02T15:19:07Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2016-11-02T15:19:07Z</b><br><br>내용 전달 잘 받았습니다.<br>감사합니다.<br>다음에 혹시 추가적으로 진행하게될 또는 좀 더 필요한 자료 수집에 대한 시나리오를 말씀 주실수 있으신지요?<br>일전에는  클라이언트 단에서 tcpdump를 생성하였고<br>서버단에서는 tcpdump와 strace 및 monitor.sh를 실행하였습니다.<br>요청이 아직 있지는 않으나 준비를 해놓고자 합니다.<br><br><publishedDate>2016-11-02T15:19:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IA1ThIAL"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-11-02T02:13:38Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-11-02T02:13:38Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>앞서 저희 개발 엔지니어가 커멘트 하였습니다만,<br>해당 내용을 포함하여 내부적으로 몇가지 확인 및 정리하였기에<br>커멘트 드립니다.<br><br>우선, 현재 생각되는 커넥션 흐름을 정리해보았습니다.<br><br>- 클라이언트와 서버는 성공적으로 커넥션을 확립합니다.<br>- 클라이언트는 리퀘스트를 보내고 서버의 TCP 스택과 서버 어플리케이션은 이를 수신합니다.<br>- 서버 어플리케이션은 클라이언트의 리퀘스트에 대해서 처리를 하지 않습니다 =&gt; * 이것이 현재 이슈입니다. *<br>- 커넥션은 약 5분동안 idle 상태로 놓이게 되며, 중간의 어떠한 idle 트래킹 기능을 가진 장치(라우터, 파이어월 등)에 의해 클라이언트와 서버가 RST 을 받습니다.<br><br>(설명을 위한 개략적인 구성도)<br> [ client ] ------- [ middlebox ] ------ [ server ]<br><br>즉, 덤프의 RST 수신 이력상 클라이언트가 RST 을 보냈을 것으로 추정했습니다만 보내주신 자료에 대하여 재확인한 결과,<br>클라이언트로부터의 RST 송신이 확인되지 않는 점을 토대로 중간의 어떠한 네트워크 장치(라우터, 파이어월 등)로부터 RST 이 송신된 것으로 판단하고 있습니다. <br>그리고, 서버 어플리케이션의 strace 를 보면 recfrom() 을 호출하고 있지만 -EAGAIN 이 발생하고 있습니다.<br><br>이와 관련하여 다음 KBase 가 보고되어 있습니다.<br><br>Why does recvfrom() call return EAGAIN erro<br>- https://access.redhat.com/solutions/393283<br><br>즉, 이러한 증상 발생시 어플리케이션단의 문제 확인이 요구되고 있습니다.<br>또한, 저희 개발 엔지니어도 현 단계에서는 서버 어플리케이션 벤더를 통한 조사가 필요하다고 언급하고 있습니다.<br><br>따라서, 앞서 거듭 말씀드렸던 서버 어플리케이션 측면의 조사 및 해결을 진행하시고 그에 따라 저희쪽 추가 조사가 필요할 경우<br>조사결과를 연계 주시길 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-11-02T02:13:38Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I9jMbIAJ"><br>======================<br><b>생성계정 : Bainbridge, Jamie</b><br><b>생성날짜 : 2016-11-01T05:46:43Z</b><br><b>마지막 답변자 : Bainbridge, Jamie</b><br><b>마지막 수정 일자 : 2016-11-01T05:46:43Z</b><br><br>// notes<br><br>times covered:<br><br> $ TZ=&quot;Asia/Seoul&quot; capinfos -ae capture_PECCAL01SL.cap capture_PPOSAL01SL.cap<br>File name:           capture_PECCAL01SL.cap<br>First packet time:   2016-11-01 10:36:38.271236<br>Last packet time:    2016-11-01 10:39:45.872981<br><br>File name:           capture_PPOSAL01SL.cap<br>First packet time:   2016-11-01 10:38:44.597046<br>Last packet time:    2016-11-01 10:38:44.597046<br><br>client pcap contains only one frame, the server sending a rst:<br><br> $ TZ=&quot;Asia/Seoul&quot; tshark -tad -nr capture_PPOSAL01SL.cap<br>  1 2016-11-01 10:38:44.597046 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9513 [RST, ACK] Seq=1 Ack=1 Win=9300 Len=0<br><br>server pcap contains much more, but only this packet of the client sending a rst slightly earlier:<br><br> $ TZ=&quot;Asia/Seoul&quot; tshark -tad -nr capture_PECCAL01SL.cap &quot;tcp.port == 9513&quot;<br>157 2016-11-01 10:38:44.595869 100.254.143.141 -&gt; 100.254.142.21 TCP 60 9513 → 8000 [RST, ACK] Seq=1 Ack=1 Win=9300 Len=0<br><br>we can see the socket ESTABLISHED then disappear after this time:<br><br> $ egrep -A1 &quot;====|\:9513&quot; network_stats_2016_11_01_10/ss | egrep -v &quot;^--$&quot;<br>===== Tue Nov  1 10:36:37 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>tcp    ESTAB      0      0      100.254.142.21:8000               100.254.143.141:9513                users:((&quot;icman&quot;,pid=3295,fd=30)) uid:20472 ino:199031153 sk:ffff883977643c00 &lt;-&gt;<br><br> skmem:(r0,rb369280,t0,tb65536,f12288,w0,o0,bl0) cubic rto:200 ato:40 mss:1460 cwnd:10 ssthresh:24 lastsnd:54755 lastrcv:54755 lastack:54755 rcv_space:29200<br>===== Tue Nov  1 10:37:08 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>tcp    ESTAB      0      0      100.254.142.21:8000               100.254.143.141:9513                users:((&quot;icman&quot;,pid=3295,fd=30)) uid:20472 ino:199031153 sk:ffff883977643c00 &lt;-&gt;<br><br> skmem:(r0,rb369280,t0,tb65536,f12288,w0,o0,bl0) cubic rto:200 ato:40 mss:1460 cwnd:10 ssthresh:24 lastsnd:85228 lastrcv:85228 lastack:85228 rcv_space:29200<br>===== Tue Nov  1 10:37:38 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>tcp    ESTAB      0      0      100.254.142.21:8000               100.254.143.141:9513                users:((&quot;icman&quot;,pid=3295,fd=30)) uid:20472 ino:199031153 sk:ffff883977643c00 &lt;-&gt;<br><br> skmem:(r0,rb369280,t0,tb65536,f12288,w0,o0,bl0) cubic rto:200 ato:40 mss:1460 cwnd:10 ssthresh:24 lastsnd:115712 lastrcv:115712 lastack:115712 rcv_space:29200<br>===== Tue Nov  1 10:38:09 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>tcp    ESTAB      0      0      100.254.142.21:8000               100.254.143.141:9513                users:((&quot;icman&quot;,pid=3295,fd=30)) uid:20472 ino:199031153 sk:ffff883977643c00 &lt;-&gt;<br><br> skmem:(r0,rb369280,t0,tb65536,f12288,w0,o0,bl0) cubic rto:200 ato:40 mss:1460 cwnd:10 ssthresh:24 lastsnd:146171 lastrcv:146171 lastack:146171 rcv_space:29200<br>===== Tue Nov  1 10:38:39 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>tcp    ESTAB      0      0      100.254.142.21:8000               100.254.143.141:9513                users:((&quot;icman&quot;,pid=3295,fd=30)) uid:20472 ino:199031153 sk:ffff883977643c00 &lt;-&gt;<br><br> skmem:(r0,rb369280,t0,tb65536,f12288,w0,o0,bl0) cubic rto:200 ato:40 mss:1460 cwnd:10 ssthresh:24 lastsnd:176643 lastrcv:176643 lastack:176643 rcv_space:29200<br>===== Tue Nov  1 10:39:10 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br>===== Tue Nov  1 10:39:40 KST 2016 =====<br>Netid  State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              <br><br>the port number is not resolved in the strace:<br><br> $ egrep -c 9513 strace_PECCAL01SL.txt <br>0<br><br>but the inode is:<br><br> $ egrep 199031153 strace_PECCAL01SL.txt <br>3890  10:38:48.034015 poll([{fd=30&lt;socket:[199031153]&gt;, events=POLLIN|POLLPRI}], 1, 1000) = 1 ([{fd=30, revents=POLLIN|POLLHUP}]) &lt;0.000048&gt;<br>3890  10:38:48.034325 close(30&lt;socket:[199031153]&gt;) = 0 &lt;0.000048&gt;<br><br>looking for all operations on fd30:<br><br> $ egrep &quot;\(30\,| = 30|199031153&quot; strace_PECCAL01SL.txt <br>3950  10:36:42.701062 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000054&gt;<br>3950  10:36:47.706356 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000151&gt;<br>3950  10:36:56.716229 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000053&gt;<br>3950  10:37:01.721790 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000049&gt;<br>3950  10:37:06.727350 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000066&gt;<br>3950  10:37:11.732926 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000065&gt;<br>3950  10:37:16.738371 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000052&gt;<br>3950  10:37:21.743738 recvfrom(30,  &lt;unfinished ...&gt;<br>3950  10:37:26.749308 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000055&gt;<br>3950  10:37:31.753799 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000050&gt;<br>3950  10:37:36.759224 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000050&gt;<br>3950  10:37:41.764689 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000050&gt;<br>3950  10:37:46.770116 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000048&gt;<br>3950  10:37:51.775567 recvfrom(30,  &lt;unfinished ...&gt;<br>3950  10:37:56.781250 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000054&gt;<br>3950  10:38:01.786827 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000054&gt;<br>3950  10:38:06.792290 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000029&gt;<br>3950  10:38:11.797664 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000058&gt;<br>3950  10:38:16.803016 recvfrom(30,  &lt;unfinished ...&gt;<br>3950  10:38:21.808242 recvfrom(30,  &lt;unfinished ...&gt;<br>3950  10:38:26.813711 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000054&gt;<br>3950  10:38:31.819058 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000055&gt;<br>3950  10:38:36.824447 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000056&gt;<br>3950  10:38:41.829791 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 EAGAIN (Resource temporarily unavailable) &lt;0.000055&gt;<br>3950  10:38:46.835163 recvfrom(30, 0x7fb01cf08d8f, 1, 2, 0, 0) = -1 ECONNRESET (Connection reset by peer) &lt;0.000058&gt;<br>3890  10:38:48.033608 sendto(30, &quot;HTTP/1.0 500 Internal Server Error\r\ndate: Tue, 01 Nov 2016 01:38:48 GMT\r\npragma: no-cache\r\nconnection: close\r\ncontent-length: 202    \r\ncontent-type: text/html\r\n\r\n&lt;html&gt;&lt;head&gt;&lt;title&gt;Application Server Error&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\r\n&lt;H2&gt;&lt;b&gt;500 Internal Server Error&lt;/b&gt;&lt;/H2&gt;&lt;br&gt;\r\nError is logged with Tag: {00054270}&lt;br&gt;&lt;hr&gt;\r\nTue Nov  1 10:38:47 2016\n\r\n&lt;/body&gt;&lt;/html&gt;\r\n&quot;, 364, 0, NULL, 0) = -1 EPIPE (Broken pipe) &lt;0.000050&gt;<br>3890  10:38:48.033803 getsockname(30, {sa_family=AF_INET, sin_port=htons(8000), sin_addr=inet_addr(&quot;100.254.142.21&quot;)}, [16]) = 0 &lt;0.000027&gt;<br>3890  10:38:48.033909 shutdown(30, SHUT_WR) = -1 ENOTCONN (Transport endpoint is not connected) &lt;0.000047&gt;<br>3890  10:38:48.034015 poll([{fd=30&lt;socket:[199031153]&gt;, events=POLLIN|POLLPRI}], 1, 1000) = 1 ([{fd=30, revents=POLLIN|POLLHUP}]) &lt;0.000048&gt;<br>3890  10:38:48.034136 recvfrom(30, &quot;&quot;, 512, 0, NULL, NULL) = 0 &lt;0.000048&gt;<br>3890  10:38:48.034240 getsockname(30, {sa_family=AF_INET, sin_port=htons(8000), sin_addr=inet_addr(&quot;100.254.142.21&quot;)}, [16]) = 0 &lt;0.000027&gt;<br>3890  10:38:48.034325 close(30&lt;socket:[199031153]&gt;) = 0 &lt;0.000048&gt;<br><br>EAGAIN as there was no data, then ECONNRESET and closing the socket<br><br>the server also logs:<br><br>3890  10:38:47.982811 write(6&lt;/usr/sap/PEC/DVEBMGS00/work/dev_icm&gt;, &quot;\n[Thr 140394408204032] Tue Nov  1 10:38:47 2016\n&quot;, 48) = 48 &lt;0.000053&gt;<br>3890  10:38:47.982973 write(6&lt;/usr/sap/PEC/DVEBMGS00/work/dev_icm&gt;, &quot;[Thr 140394408204032] *** ERROR =&gt; IcmReadFromPartner(id=5/213616): No data from server received (rc=MPI_EBROKEN: pipe broken/canceled/7) [icxxthrio.c  2522]\n&quot;, 158) = 158 &lt;0.000049&gt;<br>3890  10:38:47.983106 write(6&lt;/usr/sap/PEC/DVEBMGS00/work/dev_icm&gt;, &quot;[Thr 140394408204032] *** ERROR =&gt; IcmCreateDpRequest: Session does not exist [icxxthr.c    3432]\n&quot;, 98) = 98 &lt;0.000050&gt;<br><br>this is a client behaviour, why did the client send a TCP Reset? we do not have the data to determine<br><br>we could collect the same data again from the client side and server side at the same time<br><br>if the customer is able to capture the entire tcp stream from SYN to RST that would be better, not just the RST at the end<br><br>the customer and application support should also check the client logs at this time for that session<br><br><publishedDate>2016-11-01T05:46:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I9iwoIAB"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-11-01T04:41:53Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-11-01T04:41:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>업로드하신 자료는 확인되어,<br>저희 네트워크 전문 그룹 엔지니어와 협업할 예정입니다.<br><br>그에 앞서 추가로 요청드린 &quot;icman&quot; vendor 에의 debug 는 진행중인지<br>확인바랍니다.<br><br>감사합니다.<br><br><publishedDate>2016-11-01T04:41:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I9iALIAZ"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2016-11-01T02:35:28Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2016-11-01T02:35:28Z</b><br><br>안녕하십니까?<br>요청하신 정보 게더링하여 incoming폴더에 첨부하여 넣었습니다.<br>첨부한 화일명은 gether.tar입니다. 분석 후 연락 부탁드립니다.<br>그 안의 파일 갯수는 4개입니다.<br>감사합니다.<br><br><publishedDate>2016-11-01T02:35:28Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000I9NPMIA3"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-10-31T01:28:21Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-10-31T01:28:21Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>&gt; 그리고 5분에 대한 타임아웃은 서버에서 설정된것인지 어플리케이션에서 설정된것인지 알수 없을까요?<br><br>저희가 제공드리는 어플리케이션이 아니므로 알기 어렵습니다.<br><br>&gt; strace -fvttTyy -s 10240 -o /tmp/strace.txt -p &quot;$PID&quot; <br><br>&quot;$PID&quot; 는 icman 의 PID 로 치환하시기 바랍니다.<br><br>&gt; 아래의 모니터링 쉘을 /tmp디렉토리에서 실행시켜서 게더링된 파일을 보내드리면 되는건지 궁금합니다.<br><br>네, 말씀과 같이 이슈 발생 시점의 데이터를 게더링해서 보내주시면 됩니다.<br><br>&gt; 아울러 tcpdump에서 클라이언트로부터 받은 5840 바이트 메세지가 완전한지 불완전한지는 알 수가 없다고 말씀하셨는데 제가 <br>&gt; tcpdump의 -s(snaplen)값을 4096을 주어서 메시지를 캡쳐되지 못했다는 말씀이신지요? <br>&gt; 그런데  pposal01sl의 tcpdump를 보면 6526의 메시지가 있습니다. 그러면 6000이상이 아닌 -s옵션을 ~7000으로 주어야 메시지 정보를 <br>&gt; 캡쳐할수 있을까요?<br><br>네, 말씀과 같이 실제 메세지 길이가 설정하신 4096보다 더 깁니다.<br>따라서, 짤린 데이터에 대한 수집을 위해서는 값을 보다 크게 줄 필요가 있을 것입니다.<br><br>감사합니다.<br><br><publishedDate>2016-10-31T01:28:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I9LzkIAF"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2016-10-30T13:53:05Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2016-10-30T13:53:05Z</b><br><br>답변감사합니다.<br>추가적인 내용을 파악해보려면 <br><br>strace -fvttTyy -s 10240 -o /tmp/strace.txt -p &quot;$PID&quot; 와 <br>아래의 모니터링 쉘을 /tmp디렉토리에서 실행시켜서 게더링된 파일을 보내드리면 되는건지 궁금합니다.<br><br>그리고 5분에 대한 타임아웃은 서버에서 설정된것인지 어플리케이션에서 설정된것인지 알수 없을까요?<br>서버에서 의심되는 타임아웃설정은 어떤것이 있는지요?<br>아울러 tcpdump에서 클라이언트로부터 받은 5840 바이트 메세지가 완전한지 불완전한지는 알 수가 없다고 말씀하셨는데 제가 <br>tcpdump의 -s(snaplen)값을 4096을 주어서 메시지를 캡쳐되지 못했다는 말씀이신지요? <br><br>그런데  pposal01sl의 tcpdump를 보면 6526의 메시지가 있습니다. 그러면 6000이상이 아닌 -s옵션을 ~7000으로 주어야 메시지 정보를 <br>캡쳐할수 있을까요?<br>&lt;&lt;&lt;pposal01sl캡쳐내용&gt;&gt;&gt;<br>60  21.295388 100.254.143.141 -&gt; 100.254.142.21 TCP 6580 9517 → 8000 [PSH, ACK] Seq=42 Ack=1 Win=29200 Len=6526<br><br>감사합니다.<br><br>==== monitor.sh ====<br><br>#!/bin/bash<br># monitor.sh begins here<br>#<br>VERSION=32<br>#<br># this script collects data relevant to network debugging<br>#<br># the first parameter is optional and specifies a delay between collections<br># the default delay is 30 seconds, but an alternative delay like 10 seconds<br># can be achieved like &quot;./monitor.sh 10&quot;<br>#<br># the second parameter is optional and specifies the amount of collections<br># the default is to collect forever, but a positive number of collections<br># can be achieved like &quot;./monitor.sh 30 10&quot;<br>#<br>## set sleep delay<br>if [ -z &quot;$1&quot; ]; then<br>    DELAY=30<br>else<br>    # something was passed on the commandline, check it's a positive integer<br>    if [ &quot;$1&quot; -eq &quot;$1&quot; ] &amp;&amp; [ &quot;$1&quot; -gt 0 ] 2&gt;/dev/null; then<br>        DELAY=&quot;$1&quot;<br>    else<br>        DELAY=30<br>    fi<br>fi<br><br>## set iteratons<br>if [ -z &quot;$2&quot; ]; then<br>    ITERATIONS=-1<br>else<br>    # something was passed on the commandline, check it's a positive integer<br>    if [ &quot;$1&quot; -eq &quot;$1&quot; ] &amp;&amp; [ &quot;$1&quot; -gt 0 ] 2&gt;/dev/null; then<br>        ITERATIONS=&quot;$2&quot;<br>    else<br>        ITERATIONS=-1<br>    fi<br>fi<br><br>if [ &quot;$ITERATIONS&quot; -gt 0 ]; then<br>    echo &quot;Running network monitoring with $DELAY second delay for $ITERATIONS iterations.&quot;<br>else<br>    echo &quot;Running network monitoring with $DELAY second delay. Press Ctrl+c to stop...&quot;<br>fi<br><br>## one-time commands<br><br>MQDEVS=( $(tc qdisc show | awk '/^qdisc mq/{print $(NF-1)}') )<br><br>## data collection loop<br>while [ &quot;$ITERATIONS&quot; != 0 ]; do<br><br>    now=$(date +%Y_%m_%d_%H)<br>    then=$(date --date=&quot;yesterday&quot; +%Y_%m_%d_%H)<br>    rm -rf &quot;network_stats_$then&quot;<br>    mkdir -p &quot;network_stats_$now&quot;<br><br>   if ! [ -e &quot;network_stats_$now/version.txt&quot; ]<br>      then echo &quot;===== $(date) =====&quot; &gt; &quot;network_stats_$now/version.txt&quot;<br>           echo &quot;this output created with monitor.sh version $VERSION&quot; &gt;&gt; \<br>                      &quot;network_stats_$now/version.txt&quot;<br>           echo &quot;See \&quot;How to begin Network debugging\&quot; at &quot; &gt;&gt; \<br>                      &quot;network_stats_$now/version.txt&quot;<br>           echo &quot;  https://access.redhat.com/articles/1311173&quot; &gt;&gt; \<br>                      &quot;network_stats_$now/version.txt&quot;<br>    fi  <br>    if ! [ -e &quot;network_stats_$now/sysctl.txt&quot; ]<br>      then echo &quot;===== $(date) =====&quot; &gt; &quot;network_stats_$now/sysctl.txt&quot;<br>           sysctl -a &gt;&gt; &quot;network_stats_$now/sysctl.txt&quot;<br>    fi  <br>    if ! [ -e &quot;network_stats_$now/ip-address.txt&quot; ]<br>      then echo &quot;===== $(date) =====&quot; &gt; &quot;network_stats_$now/ip-address.txt&quot;<br>           ip address list &gt;&gt; &quot;network_stats_$now/ip-address.txt&quot;<br>    fi<br>    if ! [ -e &quot;network_stats_$now/ip-route.txt&quot; ]<br>      then echo &quot;===== $(date) =====&quot; &gt; &quot;network_stats_$now/ip-route.txt&quot;<br>           ip route show table all &gt;&gt; &quot;network_stats_$now/ip-route.txt&quot;<br>    fi<br>    if ! [ -e &quot;network_stats_$now/uname.txt&quot; ]<br>      then echo &quot;===== $(date) =====&quot; &gt; &quot;network_stats_$now/uname.txt&quot;<br>           uname -a &gt;&gt; &quot;network_stats_$now/uname.txt&quot;<br>    fi<br><br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/ip_neigh&quot;<br>    ip neigh show &gt;&gt; &quot;network_stats_$now/ip_neigh&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/tc_qdisc&quot;<br>    tc -s qdisc &gt;&gt; &quot;network_stats_$now/tc_qdisc&quot;<br>    if [ &quot;${#MQDEVS[@]}&quot; -gt 0 ]; then<br>            for MQDEV in &quot;${MQDEVS[@]}&quot;; do<br>                    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/tc_class_$MQDEV&quot;<br>                    tc -s class show dev &quot;$MQDEV&quot; &gt;&gt; &quot;network_stats_$now/tc_class_$MQDEV&quot;<br>            done<br>    fi<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/netstat&quot;<br>    netstat -s &gt;&gt; &quot;network_stats_$now/netstat&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/ss&quot;<br>    ss -noempitau &gt;&gt; &quot;network_stats_$now/ss&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/interrupts&quot;<br>    cat /proc/interrupts &gt;&gt; &quot;network_stats_$now/interrupts&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/softnet_stat&quot;<br>    cat /proc/net/softnet_stat &gt;&gt; &quot;network_stats_$now/softnet_stat&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/vmstat&quot;<br>    cat /proc/vmstat &gt;&gt; &quot;network_stats_$now/vmstat&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/ps&quot;<br>    ps -alfe &gt;&gt; &quot;network_stats_$now/ps&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/mpstat&quot;<br>    mpstat -A 2&gt;/dev/null &gt;&gt; &quot;network_stats_$now/mpstat&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/top&quot;<br>    top -c -b -n1 &gt;&gt; &quot;network_stats_$now/top&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/numastat&quot;<br>    numastat 2&gt;/dev/null &gt;&gt; &quot;network_stats_$now/numastat&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/softirqs&quot;<br>    cat /proc/softirqs &gt;&gt; &quot;network_stats_$now/softirqs&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/sockstat&quot;<br>    cat /proc/net/sockstat &gt;&gt; &quot;network_stats_$now/sockstat&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/sockstat6&quot;<br>    cat /proc/net/sockstat6 &gt;&gt; &quot;network_stats_$now/sockstat6&quot;<br>    echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/netdev&quot;<br>    cat /proc/net/dev &gt;&gt; &quot;network_stats_$now/netdev&quot;<br>    for DEV in $(ip a l | grep mtu | awk '{print $2}' | awk -F &quot;:&quot; '{print $1}'); do echo &quot;===== $(date) =====&quot; &gt;&gt; &quot;network_stats_$now/ethtool_$DEV&quot;; ethtool -S &quot;$DEV&quot; &gt;&gt; &quot;network_stats_$now/ethtool_$DEV&quot; 2&gt;null; done<br>    sleep &quot;$DELAY&quot;<br>    if [ &quot;$ITERATIONS&quot; -gt 0 ]; then let ITERATIONS-=1; fi<br>done<br>#<br># monitor.sh ends here<br><br><publishedDate>2016-10-30T13:53:05Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000I935WIAR"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-10-28T07:09:46Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-10-28T07:23:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>저희 네트워크 그룹 전문 엔지니어로부터 분석 결과가 안내되었습니다.<br><br>다시 한번 간략하게 정리 드리면,<br><br>우선, 8000 번 포트를 이용하여 리스닝하고 있는 어플리케이션은 다음과 같습니다.<br>~~~<br> $ grep 8000 sosreport-PECCAL01SL-20161026165425/sos_commands/networking/netstat_-neopa <br>tcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      20472      140872658  46261/icman          off (0.00/0/0)<br>~~~<br><br>실행되고 있는 데몬인 icman 의 프로세스는 다음과 같습니다.<br>~~~<br> $ grep icman sosreport-PECCAL01SL-20161026165425/ps<br>pecadm    46261  0.0  0.0 36864788 439088 ?     Sl   Oct12   3:14 icman -attach pf=/usr/sap/PEC/SYS/profile/PEC_DVEBMGS00_PECCAL01SL<br>pecadm    48539  0.0  0.0 36864784 425268 ?     Sl   Oct12   3:15 icman -attach pf=/usr/sap/PEC/SYS/profile/PEC_D10_PECCAL01SL<br>~~~<br><br>제공해주신 패킷 덤프 파일의 타임 스탬프를 확인하면 동시간대임이 확인됩니다.<br>~~~<br> $ TZ=&quot;Asia/Seoul&quot; capinfos -ae capture2_PECCAL01SL.cap capture2_PPOSAL01SL.cap<br><br>File name:           capture2_PECCAL01SL.cap<br>Packet size limit:   inferred: 4096 bytes<br>First packet time:   2016-10-26 14:22:11.676936<br>Last packet time:    2016-10-26 14:27:19.763154<br><br>File name:           capture2_PPOSAL01SL.cap<br>Packet size limit:   inferred: 4096 bytes<br>First packet time:   2016-10-26 14:22:11.676253<br>Last packet time:    2016-10-26 14:27:19.762839<br>~~~<br><br>저희 네트워크 그룹 전문 엔지니어는 패킷 덤프 중 다음 부분들이 세션 단절을 나타내는 것으로 보고 있습니다.<br>~~~<br> $ TZ=&quot;Asia/Seoul&quot; tshark -nr capture2_PECCAL01SL.cap &quot;tcp.stream == 2&quot;<br> 39  21.295053 100.254.143.141 -&gt; 100.254.142.21 TCP 60 9517 → 8000 [SYN] Seq=0 Win=8190 Len=0 MSS=1460<br> 40  21.295077 100.254.142.21 -&gt; 100.254.143.141 TCP 58 8000 → 9517 [SYN, ACK] Seq=0 Ack=1 Win=29200 Len=0 MSS=1460<br> 41  21.295127 100.254.143.141 -&gt; 100.254.142.21 TCP 95 9517 → 8000 [PSH, ACK] Seq=1 Ack=1 Win=29200 Len=41<br> 42  21.295141 100.254.142.21 -&gt; 100.254.143.141 TCP 54 8000 → 9517 [ACK] Seq=1 Ack=42 Win=29200 Len=0<br> 43  21.295159 100.254.143.141 -&gt; 100.254.142.21 TCP 5894 9517 → 8000 [ACK] Seq=42 Ack=1 Win=29200 Len=5840<br> 44  21.295164 100.254.142.21 -&gt; 100.254.143.141 TCP 54 8000 → 9517 [ACK] Seq=1 Ack=5882 Win=40880 Len=0<br> 45  21.295166 100.254.143.141 -&gt; 100.254.142.21 TCP 740 9517 → 8000 [PSH, ACK] Seq=5882 Ack=1 Win=29200 Len=686<br> 46  21.295169 100.254.142.21 -&gt; 100.254.143.141 TCP 54 8000 → 9517 [ACK] Seq=1 Ack=6568 Win=43800 Len=0<br> 77 308.086218 100.254.143.141 -&gt; 100.254.142.21 TCP 60 9517 → 8000 [RST, ACK] Seq=6568 Ack=1 Win=9300 Len=0<br><br> $ TZ=&quot;Asia/Seoul&quot; tshark -nr capture2_PPOSAL01SL.cap &quot;tcp.stream == 2&quot;<br> 55  21.295066 100.254.143.141 -&gt; 100.254.142.21 TCP 74 9517 → 8000 [SYN] Seq=0 Win=29200 Len=0 MSS=1460 SACK_PERM=1 TSval=2165841376 TSecr=0 WS=128<br> 56  21.295169 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [SYN, ACK] Seq=0 Ack=1 Win=8190 Len=0 MSS=1460<br> 57  21.295183 100.254.143.141 -&gt; 100.254.142.21 TCP 54 9517 → 8000 [ACK] Seq=1 Ack=1 Win=29200 Len=0<br> 58  21.295238 100.254.143.141 -&gt; 100.254.142.21 TCP 95 9517 → 8000 [PSH, ACK] Seq=1 Ack=1 Win=29200 Len=41<br> 59  21.295354 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=42 Win=27699 Len=0<br> 60  21.295388 100.254.143.141 -&gt; 100.254.142.21 TCP 6580 9517 → 8000 [PSH, ACK] Seq=42 Ack=1 Win=29200 Len=6526<br> 61  21.295550 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=2962 Win=24779 Len=0<br> 62  21.295556 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=5882 Win=21859 Len=0<br> 63  21.295653 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=6568 Win=40880 Len=0<br> 64  21.295657 100.254.142.21 -&gt; 100.254.143.141 TCP 60 [TCP Dup ACK 63#1] 8000 → 9517 [ACK] Seq=1 Ack=6568 Win=40880 Len=0<br> 75 308.086586 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [RST, ACK] Seq=1 Ack=6568 Win=9300 Len=0<br>~~~<br><br>즉, 클라이언트는 데이터를 전송했고, 서버의 TCP 스택은 받은 데이터에 대해서 확인하고 약 5분간 대기한 후 TCP RST 을 보냅니다.<br><br>이는 클라이언트가 불완전한 메세지를 보냈거나 또는 서버가 메세지를 읽지 않았음을 나타냅니다.<br><br>데이터가 HTTP(비록 pcap 의 snaplen 이 4096)이기에 클라이언트로부터 받은 5840 바이트 메세지가 완전한지 불완전한지는 알 수가 없습니다. pcaps 의 다른 워킹 스트림들을 보면, 데이터 사이즈는 유사하게 ~6000 바이트를 나타냅니다.<br><br>만약 클라이언트가 불완전한 메세지를 보냈다면 서버는 불완전한 메세지만을 읽은 후에 결국 서버는 소켓을 타임아웃시키고 이를 닫을 것입니다. 즉, 서버가 TCP FIN 을 통해 커넥션을 종료할 수는 있을 것입니다만 이를 확인하기는 어려웠습니다.<br><br>다만, 클라이언트의 리퀘스트가 불완전할 것 같지는 않습니다.<br><br>현재 주어진 TCP RST 을 나타내는 커넥션 엔드는 대부분 서버 어플리케이션이 소켓으로부터 어떠한 데이터도 읽지 않았음을 나타냅니다. 후에 수신 버퍼상에 미해결된 데이터를 가진 소켓은 타임아웃되고 닫힐 것입니다. 그 경우에 TCP RST 이 송신하였을 것이 예상 가능합니다.<br><br>저희는 이미 해당 증상이 여러번 발생했음을 다음을 통해 확인할 수 있습니다:<br><br> $ egrep user ./sos_commands/networking/netstat_-s<br>    109214 connections reset due to early user close<br><br>이에 관해서는 다음 링크에서 상세 설명되고 있습니다 :<br><br> TCP connections are sometimes ended with an unexpected RST (reset)<br> https://access.redhat.com/solutions/2110691<br><br>우리는 커넥션을 처리하는 &quot;icman&quot; 서버 프로세스의 strace 를 통해 이에 대해 보다 구체적으로 확인할 수 있습니다:<br><br> How do I use strace to trace system calls made by a command?<br> https://access.redhat.com/articles/2483<br><br> strace -fvttTyy -s 10240 -o /tmp/strace.txt -p &quot;$PID&quot;<br><br>그리고 &quot;monitor.sh&quot; 스크립트를 이용하여 세션이 실패하는 동안의 데이터를 캡쳐하여 추가조사할 수 있습니다:<br><br> How to begin Network debugging<br> https://access.redhat.com/articles/1311173<br><br>그러나, 이 모든 것은 결국 이슈가 서버 어플리케이션에 의해 발생함을 확인하기 위한 것일 수 있습니다.<br>따라서, 고객께서는 &quot;icman&quot; 어플리케이션 벤더를 통해 해당 문제를 디버깅 해보실 필요가 있습니다.<br><br>~~~<br><br>이상 저희 엔지니어의 분석을 업무에 도움을 드리고자 제가 직역하였으므로 일부 오역이 있을수 있으므로<br>앞서 안내해드린 원본을 베이스로 참고용으로 사용해주시기 바랍니다.<br><br>또한, 추가 분석을 원하시면 상기 안내해드린바와 같이 추가 데이터를 수집하여 올려주시기 바랍니다.<br><br>마지막으로 이슈에 대한 효율적인 대응을 위하여 icman 에대한 조사 및 그에 따른 결과도 연계 부탁드립니다.  <br><br>감사합니다.<br><br><publishedDate>2016-10-28T07:09:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I92MyIAJ"><br>======================<br><b>생성계정 : Bainbridge, Jamie</b><br><b>생성날짜 : 2016-10-28T06:11:41Z</b><br><b>마지막 답변자 : Bainbridge, Jamie</b><br><b>마지막 수정 일자 : 2016-10-28T06:16:58Z</b><br><br>// collaboration note<br><br>Listening application:<br><br> $ grep 8000 sosreport-PECCAL01SL-20161026165425/sos_commands/networking/netstat_-neopa <br>tcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      20472      140872658  46261/icman          off (0.00/0/0)<br><br>Running application:<br><br> $ grep icman sosreport-PECCAL01SL-20161026165425/ps<br>pecadm    46261  0.0  0.0 36864788 439088 ?     Sl   Oct12   3:14 icman -attach pf=/usr/sap/PEC/SYS/profile/PEC_DVEBMGS00_PECCAL01SL<br>pecadm    48539  0.0  0.0 36864784 425268 ?     Sl   Oct12   3:15 icman -attach pf=/usr/sap/PEC/SYS/profile/PEC_D10_PECCAL01SL<br><br>Captured at same time:<br><br> $ TZ=&quot;Asia/Seoul&quot; capinfos -ae capture2_PECCAL01SL.cap capture2_PPOSAL01SL.cap<br><br>File name:           capture2_PECCAL01SL.cap<br>Packet size limit:   inferred: 4096 bytes<br>First packet time:   2016-10-26 14:22:11.676936<br>Last packet time:    2016-10-26 14:27:19.763154<br><br>File name:           capture2_PPOSAL01SL.cap<br>Packet size limit:   inferred: 4096 bytes<br>First packet time:   2016-10-26 14:22:11.676253<br>Last packet time:    2016-10-26 14:27:19.762839<br><br>I assume this is the broken session in question:<br><br> $ TZ=&quot;Asia/Seoul&quot; tshark -nr capture2_PECCAL01SL.cap &quot;tcp.stream == 2&quot;<br> 39  21.295053 100.254.143.141 -&gt; 100.254.142.21 TCP 60 9517 → 8000 [SYN] Seq=0 Win=8190 Len=0 MSS=1460<br> 40  21.295077 100.254.142.21 -&gt; 100.254.143.141 TCP 58 8000 → 9517 [SYN, ACK] Seq=0 Ack=1 Win=29200 Len=0 MSS=1460<br> 41  21.295127 100.254.143.141 -&gt; 100.254.142.21 TCP 95 9517 → 8000 [PSH, ACK] Seq=1 Ack=1 Win=29200 Len=41<br> 42  21.295141 100.254.142.21 -&gt; 100.254.143.141 TCP 54 8000 → 9517 [ACK] Seq=1 Ack=42 Win=29200 Len=0<br> 43  21.295159 100.254.143.141 -&gt; 100.254.142.21 TCP 5894 9517 → 8000 [ACK] Seq=42 Ack=1 Win=29200 Len=5840<br> 44  21.295164 100.254.142.21 -&gt; 100.254.143.141 TCP 54 8000 → 9517 [ACK] Seq=1 Ack=5882 Win=40880 Len=0<br> 45  21.295166 100.254.143.141 -&gt; 100.254.142.21 TCP 740 9517 → 8000 [PSH, ACK] Seq=5882 Ack=1 Win=29200 Len=686<br> 46  21.295169 100.254.142.21 -&gt; 100.254.143.141 TCP 54 8000 → 9517 [ACK] Seq=1 Ack=6568 Win=43800 Len=0<br> 77 308.086218 100.254.143.141 -&gt; 100.254.142.21 TCP 60 9517 → 8000 [RST, ACK] Seq=6568 Ack=1 Win=9300 Len=0<br><br> $ TZ=&quot;Asia/Seoul&quot; tshark -nr capture2_PPOSAL01SL.cap &quot;tcp.stream == 2&quot;<br> 55  21.295066 100.254.143.141 -&gt; 100.254.142.21 TCP 74 9517 → 8000 [SYN] Seq=0 Win=29200 Len=0 MSS=1460 SACK_PERM=1 TSval=2165841376 TSecr=0 WS=128<br> 56  21.295169 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [SYN, ACK] Seq=0 Ack=1 Win=8190 Len=0 MSS=1460<br> 57  21.295183 100.254.143.141 -&gt; 100.254.142.21 TCP 54 9517 → 8000 [ACK] Seq=1 Ack=1 Win=29200 Len=0<br> 58  21.295238 100.254.143.141 -&gt; 100.254.142.21 TCP 95 9517 → 8000 [PSH, ACK] Seq=1 Ack=1 Win=29200 Len=41<br> 59  21.295354 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=42 Win=27699 Len=0<br> 60  21.295388 100.254.143.141 -&gt; 100.254.142.21 TCP 6580 9517 → 8000 [PSH, ACK] Seq=42 Ack=1 Win=29200 Len=6526<br> 61  21.295550 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=2962 Win=24779 Len=0<br> 62  21.295556 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=5882 Win=21859 Len=0<br> 63  21.295653 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [ACK] Seq=1 Ack=6568 Win=40880 Len=0<br> 64  21.295657 100.254.142.21 -&gt; 100.254.143.141 TCP 60 [TCP Dup ACK 63#1] 8000 → 9517 [ACK] Seq=1 Ack=6568 Win=40880 Len=0<br> 75 308.086586 100.254.142.21 -&gt; 100.254.143.141 TCP 60 8000 → 9517 [RST, ACK] Seq=1 Ack=6568 Win=9300 Len=0<br><br>The client sends some data, and server TCP stack acknowledges receiving data, then server waits ~5 minutes then sends a TCP RST.<br><br>Either the client sent an incomplete message, or the server never read the message.<br><br>The data is HTTP, though the pcap was taken with snaplen 4096, so we cannot see if the 5840 byte message from the client is complete or not. Looking at other working streams in the pcaps, the data size is a similar ~6000 bytes.<br><br>If the client sent an incomplete message, the server read that partial message, then the server timed out the socket and closed it, it is likely the server would end the connection with a TCP FIN. We do not see that.<br><br>It seems unlikely the client request was incomplete.<br><br>Given that the connection ends with a TCP RST, it is most likely the server application did not read any data from the socket at all, then timed the socket out and closed the socket with data outstanding in the recv buffer, in which case it is expected that a TCP RST is sent.<br><br>We can confirm this has happened many times already:<br><br> $ egrep user ./sos_commands/networking/netstat_-s<br>    109214 connections reset due to early user close<br><br>This is described at:<br><br> TCP connections are sometimes ended with an unexpected RST (reset)<br> https://access.redhat.com/solutions/2110691<br><br>We could confirm this with an strace of the &quot;icman&quot; server process which handles the connection:<br><br> How do I use strace to trace system calls made by a command?<br> https://access.redhat.com/articles/2483<br><br> strace -fvttTyy -s 10240 -o /tmp/strace.txt -p &quot;$PID&quot;<br><br>and with a capture of &quot;monitor.sh&quot; over the time of a failing session:<br><br> How to begin Network debugging<br> https://access.redhat.com/articles/1311173<br><br>However, those would just confirm the issue lies in the server application for completeness.<br><br>The customer should pursue this with the vendor of the &quot;icman&quot; application to debug the process/thread which handles the socket connection above.<br><br><publishedDate>2016-10-28T06:11:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I91BKIAZ"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2016-10-28T04:28:19Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2016-10-28T04:28:19Z</b><br><br>아네 2를 빼고 적었네요 그 화일이 맞습니다<br><br><publishedDate>2016-10-28T04:28:19Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000I8zt0IAB"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-10-28T02:09:07Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-10-28T02:09:07Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>확인결과 파일명이 다소 다릅니다만,<br><br>&gt; capture_PECCAL01SL.cap<br>&gt; capture_PPOSAL01SL.cap<br><br>다음 파일이 맞는지 확인 바랍니다.<br><br>capture2_PECCAL01SL.cap<br>capture2_PPOSAL01SL.cap<br><br>감사합니다.<br><br><publishedDate>2016-10-28T02:09:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I8zqpIAB"><br>======================<br><b>생성계정 : 게이트, 타임</b><br><b>생성날짜 : 2016-10-28T02:00:44Z</b><br><b>마지막 답변자 : 게이트, 타임</b><br><b>마지막 수정 일자 : 2016-10-28T02:00:44Z</b><br><br>capture_PECCAL01SL.cap<br>capture_PPOSAL01SL.cap<br>이상 2개의 tcpdump 원본화일 incoming 디렉토리에 올렸습니다.<br><br><publishedDate>2016-10-28T02:00:44Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000I8yXxIAJ"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-10-28T00:08:08Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-10-28T00:08:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>새벽 시간대 저희 네트워크 그룹 엔지니어로부터<br>패킷 덤프의 바이너리 파일 재요청이 있었습니다.<br>확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-10-28T00:08:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I8iKMIAZ"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-10-27T08:18:28Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-10-27T08:18:27Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>현재 올려주신 데이터를 토대로 네트워크 전문 그룹을 통해 협업을 진행중에 있습니다.<br>tcpdump 의 경우 txt 로 올려주셨습니다만<br>혹시 덤프파일 원본 그대로 올려주실 수 있는지요?<br><br>확인 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2016-10-27T08:18:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000I8cskIAB"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-10-27T00:12:10Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-10-27T00:12:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>저는 신재욱 과장이라고 합니다.<br>앞으로 해당 케이스를 담당하게 되었습니다.<br><br>현재 이 케이스의 내용을 살펴보는 중이며, 관련하여 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-10-27T00:12:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>약 3~5분 사이에 세션이 끊기는 증상이<br>발생하고 있습니다.<br><br>이에 접속 tcpdump를 캡처해서 보았으나 특이사항이 없어보이는것으로 판단됩니다.<br><br>ftp로 약 100메가 가량의 화일 tcpdump_161026.zip를 첨부하였으니<br>확인 후 연락 부탁드립니다.<br>파일안에는 PECCAL01SL, PPOSAL01SL sosreport와 각 호스트의 tcpdump가 첨부되어 있습니다.<br><br>고객정보<br>회사명 : 삼성생명  <br>성명 : 석윤식 <br>직급 : 수석보<br>전화번호 : 010-9017-1274 <br> <br>감사합니다.</issue><cep>false</cep></case>