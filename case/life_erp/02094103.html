======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2018-05-08T07:52:16Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-06-12T10:03:23Z</b><br><b>id : 500A000000aRXHzIAO</b><br>======================<br><br><b><font size=15>
제목  : vmmemctl 관련 문ㅇ
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>아래와 같이 RHEL 6.6 서버에서 메세지가 발생하였는데요.<br><br>검색해보니 아래와 같은 유사 상황이 있는 것 같아서<br>혹시 해당 문제가 맞는 것인지 문의드리려고 합니다.<br><br>https://access.redhat.com/solutions/2949201<br><br><br>root@SLPTASAL01 /var/log # cat /etc/redhat-release<br>Red Hat Enterprise Linux Server release 6.6 (Santiago)<br><br> - /var/log/messages 중 일부분<br>May  6 09:56:16 SLPTASAL01 kernel:<br>May  6 09:56:16 SLPTASAL01 kernel:<br>May  6 09:56:16 SLPTASAL01 kernel: Pid: 99, comm: khungtaskd Tainted: P           ---------------    2.6.32-504.23.4.el6.x86_64 #1 VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform<br>May  6 09:56:16 SLPTASAL01 kernel: RIP: 0010:[&lt;ffffffff810e9f98&gt;]  [&lt;000000000042d931&gt;] 0x42d931<br>May  6 09:56:16 SLPTASAL01 kernel: [&lt;ffffffff814505c7&gt;] kfree_skb+0x27/0x90<br>May  6 09:56:16 SLPTASAL01 kernel: Pid: 728, comm: vmmemctl Tainted: P           ---------------    2.6.32-504.23.4.el6.x86_64 #1 [&lt;0000003f7849c7c4&gt;] 0x3f7849c7c4<br>May  6 09:56:16 SLPTASAL01 kernel: RSP: 0018:ffff880028203ad0  EFLAGS: 00000282<br>May  6 09:56:16 SLPTASAL01 kernel: RSP: 002b:00007f74eebfc470  EFLAGS: 00010202<br>May  6 09:56:16 SLPTASAL01 kernel: [&lt;00007f93310103f5&gt;] 0x7f93310103f5<br>May  6 09:56:16 SLPTASAL01 kernel: RSP: 002b:00007f93231014f0  EFLAGS: 00010216<br>May  6 09:56:16 SLPTASAL01 kernel: [&lt;ffffffff810e9f98&gt;] watchdog+0xa8/0x250<br>May  6 09:56:16 SLPTASAL01 kernel: RAX: 00007f93310061d4 RBX: 00007f9323101510 RCX: 00000000000030c1<br>May  6 09:56:16 SLPTASAL01 kernel: RDX: 00000000a1b42af0 RSI: 00007f93231014d8 RDI: 00007f9323101520<br>May  6 09:56:16 SLPTASAL01 kernel: RBP: ffffffff8100bc0e R08: 0000000000000000 R09: 0000000000000001<br>May  6 09:56:16 SLPTASAL01 kernel: R10: 00007f933aee9840 R11: 00007f93312c2310 R12: 00007f9323101570<br>May  6 09:56:16 SLPTASAL01 kernel: R13: 00007f92e4483000 R14: 00007f9323101590 R15: 00007f9323101520<br>May  6 09:56:16 SLPTASAL01 kernel: FS:  00007f9323102700(0000) GS:ffff880028300000(0000) knlGS:0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033<br>May  6 09:56:16 SLPTASAL01 kernel: CR2: 00007f933b14c7d0 CR3: 0000000f60e43000 CR4: 00000000001407e0<br>May  6 09:56:16 SLPTASAL01 kernel: RSP: 002b:00007f59130e4930  EFLAGS: 00010206<br>May  6 09:56:16 SLPTASAL01 kernel: RAX: 0000000000000000 RBX: 00007f59130e4950 RCX: 00000000332559f1<br>May  6 09:56:16 SLPTASAL01 kernel: RDX: 00007f5932ff95f0 RSI: 0000000000000000 RDI: 00007f59130e4940<br>May  6 09:56:16 SLPTASAL01 kernel: RBP: ffffffff8100bc0e R08: 00007f5932ff9600 R09: 0000000000000001<br>May  6 09:56:16 SLPTASAL01 kernel: R10: 00007f59329cb390 R11: 0000000000000001 R12: 00007f5840018a28<br>May  6 09:56:16 SLPTASAL01 kernel: R13: 00007f5840018a50 R14: 00007f5840018a00 R15: 000000000000006e<br>May  6 09:56:16 SLPTASAL01 kernel: FS:  00007f59130e5700(0000) GS:ffff880028340000(0000) knlGS:0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033<br>May  6 09:56:16 SLPTASAL01 kernel: CR2: 00007f006f2a7000 CR3: 0000001024a0a000 CR4: 00000000001407e0<br>May  6 09:56:16 SLPTASAL01 kernel: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform<br>May  6 09:56:16 SLPTASAL01 kernel: RIP: 0010:[&lt;ffffffffa00276a9&gt;]<br>May  6 09:56:16 SLPTASAL01 kernel: RAX: 00007f74d8000ab0 RBX: 00007f74e0990258 RCX: 0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: [&lt;ffffffffa00276a9&gt;] vmballoon_work+0x3b9/0x7d8 [vmware_balloon]<br>May  6 09:56:16 SLPTASAL01 kernel: RSP: 0018:ffff88102420fea0  EFLAGS: 00010202<br>May  6 09:56:16 SLPTASAL01 kernel: DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: RAX: 0000000000000001 RBX: ffff880028203af0 RCX: ffff881028b33ac8<br>May  6 09:56:16 SLPTASAL01 kernel: DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: RDX: 0000000001d4d460 RSI: 0000000000000001 RDI: 0000000000000002<br>May  6 09:56:16 SLPTASAL01 kernel: RBP: ffffffff8100bc0e R08: 000000000000000c R09: 00007f74d0004818<br>May  6 09:56:16 SLPTASAL01 kernel: R10: 00007f750358c0e8 R11: 00000000004219d0 R12: 00007f74e0990258<br>May  6 09:56:16 SLPTASAL01 kernel: R13: 00007f74e0990258 R14: 0000000001fb98d0 R15: 00000000003baff5<br>May  6 09:56:16 SLPTASAL01 kernel: RSP: 0018:ffff881022901dd0  EFLAGS: 00000202<br>May  6 09:56:16 SLPTASAL01 kernel: RAX: 0000000000000000 RBX: ffff881022901e30 RCX: 0000000000000002<br>May  6 09:56:16 SLPTASAL01 kernel: RDX: 0000000000005670 RSI: 00000000001c8e59 RDI: 0000000000000282<br>May  6 09:56:16 SLPTASAL01 kernel: RBP: ffffffff8100bc0e R08: 0000000000000000 R09: 0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: R10: 0000000000000000 R11: 0000000000000000 R12: 00000000000158c0<br>May  6 09:56:16 SLPTASAL01 kernel: R13: ffff8810234a6040 R14: ffff881027d97520 R15: 0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400<br>May  6 09:56:16 SLPTASAL01 kernel: FS:  00007f74eebfd700(0000) GS:ffff8800282c0000(0000) knlGS:0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033<br>May  6 09:56:16 SLPTASAL01 kernel: CR2: 00007f5933260f58 CR3: 000000102701f000 CR4: 00000000001407e0<br>May  6 09:56:16 SLPTASAL01 kernel: RAX: 0000000000000001 RBX: ffff88102420fee0 RCX: 0000000000000000<br>May  6 09:56:16 SLPTASAL01 kernel: RDX: 0000000000000000 RSI: 0000000000000286 RDI: 0000000000000007<br>May  6 09:56:16 SLPTASAL01 kernel: RBP: ffffffff8100bc0e R08: ffff88102420e000 R09: ffff8810243c1530<br>May  6 09:56:16 SLPTASAL01 kernel: R10: 0000000000000000 R11: 0000000000000000 R12: ffff88102418aab0<br>May  6 09:56:16 SLPTASAL01 kernel: R13: ffffffff81087540 R14: 0000000565421c88 R15: dead000000200200<br>May  6 09:56:16 SLPTASAL01 kernel: DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400<br>May  6 09:56:16 SLPTASAL01 kernel: FS:  0000000000000000(0000) GS:ffff880028380000(0000) knlGS:0000000000000000<br>=== 생략 ===<br><br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.6</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPTASAL01</hostname><br><br><br><comment id="a0aA000000MfrTYIAZ"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-05-28T08:27:23Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-05-28T08:27:23Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>우선, 제가 분석한 내용입니다. 내용을 확인해보시고 궁금하신 사항이 있으시면 알려주시기 바랍니다.<br><br>09:26:01 시점부터 메모리 사용량이 증가하여 09:36:02 시점에 심각한 메모리 부족 현상 발생하였습니다.<br>이때는 버퍼와 캐시 까지 모두 반환하여 메모리를 할당하는 상황이 되었습니다.<br><br>sysctl 설정에서 vm.panic_on_oom = 0 로 설정되어 있어서 메모리 부족시 kdump가 수행되지 않고 hung상태로 있었것으로 보입니다. <br><br>vm.panic_on_oom = 1 로 변경한 후 문제가 다시 발생하면 kdump로 vmcore를 받아 분석이 가능할 것으로 보입니다.<br><br>oom-killer 관련 로그에서 확인되는 프로세스들의 평상시 자원 사용량을 확인해보시는 것이 필요해보입니다.<br>보내주신 sosreport로 보면 메모리 부하가 평상시 보다 작아서 아마도 문제를 발생시키는 프로세스가 작동하지 않고 있는 것으로 판단됩니다.<br><br>자세한 사항은 아래와 같습니다.<br><br>$ grep panic sysctl_-a<br>kernel.panic = 0<br>kernel.panic_on_oops = 1<br>kernel.softlockup_panic = 0<br>kernel.unknown_nmi_panic = 1<br>kernel.panic_on_unrecovered_nmi = 1<br>kernel.panic_on_io_nmi = 1<br>kernel.hung_task_panic = 0<br>vm.panic_on_oom = 0<br><br>메모리 사용률 변화<br><br>평상시 메모리 사용량과의 비교 <br>문제 발생 시점과 시스템 재기동 이후의 메모리 사용률을 보면 현저한 차이가 나타납니다.<br><br>09:30:01    kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit<br>09:31:01       311252  65663528     99.53    329672  21311096  13657676     16.50<br>09:32:01       323988  65650792     99.51    326688  17075904  13657788     16.50<br>09:33:01       322052  65652728     99.51    326104  12808500  13657796     16.50<br>09:34:01       322624  65652156     99.51    326280   8238376  13657796     16.50<br>09:35:01       321144  65653636     99.51    326092   4102616  13659608     16.50<br>09:36:02      1209188  64765592     98.17       720     14772  13657764     16.50<br>09:37:01      1519596  64455184     97.70      2164      9612  13657788     16.50<br>Average:       618549  65356231     99.06    233960   9080125  13658031     16.50<br><br>09:41:05          LINUX RESTART<br><br>09:42:01    kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit<br>09:43:01     65291268    683512      1.04     22072    149976    362864      0.44<br>09:44:01     65286848    687932      1.04     22936    151084    405152      0.49<br>09:45:01     65285220    689560      1.05     22964    151112    408264      0.49<br>09:46:01     65284640    690140      1.05     23480    152572    405152      0.49<br>09:47:01     65284224    690556      1.05     23512    152600    405060      0.49<br>09:48:01     65281688    693092      1.05     23952    153568    406592      0.49<br>09:49:01     62734464   3240316      4.91     62188    316680  11599148     14.01<br>09:50:01     62694780   3280000      4.97     64436    322780  11611068     14.03<br>09:51:01     62429512   3545268      5.37     65760    338352  11618328     14.04<br><br>11:28:01     61843124   4131656      6.26     76536    381528  13392296     16.18<br>11:29:01     61842180   4132600      6.26     76700    381564  13392296     16.18<br>11:30:01     61842064   4132716      6.26     76836    381596  13394744     16.18<br>11:31:01     61841176   4133604      6.27     76980    381640  13392292     16.18<br>11:32:02     61839328   4135452      6.27     78328    381760  13393144     16.18<br>11:33:01     61839776   4135004      6.27     78464    381784  13392484     16.18<br>11:34:01     61839604   4135176      6.27     78592    381808  13392616     16.18<br><br>11:34:01    kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit<br>11:35:01     61838684   4136096      6.27     78720    381856  13395196     16.19<br>11:36:01     61836360   4138420      6.27     78864    381892  13392684     16.18<br>Average:     62174788   3799992      5.76     68821    353876  12015163     14.52<br><br>평소의 메모리 사용률은 55% 정도로 15일 부터 27일 문제 발생전까지 꾸준히 유지되고 있습니다.<br><br>15일<br>23:58:01     29603360  36371420     55.13   1045280  28791916  13497620     16.31<br>23:59:01     29603656  36371124     55.13   1045280  28791956  13497724     16.31<br>Average:     29661695  36313085     55.04   1045180  28777849  13498225     16.31<br><br>16일<br>23:58:01     30410304  35564476     53.91   1045464  28824892  13484704     16.29<br>23:59:01     30410344  35564436     53.91   1045464  28824932  13484700     16.29<br>Average:     30481118  35493662     53.80   1045376  28810654  13480112     16.29<br><br>17일부터 25일까지는 거의 비슷한 메모리 사용량 패턴을 보이고 있습니다.<br><br>26일<br>23:58:01     29987520  35987260     54.55   1047588  28971364  13651536     16.49<br>23:59:01     29987296  35987484     54.55   1047588  28971408  13651536     16.49<br>Average:     29997347  35977433     54.53   1047536  28964128  13651975     16.50<br><br><br>messages 로그 oom-killer<br><br>messages 로그에는 메모리 부족으로인해 oom-killer 가 작동하여 메모리를 많이 사용하는 프로세스들을 종료시킨 것으로 나타나고 있으며 이후 시스템이 재기동 되었습니다. java와 Weblogic 관련 프로세스인것으로 나타납니다.<br><br>messages <br>~~~<br>May 27 09:37:21 SLPFDSAL02 kernel: __ratelimit: 3 callbacks suppressed<br>May 27 09:37:21 SLPFDSAL02 kernel: xinetd invoked oom-killer: gfp_mask=0xd0, order=1, oom_adj=0, oom_score_adj=0<br>May 27 09:37:21 SLPFDSAL02 kernel: xinetd cpuset=/ mems_allowed=0<br>May 27 09:37:21 SLPFDSAL02 kernel: Pid: 2601, comm: xinetd Tainted: P           --------------- H  2.6.32-358.23.2.el6.x86_64 #1<br>May 27 09:37:21 SLPFDSAL02 kernel: Call Trace:<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff810cb641&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111ce40&gt;] ? dump_header+0x90/0x1b0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111d2c2&gt;] ? oom_kill_process+0x82/0x2a0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111d201&gt;] ? select_bad_process+0xe1/0x120<br>May 27 09:37:21 SLPFDSAL02 kernel: [  891]  1560   891     4473        1   0       0             0 zabbix_agentd<br>May 27 09:37:21 SLPFDSAL02 kernel: [  893]  1560   893     4473      128   1       0             0 zabbix_agentd<br>May 27 09:37:21 SLPFDSAL02 kernel: [  894]  1560   894     4473        1   2       0             0 zabbix_agentd<br>May 27 09:37:21 SLPFDSAL02 kernel: [  895]  1560   895     4473        1   3       0             0 zabbix_agentd<br>May 27 09:37:21 SLPFDSAL02 kernel: [  896]  1560   896     4473        1   1       0             0 zabbix_agentd<br>May 27 09:37:21 SLPFDSAL02 kernel: [  897]  1560   897     4476        1   1       0             0 zabbix_agentd<br>May 27 09:37:21 SLPFDSAL02 kernel: [23269]  1164 23269  4645549       68   2       0             0 java<br>May 27 09:37:21 SLPFDSAL02 kernel: [27021]     0 27021     2309        1   0       0             0 sh<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 7517]     0  7517     3304        2   0       0             0 sgaSol_watchdog<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 7521]     0  7521     4983        0   1       0             0 sgaSol<br>May 27 09:37:21 SLPFDSAL02 kernel: [23438]     0 23438     1734        0   0       0             0 mxGATE<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 6994]  1164  6994     2308        1   2       0             0 startManagedWeb<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 6997]  1164  6997     2342        1   1       0             0 startWebLogic.s<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 7027]  1164  7027     2308        1   2       0             0 startManagedWeb<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 7031]  1164  7031     2342        1   0       0             0 startWebLogic.s<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 7099]  1164  7099  1939282     2138   1       0             0 java<br>May 27 09:37:21 SLPFDSAL02 kernel: [ 7109]  1164  7109  1936673      768   2       0             0 java<br>May 27 09:37:21 SLPFDSAL02 kernel: [19872]     0 19872   156357      122   2       0             0 ontuned<br>May 27 09:37:21 SLPFDSAL02 kernel: [20029]     0 20029     1532       63   1       0             0 vmstat<br>May 27 09:37:21 SLPFDSAL02 kernel: [20049]     0 20049     3093       68   1       0             0 rcagent<br>May 27 09:37:21 SLPFDSAL02 kernel: Out of memory: Kill process 7099 (java) score 29 or sacrifice child<br>May 27 09:37:21 SLPFDSAL02 kernel: Killed process 7099, UID 1164, (java) total-vm:7757128kB, anon-rss:6956kB, file-rss:16kB<br>May 27 09:37:22 SLPFDSAL02 kernel: startWebLogic.s invoked oom-killer: gfp_mask=0xd0, order=1, oom_adj=0, oom_score_adj=<br><br>May 27 09:37:22 SLPFDSAL02 kernel: [ 7517]     0  7517     3304        0   0       0             0 sgaSol_watchdog<br>May 27 09:37:22 SLPFDSAL02 kernel: [ 7521]     0  7521     4983        0   1       0             0 sgaSol<br>May 27 09:37:22 SLPFDSAL02 kernel: [23438]     0 23438     1734        0   0       0             0 mxGATE<br>May 27 09:37:22 SLPFDSAL02 kernel: [ 6994]  1164  6994     2308        1   2       0             0 startManagedWeb<br>May 27 09:37:22 SLPFDSAL02 kernel: [ 6997]  1164  6997     2343        1   2       0             0 startWebLogic.s<br>May 27 09:37:22 SLPFDSAL02 kernel: [ 7027]  1164  7027     2308        1   2       0             0 startManagedWeb<br>May 27 09:37:22 SLPFDSAL02 kernel: [ 7031]  1164  7031     2342        1   0       0             0 startWebLogic.s<br>May 27 09:37:22 SLPFDSAL02 kernel: [ 7109]  1164  7109  1936673      984   2       0             0 java<br>May 27 09:37:22 SLPFDSAL02 kernel: [19872]     0 19872   156357       12   2       0             0 ontuned<br>May 27 09:37:22 SLPFDSAL02 kernel: [20029]     0 20029     1532        1   1       0             0 vmstat<br>May 27 09:37:22 SLPFDSAL02 kernel: [20049]     0 20049     3093       61   1       0             0 rcagent<br>May 27 09:37:22 SLPFDSAL02 kernel: Out of memory: Kill process 7109 (java) score 16 or sacrifice child<br>May 27 09:37:22 SLPFDSAL02 kernel: Killed process 7109, UID 1164, (java) total-vm:7746692kB, anon-rss:3016kB, file-rss:968kB<br>May 27 09:37:23 SLPFDSAL02 kernel: startWebLogic.s invoked oom-killer: gfp_mask=0xd0, order=1, oom_adj=0, oom_score_adj=0<br>May 27 09:37:23 SLPFDSAL02 kernel: startWebLogic.s cpuset=/ mems_allowed=0<br><br><br>May 27 09:37:23 SLPFDSAL02 kernel: [  896]  1560   896     4473        1   1       0             0 zabbix_agentd<br>May 27 09:37:23 SLPFDSAL02 kernel: [  897]  1560   897     4476        1   2       0             0 zabbix_agentd<br>May 27 09:37:23 SLPFDSAL02 kernel: [23269]  1164 23269  4645549       50   2       0             0 java<br>May 27 09:37:23 SLPFDSAL02 kernel: [27021]     0 27021     2309        1   0       0             0 sh<br>May 27 09:37:23 SLPFDSAL02 kernel: [ 7517]     0  7517     3304        0   0       0             0 sgaSol_watchdog<br>May 27 09:37:23 SLPFDSAL02 kernel: [ 7521]     0  7521     4983        0   1       0             0 sgaSol<br>May 27 09:37:23 SLPFDSAL02 kernel: [23438]     0 23438     1734        0   0       0             0 mxGATE<br>May 27 09:37:23 SLPFDSAL02 kernel: [ 6994]  1164  6994     2308        1   2       0             0 startManagedWeb<br>May 27 09:37:23 SLPFDSAL02 kernel: [ 6997]  1164  6997     2343        1   2       0             0 startWebLogic.s<br>May 27 09:37:23 SLPFDSAL02 kernel: [ 7027]  1164  7027     2308        1   2       0             0 startManagedWeb<br>May 27 09:37:23 SLPFDSAL02 kernel: [ 7031]  1164  7031     2343      203   0       0             0 startWebLogic.s<br>May 27 09:37:23 SLPFDSAL02 kernel: [19872]     0 19872   156357        1   2       0             0 ontuned<br>May 27 09:37:23 SLPFDSAL02 kernel: [20029]     0 20029     1532        1   1       0             0 vmstat<br>May 27 09:37:23 SLPFDSAL02 kernel: [20049]     0 20049     3093        0   1       0             0 rcagent<br>May 27 09:37:23 SLPFDSAL02 kernel: Out of memory: Kill process 23269 (java) score 7 or sacrifice child<br>May 27 09:37:23 SLPFDSAL02 kernel: Killed process 23269, UID 1164, (java) total-vm:18582196kB, anon-rss:116kB, file-rss:84kB<br>May 27 09:37:24 SLPFDSAL02 kernel: xinetd invoked oom-killer: gfp_mask=0xd0, order=1, oom_adj=0, oom_score_adj=0<br>May 27 09:37:24 SLPFDSAL02 kernel: xinetd cpuset=/ mems_allowed=0<br>May 27 09:37:24 SLPFDSAL02 kernel: Pid: 2601, comm: xinetd Tainted: P           --------------- H  2.6.32-358.23.2.el6.x86_64 #1<br><br><br>May 27 09:37:24 SLPFDSAL02 kernel: [20049]     0 20049     3093        0   3       0             0 rcagent<br>May 27 09:37:24 SLPFDSAL02 kernel: Out of memory: Kill process 2081 (VGAuthService) score 1 or sacrifice child<br>May 27 09:37:24 SLPFDSAL02 kernel: Killed process 2081, UID 0, (VGAuthService) total-vm:47740kB, anon-rss:0kB, file-rss:4kB<br>May 27 09:41:07 SLPFDSAL02 kernel: imklog 5.8.10, log source = /proc/kmsg started.<br>May 27 09:41:07 SLPFDSAL02 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;2260&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>May 27 09:41:07 SLPFDSAL02 kernel: Initializing cgroup subsys cpuset<br>May 27 09:41:07 SLPFDSAL02 kernel: Initializing cgroup subsys cpu<br>May 27 09:41:07 SLPFDSAL02 kernel: Linux version 2.6.32-358.23.2.el6.x86_64 (mockbuild@x86-022.build.eng.bos.redhat.com) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-3) (GCC) ) #1 SMP Sat Sep 14 05:32:37 EDT 2013<br>May 27 09:41:07 SLPFDSAL02 kernel: Command line: ro root=/dev/sda2 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet nmi_watchdog=0 transparent_hugepage=never<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2018-05-28T08:27:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MfpzUIAR"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-05-28T06:36:43Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-05-28T06:36:43Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>VM guest에 대해서 문제가 또 발생하여서 문의드립니다.<br><br>발생 시점의 상태는 아래와 같은데요.<br>제가 몇가지 부분을 확인해봤습니다.<br><br>추가로 sosreport도 dropbox에 업로드하였습니다.<br><br>02094103_sosreport-SLPFDSAL02-20180527113848-3b9f.tar.xz<br><br>root@SLPFDSAL02 /var/log/sa # sar -S -f sa27 -s &quot;09:30:00&quot; -e &quot;09:50:00&quot;<br>Linux 2.6.32-358.23.2.el6.x86_64 (SLPFDSAL02)   05/27/2018      _x86_64_        (4 CPU)<br><br>09:30:01 AM kbswpfree kbswpused  %swpused  kbswpcad   %swpcad<br>09:31:01 AM  16787916         0      0.00         0      0.00<br>09:32:01 AM  16787916         0      0.00         0      0.00<br>09:33:01 AM  16787916         0      0.00         0      0.00<br>09:34:01 AM  16787916         0      0.00         0      0.00<br>09:35:01 AM  16787916         0      0.00         0      0.00<br>09:36:02 AM  16070016    717900      4.28     61488      8.56<br>09:37:01 AM  12319672   4468244     26.62     18316      0.41<br>Average:     16047038    740878      4.41     11400      1.54<br><br>09:41:05 AM       LINUX RESTART<br><br>09:42:01 AM kbswpfree kbswpused  %swpused  kbswpcad   %swpcad<br>09:43:01 AM  16787916         0      0.00         0      0.00<br>09:44:01 AM  16787916         0      0.00         0      0.00<br>09:45:01 AM  16787916         0      0.00         0      0.00<br>09:46:01 AM  16787916         0      0.00         0      0.00<br>09:47:01 AM  16787916         0      0.00         0      0.00<br>09:48:01 AM  16787916         0      0.00         0      0.00<br>09:49:01 AM  16787916         0      0.00         0      0.00<br>Average:     16787916         0      0.00         0      0.00<br>root@SLPFDSAL02 /var/log/sa # sar -u -f sa27 -s &quot;09:30:00&quot; -e &quot;09:50:00&quot;<br>Linux 2.6.32-358.23.2.el6.x86_64 (SLPFDSAL02)   05/27/2018      _x86_64_        (4 CPU)<br><br>09:30:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle<br>09:31:01 AM     all      1.39      0.00      6.08      0.27      0.00     92.26<br>09:32:01 AM     all      0.48      0.00      5.62      0.03      0.00     93.87<br>09:33:01 AM     all      0.70      0.00      4.86      0.05      0.00     94.38<br>09:34:01 AM     all      0.31      0.00      3.96      0.04      0.00     95.68<br>09:35:01 AM     all      1.04      0.00      4.32      0.04      0.00     94.61<br>09:36:02 AM     all      0.38      0.00      3.48      4.38      0.00     91.76<br>09:37:01 AM     all      0.42      0.00      4.50     13.78      0.00     81.29<br>Average:        all      0.67      0.00      4.68      2.64      0.00     92.00<br><br>09:41:05 AM       LINUX RESTART<br><br>09:42:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle<br>09:43:01 AM     all      0.04      0.00      0.11      0.02      0.00     99.84<br>09:44:01 AM     all      0.08      0.00      0.14      0.09      0.00     99.70<br>09:45:01 AM     all      0.06      0.00      0.10      0.00      0.00     99.84<br>09:46:01 AM     all      0.10      0.00      0.11      0.01      0.00     99.78<br>09:47:01 AM     all      0.05      0.00      0.10      0.00      0.00     99.85<br>09:48:01 AM     all      0.05      0.00      0.14      0.03      0.00     99.77<br>09:49:01 AM     all     19.90      0.00      4.20      4.32      0.00     71.58<br>Average:        all      2.87      0.00      0.70      0.63      0.00     95.80<br><br> - 문제 발생 시점<br>May 27 09:00:15 SLPFDSAL02 rc_pam_acl[14694]: session opened for user 'sliida'(from 100.254.180.54) with service 'sshd' [#1]<br>May 27 09:00:15 SLPFDSAL02 restricted-command: Executing passwd root<br>May 27 09:25:02 SLPFDSAL02 kernel: hrtimer: interrupt took 594792614 ns<br>May 27 09:25:04 SLPFDSAL02 kernel: NET: Unregistered protocol family 36<br>May 27 09:25:04 SLPFDSAL02 kernel: NET: Registered protocol family 36<br>May 27 09:25:35 SLPFDSAL02 kernel: NET: Unregistered protocol family 36<br>May 27 09:37:21 SLPFDSAL02 kernel: __ratelimit: 3 callbacks suppressed<br>May 27 09:37:21 SLPFDSAL02 kernel: xinetd invoked oom-killer: gfp_mask=0xd0, order=1, oom_adj=0, oom_score_adj=0<br>May 27 09:37:21 SLPFDSAL02 kernel: xinetd cpuset=/ mems_allowed=0<br>May 27 09:37:21 SLPFDSAL02 kernel: Pid: 2601, comm: xinetd Tainted: P           --------------- H  2.6.32-358.23.2.el6.x86_64 #1<br>May 27 09:37:21 SLPFDSAL02 kernel: Call Trace:<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff810cb641&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111ce40&gt;] ? dump_header+0x90/0x1b0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111d2c2&gt;] ? oom_kill_process+0x82/0x2a0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111d201&gt;] ? select_bad_process+0xe1/0x120<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8111d700&gt;] ? out_of_memory+0x220/0x3c0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8112c3dc&gt;] ? __alloc_pages_nodemask+0x8ac/0x8d0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff81160c6a&gt;] ? alloc_pages_current+0xaa/0x110<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff81129dbe&gt;] ? __get_free_pages+0xe/0x50<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8106bff4&gt;] ? copy_process+0xe4/0x1450<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa0276633&gt;] ? RC_RWLOCK_DONE+0x13/0x30 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa028075e&gt;] ? inherit_procattr_from_parent+0x2be/0x310 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8150fda6&gt;] ? down_read+0x16/0x30<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8150fda6&gt;] ? down_read+0x16/0x30<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8106d3f4&gt;] ? do_fork+0x94/0x460<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa0279276&gt;] ? prst_preproc+0x46/0x5f0 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8104759c&gt;] ? __do_page_fault+0x1ec/0x480<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8148cec8&gt;] ? tcp_setsockopt+0x18/0x30<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff81436d8f&gt;] ? sys_setsockopt+0x7f/0xe0<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa028271d&gt;] ? call_indir_fork+0x5d/0x80 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa02827b3&gt;] ? prst_fork+0x73/0xc0 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa02846e6&gt;] ? prst_setsockopt+0xb6/0x1c0 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa0282951&gt;] ? rg_clone+0x91/0x100 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffffa0285d23&gt;] ? rg_stub_clone+0x13/0x20 [RedCastle]<br>May 27 09:37:21 SLPFDSAL02 kernel: [&lt;ffffffff8100b072&gt;] ? system_call_fastpath+0x16/0x1b<br>May 27 09:37:21 SLPFDSAL02 kernel: Mem-Info:<br>May 27 09:37:21 SLPFDSAL02 kernel: Node 0 DMA per-cpu:<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    0: hi:    0, btch:   1 usd:   0<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    1: hi:    0, btch:   1 usd:   0<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    2: hi:    0, btch:   1 usd:   0<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    3: hi:    0, btch:   1 usd:   0<br>May 27 09:37:21 SLPFDSAL02 kernel: Node 0 DMA32 per-cpu:<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    0: hi:  186, btch:  31 usd:   0<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    1: hi:  186, btch:  31 usd:   0<br>May 27 09:37:21 SLPFDSAL02 kernel: CPU    2: hi:  186, btch:  31 usd:   0<br>=== 생략 ===<br><br>감사합니다.<br><br><publishedDate>2018-05-28T06:36:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mfpu0IAB"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-05-28T06:29:28Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-05-28T06:29:28Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>02094103_sosreport-SLPTASAL01-20180528151528-3ba6.tar.xz<br><br>위와 같이 sosreport를 dropbox redhat 에 업로드하였습니다.<br><br><publishedDate>2018-05-28T06:29:28Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MfpkKIAR"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-05-28T06:12:25Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-05-28T06:12:25Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>저번에 문의드렸던 vm guest hang 관련해서는 아래와 같이 답변을 받았는데요.<br>조금 답변이 늦었습니다.<br><br>혹시 OS에서 좀 더 상세히 해당 시점을 분석하려면 어떤 부분이 필요한지 문의드리려고 합니다.<br><br>==========================================================================================================================<br>안녕하세요, <br><br>고객님의 기술지원 요청사항은 '[Samsung Life Insurance] Linux 6  버전 OS hang 상태에서 vMotion 시 문제 발생' 입니다.<br><br>먼저 로그 분석 결과, SLPESXAL05 에서 다른 호스트로의 vMotion 후 GuestRpcSnedTimeout / Tools heartbeat timeout  을 확인했습니다.<br><br>2018-05-06T00:48:35.543Z| vmx| I125: GuestRpcSendTimedOut: message to toolbox timed out.<br> 2018-05-06T00:48:55.548Z| vmx| I125: GuestRpcSendTimedOut: message to toolbox timed out.<br> 2018-05-06T00:48:55.548Z| vmx| I125: GuestRpc: app toolbox's second ping timeout; assuming app is down<br> 2018-05-06T00:48:55.548Z| vmx| I125: GuestRpc: Reinitializing Channel 0(toolbox)<br> 2018-05-06T00:48:55.548Z| vmx| I125: GuestMsg: Channel 0, Cannot unpost because the previous post is already completed<br> 2018-05-06T00:49:15.937Z| vmx| I125: GuestRpcSendTimedOut: message to toolbox-dnd timed out.<br> 2018-05-06T00:49:41.082Z| vcpu-0| I125: Tools: Tools heartbeat timeout.<br> 2018-05-06T01:11:46.807Z| vmx| I125: GuestRpcSendTimedOut: message to toolbox timed out.<br> 2018-05-06T01:11:56.650Z| vcpu-0| I125: Tools: Tools heartbeat timeout.<br> 2018-05-06T01:12:06.809Z| vmx| I125: GuestRpcSendTimedOut: message to toolbox timed out.<br> 2018-05-06T01:12:06.809Z| vmx| I125: GuestRpc: app toolbox's second ping timeout; assuming app is down<br><br>VM Tools와의 RPC Timeout 을 보아 Guest OS 내의 문제가 의심되며 해당 부분에 대해 확인이 필요할 것으로 판단됩니다.<br>또한, migration 후 tools가 10분 간 작동되지 않은 것을 아래의 메세지를 통해 확인하실 수 있습니다.  <br><br>2018-05-06T03:26:18.931Z| vmx| I125: TOOLS INSTALL setting state to 0 on restore.<br> 2018-05-06T03:26:18.931Z| vmx| I125:   restoring ToolsDeployPkg<br> 2018-05-06T03:26:19.022Z| vmx| I125: ToolsISO: Selected Tools ISO 'linux.iso' for 'rhel6-64' guest.<br> 2018-05-06T03:26:19.023Z| vmx| I125: VMXVmdb_SetToolsVersionStatus: status value set to 'oldTools', 'supportedOld', install possible<br> 2018-05-06T03:36:19.017Z| vmx| I125: Tools: No activity for 10 minutes, resetting Tools version.<br> 2018-05-06T03:36:19.017Z| vmx| I125: TOOLS setting legacy tools version to '0', manifest status is 9<br><br>추가적으로 VNC Remote disconnect, syscall 에러를 확인했으며, 실제로 console 연결 확인은 하지 못 하였지만 console 접근 에러 또한 의심되는 상황입니다.<br><br> 2018-05-06T09:55:30.501Z| mks| I125: SOCKET 3 (184) Creating VNC remote connection.<br> 2018-05-06T09:55:36.135Z| mks| I125: SSL: syscall error 104: Connection reset by peer<br> 2018-05-06T09:55:36.135Z| mks| I125: SOCKET 3 (184) recv error 104: Connection reset by peer<br> 2018-05-06T09:55:36.135Z| mks| I125: SOCKET 3 (184) VNC Remote Disconnect.<br> 2018-05-06T09:56:34.676Z| mks| I125: SOCKET 4 (184) Creating VNC remote connection.<br><br>로그 분석 내용은 위와 같으며 현재로선 Guest OS 쪽의 분석이 필요할 것으로 보입니다.<br>추가적으로 VMXNET3를 사용하는 Redhat Linux VM 의 vMotion 이후 네트워크 연결 손실 관련하여 문서 참조바랍니다. <br>Network connectivity to a RedHat 6.x virtual machine is lost after a vMotion migration : https://ikb.vmware.com/s/article/2047125<br>추후 VM의 Hang 이 의심될 때 하단의 문서를 참조하여 확인하시길 권장해 드립니다.<br>Confirming whether a virtual machine is unresponsive : https://kb.vmware.com/s/article/1007802<br>감사합니다.<br>Min Hye Jun (전민혜) <br>Technical Support Engineer  <br> Global Support Services, VMware Inc. <br> Global Support Phone Numbers: Global Support Phone Numbers: https://www.vmware.com/support/contacts/southkorea.html <br> Office Hours: Monday-Friday 09:00 AM – 18:00 PM KST <br> If you cannot reach me, please contact my direct manager, Chong Wan, at cwan@vmware.com or by phone at +86 10 59934311 <br> ref:_00D409hQR._5003413I5RI:ref<br><br>=========================================================================================================================<br>안녕하세요 <br>아래 제공된 url이 잘못되어 다시 보내 드립니다.<br>https://kb.vmware.com/s/article/2047125<br>RHEL 6에서 vmotion이 실행되면 vmxnet 3 NIC의 비정상 동작으로 VM의 접속이 안되는 경우가 발생 합니다.<br>이 경우 TX/RX 버퍼 값을 조정해 주는데 이 경우가 필요 한 구성 방법을 안내하는 KB입니다.’<br>이 케이스의 경우 VM이 migration된 후 VM과 RPC통신이 되지 않는 것이 log에서 발견된 것으로 OS내부의 로그 분석이 추가적으로 필요 한 것으로 보이며 일단은 네트워크 부분은 직접적으로 관계는 없어 보입니다.  좀더 확실한 사항을 파악하기 위한 과정으로 guest OS에 대한 분석을 공유해 주시면 감사하겠습니다.<br>감사합니다.<br>==========================================================================================================================<br><br>감사합니다.<br><br><publishedDate>2018-05-28T06:12:25Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MbibfIAB"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-05-09T02:05:17Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-05-09T02:05:17Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>확인하신 내용이 완전히 동일한 이슈는 아니지만, VMWare 관련 코드에서 발생하는 문제이기 때문에 정확한 원인 분석을 위해서는 해당 벤더에 문의하셔서 지원을 받으시는 것이 좋겠습니다.<br><br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-05-09T02:05:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>