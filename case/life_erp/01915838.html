======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2017-08-22T01:50:18Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-09-14T10:08:12Z</b><br><b>id : 500A000000Y2vy9IAB</b><br>======================<br><br><b><font size=15>
제목  : ESX HOST 서버에서 numa 적용 후 guest 상태 관련 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>Redhat 7.2 버전의 OS에서 vNUMA를 적용하고 나서 서버의 상태를 확인한 내역입니다.<br><br>문의드릴 점은 DPOSAL01SL 서버의 경우 아래와 같이 kernel.sched_domain.cpu1.domain0.name 값이 DIE로 표시가 되는데 해당 의미에 대해서 문의를 드리려고 합니다.<br><br>kernel.sched_domain.cpu1.domain0.name = DIE<br><br> - PPOSAL01SL 정보<br>root@PPOSAL01SL /root # sysctl -a | grep -i numa<br>kernel.numa_balancing = 0<br>kernel.numa_balancing_scan_delay_ms = 1000<br>kernel.numa_balancing_scan_period_max_ms = 60000<br>kernel.numa_balancing_scan_period_min_ms = 1000<br>kernel.numa_balancing_scan_size_mb = 256<br>kernel.numa_balancing_settle_count = 4<br>kernel.sched_domain.cpu0.domain1.name = NUMA<br>kernel.sched_domain.cpu1.domain1.name = NUMA<br>kernel.sched_domain.cpu10.domain1.name = NUMA<br>kernel.sched_domain.cpu11.domain1.name = NUMA<br>kernel.sched_domain.cpu12.domain1.name = NUMA<br>kernel.sched_domain.cpu13.domain1.name = NUMA<br>kernel.sched_domain.cpu14.domain1.name = NUMA<br>kernel.sched_domain.cpu15.domain1.name = NUMA<br>kernel.sched_domain.cpu16.domain1.name = NUMA<br>kernel.sched_domain.cpu17.domain1.name = NUMA<br>kernel.sched_domain.cpu18.domain1.name = NUMA<br>kernel.sched_domain.cpu19.domain1.name = NUMA<br>kernel.sched_domain.cpu2.domain1.name = NUMA<br>kernel.sched_domain.cpu3.domain1.name = NUMA<br>kernel.sched_domain.cpu4.domain1.name = NUMA<br>kernel.sched_domain.cpu5.domain1.name = NUMA<br>kernel.sched_domain.cpu6.domain1.name = NUMA<br>kernel.sched_domain.cpu7.domain1.name = NUMA<br>kernel.sched_domain.cpu8.domain1.name = NUMA<br>kernel.sched_domain.cpu9.domain1.name = NUMA<br>vm.numa_zonelist_order = default<br>root@PPOSAL01SL /root # lscpu<br>Architecture:          x86_64<br>CPU op-mode(s):        32-bit, 64-bit<br>Byte Order:            Little Endian<br>CPU(s):                20<br>On-line CPU(s) list:   0-19<br>Thread(s) per core:    1<br>Core(s) per socket:    1<br>Socket(s):             20<br>NUMA node(s):          2<br>Vendor ID:             GenuineIntel<br>CPU family:            6<br>Model:                 63<br>Model name:            Intel(R) Xeon(R) CPU E5-2697 v3 @ 2.60GHz<br>Stepping:              2<br>CPU MHz:               2596.992<br>BogoMIPS:              5193.98<br>Hypervisor vendor:     VMware<br>Virtualization type:   full<br>L1d cache:             32K<br>L1i cache:             32K<br>L2 cache:              256K<br>L3 cache:              35840K<br>NUMA node0 CPU(s):     0-9<br>NUMA node1 CPU(s):     10-19<br><br> - DPOSAL01SL 정보<br>root@DPOSAL01SL /root # sysctl -a | grep -i numa<br>kernel.numa_balancing = 0<br>kernel.numa_balancing_scan_delay_ms = 1000<br>kernel.numa_balancing_scan_period_max_ms = 60000<br>kernel.numa_balancing_scan_period_min_ms = 1000<br>kernel.numa_balancing_scan_size_mb = 256<br>kernel.numa_balancing_settle_count = 4<br>vm.numa_zonelist_order = default<br><br>root@DPOSAL01SL /root # lscpu<br>Architecture:          x86_64<br>CPU op-mode(s):        32-bit, 64-bit<br>Byte Order:            Little Endian<br>CPU(s):                12<br>On-line CPU(s) list:   0-11<br>Thread(s) per core:    1<br>Core(s) per socket:    1<br>Socket(s):             12<br>NUMA node(s):          1<br>Vendor ID:             GenuineIntel<br>CPU family:            6<br>Model:                 63<br>Model name:            Intel(R) Xeon(R) CPU E5-2697 v3 @ 2.60GHz<br>Stepping:              2<br>CPU MHz:               2596.992<br>BogoMIPS:              5193.98<br>Hypervisor vendor:     VMware<br>Virtualization type:   full<br>L1d cache:             32K<br>L1i cache:             32K<br>L2 cache:              256K<br>L3 cache:              35840K<br>NUMA node0 CPU(s):     0-11<br><br>root@DPOSAL01SL /root # sysctl -a | grep -i die<br>kernel.sched_domain.cpu0.domain0.name = DIE<br>kernel.sched_domain.cpu1.domain0.name = DIE<br>kernel.sched_domain.cpu10.domain0.name = DIE<br>kernel.sched_domain.cpu11.domain0.name = DIE<br>kernel.sched_domain.cpu2.domain0.name = DIE<br>kernel.sched_domain.cpu3.domain0.name = DIE<br>kernel.sched_domain.cpu4.domain0.name = DIE<br>kernel.sched_domain.cpu5.domain0.name = DIE<br>kernel.sched_domain.cpu6.domain0.name = DIE<br>kernel.sched_domain.cpu7.domain0.name = DIE<br>kernel.sched_domain.cpu8.domain0.name = DIE<br>kernel.sched_domain.cpu9.domain0.name = DIE<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PPOSAL01SL / DPOSAL01SL</hostname><br><br><br><comment id="a0aA000000KH43NIAT"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-08-30T02:57:09Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-08-30T02:57:09Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용 해 주셔서 감사합니다. <br><br>CONFIG_NUMA 는 커널 코드 측면에서 사용 하는 파라미터 이며, 해당 파라미터가 <br>enable 되면, 주로 아래와 같은 부분들 달라지게 됩니다. <br><br>- Enable NUMA (Non Uniform Memory Access) support. <br>- The kernel will try to allocate memory used by a CPU on the<br>  local memory controller of the CPU and add some more NUMA<br>  awareness to the kernel.   <br>- This code is recommended on all multiprocessor operational systems.         <br> <br>이런 부분은 개발팀의 mail-list 에서 확인 할수 있었으며 아래와 같이 링크를 첨부 해 드리오니<br>참고 부탁드립니다. <br>https://www.redhat.com/archives/rhl-list/2006-March/msg00462.html<br><br>추가적으로, 커널 코드를 설명 하는 것은 저희 기술 지원 범위에 포함 되지 않아 만약 커널 코드를 <br>확인 하시려면 아래와 같은 링크를 이용 하시면 될 것 같습니다. <br>https://access.redhat.com/labs/psb/versions/kernel-3.10.0-327.3.1.el7<br><br>감사합니다. 좋은 하루 되십시오.<br><br><publishedDate>2017-08-30T02:57:09Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KGsgVIAT"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-08-29T10:24:43Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-08-29T10:24:43Z</b><br><br>안녕하세요 <br><br>답변 주신 내역 중에서 1가지 문의드리려고 합니다.<br>아래에서 kernel.sched_domain.cpu0.domain1.name 값이 NUMA일 경우 아래와 같이 동작한다고 알려주셨는데요.<br>(3.CONFIG_NUMA 커널 옵션 사용 부분)이 혹시 OS에서 어떠한 설정을 하는것인지 해서 문의드립니다.<br><br>NUMA 로 되어 있을 경우, <br>1.같은 NUMA 노드를 사용하는 cpu에 더 우선권을 준다. <br>2.NUMA 노드에서 최단 거리 path를 사용하는 cpu에 더 우선권을 준다. <br>3.CONFIG_NUMA 커널 옵션 사용<br><br>와 같이 되어 있습니다.<br><br><publishedDate>2017-08-29T10:24:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KSL4EIAX"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-08-25T02:34:45Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-08-25T02:34:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용 해 주셔서 감사합니다. <br><br>현재 보내 주신 각 서버에서 NUMA 설정이 아래와 같이 식별 되어 있는 것으로 보입니다. <br><br>[PPOSAL01SL]<br>NUMA node(s):          2<br>...<br>NUMA node0 CPU(s):     0-9<br>NUMA node1 CPU(s):     10-19<br><br>[DPOSAL01SL]<br>NUMA node(s):          1<br>...<br>NUMA node0 CPU(s):     0-11<br><br>하지만, 이와 같이 식별 되는 것은 OS 에서 Hardware/Hypervisor 설정을 읽어 왔기 <br>때문입니다. 따라서 Vmware 쪽으로 확인 요청을 하시는 것을 권장 드리며 만약 앞으로 OS <br>측 도움이 더 필요 하실 경우 언제든지 연락 주시기 바랍니다. <br><br>감사합니다. 좋은 하루 되십시오.<br><br><publishedDate>2017-08-25T02:34:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KS4DqIAL"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-24T04:35:01Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-24T04:35:01Z</b><br><br>ESX에서  NUMA설정을 하였으나 <br>DPOSAL은 NUMA노드가 1개로 보이고<br>PPOSAL은 NUMA 노드가 2개로 보입니다.<br>이에  DPOSAL은 NUMA설정이 안되어 있는것으로 보이고 PPOSAL측은 설정이 되어 있는것으로 보입니다.<br>저희 측은 NUMA 설정을 켜 놔야 하는상황인데 DPOSAL에서 확인하여야 할 사항이 무엇이 있는지 확인 부탁드립니다.<br><br><publishedDate>2017-08-24T04:35:01Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KS3lGIAT"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-08-24T03:24:08Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-08-24T03:24:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용 해 주셔서 감사합니다. <br><br>적절한 로드밸런싱을 위해 태스크의 migration 비용을 고려하여 언제 수행해야 할 지 <br>다음의 항목들을 체크합니다. <br>- 스케줄러 특성 별 로드 밸런싱<br>- cpu 토플로지<br><br>언급 하신 kernel.sched_domain.cpu0.domain1.name 로는 스케줄링 도메인에서<br>사용 하는 CPU 토플로지를 나타내고 있습니다. <br><br>해당 파라미터의 값이 DIE 로 되어 있을 경우, 그 다음으로 (l3 캐시를 공유하는) 같은 <br>die를 사용하는 cpu에 더 우선권을 준다는 의미를 하고 있습니다. <br><br>NUMA 로 되어 있을 경우, <br>1.같은 NUMA 노드를 사용하는 cpu에 더 우선권을 준다. <br>2.NUMA 노드에서 최단 거리 path를 사용하는 cpu에 더 우선권을 준다. <br>3.CONFIG_NUMA 커널 옵션 사용<br>와 같이 되어 있습니다. <br><br>감사합니다. 좋은 하루 되십시오.<br><br><publishedDate>2017-08-24T03:24:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KRnYiIAL"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-08-23T08:12:44Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-08-23T08:12:44Z</b><br><br>안녕하세요<br>======================<br>해당 링크에 NUMA라는 설명은 없는 것 같아서<br>혹시 NUMA는 어떤 의미인지와 DIE와 NUMA의 차이에  문의드리려고 합니다.<br><br>kernel.sched_domain.cpu0.domain1.name = NUMA<br><br><publishedDate>2017-08-23T08:12:44Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KRmxRIAT"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-08-23T07:26:50Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-08-23T07:26:50Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용 해 주셔서 감사합니다. <br><br>금일 본 기술문의 담당자가 부재중이어 담당자가 남겨둔 메모를 기반으로 답변을 드리도록 하겠습니다.<br><br><br>root@DPOSAL01SL /root # sysctl -a | grep -i die<br>kernel.sched_domain.cpu0.domain0.name = DIE<br>kernel.sched_domain.cpu1.domain0.name = DIE<br>kernel.sched_domain.cpu10.domain0.name = DIE<br>kernel.sched_domain.cpu11.domain0.name = DIE<br>kernel.sched_domain.cpu2.domain0.name = DIE<br>kernel.sched_domain.cpu3.domain0.name = DIE<br>kernel.sched_domain.cpu4.domain0.name = DIE<br>kernel.sched_domain.cpu5.domain0.name = DIE<br>kernel.sched_domain.cpu6.domain0.name = DIE<br>kernel.sched_domain.cpu7.domain0.name = DIE<br>kernel.sched_domain.cpu8.domain0.name = DIE<br>kernel.sched_domain.cpu9.domain0.name = DIE<br><br>여기서 DIE 는 Processor DIE 를 의미 하고 있습니다. 아래와 같은 링크에서 processor core, <br>Processor DIE, Processor package 또한 Dual-core processor 에 대해 설명 되어 있으며<br>참고 하시기 바랍니다. <br><br>https://superuser.com/questions/324284/what-is-meant-by-the-terms-cpu-core-die-and-package<br><br>명일 담당자가 복귀할 예정이며, 추가 문의가 있다면 담당자에 의해 답변드릴 수 있도록 하겠습니다.<br><br>감사합니다. 좋은 하루 되십시오.<br><br><publishedDate>2017-08-23T07:26:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KRO2BIAX"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-08-22T05:46:51Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-08-22T05:46:50Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용 해 주셔서 감사합니다. <br><br>저는 정미연이라고 하며 앞으로 본 케이스를 담당하게 되었습니다. <br>지금 문의 주신 내용에 대해 좀더 확인을 하고 업데이트 사항이 있으면 바로 <br>공유 드리도록 하겠습니다. <br><br>감사합니다. 좋은 하루 되십시오.<br><br><publishedDate>2017-08-22T05:46:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>