======================<br><b>생성계정 : 타임 게이트</b><br><b>생성날짜 : 2017-03-15T19:06:24Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-03-31T10:07:20Z</b><br><b>id : 500A000000WjOprIAF</b><br>======================<br><br><b><font size=15>
제목  : [삼성생명][ERP][vmware_guest] 클러스터 ping  monitoring 동작에 대한 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>vmware 환경에서 guest os  를  rhel7.2 cluster 로 구성하여 운영하고 있습니다.<br>esxi host에서 네트워크에 순단이 발생하여 클러스터 노드의 resource 가 이동하는 현상이 발생하였습니다.<br>vmware 에서는 18:56:43 에서 네트워크 순단 로그가 발생하였고<br>rhel7.2 cluster node에서는 18:56:44 에 pingd 10-&gt;0 이  발생하였습니다.<br><br>Cluster pingd  resource 조건은 다음과 같습니다.<br><br>pingd<br><br>Monitor interval :5s<br>Attempts :7s<br>Monitor timeout:20s<br><br>따라서 ping -n -q -W 3 -C 7 GATEWAY 로 조건식으로 동작하고 있습니다.<br><br>18:56:43. Vmware log 상의 네트워크 문제<br>18:56:44 cluster node 에서 pingd status 10-&gt;0  으로 전환<br><br>여기서 문의 사항은 아래와 같습니다.<br><br>1. Ping 모니터링은 attempts(count) 값 동안 최소 1개의 ping count가 성공하면 이상없음으로 감지한다고 알고있는데 맞는지요?<br>2. 1이 맞다고 한다면 최소 interval(5)+ping monitor(7-1) =&gt;  7초 동안 네트워크가 문제가 없어야 한다는 것인데 그러면 <br><br>18:56:36 . 네트워크 실제 문제 발생시간<br>18:56:43 . Vmware log 상의 네트워크 문제<br>18:56:44 .  Cluster node. Ping 문제 감지 라는 공식이 성립하게 됩니다.<br><br>따라서 저희쪽에서 18:56:36~18:56:42 사이에 네트워크 에 문제가 있었는지 유무를 확인해야 합니다.<br><br><br>3. Ping-agents 소스를 보게 되면  ping -n -q -W3 -C 7 GATEWAY 에 대한 결과를  $? 값으로 받게 되어 있는데<br><br>혹시 7번 ping count 체크 하는 중 마지막 count 에서 순단이 발생하게 되면  결과 값을 실패로 받게 되는지요?<br><br>3번이 맞다고 한다면 실제 vmware log상의 시간과 cluster node에서 pingd 상태전이가 절묘하게 맞아 떨어지는 <br>확률이 발생하게 됩니다. <br><br>확인 부탁 드립니다.<br><br>Sosreport 는 운영환경 상 이유로 케이스 오픈 후 에 올리도록 하겠습니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Defect / Bug</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000J3ZwyIAF"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-03-16T03:33:17Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-03-16T03:33:17Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>문의 주신 내용에 대해 아래와 같이 답변 드리도록 하겠습니다. <br><br>&gt; 1. Ping 모니터링은 attempts(count) 값 동안 최소 1개의 ping count가 <br>&gt;    성공하면 이상없음으로 감지한다고 알고있는데 맞는지요?<br><br>==&gt; 네, 맞습니다. <br><br><br>&gt; 2. 1이 맞다고 한다면 최소 interval(5)+ping monitor(7-1) =&gt;  7초 동안 <br>&gt;    네트워크가 문제가 없어야 한다는 것인데 그러면 1이 맞다고 한다면 최소 <br>&gt;    interval(5)+ping monitor(7-1) =&gt;  7초 동안 네트워크가 문제가 없어야 <br>&gt;    한다는 것인데 그러면 <br>&gt; 18:56:36 . 네트워크 실제 문제 발생시간<br>&gt; 18:56:43 . Vmware log 상의 네트워크 문제<br>&gt; 18:56:44 .  Cluster node. Ping 문제 감지 라는 공식이 성립하게 됩니다.<br>&gt; 따라서 저희쪽에서 18:56:36~18:56:42 사이에 네트워크 에 문제가 있었는지 유무를 확인해야 합니다.<br><br>==&gt;<br><br>pingd 에서 네트워크 에러 감지 시간은 경우에 따라 다를수 있습니다. <br>최선에 경우(장애 감지 시간이 제일 짧은 경우)는 첫번째 attempts 부터 장애가 발생 <br>하였다면, <br><br>MIN = (ping attempts -1) + pingd timeout = 7 -1 + 2(default) = 8s<br><br>최악에 경우는 2번째 ping attempts 부터 장애가 발새 하였다면, pingd에서 네트워크 <br>장애를 감지 하는 시간은:<br><br>MAX = ( attempts - 2 ) + pingd monitor interval time + ( attempts - 1  + pingd timeout )<br>    = 7 -2 + 5 + 7 -1 + 2 = 18s<br><br>즉 pingd가 18:56:44에 네트워크 에러를 감지 하였다면 18:56:26 부터 네트워크 이슈가 <br>있었는지를 확인 해 보시는게 좋을 것 같습니다. <br><br>** pingd timeout은 monitor timeout와 다릅니다. pingd timeout은 pingd <br>   리소스의 파라미터입니다. 아래와 같이 pingd 파라미터를 확인 가능 하십니다. <br>   # pcs resource describe pingd<br>======================<br>&gt; 3. Ping-agents 소스를 보게 되면  ping -n -q -W3 -C 7 GATEWAY 에 대한 <br>&gt;    결과를  $? 값으로 받게 되어 있는데<br>&gt;    혹시 7번 ping count 체크 하는 중 마지막 count 에서 순단이 발생하게 되면  <br>&gt;    결과 값을 실패로 받게 되는지요?<br><br>==&gt; <br>아닙니다. 1번에서 답변 드렸듯이 모든 ping attempts 실패 되어야만 결과값이 실패로 <br>됩니다. <br>======================<br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-03-16T03:33:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>esxi host에서 네트워크에 순단이 발생하여 클러스터 노드의 resource 가 이동하는 현상이 발생하였습니다.<br>vmware 에서는 18:56:43 에서 네트워크 순단 로그가 발생하였고<br>rhel7.2 cluster node에서는 18:56:44 에 pingd 10-&gt;0 이  발생하였습니다.<br><br>Cluster pingd  resource 조건은 다음과 같습니다.<br><br>pingd<br><br>Monitor interval :5s<br>Attempts :7s<br>Monitor timeout:20s<br><br>따라서 ping -n -q -W 3 -C 7 GATEWAY 로 조건식으로 동작하고 있습니다.<br><br>18:56:43. Vmware log 상의 네트워크 문제<br>18:56:44 cluster node 에서 pingd status 10-&gt;0  으로 전환<br><br>여기서 문의 사항은 아래와 같습니다.<br><br>1. Ping 모니터링은 attempts(count) 값 동안 최소 1개의 ping count가 성공하면 이상없음으로 감지한다고 알고있는데 맞는지요?<br>2. 1이 맞다고 한다면 최소 interval(5)+ping monitor(7-1) =&gt;  7초 동안 네트워크가 문제가 없어야 한다는 것인데 그러면 <br><br>18:56:36 . 네트워크 실제 문제 발생시간<br>18:56:43 . Vmware log 상의 네트워크 문제<br>18:56:44 .  Cluster node. Ping 문제 감지 라는 공식이 성립하게 됩니다.<br><br>따라서 저희쪽에서 18:56:36~18:56:42 사이에 네트워크 에 문제가 있었는지 유무를 확인해야 합니다.<br><br><br>3. Ping-agents 소스를 보게 되면  ping -n -q -W3 -C 7 GATEWAY 에 대한 결과를  $? 값으로 받게 되어 있는데<br><br>혹시 7번 ping count 체크 하는 중 마지막 count 에서 순단이 발생하게 되면  결과 값을 실패로 받게 되는지요?<br><br>3번이 맞다고 한다면 실제 vmware log상의 시간과 cluster node에서 pingd 상태전이가 절묘하게 맞아 떨어지는 <br>확률이 발생하게 됩니다. <br><br>확인 부탁 드립니다.<br><br>Sosreport 는 운영환경 상 이유로 케이스 오픈 후 에 올리도록 하겠습니다.</issue><cep>false</cep></case>