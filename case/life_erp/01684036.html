======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-08-12T08:25:19Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-09-03T10:02:55Z</b><br><b>id : 500A000000V2RdKIAV</b><br>======================<br><br><b><font size=15>
제목  : 부팅 시 Timed out waiting for device 로 인한 Emergency Mode 진입 문제
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>오늘 삼성생명 보험ERP 안정화 작업 후 Physical Server 부팅 시 비정상으로 Mount 실패하여 Emergency mode 로 진입되는 문제가 발견 됩니다.<br><br>기존 삼성화재에서 오픈 된 케이스 https://access.redhat.com/solutions/2147731 의 Solution 을 이미 반영했던 시스템에,<br><br>오늘 작업 시 아래와 같은 패키지가 Update 되었습니다.<br><br>lvm2-2.02.130-5.el7_2.2.x86_64<br>kpartx-0.4.9-85.el7_2.4.x86_64<br>device-mapper-1.02.107-5.el7_2.2.x86_64<br>device-mapper-multipath-0.4.9-85.el7_2.4.x86_64<br>systemd-219-19.el7_2.9.x86_64<br><br>삼성생명 시스템의 경우 기존에는 이러한 현상이 없다가, 오히려 Update 후 문제가 발견되었습니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>위 패키지를 업데이트 후 Reboot 을 하게 되면 Timed out waiting for device 이슈가 발생하고 있습니다.<br><br>부팅 시 LVM Device 를 찾지 못해 정상적으로 Mount 실패, Timeout 되어 나오는 기존 삼성화재 이슈와 동일한 이슈로 판단하고 있습니다.<br><br>특정 시스템에서만 발생되는 현상이 아닌, 불특정 다수 서버에서 랜덤하게 발생하고 있습니다.<br><br>오늘 Update 작업 과정에서 기존 Workaround 에 적용 된 사항은 그대로 두고 yum update 만 진행하였습니다.<br><br>workacound 시 아래 systemd 파일을 별도로 생성했었는데요,<br><br>lvm2-activation-early.service<br>lvm2-activation-net.service<br>lvm2-activation.service<br><br>해당 서비스와도 연관성이 있는지 확인 부탁드립니다.<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>문제가 발생한 Emergency Mode 의 화면 이미지 파일과 sosreport 를 첨부하도록 하겠습니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><br><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-08-18T06:33:26Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-08-18T06:33:26Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 혹시 문제가 없는 시스템에 대한 sosreport도 하나 받아볼 수 있는지를 먼저 여쭤봅니다.<br><br><br>그리고.. 저희 엔지니어는 use_lvmetad = 1로 설정 변경을 우선적으로 권장하고 있습니다. 혹시 적용하여 그 결과 공유 부탁드립니다.<br><br><br>만약 위의 설정변경을 한 후에도 동일한 이슈가 계속될 경우에는 아래와 같은 방법을 적용하여 주시기 바랍니다.<br><br>Please try below steps :<br>1. Take backup of existing multipath service<br> $ cp  /usr/lib/systemd/system/multipathd.service /usr/lib/systemd/system/multipathd_orig.service<br>2. Modify multipathd.service file :<br>  In [Unit] section,  append &quot;systemd-udev-trigger.service&quot; to After. <br><br> After above modification, [unit] section will look like below :<br><br>[Unit]<br>Description=Device-Mapper Multipath Device Controller<br>Requires=blk-availability.service<br>Before=iscsi.service iscsid.service lvm2-activation-early.service<br>After=syslog.target systemd-udev-trigger.service <br>#After=syslog.target<br><br>3. Save changes. <br>4. Reboot server and check whether or not issue persist?<br><br>Above change, adds &quot;systemd-udev-trigger.service&quot; to order multipathd.service after udev-trigger. <br>======================<br>적용후, 업데이트 바랍니다.<br>======================<br>감사삽니다.<br><br><publishedDate>2016-08-18T06:33:26Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G6K4fIAF"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-08-17T04:09:31Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-08-17T04:09:31Z</b><br><br>안녕하세요.<br><br>패키지 업데이트 후 PMS 노드 10대의 initramfs 를 dracut 을 이용하여 다시 생성해서 Reboot 했었으나,<br><br>동일한 문제가 발생했었습니다.<br><br># dracut -H -f -v<br><br>감사합니다.<br><br><publishedDate>2016-08-17T04:09:31Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HfCUZIA3"><br>======================<br><b>생성계정 : Kshirsagar, Nikhil</b><br><b>생성날짜 : 2016-08-15T07:33:11Z</b><br><b>마지막 답변자 : Kshirsagar, Nikhil</b><br><b>마지막 수정 일자 : 2016-08-15T07:33:11Z</b><br><br>Hello,<br><br>my name is Nikhil and i am assisting with this case.<br><br>I have a few questions. Did you unzip and copy over 10-dm.rules_.gz and lvm2_activation_services.tar.gz as the kcs https://access.redhat.com/solutions/2147731 mentions?<br><br>The kcs article mentions some steps apart from updating the packages, please verify that you ran those steps including rebuilding initramfs.<br><br>Thanks,<br>nikhil.<br><br><publishedDate>2016-08-15T07:33:11Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HalsLIAR"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-08-12T08:57:21Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-08-12T08:57:20Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>보내주신 데이터를 먼저 확인후, 답변 드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-08-12T08:57:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>오늘 삼성생명 보험ERP 안정화 작업 후 Physical Server 부팅 시 비정상으로 Mount 실패하여 Emergency mode 로 진입되는 문제가 발견 됩니다.<br><br>기존 삼성화재에서 오픈 된 케이스 https://access.redhat.com/solutions/2147731 의 Solution 을 이미 반영했던 시스템에,<br><br>오늘 작업 시 아래와 같은 패키지가 Update 되었습니다.<br><br>lvm2-2.02.130-5.el7_2.2.x86_64<br>kpartx-0.4.9-85.el7_2.4.x86_64<br>device-mapper-1.02.107-5.el7_2.2.x86_64<br>device-mapper-multipath-0.4.9-85.el7_2.4.x86_64<br>systemd-219-19.el7_2.9.x86_64<br><br>삼성생명 시스템의 경우 기존에는 이러한 현상이 없다가, 오히려 Update 후 문제가 발견되었습니다.</issue><environment>위 패키지를 업데이트 후 Reboot 을 하게 되면 Timed out waiting for device 이슈가 발생하고 있습니다.<br><br>부팅 시 LVM Device 를 찾지 못해 정상적으로 Mount 실패, Timeout 되어 나오는 기존 삼성화재 이슈와 동일한 이슈로 판단하고 있습니다.<br><br>특정 시스템에서만 발생되는 현상이 아닌, 불특정 다수 서버에서 랜덤하게 발생하고 있습니다.<br><br>오늘 Update 작업 과정에서 기존 Workaround 에 적용 된 사항은 그대로 두고 yum update 만 진행하였습니다.<br><br>workacound 시 아래 systemd 파일을 별도로 생성했었는데요,<br><br>lvm2-activation-early.service<br>lvm2-activation-net.service<br>lvm2-activation.service<br><br>해당 서비스와도 연관성이 있는지 확인 부탁드립니다.</environment><periodicityOfIssue>문제가 발생한 Emergency Mode 의 화면 이미지 파일과 sosreport 를 첨부하도록 하겠습니다.</periodicityOfIssue><cep>false</cep></case>