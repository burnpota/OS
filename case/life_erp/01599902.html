======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-03-14T04:42:43Z</b><br><b>마지막 답변자 : 우택 심</b><br><b>마지막 수정 일자 : 2016-03-28T03:42:01Z</b><br><b>id : 500A000000TfQihIAF</b><br>======================<br><br><b><font size=15>
제목  : Pacemaker Stonith 의 pcmk_monitor_timeout 최대 값 설정 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>VMWare 기반 Pacemaker Cluster 설정에서 Stonith pcmk_monitor_timeout 의 최대 값을 알고 싶습니다.<br><br>얼마 전 vmware vcenter 가 reboot 이 되었는데요, 이 문제로 인해 vmware 기반 클러스터의 전체 fence_vmware_soap 이 Stop 되는 문제가 발생하였습니다.<br><br>당연히 stonith 의 op monitor 가 주기적(60s)으로 체킹을 하여 stonith 의 상태를 Update 하는 것은 알겠으나, <br><br>위와 같은 vcenter 의 장애 시 stonith 에 영향을 받게 되어, stonith 의 monitor timeout 을 10분 이상으로 설정하고 싶습니다.<br><br>op monitor interval=<br>pcmk_monitor_timeout=<br><br>위 2가지 옵션의 최대 설정 가능 값(600s  이상)을 확인 부탁 드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 4 (Low)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000GlnDhIAJ"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-03-28T03:41:51Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-03-28T03:41:51Z</b><br><br>감사합니다.<br><br>많은 도움이 되었습니다.<br><br><publishedDate>2016-03-28T03:41:51Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GjmWIIAZ"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-03-17T07:59:04Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-03-17T07:59:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br>소스 pcmk_monitor_timeout 값은 아래와 같은 부분에서 받아온 것으로 보입니다. pcmk_*_timeout 값은 <br>g_hash_table_lookup(device-&gt;params, buffer)에 의해 가져오거나 해당 값을 설정 되지 않을 경우에 <br>디폴트 값 60초로 설정 됩니다. 그리고 해당 파라미터의 최대치에 대해 제한이 되는 내용이 없어 보입니다. <br>======================<br>/*!<br> * \internal<br> * \brief Override STONITH timeout with pcmk_*_timeout if available<br> *<br> * \param[in] device           STONITH device to use<br> * \param[in] action           STONITH action name<br> * \param[in] default_timeout  Timeout to use if device does not have<br> *                             a pcmk_*_timeout parameter for action<br> * \return Value of pcmk_(action)_timeout if available, otherwise default_timeout<br> * \note For consistency, it would be nice if reboot/off/on timeouts could be<br> *       set the same way as start/stop/monitor timeouts, i.e. with an<br> *       &lt;operation&gt; entry in the fencing resource configuration. However that<br> *       is insufficient because fencing devices may be registered directly via<br> *       the STONITH register_device() API instead of going through the CIB<br> *       (e.g. stonith_admin uses it for its -R option, and the LRMD uses it to<br> *       ensure a device is registered when a command is issued). As device<br> *       properties, pcmk_*_timeout parameters can be grabbed by stonithd when<br> *       the device is registered, whether by CIB change or API call.<br><br>...<br>static int<br>get_action_timeout(stonith_device_t * device, const char *action, int default_timeout)<br>{<br>        ...<br>        /* If the device config specified an action-specific timeout, use it */<br>        snprintf(buffer, sizeof(buffer) - 1, &quot;pcmk_%s_timeout&quot;, action);<br>        value = g_hash_table_lookup(device-&gt;params, buffer);  &lt;=====<br>        if (value) {<br>            return atoi(value);  <br>        }<br>    }<br>    return default_timeout;   &lt;====<br>}<br><br>void<br>schedule_internal_command(const char *origin,<br>                          stonith_device_t * device,<br>                          const char *action,<br>                          const char *victim,<br>                          int timeout,    &lt;===============<br>                          void *internal_user_data,<br>                          void (*done_cb) (GPid pid, int rc, const char *output,<br>                                           gpointer user_data))<br>{<br>    async_command_t *cmd = NULL;<br><br>    cmd = calloc(1, sizeof(async_command_t));<br><br>    cmd-&gt;id = -1;<br>    cmd-&gt;default_timeout = timeout ? timeout : 60;  &lt;===<br>    cmd-&gt;timeout = cmd-&gt;default_timeout;<br>   ...<br>}<br><br><br>op monitor interval 파라미터는 아래와 같은 부분에서 정의 되어 있는 것으로 보이며 int 유현으로 되어 있습니다. <br>해당 값의 최대치에 대해서도 제한이 되는 부분이 없어 보입니다. <br><br>typedef struct remote_ra_cmd_s {<br>    /*! the local node the cmd is issued from */<br>    char *owner;<br>    /*! the remote node the cmd is executed on */<br>    char *rsc_id;<br>    /*! the action to execute */<br>    char *action;<br>    /*! some string the client wants us to give it back */<br>    char *userdata;<br>    /*! start delay in ms */<br>    int start_delay;<br>    /*! timer id used for start delay. */<br>    int delay_id;<br>    /*! timeout in ms for cmd */<br>    int timeout;<br>    int remaining_timeout;<br>    /*! recurring interval in ms */<br>    int interval;<br>    /*! interval timer id */<br>    int interval_id;<br>    int reported_success;<br>    int monitor_timeout_id;<br>    int takeover_timeout_id;<br>    /*! action parameters */<br>    lrmd_key_value_t *params;<br>    /*! executed rc */<br>    int rc;<br>    int op_status;<br>    int call_id;<br>    time_t start_time;<br>    gboolean cancel;<br>} remote_ra_cmd_t;<br><br><br>해당 두 파라미터에 대해 아래와 같이 설정 해 보았으며 정상적으로 설정 된 것으로 보입니다. <br><br># pcs stonith update RHEVM_Fence op monitor interval=30000000000000000000000000000000000000000<br># pcs stonith update RHEVM_Fence metadata pcmk_monitor_timeout=30000000000000000000000000000000000000000<br><br># pcs stonith show --full<br> Resource: RHEVM_Fence (class=stonith type=fence_rhevm)<br>  Attributes: action=reboot ipaddr=10.66.208.15 login=rhevadmin@gsslab.pnq2.redhat.com passwd=RedHat1! ssl=1 port=meiyan-RHEL6u5-node1 pcmk_monitor_timeout=30000000000000000000000000000000000000000 <br>  Operations: monitor interval=30000000000000000000000000000000000000000 (RHEVM_Fence-monitor-interval-30000000000000000000000000000000000000000)<br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연<br><br><publishedDate>2016-03-17T07:59:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GjEfQIAV"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-03-15T03:44:38Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-03-15T03:44:38Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>말씀 하신 파라미터에 대해 설정 가능한 최대치에 대해 현재 확인 중에 있으며 확인 되는대로 바로 공유 <br>드리도록 하겠습니다. <br><br>op monitor interval=<br>pcmk_monitor_timeout=<br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연<br><br><publishedDate>2016-03-15T03:44:38Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>VMWare 기반 Pacemaker Cluster 설정에서 Stonith pcmk_monitor_timeout 의 최대 값을 알고 싶습니다.<br><br>얼마 전 vmware vcenter 가 reboot 이 되었는데요, 이 문제로 인해 vmware 기반 클러스터의 전체 fence_vmware_soap 이 Stop 되는 문제가 발생하였습니다.<br><br>당연히 stonith 의 op monitor 가 주기적(60s)으로 체킹을 하여 stonith 의 상태를 Update 하는 것은 알겠으나, <br><br>위와 같은 vcenter 의 장애 시 stonith 에 영향을 받게 되어, stonith 의 monitor timeout 을 10분 이상으로 설정하고 싶습니다.<br><br>op monitor interval=<br>pcmk_monitor_timeout=<br><br>위 2가지 옵션의 최대 설정 가능 값(600s  이상)을 확인 부탁 드립니다.<br><br>감사합니다.</issue><cep>false</cep></case>