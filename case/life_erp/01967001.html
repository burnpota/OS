======================<br><b>생성계정 : 삼성생명 타임게이트</b><br><b>생성날짜 : 2017-11-06T02:27:47Z</b><br><b>마지막 답변자 : Ying Huang</b><br><b>마지막 수정 일자 : 2017-11-21T11:03:54Z</b><br><b>id : 500A000000Z1m4KIAR</b><br>======================<br><br><b><font size=15>
제목  : tcpbacklogdrop 카운트 증가로 인한 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요?<br>TCPBacklogDrop 에 대한 문의드립니다.<br><br>1. TCPBacklogDrop의 발생원인은 tcp 3way handshaking의 syn이 <br>  대기큐에 쌓이다 정해져 있는값(net.ipv4.tcp_max_syn_backlog, net.core.netdev_max_backlog)을 <br>  초과 할 경우 syn 요청을 무시하여 증가되는것이 맞는지요? <br><br>&lt;현, TCPBacklogDrop 상태&gt;<br>root@PQUOAL01SL /root # netstat -s | grep -i tcpb<br>    TCPBacklogDrop: 1230389<br><br>위와 같이 TCPBacklogDrop 값이 많이 증가하였음을 보실수 있습니다.<br>이에 이 값은 가동 이후 누적 값인지 아니면 현, 시점에서의 드롭 카운트인지 궁금합니다.<br><br>2. 현, backlog 파라메터는 아래와 같이 설정되어 있는데 tcpbackdrop을 최소화 하기 위하여 <br>다른 어떠한 개선방안이 있는지 문의 드립니다.<br><br>root@PQUOAL01SL /root # sysctl -a | grep backlog<br>net.core.netdev_max_backlog = 8192<br>net.ipv4.tcp_max_syn_backlog = 8192<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PQUOAL01SL</hostname><br><br><br><comment id="a0aA000000KwIYUIA3"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-06T06:26:24Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-06T06:26:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>소스 코드에 의하면 소켓의 receive buffer이 풀이 될 경우 드랍이슈가 발생하게 되는데 <br>해당 경우에 TCPBacklogDrop 값이 증가 하게 됩니다.<br><br>        else if (unlikely(sk_add_backlog(sk, skb))) {<br>                bh_unlock_sock(sk);<br>                NET_INC_STATS_BH(net, LINUX_MIB_TCPBACKLOGDROP);<br>                goto discard_and_relse;<br>        }<br><br>In sk_add_backlog() there is a test to see if the socket's receive<br>buffer is full, and if there is the kernel drops the packets, reporting<br>them through netstat as TCPBacklogDrop.<br><br>&gt; 이에 이 값은 가동 이후 누적 값인지 아니면 현, 시점에서의 드롭 카운트인지 궁금합니다.<br>부팅후 누적된 값입니다.<br><br>&gt; 현, backlog 파라메터는 아래와 같이 설정되어 있는데 tcpbackdrop을 최소화 하기 위하여 <br>다른 어떠한 개선방안이 있는지 문의 드립니다.<br><br>상기 소스 코드에 의하면 receive buffer을 늘려주시면 이슈에 도움이 될수 있습니다.<br>다만 먼저 이와 같이 많은 소켓량이 정상적인 현상인지를 확인해 보시기 바랍니다.<br><br>튜닝 방법 및 영향도에는 아래의 문서들을 참고 하실수 있으십니다.<br>[1] How can I tune the TCP Socket Buffers?<br>https://access.redhat.com/solutions/369563<br><br>[2] What are the implications of changing socket buffer sizes?<br>https://access.redhat.com/solutions/85913<br><br>감사합니다.<br><br><publishedDate>2017-11-06T06:26:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KwHhfIAF"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-11-06T04:31:59Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-11-06T04:31:59Z</b><br><br>해당 파일명은 아래와 같습니다.<br>sosreport-PQUOAL01SL-20171106115332.tar.xz<br><br><publishedDate>2017-11-06T04:31:59Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KwHhLIAV"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-11-06T04:31:22Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-11-06T04:31:22Z</b><br><br>해당 sosreport는 dropbox에 업로드 예정이며 업로드 되는 즉시 화일명 말씀드리겠습니다.<br>감사합니다.<br><br><publishedDate>2017-11-06T04:31:22Z</publishedDate><createdByType>Customer</createdByType><br>======================<br></comments><br>