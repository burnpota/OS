======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2016-06-16T08:12:07Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-06-28T10:05:11Z</b><br><b>id : 500A000000UaksmIAB</b><br>======================<br><br><b><font size=15>
제목  : SAP system has an error with &quot;39 : Extended Global Memory Semaphore&quot; (RHEL 세마포어 성능 모니터링 방안 문의)
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>최근 마이그레이션 테스트를 진행할 때 세마포어 경합이 모니터링 되어 지고 있습니다. <br>- SAP 에러메시지  : 아래 메시지를 의미하는 에러코드 39번을 뿌리면서 대기하는 현상 지속 발생중<br>   39 : Extended Global Memory Semaphoe (EG management)<br>- 세마포어의 사용량 모니터링 ( 전체 XXX중 YYY 만큼 사용함 ) 방법 안내 부탁드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 2 (High)</b><br><br><br>======================<br><b>생성계정 : Babar, Yogesh</b><br><b>생성날짜 : 2016-06-17T07:45:40Z</b><br><b>마지막 답변자 : Babar, Yogesh</b><br><b>마지막 수정 일자 : 2016-06-17T07:45:40Z</b><br><br>Hello Jimin, <br><br><br>Thanks for your update, <br><br><br>You have asked couple of interesting questions<br><br>1) &gt;&gt; I have one more question.<br><br>The following  is the output from my system.<br><br> ppmadm@ # ipcs -sl<br>------ Semaphore Limits --------<br>max number of arrays = 8192<br>max semaphores per array = 1250<br>max semaphores system wide = 307200<br>max ops per semop call = 100<br>semaphore max value = 32767  &lt;---- this value...<br><br>ppmadm@# ipcs -su  <br>------ Semaphore Status --------<br>used arrays = 694<br>allocated semaphores = 936<br><br>Can I interpret this result like this?<br>- Total semaphores        : 307200 (system wide)<br>- allocated semaphores : 936 <br><br><br> --&gt; Yes, the above assumption is absolutely right. If you run only 'ipcs -s' you might find 936 entries. <br><br><br>2) &gt;&gt; Then how can I check this ??<br>- number of blocking process (waiting for semaphore) : ??<br><br><br>&gt;&gt; I add one more question. <br>As I googled, someone mentioned like this.<br><br>#localhost:root-~ $ ipcs -s -i 65538<br>semnum     value      ncount     zcount     pid<br>0          1          0          0          1403<br><br>The  ncount is the number of processes blocking on the semaphore, waiting for it to increment. <br>The zcount is the number of processes blocking on the semaphore, waiting for it to go to zero<br>- See more at: http://jagadesh4java.blogspot.kr/2012/10/resource-managementt-ipcs.html#sthash.EkMJRoRE.dpuf<br>======================<br>Can I interpret  the result column like this ???<br>- ncount : the number of processes to allocate semaphore<br>- zcount : the number of processes to release semaphore (currently holding it)<br><br><br>--&gt; Yes you are absolutely right here. The ncount is the number of processes blocking on the semaphore, waiting for it to increment. <br>The zcount is the number of processes blocking on the semaphore, waiting for it to go to zero. The pid column identifies the most recent process to complete a semaphore operation; it does not identify processes waiting on the semaphore.<br>The ps command can help identify processes waiting on a semaphore. <br><br>3) &gt;&gt; I wonder if there is no limit to individual user. <br>And What does 'semaphore max value' mean??   (I suppose .. this max value is not important factor though.. just curious.)<br><br>The values are define here: <br><br><br>#vim include/linux/sem.h<br><br>#define SEMMNI  128             /* &lt;= IPCMNI  max # of semaphore identifiers */<br>#define SEMMSL  250             /* &lt;= 8 000 max num of semaphores per id */<br>#define SEMMNS  (SEMMNI*SEMMSL) /* &lt;= INT_MAX max # of semaphores in system */<br>#define SEMOPM  32              /* &lt;= 1 000 max num of ops per semop call */<br>#define SEMVMX  32767           /* &lt;= 32767 semaphore maximum value */<br>#define SEMAEM  SEMVMX          /* adjust on exit max value */<br><br>I never though about SEMVMX infact we never set that value in our sysctl.conf. We always set first 4 parameters: <br><br>max number of arrays <br>max semaphores per array <br>max semaphores system wide <br>max ops per semop call<br><br><br>It looks like '32767 semaphore maximum value' looks to be the highest value a semaphore can hold but cant be sure on it. <br>If you want I can confirm it from our engineering group but that will take days to confirm. <br><br><br>Let me know and feel free to revert back in case of any difficulty or concern. <br><br><br>Regards,<br>Yogesh Babar<br>Red Hat Global Support<br><br><publishedDate>2016-06-17T07:45:40Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HJkzIIAT"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2016-06-17T06:05:58Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2016-06-17T06:05:58Z</b><br><br>I add one more question. <br>As I googled, someone mentioned like this.<br><br>#localhost:root-~ $ ipcs -s -i 65538<br>semnum     value      ncount     zcount     pid<br>0          1          0          0          1403<br><br>The  ncount is the number of processes blocking on the semaphore, waiting for it to increment. <br>The zcount is the number of processes blocking on the semaphore, waiting for it to go to zero<br>- See more at: http://jagadesh4java.blogspot.kr/2012/10/resource-managementt-ipcs.html#sthash.EkMJRoRE.dpuf<br>======================<br>Can I interpret  the result column like this ???<br>- ncount : the number of processes to allocate semaphore<br>- zcount : the number of processes to release semaphore (currently holding it)<br><br><publishedDate>2016-06-17T06:05:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HJksHIAT"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2016-06-17T05:46:40Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2016-06-17T05:46:40Z</b><br><br>Thanks Babar.<br>I have one more question.<br><br>The following  is the output from my system.<br><br> ppmadm@ # ipcs -sl<br>------ Semaphore Limits --------<br>max number of arrays = 8192<br>max semaphores per array = 1250<br>max semaphores system wide = 307200<br>max ops per semop call = 100<br>semaphore max value = 32767  &lt;---- this value...<br><br>ppmadm@# ipcs -su  <br>------ Semaphore Status --------<br>used arrays = 694<br>allocated semaphores = 936<br><br>Can I interpret this result like this?<br>- Total semaphores        : 307200 (system wide)<br>- allocated semaphores : 936 <br><br>Then how can I check this ??<br>- number of blocking process (waiting for semaphore) : ??<br><br>I wonder if there is no limit to individual user. <br>And What does 'semaphore max value' mean??   (I suppose .. this max value is not important factor though.. just curious.)<br><br>thanks in advance.<br><br>(Babar, Yogesh에 회신)<br>&gt; Hello, <br>&gt; <br>&gt; <br>&gt; This is Yogesh from kernel team and I will be assisting you further. <br>&gt; <br>&gt; <br>&gt; <br>&gt; &gt;&gt;     39 : Extended Global Memory Semaphore (EG management)<br>&gt; <br>&gt; This is a SAP specific error and I can not really comment on it. But if the error is saying allocated semaphores are exhausted then you can simply increase the number of semaphore allocations: <br>&gt; <br>&gt; <br>&gt; 'How to increase the number of semaphores' <br>&gt; --&gt; https://access.redhat.com/solutions/2896<br>&gt; <br>&gt; <br>&gt; <br>&gt; &gt;&gt; how to monitor the usage of semaphore in the system.<br>&gt; <br>&gt; Unfortunately Linux systems does not have any 'top' like tool to monitor the semaphore usage. We have already started building one but it will be launched in around RHEL-7.5 release (just a wild guess). As of now we have 'ipcs' tool, which shows the semaphore usage. Example: <br>&gt; <br>&gt; <br>&gt; <br>&gt; # ipcs -s<br>&gt; <br>&gt; ------ Semaphore Arrays --------<br>&gt; key        semid      owner      perms      nsems     <br>&gt; 0x00000000 0          root       600        1         <br>&gt; 0x00000000 65537      root       600        1         <br>&gt; <br>&gt; <br>&gt; # ipcs -sl    &lt;&lt;&lt;--<br><br><publishedDate>2016-06-17T05:46:40Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HJgArIAL"><br>======================<br><b>생성계정 : Babar, Yogesh</b><br><b>생성날짜 : 2016-06-17T01:33:57Z</b><br><b>마지막 답변자 : Babar, Yogesh</b><br><b>마지막 수정 일자 : 2016-06-17T01:33:56Z</b><br><br>Hello, <br><br><br>This is Yogesh from kernel team and I will be assisting you further. <br>======================<br>&gt;&gt;     39 : Extended Global Memory Semaphore (EG management)<br><br>This is a SAP specific error and I can not really comment on it. But if the error is saying allocated semaphores are exhausted then you can simply increase the number of semaphore allocations: <br><br><br>'How to increase the number of semaphores' <br>--&gt; https://access.redhat.com/solutions/2896<br>======================<br>&gt;&gt; how to monitor the usage of semaphore in the system.<br><br>Unfortunately Linux systems does not have any 'top' like tool to monitor the semaphore usage. We have already started building one but it will be launched in around RHEL-7.5 release (just a wild guess). As of now we have 'ipcs' tool, which shows the semaphore usage. Example: <br>======================<br># ipcs -s<br><br>------ Semaphore Arrays --------<br>key        semid      owner      perms      nsems     <br>0x00000000 0          root       600        1         <br>0x00000000 65537      root       600        1         <br><br><br># ipcs -sl    &lt;&lt;&lt;----- This will show you the limits<br><br>------ Semaphore Limits --------<br>max number of arrays = 128<br>max semaphores per array = 250<br>max semaphores system wide = 32000<br>max ops per semop call = 32<br>semaphore max value = 32767<br><br># watch ipcs -s    &lt;&lt;-- You can use watch command to monitor the active usage of semaphores though.. <br><br><br>Please feel free to revert back in case of any difficulty or concern. <br><br><br>Regards,<br>Yogesh Babar<br>Red Hat Global Support<br><br><publishedDate>2016-06-17T01:33:56Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HJfvwIAD"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2016-06-17T00:48:00Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2016-06-17T00:47:59Z</b><br><br>안녕하세요,<br><br>본 기술 문의는 TAM 담당자가 처리해야하나, 금일은 앞서 안내해드린바와 같이<br>직원 행사로 인하여 기술 문의를 처리할 수 없는 상황입니다.<br><br>따라서, 본 기술 문의는 영어권 엔지니에어 콜라보레이션을 요청해보도록 하겠습니다.<br>답변이 되기까지 다소 시간이 소요될 수 있는점 양해말씀드립니다.<br><br>이와는 별도로 시스템의 sosreport 를 첨부해주시면 엔지니어가 분석하는데 좀 더 수월할 것으로 보입니다.<br>======================<br>&gt;&gt;&gt; COLLABORATION REQUEST &lt;&lt;&lt;<br> <br>ENVIRONMENT:<br>  RHEL 7.2 SAP HANA<br><br>SPECIFICS:<br>  While migration is tested, semaphore competition is being monitored.<br>  - Error code 39 messages come out and application is continuously waited.<br>    39 : Extended Global Memory Semaphore (EG management)<br>  - Let us know how to monitor the usage of semaphore in the system.<br>    ie) used 10(10%) / total 100(100%)<br><br>STEPS TAKEN: <br>  <br>SUPPORTING DATA:<br>  Attached to Case:<br><br>  Elsewhere:<br> <br>REQUESTED ACTION:<br>  - Can someone know why this issue happens? how to solve it?<br>  - Let them know how to monitor the usage of semaphore in the system.<br><br><publishedDate>2016-06-17T00:47:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HJfbKIAT"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2016-06-16T23:44:37Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2016-06-16T23:44:36Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>금일은 한국 레드햇 직원들의 행사가 있어 기술 문의의 답변이 늦어질 수 있는 점 양해말씀드립니다.<br>본 기술문의는 담당자에 의해 돌아오는 영업일 중으로 답변드릴 수 있게 전달해 두도록 하겠습니다.<br><br>만일 아래 기술 문의 심각도 정의에 따라 긴급한 사안이라면 심각도를 올려주시거나 <br>Management Escalation 을 설정해주시면<br>신속하게 기술 문의에 대한 답변이 처리될 수 있게 도와드릴 수 있습니다.<br><br>- Red Hat 기술 문의 심각도 정의와 관련하여 하기의 URL를 참고 하시기 바랍니다. <br>  https://access.redhat.com/support/policy/severity/ <br><br>- Red Hat Support Case Escalation<br>  https://access.redhat.com/support/escalation<br><br>감사합니다.<br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2016-06-16T23:44:36Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>- SAP 에러메시지  : 아래 메시지를 의미하는 에러코드 39번을 뿌리면서 대기하는 현상 지속 발생중<br>   39 : Extended Global Memory Semaphoe (EG management)<br>- 세마포어의 사용량 모니터링 ( 전체 XXX중 YYY 만큼 사용함 ) 방법 안내 부탁드립니다.</issue><cep>false</cep></case>