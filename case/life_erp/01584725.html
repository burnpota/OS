======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-02-17T07:09:49Z</b><br><b>마지막 답변자 : JINKOO HAN</b><br><b>마지막 수정 일자 : 2016-03-09T01:15:06Z</b><br><b>id : 500A000000TcYbiIAF</b><br>======================<br><br><b><font size=15>
제목  : 일부 시스템 NTP 시간 동기화 문제 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>물리시스템 중 일부 서버에서 NTP 시간동기화에 문제가 있음을 확인하였습니다.<br><br>/etc/ntp.conf 설정과 모든 환경은 물리서버 모두 동일한 상태이며, 특정 몇몇 서버에서 offset/jitter 값이 많이 벌어져 있는 상태라 아래와 같이 체크를 진행하였습니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>문제가 있는 시스템에서 아래와 같이 확인 해 보니,<br><br>[root@PQUOAL02SL:/etc] ntptime<br>ntp_gettime() returns code 0 (OK)<br>  time da6e7e10.d5f4c000  Wed, Feb 17 2016 14:05:20.835, (.835766),<br>  maximum error 23016 us, estimated error 16 us, TAI offset 0<br>ntp_adjtime() returns code 0 (OK)<br>  modes 0x0 (),<br>  offset 0.000 us, frequency 0.000 ppm, interval 1 s,<br>  maximum error 23016 us, estimated error 16 us,<br>  status 0x1 (PLL),<br>  time constant 7, precision 1.000 us, tolerance 500 ppm,<br><br>[root@PQUOAL02SL:/etc] ntpq -p<br>     remote           refid      st t when poll reach   delay   offset<br>========================================================================<br> PNTPML01SL      .GPS.            1 u  366 1024  377    0.502  -116208 1<br> PNTPML02SL      .GPS.            1 u  712 1024  377    0.520  -116242 2<br><br>[root@PQUOAL02SL:/etc] tcpdump -nvvv -i bond0 udp port 123<br>tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 6<br>14:13:18.645615 IP (tos 0xc0, ttl 64, id 53668, offset 0, flags [DF], pr<br>    100.254.142.42.ntp &gt; 100.254.147.200.ntp: [bad udp cksum 0xec38 -&gt; 0<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), p<br>        Root Delay: 0.000518, Root dispersion: 36.593292, Reference-ID:<br>          Reference Timestamp:  3662351806.653518497 (2016/01/21 16:56:4<br>          Originator Timestamp: 3664672612.217239052 (2016/02/17 13:36:5<br>          Receive Timestamp:    3664673774.646631360 (2016/02/17 13:56:1<br>          Transmit Timestamp:   3664674798.645579457 (2016/02/17 14:13:1<br>            Originator - Receive Timestamp:  +1162.429392337<br>            Originator - Transmit Timestamp: +2186.428340435<br>14:13:18.646088 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto U<br>    100.254.147.200.ntp &gt; 100.254.142.42.ntp: [udp sum ok] NTPv4, length<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), pol<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: G<br>          Reference Timestamp:  3664673634.703810870 (2016/02/17 13:53:5<br>          Originator Timestamp: 3664674798.645579457 (2016/02/17 14:13:1<br>          Receive Timestamp:    3664673635.703810870 (2016/02/17 13:53:5<br>          Transmit Timestamp:   3664673635.703810870 (2016/02/17 13:53:5<br>            Originator - Receive Timestamp:  -1162.941768646<br>            Originator - Transmit Timestamp: -1162.941768646<br><br>[root@PQUOAL02SL:/var/log] ps auwwx | grep ntp[d]<br>ntp      31187  0.0  0.0  29416  2068 ?        Ss   Jan21   1:04 /usr/sb<br><br>이미 1월 21에 ntp 데몬을 올렸으나, ntpq -p 로 확인했을 때 + 또는 * 표시가 모두 없는 상태이며,<br><br>tcpdump 로 확인했을 때에는 정상적으로 시간데이터가 들어옴을 확인하였습니다.<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>그래서 아래와 같이 강제로 시간을 맞췄습니다.<br><br>[root@PQUOAL02SL:/root] systemctl stop ntpd<br>[root@PQUOAL02SL:/root] ntpdate PNTPML01SL<br>[root@PQUOAL02SL:/root] systemctl start ntpd<br><br>위와 같이 강제로 실행을 해도 결과는 아래와 같이 나오고 있습니다.<br><br>[root@PQUOAL02SL:/root] ntpq -p<br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>*PNTPML01SL      .GPS.            1 u   26   64   17    0.472  -31.798  43.123 &lt;-- 시작하자마자 offset 차이 발생<br>+PNTPML02SL      .GPS.            1 u   22   64   17    0.507  -32.801  43.987<br><br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>xPNTPML01SL      .GPS.            1 u   60   64  377    0.461  -674.63 254.286 &lt;-- jitter, offset 모두 벌어지며, remote 도 x 표시<br>*PNTPML02SL      .GPS.            1 u   49   64  377    0.438  -466.10 146.380<br><br>위와 같이 나오고 있으며, <br><br>하드웨어 시계가 문제일 가능성도 있어 HP 에도 동일한 문의를 요청하였습니다.<br><br>문의드리는 내용은 아래와 같습니다.<br><br>1. ntpdate 를 이용하여 강제로 시간동기화를 해도 바로 시간이 벌어지는 이유.<br>2. ntpq -p 로 봤을 때, POLL 값의 부여 기준.<br>3. remote 서버가 +/*/x 표시가 나오는데, 의미하는 값<br>4. Hardware 시계 자체에 문제 가능성.<br><br>확인 부탁드립니다.<br><br>문제가 되는 시스템 중 1대의 sosreport 도 추가로 첨부하도록 하겠습니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000GdW7LIAV"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-03-08T06:33:13Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-03-08T06:33:13Z</b><br><br>HP 물리시스템의 경우 iLO 에 별도 NTP 를 설정하여 Hardware Clock 동기화를 하였습니다.<br><br>감사합니다.<br><br><publishedDate>2016-03-08T06:33:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Ga7GAIAZ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-24T00:30:42Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-24T00:30:41Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 x86시스템의 경우, 하드웨어 표준에 따라서 하드웨어에 있는 management 시스템의 시간을 CMOS에서 시간을 가지고 시스템 하드웨어 clock을 설정하는 경우가 존재합니다.<br>그리고 이러한 경우, 하드웨어 시간이 표준시간과 차이가 있을경우 ntpdate를 통해서 시간을 맞추더라도 시간이 맞지 않거나 또는 ntpd을 실행하는 과정에서도 시간이 다시 비정상적으로 옮겨가는 현상이 존재할 수 있습니다.<br><br>그래서 우선 시스템 하드웨어의 Management(HP의 경우 iLO)의 시간을 표준시간대로 맞춘 상태로 변경하고 hwclock을 확인한 후에 ntpdate와 nptd을 수행하는 것을 수행하여 주시기 바랍니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-02-24T00:30:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GZTV2IAP"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-22T00:49:15Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-22T00:49:15Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>확인 후, 업데이트 드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-22T00:49:15Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GZSF5IAP"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-02-21T11:11:13Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-02-21T11:11:13Z</b><br><br>안녕하세요.<br><br>문제가 있는 시스템에서 아래와 같이 데이터를 수집하였습니다.<br><br>root@PECCAL02SL /root # ntpq -p<br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>*PNTPML01SL      .GPS.            1 u   60   64  377    0.491  -2647.3  93.870<br>+PNTPML02SL      .GPS.            1 u   54   64  377    0.438  -2678.8 117.343<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br><br> <br><br>root@PECCAL02SL /root # ntpq<br>ntpq&gt; peers<br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>*PNTPML01SL      .GPS.            1 u   66   64  377    0.491  -2647.3  93.870<br>+PNTPML02SL      .GPS.            1 u   60   64  377    0.438  -2678.8 117.343<br><br> <br><br>ntpq&gt; as<br><br>ind assid status  conf reach auth condition  last_event cnt<br>===========================================================<br>  1 20470  961a   yes   yes  none  sys.peer    sys_peer  1<br>  2 20471  943a   yes   yes  none candidate    sys_peer  3<br><br> <br><br>ntpq&gt; rv 20470<br>associd=20470 status=961a conf, reach, sel_sys.peer, 1 event, sys_peer,<br>srcadr=PNTPML01SL, srcport=123, dstadr=100.254.142.22, dstport=123,<br>leap=00, stratum=1, precision=-19, rootdelay=0.000, rootdisp=0.000,<br>refid=GPS, reftime=da724d45.2ca77cfe  Sat, Feb 20 2016 11:26:13.174,<br>rec=da724d48.a12def9d  Sat, Feb 20 2016 11:26:16.629, reach=377,<br>unreach=0, hmode=3, pmode=4, hpoll=6, ppoll=6, headway=53, flash=00 ok,<br>keyid=0, offset=-2647.332, delay=0.491, dispersion=4.778, jitter=116.181,<br>xleave=0.012,<br>filtdelay=     0.53    0.52    0.67    0.50    0.56    0.52    0.49    0.51,<br>filtoffset= -2454.9 -2487.8 -2519.2 -2550.8 -2582.3 -2615.3 -2647.3 -2680.3,<br>filtdisp=      0.00    1.01    1.97    2.93    3.89    4.89    5.87    6.87<br><br> <br><br>ntpq&gt; rv 20471<br>associd=20471 status=943a conf, reach, sel_candidate, 3 events, sys_peer,<br>srcadr=PNTPML02SL, srcport=123, dstadr=100.254.142.22, dstport=123,<br>leap=00, stratum=1, precision=-19, rootdelay=0.000, rootdisp=0.000,<br>refid=GPS, reftime=da724d4b.2d55a214  Sat, Feb 20 2016 11:26:19.177,<br>rec=da724d4e.a119e753  Sat, Feb 20 2016 11:26:22.629, reach=377,<br>unreach=0, hmode=3, pmode=4, hpoll=6, ppoll=6, headway=56, flash=00 ok,<br>keyid=0, offset=-2678.850, delay=0.438, dispersion=4.233, jitter=144.844,<br>xleave=0.018,<br>filtdelay=     0.45    0.44    0.50    0.52    0.47    0.49    0.49    0.44,<br>filtoffset= -2451.9 -2484.9 -2516.4 -2548.9 -2581.8 -2614.8 -2646.8 -2678.8,<br>filtdisp=      0.00    1.01    1.97    2.96    3.96    4.97    5.94    6.92<br><br> <br><br>ntpq&gt; quit<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br>root@PECCAL02SL /root #<br><br> <br><br>root@PECCAL02SL /root # tcpdump -s0 port 123 -vvv -i bond0 -w port123.cap<br>tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes<br>^C29 packets captured<br>29 packets received by filter<br>0 packets dropped by kernel<br>427 packets dropped by interface<br>root@PECCAL02SL /root/.redhat/ntp_issue # cat tcpdump.txt<br>root@PECCAL02SL /root/.redhat/ntp_issue # tcpdump -s0 port 123 -vvv -i bond0<br>tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 65535 bytes<br>11:31:33.334372 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; 100.254.142.131.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 9 (512s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924290.034951556 (2016/02/20 11:31:30)<br>          Originator Timestamp: 3664924291.035271394 (2016/02/20 11:31:31)<br>          Receive Timestamp:    3664924291.034951556 (2016/02/20 11:31:31)<br>          Transmit Timestamp:   3664924291.034951556 (2016/02/20 11:31:31)<br>            Originator - Receive Timestamp:  -0.000319836<br>            Originator - Transmit Timestamp: -0.000319836<br>11:31:44.629196 IP (tos 0xc0, ttl 64, id 14956, offset 0, flags [DF], proto UDP (17), length 76)<br>    PECCAL02SL.ntp &gt; PNTPML01SL.ntp: [bad udp cksum 0xebc0 -&gt; 0xbbec!] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000442, Root dispersion: 2.490814, Reference-ID: PNTPML02SL<br>          Reference Timestamp:  3664924114.629365622 (2016/02/20 11:28:34)<br>          Originator Timestamp: 3664924237.303909868 (2016/02/20 11:30:37)<br>          Receive Timestamp:    3664924239.629712998 (2016/02/20 11:30:39)<br>          Transmit Timestamp:   3664924304.629178881 (2016/02/20 11:31:44)<br>            Originator - Receive Timestamp:  +2.325803130<br>            Originator - Transmit Timestamp: +67.325269043<br>11:31:44.629705 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; PECCAL02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 7 (128s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924301.335902631 (2016/02/20 11:31:41)<br>          Originator Timestamp: 3664924304.629178881 (2016/02/20 11:31:44)<br>          Receive Timestamp:    3664924302.335902631 (2016/02/20 11:31:42)<br>          Transmit Timestamp:   3664924302.335902631 (2016/02/20 11:31:42)<br>            Originator - Receive Timestamp:  -2.293276250<br>            Originator - Transmit Timestamp: -2.293276250<br>11:31:50.142395 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; 100.254.142.36.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 10 (1024s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924306.851255595 (2016/02/20 11:31:46)<br>          Originator Timestamp: 3664924307.850906074 (2016/02/20 11:31:47)<br>          Receive Timestamp:    3664924307.851255595 (2016/02/20 11:31:47)<br>          Transmit Timestamp:   3664924307.851255595 (2016/02/20 11:31:47)<br>            Originator - Receive Timestamp:  +0.000349520<br>            Originator - Transmit Timestamp: +0.000349520<br>11:31:53.628931 IP (tos 0xc0, ttl 64, id 59445, offset 0, flags [DF], proto UDP (17), length 76)<br>    PECCAL02SL.ntp &gt; PNTPML02SL.ntp: [bad udp cksum 0xec24 -&gt; 0x6c3d!] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000442, Root dispersion: 2.490951, Reference-ID: PNTPML02SL<br>          Reference Timestamp:  3664924114.629365622 (2016/02/20 11:28:34)<br>          Originator Timestamp: 3664924178.274552196 (2016/02/20 11:29:38)<br>          Receive Timestamp:    3664924180.629516780 (2016/02/20 11:29:40)<br>          Transmit Timestamp:   3664924313.628922283 (2016/02/20 11:31:53)<br>            Originator - Receive Timestamp:  +2.354964584<br>            Originator - Transmit Timestamp: +135.354370117<br>11:31:53.629364 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; PECCAL02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 7 (128s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924310.339995324 (2016/02/20 11:31:50)<br>          Originator Timestamp: 3664924313.628922283 (2016/02/20 11:31:53)<br>          Receive Timestamp:    3664924311.339995324 (2016/02/20 11:31:51)<br>          Transmit Timestamp:   3664924311.339995324 (2016/02/20 11:31:51)<br>            Originator - Receive Timestamp:  -2.288926988<br>            Originator - Transmit Timestamp: -2.288926988<br>11:32:55.234646 IP (tos 0xc0, ttl 64, id 44607, offset 0, flags [DF], proto UDP (17), length 76)<br>    ap4.p.ecc.samsunglife.kr.ntp &gt; PNTPML02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 6 (64s), precision -25<br>        Root Delay: 0.000457, Root dispersion: 0.948593, Reference-ID: PNTPML01SL<br>          Reference Timestamp:  3664924309.209485545 (2016/02/20 11:31:49)<br>          Originator Timestamp: 3664924309.008272719 (2016/02/20 11:31:49)<br>          Receive Timestamp:    3664924308.209571197 (2016/02/20 11:31:48)<br>          Transmit Timestamp:   3664924372.208985403 (2016/02/20 11:32:52)<br>            Originator - Receive Timestamp:  -0.798701524<br>            Originator - Transmit Timestamp: +63.200712680<br>11:33:02.579033 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; ap6.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924379.323552757 (2016/02/20 11:32:59)<br>          Originator Timestamp: 3664924375.030588485 (2016/02/20 11:32:55)<br>          Receive Timestamp:    3664924380.323552757 (2016/02/20 11:33:00)<br>          Transmit Timestamp:   3664924380.323552757 (2016/02/20 11:33:00)<br>            Originator - Receive Timestamp:  +5.292964279<br>            Originator - Transmit Timestamp: +5.292964279<br>11:33:03.578052 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; ap6.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924380.323042184 (2016/02/20 11:33:00)<br>          Originator Timestamp: 3664924376.030583212 (2016/02/20 11:32:56)<br>          Receive Timestamp:    3664924381.323042184 (2016/02/20 11:33:01)<br>          Transmit Timestamp:   3664924381.323042184 (2016/02/20 11:33:01)<br>            Originator - Receive Timestamp:  +5.292458951<br>            Originator - Transmit Timestamp: +5.292458951<br>11:33:17.417574 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; ap7.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924394.169395580 (2016/02/20 11:33:14)<br>          Originator Timestamp: 3664924394.373565584 (2016/02/20 11:33:14)<br>          Receive Timestamp:    3664924395.169395580 (2016/02/20 11:33:15)<br>          Transmit Timestamp:   3664924395.169395580 (2016/02/20 11:33:15)<br>            Originator - Receive Timestamp:  +0.795830011<br>            Originator - Transmit Timestamp: +0.795830011<br>11:33:19.415612 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; ap7.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924396.168420255 (2016/02/20 11:33:16)<br>          Originator Timestamp: 3664924396.373616933 (2016/02/20 11:33:16)<br>          Receive Timestamp:    3664924397.168420255 (2016/02/20 11:33:17)<br>          Transmit Timestamp:   3664924397.168420255 (2016/02/20 11:33:17)<br>            Originator - Receive Timestamp:  +0.794803321<br>            Originator - Transmit Timestamp: +0.794803321<br>11:33:56.629226 IP (tos 0xc0, ttl 64, id 14957, offset 0, flags [DF], proto UDP (17), length 76)<br>    PECCAL02SL.ntp &gt; PNTPML01SL.ntp: [bad udp cksum 0xebc0 -&gt; 0x206f!] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000488, Root dispersion: 2.446685, Reference-ID: PNTPML01SL<br>          Reference Timestamp:  3664924304.629705250 (2016/02/20 11:31:44)<br>          Originator Timestamp: 3664924302.335902631 (2016/02/20 11:31:42)<br>          Receive Timestamp:    3664924304.629705250 (2016/02/20 11:31:44)<br>          Transmit Timestamp:   3664924436.629212260 (2016/02/20 11:33:56)<br>            Originator - Receive Timestamp:  +2.293802589<br>            Originator - Transmit Timestamp: +134.293309628<br>11:33:56.629715 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; PECCAL02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 7 (128s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924433.400836706 (2016/02/20 11:33:53)<br>          Originator Timestamp: 3664924436.629212260 (2016/02/20 11:33:56)<br>          Receive Timestamp:    3664924434.400836706 (2016/02/20 11:33:54)<br>          Transmit Timestamp:   3664924434.400836706 (2016/02/20 11:33:54)<br>            Originator - Receive Timestamp:  -2.228375568<br>            Originator - Transmit Timestamp: -2.228375568<br>11:34:04.629202 IP (tos 0xc0, ttl 64, id 59446, offset 0, flags [DF], proto UDP (17), length 76)<br>    PECCAL02SL.ntp &gt; PNTPML02SL.ntp: [bad udp cksum 0xec24 -&gt; 0x843e!] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000488, Root dispersion: 2.446807, Reference-ID: PNTPML01SL<br>          Reference Timestamp:  3664924304.629705250 (2016/02/20 11:31:44)<br>          Originator Timestamp: 3664924311.339995324 (2016/02/20 11:31:51)<br>          Receive Timestamp:    3664924313.629364013 (2016/02/20 11:31:53)<br>          Transmit Timestamp:   3664924444.629193127 (2016/02/20 11:34:04)<br>            Originator - Receive Timestamp:  +2.289368689<br>            Originator - Transmit Timestamp: +133.289197832<br>11:34:04.636807 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; PECCAL02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 7 (128s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924441.411776483 (2016/02/20 11:34:01)<br>          Originator Timestamp: 3664924444.629193127 (2016/02/20 11:34:04)<br>          Receive Timestamp:    3664924442.411776483 (2016/02/20 11:34:02)<br>          Transmit Timestamp:   3664924442.411776483 (2016/02/20 11:34:02)<br>            Originator - Receive Timestamp:  -2.217416688<br>            Originator - Transmit Timestamp: -2.217416688<br>11:34:17.732835 IP (tos 0xc0, ttl 64, id 6340, offset 0, flags [DF], proto UDP (17), length 76)<br>    100.254.142.43.ntp &gt; PNTPML02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000473, Root dispersion: 0.004531, Reference-ID: PNTPML01SL<br>          Reference Timestamp:  3664924450.515747427 (2016/02/20 11:34:10)<br>          Originator Timestamp: 3664924326.514755427 (2016/02/20 11:32:06)<br>          Receive Timestamp:    3664924326.515845537 (2016/02/20 11:32:06)<br>          Transmit Timestamp:   3664924455.515268087 (2016/02/20 11:34:15)<br>            Originator - Receive Timestamp:  +0.001090121<br>            Originator - Transmit Timestamp: +129.000512616<br>11:34:23.352134 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; ap7.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924460.136388525 (2016/02/20 11:34:20)<br>          Originator Timestamp: 3664924460.373927503 (2016/02/20 11:34:20)<br>          Receive Timestamp:    3664924461.136388525 (2016/02/20 11:34:21)<br>          Transmit Timestamp:   3664924461.136388525 (2016/02/20 11:34:21)<br>            Originator - Receive Timestamp:  +0.762461006<br>            Originator - Transmit Timestamp: +0.762461006<br>11:34:24.350833 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; ap7.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924461.135590344 (2016/02/20 11:34:21)<br>          Originator Timestamp: 3664924461.373637914 (2016/02/20 11:34:21)<br>          Receive Timestamp:    3664924462.135590344 (2016/02/20 11:34:22)<br>          Transmit Timestamp:   3664924462.135590344 (2016/02/20 11:34:22)<br>            Originator - Receive Timestamp:  +0.761952459<br>            Originator - Transmit Timestamp: +0.761952459<br>11:34:45.281438 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; 100.254.142.38.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 10 (1024s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924482.076464876 (2016/02/20 11:34:42)<br>          Originator Timestamp: 3664924483.075860671 (2016/02/20 11:34:43)<br>          Receive Timestamp:    3664924483.076464876 (2016/02/20 11:34:43)<br>          Transmit Timestamp:   3664924483.076464876 (2016/02/20 11:34:43)<br>            Originator - Receive Timestamp:  +0.000604203<br>            Originator - Transmit Timestamp: +0.000604203<br>11:35:12.448810 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; ap6.p.ecc.samsunglife.kr.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 6 (64s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924509.257240593 (2016/02/20 11:35:09)<br>          Originator Timestamp: 3664924505.030511667 (2016/02/20 11:35:05)<br>          Receive Timestamp:    3664924510.257240593 (2016/02/20 11:35:10)<br>          Transmit Timestamp:   3664924510.257240593 (2016/02/20 11:35:10)<br>            Originator - Receive Timestamp:  +5.226728931<br>            Originator - Transmit Timestamp: +5.226728931<br>11:36:04.628733 IP (tos 0xc0, ttl 64, id 14958, offset 0, flags [DF], proto UDP (17), length 76)<br>    PECCAL02SL.ntp &gt; PNTPML01SL.ntp: [bad udp cksum 0xebc0 -&gt; 0xd7e9!] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000488, Root dispersion: 2.448608, Reference-ID: PNTPML01SL<br>          Reference Timestamp:  3664924304.629705250 (2016/02/20 11:31:44)<br>          Originator Timestamp: 3664924434.400836706 (2016/02/20 11:33:54)<br>          Receive Timestamp:    3664924436.629715442 (2016/02/20 11:33:56)<br>          Transmit Timestamp:   3664924564.628724336 (2016/02/20 11:36:04)<br>            Originator - Receive Timestamp:  +2.228878721<br>            Originator - Transmit Timestamp: +130.227887630<br>11:36:04.629229 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML01SL.ntp &gt; PECCAL02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 7 (128s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924561.463357478 (2016/02/20 11:36:01)<br>          Originator Timestamp: 3664924564.628724336 (2016/02/20 11:36:04)<br>          Receive Timestamp:    3664924562.463357478 (2016/02/20 11:36:02)<br>          Transmit Timestamp:   3664924562.463357478 (2016/02/20 11:36:02)<br>            Originator - Receive Timestamp:  -2.165366858<br>            Originator - Transmit Timestamp: -2.165366858<br>11:36:15.629152 IP (tos 0xc0, ttl 64, id 59447, offset 0, flags [DF], proto UDP (17), length 76)<br>    PECCAL02SL.ntp &gt; PNTPML02SL.ntp: [bad udp cksum 0xec24 -&gt; 0xc9c5!] NTPv4, length 48<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), poll 7 (128s), precision -25<br>        Root Delay: 0.000488, Root dispersion: 2.448776, Reference-ID: PNTPML01SL<br>          Reference Timestamp:  3664924304.629705250 (2016/02/20 11:31:44)<br>          Originator Timestamp: 3664924442.411776483 (2016/02/20 11:34:02)<br>          Receive Timestamp:    3664924444.636807382 (2016/02/20 11:34:04)<br>          Transmit Timestamp:   3664924575.629125773 (2016/02/20 11:36:15)<br>            Originator - Receive Timestamp:  +2.225030928<br>            Originator - Transmit Timestamp: +133.217349290<br>11:36:15.629629 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto UDP (17), length 76)<br>    PNTPML02SL.ntp &gt; PECCAL02SL.ntp: [udp sum ok] NTPv4, length 48<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), poll 7 (128s), precision -19<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: GPS^@<br>          Reference Timestamp:  3664924572.469173133 (2016/02/20 11:36:12)<br>          Originator Timestamp: 3664924575.629125773 (2016/02/20 11:36:15)<br>          Receive Timestamp:    3664924573.469173133 (2016/02/20 11:36:13)<br>          Transmit Timestamp:   3664924573.469173133 (2016/02/20 11:36:13)<br>            Originator - Receive Timestamp:  -2.159952610<br>            Originator - Transmit Timestamp: -2.159952610<br>^C<br>24 packets captured<br>24 packets received by filter<br>0 packets dropped by kernel<br>173 packets dropped by interface <br><br>감사합니다.<br><br><publishedDate>2016-02-21T11:11:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GZCEMIA5"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-19T06:53:44Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-19T06:53:44Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>추가적인 수집 데이터가 있어서 아래와 같이 추가 요청 드립니다.<br><br>아래와 같이 테스트 및 그 결과값을 공유 바랍니다.<br><br>1. ntpq<br>  ntpq&gt; peers<br>  ntpq&gt; as<br>  ntpq&gt; rv &lt;asID&gt;<br><br>2. tcpdump<br><br># tcpdump -s0 port 123 -vvv -i &lt;NIC&gt; -w port123.cap<br><br><br>예를들어, <br><br>ntpq&gt; as<br>ind assID status  conf reach auth condition  last_event cnt<br>===========================================================<br>  1 29581  9624   yes   yes  none  sys.peer   reachable  1<br>  2 29582  9014   yes   yes  none  candidat   reachable  1<br>  4 29583  8000   yes   yes  none    reject<br>  5 29584  9024   yes   yes  none    reject   reachable  2<br><br>ntpq&gt; rv 29583<br>assID=62236 status=9014 reach, conf, 1 event, event_reach,<br>srcadr=192.168.23.1, srcport=123, dstadr=192.168.247.11, dstport=123,....<br><br><br>감사합니다.<br><br><publishedDate>2016-02-19T06:53:44Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GZC2kIAH"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-19T06:31:47Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-19T06:31:47Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>현재 본 케이스에 대한 내용을 검토중에 있으며, 추가적인 자료가 필요하여 아래 내용을 요청드립니다.<br><br>'ntpdate'를 수행할때.. -d option과 함께 한 결과를 바랍니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-19T06:31:47Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GYiUdIAL"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-18T01:44:53Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-18T01:44:53Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>문의주신 내용을 확인하고 다시 업데이트 드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-18T01:44:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GYMmxIAH"><br>======================<br><b>생성계정 : 심, 우택</b><br><b>생성날짜 : 2016-02-17T08:57:03Z</b><br><b>마지막 답변자 : 심, 우택</b><br><b>마지막 수정 일자 : 2016-02-17T08:57:02Z</b><br><br>sosreport 파일을 업로드 합니다.<br><br>확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-02-17T08:57:02Z</publishedDate><createdByType>Customer</createdByType><br>======================<br></comments><br><br>물리시스템 중 일부 서버에서 NTP 시간동기화에 문제가 있음을 확인하였습니다.<br><br>/etc/ntp.conf 설정과 모든 환경은 물리서버 모두 동일한 상태이며, 특정 몇몇 서버에서 offset/jitter 값이 많이 벌어져 있는 상태라 아래와 같이 체크를 진행하였습니다.</issue><environment>문제가 있는 시스템에서 아래와 같이 확인 해 보니,<br><br>[root@PQUOAL02SL:/etc] ntptime<br>ntp_gettime() returns code 0 (OK)<br>  time da6e7e10.d5f4c000  Wed, Feb 17 2016 14:05:20.835, (.835766),<br>  maximum error 23016 us, estimated error 16 us, TAI offset 0<br>ntp_adjtime() returns code 0 (OK)<br>  modes 0x0 (),<br>  offset 0.000 us, frequency 0.000 ppm, interval 1 s,<br>  maximum error 23016 us, estimated error 16 us,<br>  status 0x1 (PLL),<br>  time constant 7, precision 1.000 us, tolerance 500 ppm,<br><br>[root@PQUOAL02SL:/etc] ntpq -p<br>     remote           refid      st t when poll reach   delay   offset<br>========================================================================<br> PNTPML01SL      .GPS.            1 u  366 1024  377    0.502  -116208 1<br> PNTPML02SL      .GPS.            1 u  712 1024  377    0.520  -116242 2<br><br>[root@PQUOAL02SL:/etc] tcpdump -nvvv -i bond0 udp port 123<br>tcpdump: listening on bond0, link-type EN10MB (Ethernet), capture size 6<br>14:13:18.645615 IP (tos 0xc0, ttl 64, id 53668, offset 0, flags [DF], pr<br>    100.254.142.42.ntp &gt; 100.254.147.200.ntp: [bad udp cksum 0xec38 -&gt; 0<br>        Client, Leap indicator:  (0), Stratum 2 (secondary reference), p<br>        Root Delay: 0.000518, Root dispersion: 36.593292, Reference-ID:<br>          Reference Timestamp:  3662351806.653518497 (2016/01/21 16:56:4<br>          Originator Timestamp: 3664672612.217239052 (2016/02/17 13:36:5<br>          Receive Timestamp:    3664673774.646631360 (2016/02/17 13:56:1<br>          Transmit Timestamp:   3664674798.645579457 (2016/02/17 14:13:1<br>            Originator - Receive Timestamp:  +1162.429392337<br>            Originator - Transmit Timestamp: +2186.428340435<br>14:13:18.646088 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto U<br>    100.254.147.200.ntp &gt; 100.254.142.42.ntp: [udp sum ok] NTPv4, length<br>        Server, Leap indicator:  (0), Stratum 1 (primary reference), pol<br>        Root Delay: 0.000000, Root dispersion: 0.000000, Reference-ID: G<br>          Reference Timestamp:  3664673634.703810870 (2016/02/17 13:53:5<br>          Originator Timestamp: 3664674798.645579457 (2016/02/17 14:13:1<br>          Receive Timestamp:    3664673635.703810870 (2016/02/17 13:53:5<br>          Transmit Timestamp:   3664673635.703810870 (2016/02/17 13:53:5<br>            Originator - Receive Timestamp:  -1162.941768646<br>            Originator - Transmit Timestamp: -1162.941768646<br><br>[root@PQUOAL02SL:/var/log] ps auwwx | grep ntp[d]<br>ntp      31187  0.0  0.0  29416  2068 ?        Ss   Jan21   1:04 /usr/sb<br><br>이미 1월 21에 ntp 데몬을 올렸으나, ntpq -p 로 확인했을 때 + 또는 * 표시가 모두 없는 상태이며,<br><br>tcpdump 로 확인했을 때에는 정상적으로 시간데이터가 들어옴을 확인하였습니다.</environment><periodicityOfIssue>그래서 아래와 같이 강제로 시간을 맞췄습니다.<br><br>[root@PQUOAL02SL:/root] systemctl stop ntpd<br>[root@PQUOAL02SL:/root] ntpdate PNTPML01SL<br>[root@PQUOAL02SL:/root] systemctl start ntpd<br><br>위와 같이 강제로 실행을 해도 결과는 아래와 같이 나오고 있습니다.<br><br>[root@PQUOAL02SL:/root] ntpq -p<br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>*PNTPML01SL      .GPS.            1 u   26   64   17    0.472  -31.798  43.123 &lt;-- 시작하자마자 offset 차이 발생<br>+PNTPML02SL      .GPS.            1 u   22   64   17    0.507  -32.801  43.987<br><br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>xPNTPML01SL      .GPS.            1 u   60   64  377    0.461  -674.63 254.286 &lt;-- jitter, offset 모두 벌어지며, remote 도 x 표시<br>*PNTPML02SL      .GPS.            1 u   49   64  377    0.438  -466.10 146.380<br><br>위와 같이 나오고 있으며, <br><br>하드웨어 시계가 문제일 가능성도 있어 HP 에도 동일한 문의를 요청하였습니다.<br><br>문의드리는 내용은 아래와 같습니다.<br><br>1. ntpdate 를 이용하여 강제로 시간동기화를 해도 바로 시간이 벌어지는 이유.<br>2. ntpq -p 로 봤을 때, POLL 값의 부여 기준.<br>3. remote 서버가 +/*/x 표시가 나오는데, 의미하는 값<br>4. Hardware 시계 자체에 문제 가능성.<br><br>확인 부탁드립니다.<br><br>문제가 되는 시스템 중 1대의 sosreport 도 추가로 첨부하도록 하겠습니다.<br><br>감사합니다.</periodicityOfIssue><cep>false</cep></case>