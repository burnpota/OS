======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2017-12-04T09:38:27Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2017-12-12T02:56:55Z</b><br><b>id : 500A000000Z50t5IAB</b><br>======================<br><br><b><font size=15>
제목  : netstat 결과에서 연결된 session의 지속 시간 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>삼성생명 ERP Web 업무 역할을 하고 있는 서버가 있습니다.<br><br>해당 서버가 예를 들면 아래와 같이 session이 연결되어있는데 ESTABLISHED가 되고 지속 시간 관련해서 문의드리려고 합니다.<br><br><br>간단히 검색한 바로는<br><br>active session → fin_wait1 → fin_wait2 → time_wait → closed 상태로 되는 것으로 알고있는데요.<br><br>fin_wait1 / fin_wait2 / time_wait 시간의 설정이 os에서 확인이 가능한지 문의드리려고 합니다.<br><br>root@PEWBWL0ASL /root # sysctl -a | grep net.ipv4.tcp_fin_timeout<br>net.ipv4.tcp_fin_timeout = 60<br><br>root@PEWBWL0ASL /root # netstat -an | grep -i establi<br>Active Internet connections (servers and established)<br>tcp        0      0 121.253.31.121:40776    100.254.170.97:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:1002     100.5.64.219:39025      ESTABLISHED<br>tcp        0      0 121.253.31.121:9360     100.254.170.98:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:25127    100.254.141.236:51031   ESTABLISHED<br>tcp        0      0 127.0.0.1:33236         127.0.0.1:44324         ESTABLISHED<br>tcp        0      0 121.253.31.121:8443     123.142.108.187:65105   ESTABLISHED<br>tcp        0      0 121.253.31.121:47399    100.254.141.21:51031    ESTABLISHED<br>tcp        0      0 121.253.31.121:47199    100.254.170.98:5575     ESTABLISHED<br>tcp        0      0 127.0.0.1:44334         127.0.0.1:33236         ESTABLISHED<br>tcp        0      0 172.18.12.134:39901     172.18.12.191:1556      ESTABLISHED<br>tcp        0      0 121.253.31.121:39906    100.254.142.248:18893   ESTABLISHED<br>tcp        0      0 121.253.31.121:8443     203.241.147.15:4400     ESTABLISHED<br>tcp        0      0 127.0.0.1:33236         127.0.0.1:44334         ESTABLISHED<br>tcp        0      0 121.253.31.121:19939    100.254.141.23:50031    ESTABLISHED<br>tcp        0      0 121.253.31.121:15116    100.254.170.98:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:65124    100.5.64.151:15024      ESTABLISHED<br>tcp        0      0 121.253.31.121:38326    100.254.141.226:51031   ESTABLISHED<br>tcp        0      0 121.253.31.121:21535    100.254.170.97:5575     ESTABLISHED<br>tcp        0      0 127.0.0.1:44324         127.0.0.1:33236         ESTABLISHED<br>tcp        0      0 121.253.31.121:41465    100.254.170.97:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:16195    100.254.170.97:5575     ESTABLISHED<br>tcp        0      0 127.0.0.1:33236         127.0.0.1:44328         ESTABLISHED<br>tcp        0      0 127.0.0.1:44328         127.0.0.1:33236         ESTABLISHED<br>tcp        0      0 121.253.31.121:36686    100.254.170.97:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:45399    112.106.16.171:7778     ESTABLISHED<br>tcp        0      0 121.253.31.121:9362     100.254.170.98:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:65259    100.254.170.98:5575     ESTABLISHED<br>tcp        0      0 121.253.31.121:59988    100.254.170.97:5575     ESTABLISHED<br>Active UNIX domain sockets (servers and established)<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PEWBWL0ASL</hostname><br><br><br><comment id="a0aA000000LCJdIIAX"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-12T02:56:52Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-12T02:56:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>마지막 안내후 일정기간동안 답변이 없으셔서 본 케이스를 close 처리 하려고 합니다.<br>만약 본 케이스와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.  <br>  <br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발생됩니다. <br>고객님께서 남기 신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. <br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.  <br>  <br>감사합니다.<br><br><publishedDate>2017-12-12T02:56:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6yHGIAZ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-06T06:02:50Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-06T06:02:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services팀입니다.<br><br>본 케이스에 관련하여 추가적으로 문의하실 사항이 있으신가요?<br><br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-06T06:02:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6y7pIAB"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-12-06T05:46:39Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-12-06T05:46:39Z</b><br><br>안녕하세요<br><br>답변 감사드립니다.<br><br><publishedDate>2017-12-06T05:46:39Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L6iboIAB"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-05T11:23:34Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-06T01:43:33Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>tcp_orphan_retries 의 값이 8이라면 100초 가량에 해당됩니다.<br><br>아래의 공식에 의해 산출되었습니다.<br><br>(1+2+4+8+16+32+64+128+256)* 0.2s = 102.4s <br><br>감사합니다.<br><br><publishedDate>2017-12-05T11:23:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6gAcIAJ"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-12-05T08:36:33Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-12-05T08:36:33Z</b><br><br>안녕하세요 <br><br>답변 감사합니다.<br><br>그럼 tcp_orphan_retries 값의 경우는 소켓이 alive 상태(established)라면<br><br>8초 동안은 지속이 되시는 것인가요?<br><br><publishedDate>2017-12-05T08:36:33Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L6fY4IAJ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-05T07:38:24Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-05T07:38:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt;OS에서 설정값이 아래와 같다면 FIN_WAIT1 지속시간은 0이고<br><br>소켓이 alive 상태라면 해당 값은 8이며 100초가량 으로 보실수 있습니다.<br>관련내용은 아래 링크에서 확인하실수 있습니다.<br><br>What does it mean when &quot;tcp_orphan_retries&quot; is set to 0? <br>https://access.redhat.com/solutions/46154<br><br>&gt;FIN_WAIT2의 지속시간은 60초로 보면 되는 것인지 문의드립니다.<br><br>말씀하신 것이 맞습니다. 해당 시간은 time-out 시간으로 보실수 있습니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-05T07:38:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6f2cIAB"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2017-12-05T06:55:49Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2017-12-05T06:55:48Z</b><br><br>안녕하세요<br><br>답변 감사드립니다.<br><br>한가지 추가로 문의드릴 점은<br>OS에서 설정값이 아래와 같다면 FIN_WAIT1 지속시간은 0이고 FIN_WAIT2의 지속시간은 60초로 보면 되는 것인지 문의드립니다.<br><br>root@PEWBWL0ASL /root # sysctl -a | grep tcp_orphan<br>net.ipv4.tcp_orphan_retries = 0<br><br>root@PEWBWL0ASL /root # sysctl -a | grep net.ipv4.tcp_fin_timeout<br>net.ipv4.tcp_fin_timeout = 60<br><br> https://access.redhat.com/solutions/69115' 부분은 access denied라고 보입니다.<br><br><publishedDate>2017-12-05T06:55:48Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L6dAtIAJ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-05T03:18:18Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-05T03:18:18Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>문의 주신 내용에 대해 아래와 같이 답변드리겠습니다.<br><br>FIN_WAIT 1: 본 상태에서의 지속 시간에 영향 주는 커널 파라메터로는 net.ipv4.tcp_orphan_retries <br>            가 있습니다. 해당 값을 작게 하면 FIN_WAIT1 상태에서의 지속시간을 줄일수 있습니다.<br>            본 파라메터는 passive closer 측에서 ack를 보내지 못할시 FIN_WAIT1 상태로 남아있는 <br>            소켓이 존재할시 소켓들을 clean하는 목적으로 사용하면 유용합니다. 정상적으로 ACK 패킷<br>            을 받을수 있는 환경이라면 해당 값을 너무 작게 조절하는 것을 권장드리지 않습니다.<br><br>        Is there any way to clean TCP connections in &quot;FIN_WAIT1&quot; state ?  <br>         https://access.redhat.com/solutions/69115<br><br>FIN_WAIT 2: 본 상태에 진입후 상대방에서 close() 를 사용하여 FIN패킷을 받지 못해 지속되는 <br>            시간을 줄이려면 커널파라메터 net.ipv4.tcp_fin_timeout 값으로 조절할수 있습니다.<br>            이 커널파라메터도 마찬가지로 상대방측에서 문제가 생겨 소켓이 FIN_WAIT2 상태로 남아<br>            있는 경우에 지속되는 시간을 줄이는 목적으로 해당 값을 조절하실수 있습니다.<br>         <br>         Can we forcibly close TCP connnections in FIN_WAIT2 state?<br>          https://access.redhat.com/solutions/505903<br><br>TIME_WAIT : 해당 값은 60초로 하드코딩 되어 있으므로 조절할 방법은 없습니다.<br><br><br>감사합니다.<br><br><publishedDate>2017-12-05T03:18:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6c9sIAB"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-05T01:08:15Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-05T01:08:14Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 문의 주신 내용에 관해 자세히 살펴보고 있는 중이며 답변이 정리되는대로<br>코멘트를 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-05T01:08:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>