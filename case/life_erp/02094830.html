======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2018-05-09T01:52:16Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-06-01T10:07:09Z</b><br><b>id : 500A000000aqripIAA</b><br>======================<br><br><b><font size=15>
제목  : systemd-logind.service 관련 문ㅇ
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>접속 시 ssh 접속이 좀 느리면서<br>서버에서 아래와 같이 Fail 메세지가 발생하는데요.<br><br>systemd-login.service가 정상인 것 처럼은 보이는데 메세지 관련해서 문의드리려고 합니다.<br><br>[root@SLPCISAL01:/root] systemctl status systemd-logind.service<br>* systemd-logind.service - Login Service<br>   Loaded: loaded (/usr/lib/systemd/system/systemd-logind.service; static; vendor preset: disabled)<br>   Active: active (running) since Sun 2017-05-14 08:18:45 KST; 11 months 25 days ago<br>     Docs: man:systemd-logind.service(8)<br>           man:logind.conf(5)<br>           http://www.freedesktop.org/wiki/Software/systemd/logind<br>           http://www.freedesktop.org/wiki/Software/systemd/multiseat<br> Main PID: 1009 (systemd-logind)<br>   Status: &quot;Processing requests...&quot;<br>   CGroup: /system.slice/systemd-logind.service<br>           `-1009 /usr/lib/systemd/systemd-logind<br><br> - /var/log/messages<br>May 06 04:01:01 SLPCISAL01 systemd-logind[1009]: Removed session 592507.<br>May 06 04:01:01 SLPCISAL01 systemd-logind[1009]: New session 592508 of user security.<br>May 06 04:01:01 SLPCISAL01 systemd-logind[1009]: Removed session 592508.<br>May 06 07:41:29 SLPCISAL01 systemd-logind[1009]: New session 592756 of user sliida.<br>May 06 07:41:29 SLPCISAL01 systemd-logind[1009]: Removed session 592756.<br>May 06 09:11:15 SLPCISAL01 systemd-logind[1009]: Removed session 515723.<br>May 06 09:12:05 SLPCISAL01 systemd-logind[1009]: Removed session 238781.<br>May 06 09:15:21 SLPCISAL01 systemd-logind[1009]: Removed session 81136.<br>May 06 09:15:21 SLPCISAL01 systemd-logind[1009]: Removed session 515722.<br>May 06 09:15:36 SLPCISAL01 systemd-logind[1009]: Removed session 240070.<br><br>May  9 09:32:08 SLPCISAL01 dbus[71057]: [system] Failed to activate service 'org.freedesktop.login1': timed out<br>May  9 09:32:08 SLPCISAL01 dbus-daemon: dbus[71057]: [system] Failed to activate service 'org.freedesktop.login1': timed out<br>May  9 09:32:08 SLPCISAL01 su: pam_systemd(su-l:session): Failed to create session: Activation of org.freedesktop.login1 timed out<br>May  9 09:32:08 SLPCISAL01 crond[87252]: pam_systemd(crond:session): Failed to create session: Activation of org.freedesktop.login1 timed out<br>May  9 09:32:08 SLPCISAL01 su: pam_systemd(su-l:session): Failed to create session: Activation of org.freedesktop.login1 timed out<br>May  9 09:32:08 SLPCISAL01 su: pam_systemd(su-l:session): Failed to create session: Activation of org.freedesktop.login1 timed out<br>May  9 09:32:08 SLPCISAL01 su: pam_unix(su-l:session): session opened for user ftsadm by (uid=0)<br>May  9 09:32:08 SLPCISAL01 su: pam_unix(su-l:session): session opened for user ftsadm by (uid=0)<br>May  9 09:32:08 SLPCISAL01 su: pam_unix(su-l:session): session opened for user ftsadm by (uid=0)<br>May  9 09:32:08 SLPCISAL01 su: pam_systemd(su-l:session): Failed to create session: Activation of org.freedesktop.login1 timed out<br>May  9 09:32:08 SLPCISAL01 su: pam_unix(su-l:session): session opened for user ftsadm by (uid=0)<br>May  9 09:32:08 SLPCISAL01 su: pam_lastlog(su-l:session): file /var/log/lastlog is locked/write<br>May  9 09:32:08 SLPCISAL01 su: pam_lastlog(su-l:session): file /var/log/lastlog is locked/write<br>May  9 09:32:08 SLPCISAL01 su: pam_lastlog(su-l:session): file /var/log/lastlog is locked/write<br>May  9 09:32:08 SLPCISAL01 su: pam_systemd(su-l:session): Failed to create session: Activation of org.freedesktop.login1 timed out<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPCISAL01</hostname><br><br><br><comment id="a0aA000000MdIGuIAN"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-05-16T04:48:41Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-05-16T04:48:41Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>추가 질문 없으시면 케이스 종료하겠습니다.<br><br>고맙습니다.<br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-05-16T04:48:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Md0pxIAB"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-05-15T07:37:15Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-05-15T07:37:15Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>답변 감사드립니다.<br><br><publishedDate>2018-05-15T07:37:15Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mc1I3IAJ"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-05-10T02:16:01Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-05-10T02:16:01Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>dbus 서비스의 경우 주로 데스크탑 환경에서 데몬간 통신 할 때 많이 사용합니다. 이 때문에 alsa 서비스와 같은 사운드관련 서비스를 확인하는 것입니다.<br>하지만, 서버로 사용하는 시스템이기 때문에 alsa 관련 서비스가 필요하지 않아 mask 처리하신 것으로 보여집니다. mask 처리된 서비스는 자동이던 수동이던 실행되지 않도록 설정한 것이기 때문에 dependency 확인과정에서 확인을 하지만 무시하는 것입니다.<br><br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-05-10T02:16:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MbocnIAB"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-05-09T11:14:58Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-05-09T11:14:58Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>아래와 같이 조치를 수행하였고<br>알려주신 command 실행 시 로그입니다.<br><br>1번째 command만 수행하고 접속을 해봤는데 정상적으로 바로 접속이 되었습니다.<br><br>문의드릴 점은 command 수행 시 아래와 같이 mask 처리 되어있는 alsa관련 서비스들에 대해서 dependenct를 체크하는 것 같은데<br>이유에 대해서 문의드리려고 합니다.<br><br>May  9 20:07:42 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-state.service, ignoring: Unit alsa-state.service is <br><br>masked.<br>May  9 20:07:42 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-restore.service, ignoring: Unit alsa-restore.service <br><br>is masked.<br><br>systemctl restart dbus-org.freedesktop.login1.service<br><br>systemctl restart systemd-logind.service<br>systemctl daemon-reload<br><br>1번째 command<br>May  9 20:07:42 SLPCISAL02 dbus[116575]: [system] Activating via systemd: service name='org.freedesktop.login1' unit='dbus-<br><br>org.freedesktop.login1.service'<br>May  9 20:07:42 SLPCISAL02 dbus-daemon: dbus[116575]: [system] Activating via systemd: service name='org.freedesktop.login1' <br><br>unit='dbus-org.freedesktop.login1.service'<br><br>May  9 20:07:42 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-state.service, ignoring: Unit alsa-state.service is <br><br>masked.<br>May  9 20:07:42 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-restore.service, ignoring: Unit alsa-restore.service <br><br>is masked.<br><br>May  9 20:07:43 SLPCISAL02 polkitd[43429]: Registered Authentication Agent for unix-process:52320:3114651770 (system bus name <br><br>:1.58690 [/usr/bin/pkttyagent --notify-fd 5 --fallback], object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale C)<br><br>May  9 20:07:43 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-state.service, ignoring: Unit alsa-state.service is <br><br>masked.<br>May  9 20:07:43 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-restore.service, ignoring: Unit alsa-restore.service <br><br>is masked.<br><br>May  9 20:07:43 SLPCISAL02 dbus[116575]: [system] Successfully activated service 'org.freedesktop.login1'<br>May  9 20:07:43 SLPCISAL02 dbus-daemon: dbus[116575]: [system] Successfully activated service 'org.freedesktop.login1'<br>May  9 20:07:43 SLPCISAL02 polkitd[43429]: Unregistered Authentication Agent for unix-process:52320:3114651770 (system bus name <br><br>:1.58690, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale C) (disconnected from bus)<br>May  9 20:07:43 SLPCISAL02 systemd-logind: New seat seat0.<br>May  9 20:07:43 SLPCISAL02 systemd-logind: Watching system buttons on /dev/input/event0 (Power Button)<br>May  9 20:07:43 SLPCISAL02 systemd-logind: New session 1644 of user pnm14077.<br><br>2번째 command<br>May  9 20:09:09 SLPCISAL02 polkitd[43429]: Registered Authentication Agent for unix-process:53286:3114660418 (system bus name <br><br>:1.58738 [/usr/bin/pkttyagent --notify-fd 5 --fallback], object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale C)<br>May  9 20:09:09 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-state.service, ignoring: Unit alsa-state.service is <br><br>masked.<br>May  9 20:09:09 SLPCISAL02 systemd: Cannot add dependency job for unit alsa-restore.service, ignoring: Unit alsa-restore.service <br><br>is masked.<br>May  9 20:09:09 SLPCISAL02 systemd-logind: New seat seat0.<br>May  9 20:09:09 SLPCISAL02 systemd-logind: Watching system buttons on /dev/input/event0 (Power Button)<br>May  9 20:09:09 SLPCISAL02 polkitd[43429]: Unregistered Authentication Agent for unix-process:53286:3114660418 (system bus name <br><br>:1.58738, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale C) (disconnected from bus)<br>May  9 20:09:09 SLPCISAL02 systemd-logind: New session 1644 of user pnm14077.<br><br>3번째 command<br>May  9 20:10:01 SLPCISAL02 polkitd[43429]: Registered Authentication Agent for unix-process:53816:3114665650 (system bus name <br><br>:1.58764 [/usr/bin/pkttyagent --notify-fd 5 --fallback], object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale C)<br>May  9 20:10:01 SLPCISAL02 systemd-sysv-generator[53832]: Overwriting existing symlink <br><br>/run/systemd/generator.late/netbackup.service with real service<br>May  9 20:10:02 SLPCISAL02 systemd: Configuration file /usr/lib/systemd/system/ontunev4.service is marked world-inaccessible. <br><br>This has no effect as configuration data is accessible via APIs without restrictions. Proceeding anyway.<br>May  9 20:10:02 SLPCISAL02 systemd: Configuration file /usr/lib/systemd/system/SeosManager.service is marked world-inaccessible. <br><br>This has no effect as configuration data is accessible via APIs without restrictions. Proceeding anyway.<br>May  9 20:10:02 SLPCISAL02 systemd: Configuration file /usr/lib/systemd/system/SeosKMod.service is marked world-inaccessible. <br><br>This has no effect as configuration data is accessible via APIs without restrictions. Proceeding anyway.<br>May  9 20:10:02 SLPCISAL02 polkitd[43429]: Unregistered Authentication Agent for unix-process:53816:3114665650 (system bus name <br><br>:1.58764, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale C) (disconnected from bus)<br><br>감사합니다.<br><br><publishedDate>2018-05-09T11:14:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MbkL8IAJ"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-05-09T05:52:58Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-05-09T05:52:57Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>systemd-logind 의 scope 파일과 연관이 있는 것으로 보입니다. <br>일시적으로 systemd-logind 를 재시작하여 문제를 해결할 수는 있으나 완전한 해결책은 아닙니다. <br>DDOS 공격에 대한 보안패치로 인한 부작용인것으로 알려져 있습니다.<br><br>/run/systemd/system/*.scope 파일이 몇 개정도 있는지 확인해보신 후에 다량의 파일이 보이시면 아래와 같이 cron에 등록하셔서 한번씩 지워서 증상을 완화할 수 있습니다.<br><br>* 2,14 * * * root /bin/rm -f /run/systemd/system/*.scope<br><br>이 문제와 유사한 버그질라와 systemd 이슈가 알려져 있습니다.<br><br>https://bugzilla.redhat.com/show_bug.cgi?id=1439989<br><br>systemctl list-unti-files 명령의 결과가 늦게나오고 login이 지연되는 경우에는 아래 내용을 참고하시기 바랍니다.<br><br>Leak of scope units slowing down &quot;systemctl list-unit-files&quot; and delaying logins<br>https://github.com/systemd/systemd/issues/1961<br><br>임시 해결방법은 아래와 같습니다.<br><br>1. 수동으로 파일 정리<br>abandoned sessions from systemd:<br>Delete session files<br>find /run/systemd/system -name &quot;session-*.scope&quot; -delete<br><br>Delete session directories<br>rm -rf /run/systemd/system/session*scope*<br><br>Remove the abandoned sessions<br>systemctl | grep &quot;abandoned&quot; | grep -e &quot;-[[:digit:]]&quot; | sed &quot;s/\.scope.*/.scope/&quot; | xargs systemctl stop<br><br>2. 관련 서비스 재시작으로 해소<br>systemctl restart dbus-org.freedesktop.login1.service<br>systemctl restart systemd-logind.service<br>systemctl daemon-reload<br><br>수동으로 파일을 삭제하는 방법보다는 서비스 재시작으로 해결하는 것이 좀 더 쉽고 안전해보입니다.<br>우선 관련 서비스를 재시작하고 몇 분 기다리신 후 문제가 해소되는지 확인하시기 바랍니다.<br><br>고맙습니다.<br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-05-09T05:52:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>