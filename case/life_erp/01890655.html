======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2017-07-14T14:39:19Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-08-02T10:05:12Z</b><br><b>id : 500A000000XVPt2IAH</b><br>======================<br><br><b><font size=15>
제목  : msg.PM pmtomatosx CPU (Core) 100% 점유로 인한 장애의 건
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하십니까? <br><br>기존 https://access.redhat.com/support/cases/#/case/01890369 케이스와 연결되는 문제입니다.<br><br>msg.PM 업무 시스템 내부에서 실행되는 pmtomatosx 라는 Application 에서 특정 CPU 를 점유하는 문제가 발견되었습니다.<br><br>이미 장애가 발생하여, 개발팀에서 pmtomatosx Application 에 대한 업데이트가 이뤄졌음에도 문제가 다시 발생 된 상황입니다.<br><br>추가적으로 자료를 업데이트 할 예정 이오니 유사 사례에서 어떠한 데이터를 추가로 수집하였는지 답변 부탁드립니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>strace 를 이용하여 pmtomatosx PID 를 추적한 결과 <br><br>root@PMPRAL03SL /root # strace -p 64745<br>Process 64745 attached<br>restart_syscall(&lt;... resuming interrupted call ...&gt;) = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br><br>이와 같이 나왔으며, ps 로 프로세스의 상태는 아래와 같았습니다.<br><br>msgadmin  64745 1244  3.0 27461928 23897832 pts/4 Sl 20:47 956:44 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config01.xml<br>msgadmin  64770 1158  2.8 26295988 22818496 pts/4 Sl 20:47 889:59 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config02.xml<br>msgadmin  64795 1136  2.8 26062268 22749004 pts/4 Sl 20:47 872:39 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config03.xml<br>msgadmin  64820 1128  2.6 24071452 21034428 pts/4 Sl 20:47 865:50 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config04.xml<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>아직 데이터가 충분하지 않아 예측이 쉽지 않겠지만,<br><br>ps 상 정보로 보았을 때, 문제가 되는 프로세스를 어떤 식으로 trace 해야 하는지 조언 부탁 드립니다.<br><br>(예) ; 장애 발생 시 아래 항목에 대한 모니터링 방안<br> - system call<br> - library call<br> - memory leak<br><br>또한 유사 장애가 지속적으로 일어날 수 있는 만큼 향 후 수집할 수 있는 명령어를 제시해 주시면 모니터링을 하도록 하겠습니다.<br><br>해결 기간이나 업무에 미치는 영향에 대한 정보를 제공해 주시겠습니까?<br><br>sosreport 는 dropbox.redhat.com/incoming 에 아래와 같은 파일명으로 오늘 업로드가 이미 되었으며,  vmcore 도 업로드 되었습니다.<br><br>(필요하다면 현재 장애가 발생 된 이후의 sosreport 도 추가적으로 업로드 하겠습니다.)<br><br>sosreport-PMPRAL03SL-20170713122609.tar.xz<br>sosreport-PMPRAL03SL-20170714091639.tar.xz<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Defect / Bug</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PMPRAL03SL</hostname><br><br><br><comment id="a0aA000000JvKXWIA3"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-07-17T02:14:28Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-07-17T02:14:28Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>앞선 케이스(#01890369)의 vmcore를 분석 한 결과,<br><br>현재 말씀주신것과 동일한  'pmtomatosx_u64_' 라는 프로세스에서 메모리를 많이 점유하고 있는 상태로 확인이 됩니다.<br><br><br>&lt; Top 10 메모리 사용 프로세스 &gt; <br><br>     pmtomatosx_u64_  685217196 KiB<br>                java    2492676 KiB<br>              python      63540 KiB<br>     systemd-journal      45368 KiB<br>                sshd      40472 KiB<br>              hpsmhd      33564 KiB<br>               httpd      30016 KiB<br>                bash      27040 KiB<br>            rsyslogd      26768 KiB<br>             nbdisco      22552 KiB<br><br><br>                 PAGES        TOTAL      PERCENTAGE<br>    TOTAL MEM  197995539     755.3 GB         ----<br>         FREE  1126488       4.3 GB    0% of TOTAL MEM<br>         USED  196869051       751 GB   99% of TOTAL MEM<br>       SHARED  1431355       5.5 GB    0% of TOTAL MEM<br>      BUFFERS    14322      55.9 MB    0% of TOTAL MEM<br>       CACHED  21629386      82.5 GB   10% of TOTAL MEM<br>         SLAB   729253       2.8 GB    0% of TOTAL MEM<br>======================<br>해당 프로세스가 정상적으로 메모리를 점유하고 있는지 여부는 vmcore를 가지고는 확인이 어렵습니다. application에서 확인을 해주셔야 할 부분인거 같습니다.<br><br><br>일반적으로 메모리의 Leak 여부등을 확인하기 위해서는 Valgrind라는 툴이 있습니다. 아마도 Application vendor에서 더 좋은 툴을 가지고 있으리라 판단되나, 참고로 안내드립니다.<br><br>결론적으로 시스템에서의 특별한 이상점은 발견되지 않았습니다.<br>======================<br>업무에 참고하여 주시기 바랍니다.<br>======================<br>감사합니다.<br><br><publishedDate>2017-07-17T02:14:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JvKLZIA3"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-07-17T01:30:20Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-07-17T01:30:20Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>현재 케이스(#01890369)의 vmcore가 분석중임에 따라 해당 분석을 완료 한 후, 본 케이스에 대한 답변을 드릴 수 있도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2017-07-17T01:30:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JvK8pIAF"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2017-07-17T00:46:52Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2017-07-17T00:46:52Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>문의주신 내용을 확인후, 업데이트 드리겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2017-07-17T00:46:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>기존 https://access.redhat.com/support/cases/#/case/01890369 케이스와 연결되는 문제입니다.<br><br>msg.PM 업무 시스템 내부에서 실행되는 pmtomatosx 라는 Application 에서 특정 CPU 를 점유하는 문제가 발견되었습니다.<br><br>이미 장애가 발생하여, 개발팀에서 pmtomatosx Application 에 대한 업데이트가 이뤄졌음에도 문제가 다시 발생 된 상황입니다.<br><br>추가적으로 자료를 업데이트 할 예정 이오니 유사 사례에서 어떠한 데이터를 추가로 수집하였는지 답변 부탁드립니다.</issue><environment>strace 를 이용하여 pmtomatosx PID 를 추적한 결과 <br><br>root@PMPRAL03SL /root # strace -p 64745<br>Process 64745 attached<br>restart_syscall(&lt;... resuming interrupted call ...&gt;) = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br>rt_sigprocmask(SIG_BLOCK, [CHLD], [], 8) = 0<br>rt_sigaction(SIGCHLD, NULL, {SIG_DFL, [], 0}, 8) = 0<br>rt_sigprocmask(SIG_SETMASK, [], NULL, 8) = 0<br>nanosleep({5, 0}, 0x7ffd3057afb0)       = 0<br><br>이와 같이 나왔으며, ps 로 프로세스의 상태는 아래와 같았습니다.<br><br>msgadmin  64745 1244  3.0 27461928 23897832 pts/4 Sl 20:47 956:44 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config01.xml<br>msgadmin  64770 1158  2.8 26295988 22818496 pts/4 Sl 20:47 889:59 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config02.xml<br>msgadmin  64795 1136  2.8 26062268 22749004 pts/4 Sl 20:47 872:39 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config03.xml<br>msgadmin  64820 1128  2.6 24071452 21034428 pts/4 Sl 20:47 865:50 /msg/pmtomatosx_u64_rhel5 /msg/config/R18config04.xml</environment><periodicityOfIssue>아직 데이터가 충분하지 않아 예측이 쉽지 않겠지만,<br><br>ps 상 정보로 보았을 때, 문제가 되는 프로세스를 어떤 식으로 trace 해야 하는지 조언 부탁 드립니다.<br><br>(예) ; 장애 발생 시 아래 항목에 대한 모니터링 방안<br> - system call<br> - library call<br> - memory leak<br><br>또한 유사 장애가 지속적으로 일어날 수 있는 만큼 향 후 수집할 수 있는 명령어를 제시해 주시면 모니터링을 하도록 하겠습니다.</periodicityOfIssue><timeFramesAndUrgency>sosreport 는 dropbox.redhat.com/incoming 에 아래와 같은 파일명으로 오늘 업로드가 이미 되었으며,  vmcore 도 업로드 되었습니다.<br><br>(필요하다면 현재 장애가 발생 된 이후의 sosreport 도 추가적으로 업로드 하겠습니다.)<br><br>sosreport-PMPRAL03SL-20170713122609.tar.xz<br>sosreport-PMPRAL03SL-20170714091639.tar.xz<br><br>감사합니다.</timeFramesAndUrgency><cep>false</cep></case>