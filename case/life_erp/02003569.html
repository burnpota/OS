======================<br><b>생성계정 : jimin kim</b><br><b>생성날짜 : 2018-01-04T06:29:41Z</b><br><b>마지막 답변자 : Jake Jaewook Shin</b><br><b>마지막 수정 일자 : 2018-01-24T00:47:09Z</b><br><b>id : 500A000000ZPI84IAH</b><br>======================<br><br><b><font size=15>
제목  : Redhat cluster 구성된 서버의 NTP 동기화 문제로 시간 차이가 발생했을 경우 조치 방법에 대해서 문의드립니다.
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>redhat cluster 구성된 FLPTRSD01 / FLPTRSD02 서버의 시간이 현재 다른 상황인데요.<br><br>FLPTRSD01서버가 조금 느린 상황입니다. (FLPTRSD02 정상)<br><br>cluster가 가동된 상태에서 FLPTRSD01 서버의 시간을 정상적으로 맞추는 것이 가능한지 문의드리려고 합니다.<br><br>현재 상황은 아래와 같습니다.<br><br>root@FLPTRSD01 /root # clustat<br>Cluster Status for cl_TRSD @ Thu Jan  4 11:40:54 2018<br>Member Status: Quorate<br><br> Member Name                                                     ID   Status<br> ------ ----                                                     ---- ------<br> flptrsd01.cs                                                        1 Online, Local, rgmanager<br> flptrsd02.cs                                                        2 Online, rgmanager<br><br> Service Name                                                   Owner (Last)                                                   State<br> ------- ----                                                   ----- ------                                                   -----<br> service:svc_PJSA                                               flptrsd02.cs                                                   started<br> service:svc_TRSD                                               flptrsd01.cs                                                   started<br>root@FLPTRSD01 /root # clustat -l<br>Cluster Status for cl_TRSD @ Thu Jan  4 11:40:59 2018<br>Member Status: Quorate<br><br> Member Name                                                     ID   Status<br> ------ ----                                                     ---- ------<br> flptrsd01.cs                                                        1 Online, Local, rgmanager<br> flptrsd02.cs                                                        2 Online, rgmanager<br><br>Service Information<br>------- -----------<br><br>Service Name      : service:svc_PJSA<br>  Current State   : started (112)<br>  Flags           : none (0)<br>  Owner           : flptrsd02.cs<br>  Last Owner      : flptrsd01.cs<br>  Last Transition : Sun Jul  2 11:37:31 2017<br><br>Service Name      : service:svc_TRSD<br>  Current State   : started (112)<br>  Flags           : none (0)<br>  Owner           : flptrsd01.cs<br>  Last Owner      : flptrsd02.cs<br>  Last Transition : Sun Jul  2 12:02:01 2017<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.4</b><br><b>타입  : Other</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>FLPTRSD01 / FLPTRSD02</hostname><br><br><br><comment id="a0aA000000LX3hhIAD"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-24T00:47:06Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-24T00:47:06Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>마지막 안내 이후 관련하여 추가 문의하신 내용없이 일정 시간이 경과되었으므로<br>이상으로 close 처리하도록 하겠습니다.<br><br>케이스가 처리 완료되면 고객 설문조사 메일이 발송됩니다.<br>고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해,<br>소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-24T00:47:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LMrWaIAL"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-16T09:02:15Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-16T09:02:15Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>현재 해당 케이스의 상황이 어떠신지 확인 부탁드립니다.<br>일정시간 업데이트가 없으실 경우, 해당 케이스는 자동으로 close 처리 될 것입니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-16T09:02:15Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LL3GaIAL"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-08T13:42:46Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-08T13:42:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>업무에 도움이 되시도록 제가 정리한바를 남겨드립니다.<br><br>drift 의 단위는 PPM(Parts-per-Million) 입니다.<br><br>1PPM 은 100만분의 1초의 오차가 발생함을 나타내며,<br>예를 들어 100 PPM 이면 1일(86,400초) 에서 8.64 초의 오차를 나타낼 것입니다.<br>ntpd 는 사용되고 있는 메인보드의 클럭소스가 이정도의 오차를 가지고 있음을 drift 파일에<br>기록 및 인식하므로 해당 오차를 고려하여 시간정보를 유지할 수 있습니다.<br><br>즉, ntpq -p 에서 출력되는 단순 시간차에 의한 offset 이라기보다는<br>메인보드의 클럭소스가 NTP 서버의 정보와 비교해서 *시각이 흐르는데* 있어<br>어느정도 오차정보를 가지고 있느냐는 정보입니다.<br>클럭소스의 정밀도는 사람의 지문같이 메인보드마다 약간의 차이(상기로보면 100만분의 1초단위)가 있을 수 있습니다.<br><br>제품 메뉴얼에서는 주파수(frequency) offset 으로 설명하고 있습니다.<br><br>22.4. Understanding the Drift File<br>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/s1-understanding_the_drift_file<br><br>감사합니다.<br><br><publishedDate>2018-01-08T13:42:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LL29dIAD"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-01-08T12:20:31Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-01-08T12:20:31Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>알려주신 방법으로 확인하였을 때 아래와 같은 값이 나오는데 혹시 이 단위는 초 단위인지 문의드립니다.<br><br>root@FLPTRSD01 /root # cat /var/lib/ntp/drift<br>16.807<br><br>root@FLPTRSD01 /root # ntpq -p<br>     remote           refid      st t when poll reach   delay   offset  jitter<br>==============================================================================<br>+PNTPML01SL      .GPS.            1 u  105  256  377    0.597   -1.637   0.079<br>*PNTPML02SL      .GPS.            1 u  188  256  377    0.592   -1.586   0.047<br><br>감사합니다.<br><br><publishedDate>2018-01-08T12:20:31Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LKz4rIAD"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-01-08T08:09:27Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-01-08T08:09:26Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>빠른 답변 감사드리니다.<br><br><publishedDate>2018-01-08T08:09:26Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LKz0fIAD"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-08T08:01:52Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-08T08:01:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>메인보드에 따라 클럭소스가 가진 정밀도에 약간의 오차가 있을 수 있습니다.<br>ntpd 는 자신이 가진 클럭소스와 ntp 서버의 시각 값을 비교해서 그 오차 범위를<br>/var/lib/ntpd/drift 에 기록해둡니다.<br><br>ntpd 서비스를 재시작 할 때, 기존에 저장되어있는 해당 오차범위가 방해가 되서 오히려 시각 동기화를 방해하는 경우가 있기에<br>해당 파일을 지우거나 초기화하여 ntpd 재시작하는 것입니다.<br>지운다고 하더라도 drift 파일은 ntpd 에 의해 재생성됩니다. <br><br>감사합니다.<br><br><publishedDate>2018-01-08T08:01:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LKyu3IAD"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-01-08T07:49:30Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-01-08T07:49:30Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>답변 감사드립니다.<br><br>한가지 문의드릴 점은 ntp 동기화 과정 중에서 아래 과정이 어떤 의미인지 한번 문의드리려고 합니다.<br><br># mv /var/lib/ntp/drift /var/lib/ntp/drift.bak<br>또는<br># rm /var/lib/ntp/drift<br>또는<br># echo -n &quot;0&quot; &gt; /var/lib/ntp/drift<br><br><publishedDate>2018-01-08T07:49:30Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LKxuHIAT"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-08T05:51:41Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-08T05:51:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>확인결과,<br>안전한 시각 동기화를 위해서는 유지보수 계획을 통해 양 노드의 클러스터를 내리고<br>ntp 서버에 동기화를 한 후, 다시 올리는 방법이 가장 안정적인 방법으로 보입니다.<br><br>클러스터를 정지하는 방법과 관련해서는 다음 메뉴얼을 참조하시고,<br><br>https://access.redhat.com/documentation/ko-kr/red_hat_enterprise_linux/6/html-single/cluster_administration/#s2-admin-start-cli-CA<br><br>ntp 동기화와 관련해서는 다음 내용을 참고하시기 바랍니다.<br><br>=======================================================<br># service ntpd stop<br><br># mv /var/lib/ntp/drift /var/lib/ntp/drift.bak<br>또는<br># rm /var/lib/ntp/drift<br>또는<br># echo -n &quot;0&quot; &gt; /var/lib/ntp/drift<br><br># ntpdate &lt;상위 ntp 서버 아이피&gt;<br><br># service ntpd start<br>=======================================================<br><br>관련 문의사항이 있으실 경우 커멘트 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-08T05:51:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LKeL6IAL"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-05T07:55:20Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-05T07:55:20Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>현재 내부적으로 확인중에 있습니다.<br>다시 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-05T07:55:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LKMpiIAH"><br>======================<br><b>생성계정 : kim, jimin</b><br><b>생성날짜 : 2018-01-04T07:56:08Z</b><br><b>마지막 답변자 : kim, jimin</b><br><b>마지막 수정 일자 : 2018-01-04T07:56:08Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>아래는 두 서버에서 broadcast command로 date를 수행한 내역이고 sosreport도 지금 수집해서 바로 dropbox에 upload하겠습니다. <br><br>root@FLPTRSD01 /root # date<br>Thu Jan  4 14:36:32 KST 2018<br>root@FLPTRSD01 /root #<br><br>root@FLPTRSD02 /root # date<br>Thu Jan  4 16:55:00 KST 2018<br>root@FLPTRSD02 /root #<br><br><publishedDate>2018-01-04T07:56:08Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LKMncIAH"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-04T07:52:14Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-04T07:53:11Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>상황을 보다 명확하게 하기 위해 두가지 요청 드립니다.<br>조금 느리다고 언급하신 부분에 대해 어느 정도느린 것인지 작업 로그나 보다 자세한 설명 등 연계 부탁드립니다.<br>또한, 가능하시면 버젼, ntp 상황 등을 확인하기 위해 두 시스템의 sosreports 가 업로드 가능하신지 확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-04T07:52:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LKMdDIAX"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-01-04T07:27:55Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-01-04T07:27:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>저는 신재욱 차장이라고 하며 앞으로 해당 케이스를 담당하게 되었습니다.<br><br>현재 케이스 내용을 살펴보는 중이며, 관련하여 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-04T07:27:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>