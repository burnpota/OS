======================<br><b>생성계정 : 삼성생명 타임게이트</b><br><b>생성날짜 : 2017-08-08T05:29:46Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2017-08-25T10:11:47Z</b><br><b>id : 500A000000Y5eDTIAZ</b><br>======================<br><br><b><font size=15>
제목  : secondary ip 통신 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요. <br>bond0 에 A ip 와  bond0:0 B ip 가 있는데 <br>B 의 Source IP Address 만을 통해서 통신을 하고 싶습니다.<br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 3 (Normal)</b><br><hostname>DMPRAL05SL</hostname><br><br><br><comment id="a0aA000000K8YJZIA3"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-08-09T09:42:55Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-08-10T01:12:58Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>저의 테스트환경에서 테스트한 바로는 소스 아이피가 secondary IP 로 통신이 되는 것을 확인하였습니다.<br><br>테스트 절차:<br>target ---&gt; &lt;192.168.122.65&gt;<br>source ---&gt; &lt;192.168.122.72&gt; ,secondary IP :&lt;192.168.122.200&gt; (hostname:rhel7u2)<br><br>1) /etc/sysconfig/network 파일에 아래와 같이 추가.<br>[root@rhel7u2 ~]# vim /etc/sysconfig/network <br>ip route change 0.0.0.0/0 via 192.168.122.1 src 192.168.122.200 dev team0<br><br>2) 새 라우팅 정보를 적용.<br>[root@rhel7u2 ~]# systemctl restart network<br><br>3) ip r 커멘드로 src 아이피가 추가됨을 확인. <br>[root@rhel7u2 ~]# ip r<br>default via 192.168.122.1 dev team0  src 192.168.122.200  &lt;------ <br>default via 192.168.122.1 dev team0  proto static  metric 350 <br>192.168.122.0/24 dev team0  proto kernel  scope link  src 192.168.122.72  metric 350 <br><br>4) 타겟 호스트쪽으로 ping 테스트를 진행<br>[root@rhel7u2 ~]# ping 192.168.122.65 <br><br>5) target host 에서 tcpdump 확인:<br>18:04:40.119172 IP 192.168.122.200 &gt; 192.168.122.65: ICMP echo request, id 13824, seq 23, length 64<br>18:04:40.119240 IP 192.168.122.65 &gt; 192.168.122.200: ICMP echo reply, id 13824, seq 23, length 64<br><br>혹시 상기의 절차대로 다시 한번 테스트하실수 있는지요? <br>그리고 /etc/sysconfig/network 파일의 via &lt;gateway&gt; 부분을 <br>target IP 가 아닌 게이트웨이 IP로 설정하시는 것을 권장드립니다.<br><br>추가적으로 firewalld로도 source IP 를 정하실수 있습니다.<br>추가방법:<br># firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -d 0.0.0.0 -o &lt;interface&gt; -j SNAT --to-source &lt;secondary_IP&gt;<br># firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -d 0.0.0.0 -o &lt;interface&gt; -j SNAT --to-source &lt;secondary_IP&gt; --permanent &lt;---영구적으로 추가<br><br>삭제방법:<br># firewall-cmd --direct --remove-rule ipv4 nat POSTROUTING 0 -d 0.0.0.0 -o &lt;interface&gt; -j SNAT --to-source &lt;secondary_IP&gt;<br># firewall-cmd --direct --remove-rule ipv4 nat POSTROUTING 0 -d 0.0.0.0 -o &lt;interface&gt; -j SNAT --to-source &lt;secondary_IP&gt; --permanent  <br><br>감사합니다.<br><br><publishedDate>2017-08-09T09:42:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000K8W2xIAF"><br>======================<br><b>생성계정 : 타임게이트, 삼성생명</b><br><b>생성날짜 : 2017-08-09T06:18:06Z</b><br><b>마지막 답변자 : 타임게이트, 삼성생명</b><br><b>마지막 수정 일자 : 2017-08-09T06:18:06Z</b><br><br>다시 질문 드립니다.<br>구성은 아래와 같습니다.<br>target ---&gt; 192.168.101.10<br>source ---&gt; 192.168.101.11 (192.168.101.12로 하고 싶음)<br><br>eth0 인터페이스가 있을경우 <br>ifcfg-eth0의 설정을 아래와 같이 하였습니다. <br>이럴때 192.168.101.11이 아닌 192.168.101.12가 Source ip가 되어 통신을 하고자 합니다.<br>말씀 주신대로(ip route change 0.0.0.0/0 via 192.168.101.10 src 192.168.101.12 dev eth0) 하여 <br>target측에서 tcpdump -i eth0 host 192.168.101.12를 하면 소스 아이피가 보이지 않고<br>tcpdump -i eth0 host 192.168.101.11로 하였을 경우 소스아이피(192.168.101.11)가 보입니다.<br><br>&lt;&lt;&lt; /etc/sysconfig/network 내용 &gt;&gt;&gt;<br>ip route change 0.0.0.0/0 via 192.168.101.10 src 192.168.101.12 dev eth0<br> <br>&lt;&lt; ifcfg-eth0 설정 &gt;&gt;<br>TYPE=Ethernet<br>BOOTPROTO=none<br>NAME=eth0<br>DEVICE=eth0<br>IPADDR0=192.168.101.11<br>NETMASK0=255.255.255.0<br>IPADDR1=192.168.101.12<br>NETMASK1=255.255.255.0<br>ONBOOT=yes<br><br>확인 부탁드립니다.<br><br><publishedDate>2017-08-09T06:18:06Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000K8GWnIAN"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-08-08T07:55:51Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-08-09T00:49:39Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>alias ip를 통해 통신 하시려면 route table에서 bond0의 source ip를 변경 하시면 됩니다.<br>network가 재기동 되어도 유효하도록 설정하시려면 /etc/sysconfig/network에 아래와 같이 써넣으시면 됩니다.<br><br>ip route change 0.0.0.0/0 via &lt;gateway&gt; src &lt;alias_ip&gt; dev bond0\:0<br><br>예: bond0에 alias ip(192.168.122.100/24)를 아래와 같이 추가 하였습니다.<br>#ip a<br>bond0: &lt;BROADCAST,MULTICAST,MASTER,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP <br>    link/ether 52:54:00:e9:7e:63 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.122.73/24 brd 192.168.122.255 scope global bond0<br>       valid_lft forever preferred_lft forever<br>    inet 192.168.122.100/24 brd 192.168.122.255 scope global secondary bond0:0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::5054:ff:fee9:7e63/64 scope link tentative dadfailed <br>       valid_lft forever preferred_lft forever<br><br># ifconfig bond0:0<br>bond0:0: flags=5187&lt;UP,BROADCAST,RUNNING,MASTER,MULTICAST&gt;  mtu 1500<br>        inet 192.168.122.100  netmask 255.255.255.0  broadcast 192.168.122.255<br>        ether 52:54:00:e9:7e:63  txqueuelen 0  (Ethernet)<br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><br># vim /etc/sysconfig/network<br><br>ip route change 0.0.0.0/0 via 192.168.122.1 src 192.168.122.100 dev bond0\:0 &lt;----추가 <br><br>~~~~~~~~~~~~~~~~~~~~~~~~<br>#systemctl restart network<br># ip r<br><br>default via 192.168.122.1 dev bond0  src 192.168.122.100  &lt;---source IP 가 alias IP로 설정됨.<br>&lt;..&gt;<br>~~~~~~~~~~~~~~~~~~~~~~~~~<br><br>감사합니다.<br><br><publishedDate>2017-08-08T07:55:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>