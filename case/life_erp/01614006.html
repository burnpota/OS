======================<br><b>생성계정 : 우택 심</b><br><b>생성날짜 : 2016-04-08T01:44:20Z</b><br><b>마지막 답변자 : Jake Jaewook Shin</b><br><b>마지막 수정 일자 : 2017-09-18T11:55:04Z</b><br><b>id : 500A000000U7adIIAR</b><br>======================<br><br><b><font size=15>
제목  : TCP Backlog 관련 문의 (net.ipv4.tcp_max_syn_backlog)
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br><br>최근 운영계 커널 파라미터 설정 중 아래와 같이 추가 반영된 부분이 있습니다.<br><br>net.core.somaxconn = 8192<br>net.ipv4.tcp_max_syn_backlog = 8192<br><br>이 중 net.ipv4.tcp_max_syn_backlog 파라미터의 역할은 TCP 동시 연결 요청이 많아 질 때 사용되는 Backlog 로 알고 있습니다.<br><br>솔라리스의 경우 Backlog 의  25%  가량 사용되면 Syn Flood Protection Mode 가 작동한다고 하는데요,<br><br>비슷한 기능이 RHEL TCP 환경에서도 제공되는지 궁금하며,<br><br>만약 있다면 어느 비율에 도달 했을 때 작동하는지 그리고 Protection 작동 메커니즘에 대한 간략한 설명/확인 부탁 드립니다.<br><br>그리고 아래 과거 사례를 보시면 성능저하 문제점도 타 시스템에서 발견되어 RHEL 에서도 성능과 관련된 문제점에 대한 확인 부탁드립니다.<br><br>감사합니다.<br><br>===============================================<br><br>- 사례<br><br> . OS : solaris<br><br> . 대기큐 적재건이 syn flood 임계치 1/4 초과후 , 외부 공격으로 판단하여  Syn flood Protection 모드로 변경됨<br><br>  ※ 해당 모드에서 접속자 IP 주소관리 저장소를 별도로 생성하여 IP 비교기능을 수행하면서 성능저하 유발함 <br><br>     대기큐 적재건당 최대 19회(3분간) TCP retransmission 수행 (추가적인 성능저하 유발)<br><br>  .관련파라미터 :  tcp_conn_req_max_q0 (incomplete TCP 요청 저장 큐), default 1,024<br><br>===============================================<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 5251314</b><br><b>심각도  : 4 (Low)</b><br>======================<br><comment id="a0aA000000GpSMRIA3"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-04-08T08:34:22Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-04-08T08:57:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>문의하신 내용에 대하여 안내를 드리면 다음과 같습니다.<br><br>우선 다음 링크가 문의하신 내용에 대한 답변이 될 것으로 보입니다.<br><br>What is the message &quot;kernel: possible SYN flooding on port X. Sending cookies&quot;? <br>- https://access.redhat.com/solutions/30453<br><br>상기에도 나와 있듯이,<br>리눅스의 경우, tcp_syncookies 파라메터가 활성화되어 syn cookies 를 보내는데는 somaxconn 즉 리슨 백로그(리슨큐)가<br>영향을 미칩니다.<br><br>해당 링크의 마지막 문장도 이를 명기하고 있습니다.<br><br>So if a socket's listen queue is full, and more SYNs arrive for that socket, then we either send SYN cookies. If SYN cookies are disabled then we drop the incoming traffic.<br><br>만약 소캣의 리슨큐가 가득차고 해당 소켓에 대해 추가적인 SYN 패킷이 도달하면, 리눅스는 SYN 쿠키를 보낼 것입니다.<br>만약 SYN 쿠키 기능을 비활성화한다면 수신 트래픽을 드랍할 것입니다.<br><br>각 파라메터에 대해서 다시 안내드리면,<br><br>tcp_max_syn_backlog 는 아직 커넥팅을 시도하려는 클라이언트로부터 ack 를 받지 못한<br>커넥션 요구가 큐잉 될 수 있는 최대 숫자 값입니다.<br><br>somaxconn 은 어플리케이션의 리슨큐(리슨 백로그)를 제한하는 파라미터이며<br>사용하시는 어플리케이션의 설정에 의해 overwrite 될 수 있으며, 그때는 somaxconn 이 어플리케이션에서 설정가능한<br>제한값으로 동작할 것입니다.<br><br>솔라리스의 tcp_conn_req_max_q0 의 경우는 tcp_max_syn_backlog 와 유사해보입니다.<br>다만 OS 가 다르므로 명확히 같다라고 말씀드리기는 어렵습니다.<br><br>감사합니다.<br><br><publishedDate>2016-04-08T08:34:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GpRAiIAN"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2016-04-08T06:08:18Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2016-04-08T06:08:18Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>저는 신재욱이라고 하며 앞으로 이 케이스를 담당하게 되었습니다.<br><br>현재 이 케이스의 내용을 살펴보는 중이며, 관련하여 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-04-08T06:08:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>최근 운영계 커널 파라미터 설정 중 아래와 같이 추가 반영된 부분이 있습니다.<br><br>net.core.somaxconn = 8192<br>net.ipv4.tcp_max_syn_backlog = 8192<br><br>이 중 net.ipv4.tcp_max_syn_backlog 파라미터의 역할은 TCP 동시 연결 요청이 많아 질 때 사용되는 Backlog 로 알고 있습니다.<br><br>솔라리스의 경우 Backlog 의  25%  가량 사용되면 Syn Flood Protection Mode 가 작동한다고 하는데요,<br><br>비슷한 기능이 RHEL TCP 환경에서도 제공되는지 궁금하며,<br><br>만약 있다면 어느 비율에 도달 했을 때 작동하는지 그리고 Protection 작동 메커니즘에 대한 간략한 설명/확인 부탁 드립니다.<br><br>그리고 아래 과거 사례를 보시면 성능저하 문제점도 타 시스템에서 발견되어 RHEL 에서도 성능과 관련된 문제점에 대한 확인 부탁드립니다.<br><br>감사합니다.<br><br>===============================================<br><br>- 사례<br><br> . OS : solaris<br><br> . 대기큐 적재건이 syn flood 임계치 1/4 초과후 , 외부 공격으로 판단하여  Syn flood Protection 모드로 변경됨<br><br>  ※ 해당 모드에서 접속자 IP 주소관리 저장소를 별도로 생성하여 IP 비교기능을 수행하면서 성능저하 유발함 <br><br>     대기큐 적재건당 최대 19회(3분간) TCP retransmission 수행 (추가적인 성능저하 유발)<br><br>  .관련파라미터 :  tcp_conn_req_max_q0 (incomplete TCP 요청 저장 큐), default 1,024<br><br>===============================================</issue><cep>false</cep></case>