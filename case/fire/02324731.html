======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2019-02-26T01:44:13Z</b><br><b>마지막 답변자 : support os</b><br><b>마지막 수정 일자 : 2019-02-27T00:54:21Z</b><br><b>id : 5002K00000dHrkYQAS</b><br>======================<br><br><b><font size=15>
제목  : nfs 순단 현상 발생 이슈
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br>지난 22일 18시 48분경부터 간헐적으로 nfs가 순단되는 현상이 발생하였습니다.<br>nfs 순단 발생 이전에는 tomato라는 프로세스에서 hung task INFO 메세지가 발생하였습니다.<br><br>&lt;&lt; 시스템로그 &gt;&gt;<br>Feb 22 18:48:23 mpralp26 kernel: INFO: task pmtomatosx_u64_:58227 blocked for more than 120 seconds.<br>Feb 22 18:48:23 mpralp26 kernel: &quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot; disables this message.<br>Feb 22 18:48:23 mpralp26 kernel: pmtomatosx_u64_ D ffffffff816a75f0     0 58227      1 0x00000000<br>Feb 22 18:48:23 mpralp26 kernel: ffff88f5a0247bd0 0000000000000086 ffff88f3f6f98000 ffff88f5a0247fd8<br>Feb 22 18:48:23 mpralp26 kernel: ffff88f5a0247fd8 ffff88f5a0247fd8 ffff88f3f6f98000 ffff88fc79056cc0<br>Feb 22 18:48:23 mpralp26 kernel: 0000000000000000 7fffffffffffffff ffff89007ff624e8 ffffffff816a75f0<br>Feb 22 18:48:23 mpralp26 kernel: Call Trace:<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a75f0&gt;] ? bit_wait+0x50/0x50<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a94c9&gt;] schedule+0x29/0x70<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a6fd9&gt;] schedule_timeout+0x239/0x2c0<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffffc0147776&gt;] ? rpc_run_task+0xf6/0x150 [sunrpc]<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff810e939c&gt;] ? ktime_get_ts64+0x4c/0xf0<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff8113d36f&gt;] ? delayacct_end+0x8f/0xb0<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff810e939c&gt;] ? ktime_get_ts64+0x4c/0xf0<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a75f0&gt;] ? bit_wait+0x50/0x50<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a8b4d&gt;] io_schedule_timeout+0xad/0x130<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a8be8&gt;] io_schedule+0x18/0x20<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a7601&gt;] bit_wait_io+0x11/0x50<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816a7125&gt;] __wait_on_bit+0x65/0x90<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff81181cb1&gt;] wait_on_page_bit+0x81/0xa0<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff810b19d0&gt;] ? wake_bit_function+0x40/0x40<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff81181de1&gt;] __filemap_fdatawait_range+0x111/0x190<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff81181e74&gt;] filemap_fdatawait_range+0x14/0x30<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff81183db6&gt;] filemap_write_and_wait_range+0x56/0x90<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffffc0a54506&gt;] nfs_file_fsync+0x86/0x110 [nfs]<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff812332bb&gt;] vfs_fsync+0x2b/0x40<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffffc0a54946&gt;] nfs_file_flush+0x46/0x60 [nfs]<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff811fe314&gt;] filp_close+0x34/0x80<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff81220278&gt;] __close_fd+0x78/0xa0<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff811ffd83&gt;] SyS_close+0x23/0x50<br>Feb 22 18:48:23 mpralp26 kernel: [&lt;ffffffff816b4fc9&gt;] system_call_fastpath+0x16/0x1b<br>Feb 22 18:48:49 mpralp26 kernel: nfs: server nasalp01 not responding, still trying<br>Feb 22 18:48:50 mpralp26 kernel: nfs: server nasalp01 not responding, still trying<br>Feb 22 18:48:50 mpralp26 kernel: nfs: server nasalp01 OK<br>Feb 22 18:48:50 mpralp26 kernel: nfs: server nasalp01 OK<br>====== 중 략 ======<br>Feb 25 15:05:16 mpralp26 kernel: nfs: server nasalp01 not responding, still trying<br>Feb 25 15:12:49 mpralp26 kernel: nfs: server nasalp01 OK<br>Feb 25 15:24:45 mpralp26 kernel: nfs: server nasalp01 not responding, still trying<br>Feb 25 15:27:30 mpralp26 kernel: nfs: server nasalp01 OK<br>Feb 25 15:33:05 mpralp26 kernel: nfs: server nasalp01 not responding, still trying<br>Feb 25 15:33:06 mpralp26 kernel: nfs: server nasalp01 not responding, still trying<br>Feb 25 15:33:07 mpralp26 kernel: nfs: server nasalp01 OK<br>Feb 25 15:33:07 mpralp26 kernel: nfs: server nasalp01 OK<br><br>이 현상은 고객 측으로 부터 sosreport 를 받은 25일 오후까지 지속되었습니다.<br>어떠한 원인으로 해당 현상이 발생하는지 분석 부탁드립니다.<br><br>해당 호스트 sosreport와 22일부터 25일까지의 sar파일 첨부해드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><hostname>mpralp26</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0a2K00000PPwN9QAL"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2019-02-26T05:47:54Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2019-02-26T06:01:06Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저는 Platform Support 를 담당하고 있는 Senior Technical Support Engineer 황 영 입니다.<br><br>올려주신 sosreport 살펴보았지만 원인이 될 기타 로그가 확인이 되지 않고 있습니다.<br>이와 같은 경우에는 이슈 발생시 패킷 캡쳐가 필요합니다.<br>이슈 재현이 된다면 패킷을 캡쳐하셔서 케이스에 업로드 부탁 드립니다.<br><br># tcpdump -s 1024 -i &lt;interface&gt; -w /tmp/nfsclient.pcap<br><br>또한 제가 시스템 버전에 따라 기존 사례를 확인해본바에 의하면 아래와 같은 NFS 관련 버그가 있으며<br>커널 버전을 kernel-3.10.0-862.el7 올리시면 이슈가 해소되는 것으로 확인됩니다.<br>가능하시다면 커널 업데이트 시 이슈가 해소 되는지 확인 부탁 드립니다.<br><br>참고문서:<br>[1] RHEL7.4: NFS mount to DELL/EMC Isilon servers fails with 'permission denied' due to NFS server duplicate response to single EXCHANGE_ID causes mount.nfs to fail auto-negotiation <br>https://access.redhat.com/solutions/3144151<br><br>[2] RHEL7.4: NFS client sends two CLOSE operations for the same stateid resulting in a bad sequence-id (NFS4ERR_BAD_SEQID) error reply from the NFS server <br>https://access.redhat.com/solutions/3354251<br><br>[3] RHEL7.4: Linux NFS server's DRC memory limits can cause NFS client mount command hangs with repeated CREATE_SESSION / NFS4ERR_DELAY <br>https://access.redhat.com/solutions/3146191 <br><br>감사합니다.<br><br><publishedDate>2019-02-26T05:47:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PPwUtQAL"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2019-02-26T05:59:47Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2019-02-26T05:59:47Z</b><br><br>안녕하세요,<br>해당 케이스는 한국시간으로 10:44 경 작성되었습니다.<br>고객 담당자 정보 보내드립니다.<br><br>감사합니다.<br><br><br>===============<br>* 고객 담당자 정보 (필수) - 실제 서브스크립션을 보유하고 계신 앤드 유저<br>- 성함(직급) : 김성훈(선임)<br>- 회사명(부서명) : 삼성SDS(금융시스템그룹)<br>- 전화번호 : 010-5069-8084<br>- 메일주소 : sh1221.kim@samsung.com<br><br>* 파트너사/유지보수 업체 담당자 정보<br>- 성함(직급) : 이인식(사원)<br>- 회사명(부서명) : 타임게이트(오픈소스솔루션팀)<br>- 전화번호 : 010-4043-3211<br>- 메일주소 : is.lee@time-gate.com<br>===============<br><br><publishedDate>2019-02-26T05:59:47Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PPwC0QAL"><br>======================<br><b>생성계정 : Patil, Anshuman</b><br><b>생성날짜 : 2019-02-26T05:35:10Z</b><br><b>마지막 답변자 : Patil, Anshuman</b><br><b>마지막 수정 일자 : 2019-02-26T05:35:10Z</b><br><br>안녕하세요,<br><br> <br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br> <br><br>고객님의 계약 사항과 문제 심각도에 따라서 본 기술 문의는 한국 업무 시간에 지원됨을 안내해드립니다.<br><br>한국 업무 시간 : 월 - 금, 오전 9시 - 오후 5시<br><br> <br><br>아래 제품 지원 서비스 수준 계약을 참고하시기 바랍니다.<br><br> <br><br>&lt; 제품 지원 서비스 수준 계약 &gt;<br><br>https://access.redhat.com/ko/support/offerings/production/sla<br><br> <br><br>&lt; 레드햇 지원 심각도 정의 &gt;<br><br>https://access.redhat.com/ko/support/policy/severity<br><br> <br><br>감사합니다.<br><br> <br><br> <br><br>Dear Customer,<br><br> <br><br>My name is Anshuman.<br><br>Thank you for contacting Red Hat Global Support Services.<br><br>Your case will be responded by our support representative in business hours depending upon your contract type and severity.<br><br> <br><br>Please refer the following links for our service level agreement.<br><br>＜ Service Level Agreement＞<br><br>https://access.redhat.com/ko/support/offerings/production/sla<br><br>＜ Red Hat Severity Definition ＞<br><br>https://access.redhat.com/ko/support/policy/severity<br><br> <br><br>Kind Regards,<br><br>Anshuman Patil<br><br>Red Hat Global Support Services<br><br><publishedDate>2019-02-26T05:35:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>