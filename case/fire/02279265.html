======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2018-12-20T04:25:47Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2019-01-03T05:43:11Z</b><br><b>id : 5002K00000czdAFQAY</b><br>======================<br><br><b><font size=15>
제목  : [삼성화재][WEB/WAS]업무쪽에서 요청하는  커널 파라미터 값 영향도 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>아래의 두가지 커널 파라메터 변경요청이 왔는데 해당 커널 파라메터에 대한 영향도 문의가 와서 질문드립니다.<br>아래와 같이 각각 설정을 변경했을때 os 에 관련하여 영향도를 알고 싶습니다.<br><br>질문 1.<br><br>- 변경이유 : 발송서버 오픈파일 수 부족으로 에러로그 디스크FULL 방지를 위해 오픈파일수 증가 및 소켓 재사용설정 요청드립니다.<br><br>변경 사항 1.<br> vi /etc/security/limits.conf<br><br>--변경전<br>*       soft    nofile  32800<br>*       hard    nofile  32800<br>--변경후 (sysctl -a | grep fs.file-max 값 이하로 적용)<br>*       soft    nofile  1000000<br>*       hard    nofile  1000000<br>변경사항 2.<br> sysctl -w net.ipv4.tcp_tw_reuse=1<br><br>변경에 대해서 온라인 적용 가능여부 및 영향도에 대해서 검토 부탁드리겠습니다.<br>#######################################<br><br>질문2.<br>/etc/security/limits.conf  변경<br><br><br>*       soft    nproc    unlimited<br>*       hard    nproc   unlimited<br>*       soft   nofile   32800<br>*       hard   nofie   60000<br><br>/etc/sysctl.conf  변경<br><br>fs.file-max<br><br>9755498<br>net.core.rmem_default<br><br>25165824<br>net.core.rmem_max<br><br>25165824<br>net.core.wmem_default<br><br>65536<br>net.core.wmem_max<br><br>25165824<br>net.core.netdev_max_backlog<br><br>50000<br>net.ipv4.tcp_max_syn_backlog<br><br>30000<br>net.ipv4.tcp_max_tw_buckets<br><br>2000000<br>======================<br><br><br>net.ipv4.tcp_rfc1337<br><br>1<br>net.ipv4.tcp_mem<br><br>2306772 3075697 4613544<br>net.ipv4.tcp_wmem<br><br>4096 65536 25165824<br>net.ipv4.tcp_rmem<br><br>4096 25165824 25165824<br>net.ipv4.tcp_orphan_retries<br><br>0<br>net.ipv4.tcp_sack<br><br>1<br>net.ipv4.tcp_timestamps<br><br>1<br>net.ipv4.tcp_window_scaling<br><br>1<br>======================<br>net.ipv4.tcp_keepalive_time<br><br>30<br>net.ipv4.ip_local_port_range<br><br>10000 65000<br>net.ipv4.tcp_fin_timeout<br><br>10<br>net.ipv4.tcp_tw_recycle<br><br>1<br>net.ipv4.tcp_tw_reuse <br><br>1<br>kernel.sem<br><br>1250 256000 100 8192<br><br><br>kernel.msgmni<br><br>1024<br>net.ipv4.tcp_slow_start_after_idle<br><br>0<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><hostname>[삼성화재][WEB/WAS]</hostname><br><br><br><comment id="a0a2K00000OlX6LQAV"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-01-03T05:43:10Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-01-03T05:43:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service입니다.<br><br>본 케이스를 종료처리 하고자 합니다.<br>만약 본 케이스와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.  <br>  <br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발생됩니다. <br>고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. <br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.  <br>  <br>감사합니다.<br><br><publishedDate>2019-01-03T05:43:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OkqBXQAZ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-12-27T01:46:16Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-12-27T01:46:16Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 추가적으로 문의하실 사항이 있으신가요?<br><br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-12-27T01:46:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OkDXtQAN"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-12-21T05:28:42Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-12-21T05:28:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>Q.NAT 환경이 아닐경우 상관없고 온라인에서 가능하다는 말씀이시죠?<br>A.NAT 환경이 아닐경우 사용하실수 있으며 온라인에서 가능합니다.<br><br>Q.온라인에서 가능 할 경우 현재 어플리케이션이 동작 중에  sysctl -w net.ipv4.tcp_tw_reuse=1 값을 적용해도 문제가 없는지요?<br>A.네, sysctl -w 로 온라인 중에 적용하셔도 괜찮습니다. 재부팅이 된후에도 적용하시려면 /etc/sysctl.conf 혹은 /etc/sysctl.d/ 경로에 .conf 파일을 생성하신후<br>해당 파라메터를 기입하셔서 sysctl -p 로 영구적용하실 수 있습니다<br><br><br>감사합니다.<br><br><publishedDate>2018-12-21T05:28:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OkDGSQA3"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2018-12-21T04:51:52Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2018-12-21T04:51:52Z</b><br><br>네 감사합니다.<br>한가지 더 문의 드립니다.<br> NAT 환경이 아닐경우 상관없고 온라인에서 가능하다는 말씀이시죠?<br>온라인에서 가능 할 경우 현재 어플리케이션이 동작 중에  sysctl -w net.ipv4.tcp_tw_reuse=1 <br>값을 적용해도 문제가 없는지요?<br><br><publishedDate>2018-12-21T04:51:52Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000Ok0qWQAR"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-12-20T09:47:18Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-12-21T03:10:29Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>자세한 설명 감사드립니다.<br><br><br>질문 1.<br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>- 변경이유 : 발송서버 오픈파일 수 부족으로 에러로그 디스크FULL 방지를 위해 오픈파일수 증가 및 소켓 재사용설정 요청드립니다.<br><br>변경 사항 1.<br> vi /etc/security/limits.conf<br><br>--변경전<br>*       soft    nofile  32800<br>*       hard    nofile  32800<br>--변경후 (sysctl -a | grep fs.file-max 값 이하로 적용)<br>*       soft    nofile  1000000<br>*       hard    nofile  1000000<br>변경사항 2.<br> sysctl -w net.ipv4.tcp_tw_reuse=1<br><br>변경에 대해서 온라인 적용 가능여부 및 영향도에 대해서 검토 부탁드리겠습니다.<br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>[답변 1]<br><br>/etc/security/limits.conf 파일에서 nofile에 대한 변경은 온라인적용이 가능하며 문제가 없을 것으로 보입니다.<br><br>net.ipv4.tcp_tw_reuse=1 파라메터 온라인 활성화에 대해서는 아래와 같이 말씀 드리겠습니다.<br>TIME-WAIT 상태의 socket이 보다 빠른 시간내에 재사용 되기를 원하신다면 아래의 문서를 토대로<br>아래의 두 파라메터를 활성화 하실수 있습니다. 다만 해당 파라메터를 활성화 할 경우, NAT 환경에서<br>패킷 드롭 등 네트워크 오류가 발생할수 있으니 사용하지 말아야 합니다. 또한 커널파라메터를 변경후에는<br>반드시 테스트를 하셔야 합니다.<br><br>net.ipv4.tcp_timestamps = 1<br>net.ipv4.tcp_tw_recycle = 1<br><br>How to reduce the number of TIME WAIT sockets? <br>https://access.redhat.com/solutions/24154<br>======================<br>질문2.<br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>/etc/security/limits.conf  변경<br><br><br>*       soft    nproc    unlimited<br>*       hard    nproc   unlimited<br>*       soft   nofile   32800<br>*       hard   nofie   60000<br><br>/etc/sysctl.conf  변경<br><br>fs.file-max<br><br>9755498<br>net.core.rmem_default<br><br>25165824<br>net.core.rmem_max<br><br>25165824<br>net.core.wmem_default<br><br>65536<br>net.core.wmem_max<br><br>25165824<br>net.core.netdev_max_backlog<br><br>50000<br>net.ipv4.tcp_max_syn_backlog<br><br>30000<br>net.ipv4.tcp_max_tw_buckets<br><br>2000000<br>======================<br><br><br>net.ipv4.tcp_rfc1337<br><br>1<br>net.ipv4.tcp_mem<br><br>2306772 3075697 4613544<br>net.ipv4.tcp_wmem<br><br>4096 65536 25165824<br>net.ipv4.tcp_rmem<br><br>4096 25165824 25165824<br>net.ipv4.tcp_orphan_retries<br><br>0<br>net.ipv4.tcp_sack<br><br>1<br>net.ipv4.tcp_timestamps<br><br>1<br>net.ipv4.tcp_window_scaling<br><br>1<br>======================<br>net.ipv4.tcp_keepalive_time<br><br>30<br>net.ipv4.ip_local_port_range<br><br>10000 65000<br>net.ipv4.tcp_fin_timeout<br><br>10<br>net.ipv4.tcp_tw_recycle<br><br>1<br>net.ipv4.tcp_tw_reuse <br><br>1<br>kernel.sem<br><br>1250 256000 100 8192<br><br><br>kernel.msgmni<br><br>1024<br>net.ipv4.tcp_slow_start_after_idle<br><br>0<br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br><br>[답변 2]<br><br>/etc/security/limits.conf 변경에는 문제가 없어보입니다.<br><br>변경된 커널 파라메터중 아래의 세개 파라메터는 여러 기술문서에서 모두 NAT 환경에서는 사용하지 말것을 권고드리고 있습니다.<br><br>net.ipv4.tcp_timestamps<br><br>1<br>net.ipv4.tcp_tw_recycle<br><br>1<br>net.ipv4.tcp_tw_reuse <br><br>1<br><br>이외의 커널 파라메터는 명확하게 어떤 상황하에서는 적용해서는 안되다는 내용은 없습니다.<br>기본적으로 커널 파라메터들은 실제 시스템 환경에 의존적이기 때문에 권장사항에 대해서 <br>확실하게 대답해드릴수 없는 점 양해부탁드립니다. 따라서 커널 파라메터를 <br>수정후에는 반드시 충분한 테스트를 거치신후 적용하셔야 합니다.<br><br>감사합니다.<br>.<br><br><publishedDate>2018-12-20T09:47:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OjyR8QAJ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-12-20T06:29:00Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-12-20T06:29:00Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저는 Platform Support 를 담당하고 있는 Technical Support Engineer 이성빈입니다.<br>올려주신 문의내용은 현재 자세히 살펴보고 있는중이며, 관련된 내용이 확인이 되는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-12-20T06:29:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>아래와 같이 각각 설정을 변경했을때 os 에 관련하여 영향도를 알고 싶습니다.<br><br>질문 1.<br><br>- 변경이유 : 발송서버 오픈파일 수 부족으로 에러로그 디스크FULL 방지를 위해 오픈파일수 증가 및 소켓 재사용설정 요청드립니다.<br><br>변경 사항 1.<br> vi /etc/security/limits.conf<br><br>--변경전<br>*       soft    nofile  32800<br>*       hard    nofile  32800<br>--변경후 (sysctl -a | grep fs.file-max 값 이하로 적용)<br>*       soft    nofile  1000000<br>*       hard    nofile  1000000<br>변경사항 2.<br> sysctl -w net.ipv4.tcp_tw_reuse=1<br><br>변경에 대해서 온라인 적용 가능여부 및 영향도에 대해서 검토 부탁드리겠습니다.<br>#######################################<br><br>질문2.<br>/etc/security/limits.conf  변경<br><br><br>*       soft    nproc    unlimited<br>*       hard    nproc   unlimited<br>*       soft   nofile   32800<br>*       hard   nofie   60000<br><br>/etc/sysctl.conf  변경<br><br>fs.file-max<br><br>9755498<br>net.core.rmem_default<br><br>25165824<br>net.core.rmem_max<br><br>25165824<br>net.core.wmem_default<br><br>65536<br>net.core.wmem_max<br><br>25165824<br>net.core.netdev_max_backlog<br><br>50000<br>net.ipv4.tcp_max_syn_backlog<br><br>30000<br>net.ipv4.tcp_max_tw_buckets<br><br>2000000<br>======================<br><br><br>net.ipv4.tcp_rfc1337<br><br>1<br>net.ipv4.tcp_mem<br><br>2306772 3075697 4613544<br>net.ipv4.tcp_wmem<br><br>4096 65536 25165824<br>net.ipv4.tcp_rmem<br><br>4096 25165824 25165824<br>net.ipv4.tcp_orphan_retries<br><br>0<br>net.ipv4.tcp_sack<br><br>1<br>net.ipv4.tcp_timestamps<br><br>1<br>net.ipv4.tcp_window_scaling<br><br>1<br>======================<br>net.ipv4.tcp_keepalive_time<br><br>30<br>net.ipv4.ip_local_port_range<br><br>10000 65000<br>net.ipv4.tcp_fin_timeout<br><br>10<br>net.ipv4.tcp_tw_recycle<br><br>1<br>net.ipv4.tcp_tw_reuse <br><br>1<br>kernel.sem<br><br>1250 256000 100 8192<br><br><br>kernel.msgmni<br><br>1024<br>net.ipv4.tcp_slow_start_after_idle<br><br>0</issue><cep>false</cep></case>