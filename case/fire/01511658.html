======================<br><b>생성계정 : 주호 이</b><br><b>생성날짜 : 2015-09-22T04:39:49Z</b><br><b>마지막 답변자 : JINKOO HAN</b><br><b>마지막 수정 일자 : 2016-02-24T01:58:12Z</b><br><b>id : 500A000000SHyfxIAD</b><br>======================<br><br><b><font size=15>
제목  : [BZ] VMWare VM(RHEL 7.0 x86_64) 예기치 못한 reboot
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>장애 당시 로그는 아래와 같습니다. <br><br> <br><br>/var/log/messages<br><br>Sep 19 07:00:01 sfdeccal01 systemd: Starting Session 15380 of user root.<br>Sep 19 07:00:01 sfdeccal01 systemd: Started Session 15380 of user root.<br>Sep 19 07:01:01 sfdeccal01 systemd: Starting Session 15381 of user root.<br>Sep 19 07:01:01 sfdeccal01 systemd: Started Session 15381 of user root.<br>Sep 19 07:10:01 sfdeccal01 systemd: Starting Session 15382 of user root.<br>Sep 19 07:10:01 sfdeccal01 systemd: Started Session 15382 of user root.<br><br>(로깅 단절)<br><br>Sep 19 01:37:30 sfdeccal01 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;3522&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>Sep 19 01:37:30 sfdeccal01 rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop' statement instead [try <br><br>http://www.rsyslog.com/e/2307 ]<br>Sep 19 01:37:30 sfdeccal01 rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop' statement instead [try <br><br>http://www.rsyslog.com/e/2307 ]<br>Sep 19 01:37:23 sfdeccal01 journal: Runtime journal is using 8.0M (max 4.0G, leaving 4.0G of free 133.7G, current limit 4.0G).<br>Sep 19 01:37:23 sfdeccal01 kernel: Initializing cgroup subsys cpuset<br>Sep 19 01:37:23 sfdeccal01 kernel: Initializing cgroup subsys cpu<br>Sep 19 01:37:23 sfdeccal01 kernel: Initializing cgroup subsys cpuacct<br>Sep 19 01:37:23 sfdeccal01 kernel: Linux version 3.10.0-229.1.2.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.2 20140120 <br><br>(Red Hat 4.8.2-16) (GCC) ) #1 SMP Fri Mar 27 03:04:26 UTC 2015<br><br><br>/var/crash에 kdump는 생성되지 않았습니다.<br><br>va/r/log/messages에 남은 로그의 시각이 연속적이지 않은 특징이 있어 시스템 로그만으로는 OS에 최초 문제가 발생한 정확한 시각 추정이 어려운 상태입니다.<br><br>sar 로그의 시각도 연속적이지 않은 특징이 있습니다.<br><br>[root@localhost sa]# sar -f sa19<br>Linux 3.10.0-229.1.2.el7.x86_64 (sfdeccal01)    09/19/2015      _x86_64_        (17 CPU)<br><br>12:00:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle<br>12:10:01 AM     all      0.08      0.00      0.11      0.00      0.00     99.81<br>12:20:01 AM     all      0.13      0.00      0.14      0.01      0.00     99.72<br>12:30:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.81<br>12:40:01 AM     all      0.13      0.00      0.11      0.01      0.00     99.76<br>12:50:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>01:00:01 AM     all      0.08      0.00      0.11      0.01      0.00     99.81<br>01:10:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>01:20:02 AM     all      0.18      0.00      0.15      0.01      0.00     99.66<br>01:30:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.81<br>01:40:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>01:50:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.82<br>02:00:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>02:10:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>02:20:01 AM     all      0.16      0.00      0.15      0.01      0.00     99.68<br>02:30:01 AM     all      0.08      0.00      0.11      0.00      0.00     99.81<br>02:40:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>02:50:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.82<br>03:00:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>03:10:01 AM     all      0.08      0.00      0.11      0.01      0.00     99.81<br>03:20:01 AM     all      0.16      0.00      0.14      0.01      0.00     99.69<br>03:30:01 AM     all      0.08      0.00      0.11      0.01      0.00     99.81<br>03:40:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>03:50:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.81<br>04:00:02 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>04:10:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.82<br>04:20:01 AM     all      0.13      0.00      0.13      0.01      0.00     99.73<br>04:30:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.81<br>04:40:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>04:50:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>05:00:01 AM     all      0.08      0.00      0.11      0.01      0.00     99.81<br>05:10:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.82<br>05:20:01 AM     all      0.13      0.00      0.13      0.01      0.00     99.73<br>05:30:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>05:40:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>05:50:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.82<br>06:00:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>06:10:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.81<br>06:20:01 AM     all      0.13      0.00      0.14      0.01      0.00     99.72<br>06:30:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>06:40:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.81<br>06:50:01 AM     all      0.08      0.00      0.10      0.00      0.00     99.82<br>07:00:01 AM     all      0.08      0.00      0.11      0.01      0.00     99.81<br>07:10:01 AM     all      0.08      0.00      0.10      0.01      0.00     99.82<br>Average:        all      0.09      0.00      0.11      0.01      0.00     99.79<br><br>01:37:30 AM       LINUX RESTART<br><br>10:40:01 AM     CPU     %user     %nice   %system   %iowait    %steal     %idle<br>10:50:01 AM     all      0.03      0.00      0.04      0.01      0.00     99.92<br>11:00:01 AM     all      0.02      0.00      0.04      0.01      0.00     99.93<br>11:10:01 AM     all      0.25      0.00      0.37      0.06      0.00     99.33<br>11:20:01 AM     all      0.04      0.00      0.07      0.01      0.00     99.89<br>11:30:01 AM     all      0.58      0.00      0.93      0.01      0.00     98.48<br>11:40:01 AM     all      0.16      0.00      0.10      0.01      0.00     99.73<br>11:50:01 AM     all      0.03      0.00      0.05      0.01      0.00     99.91<br>12:00:01 PM     all      0.03      0.00      0.05      0.01      0.00     99.91<br>12:10:01 PM     all      0.04      0.00      0.05      0.01      0.00     99.91<br>12:20:01 PM     all      0.08      0.00      0.08      0.01      0.00     99.83<br>12:30:01 PM     all      0.03      0.00      0.05      0.00      0.00     99.91<br>12:40:01 PM     all      0.03      0.00      0.05      0.01      0.00     99.91<br>12:50:01 PM     all      0.04      0.00      0.05      0.01      0.00     99.91<br>01:00:01 PM     all      0.03      0.00      0.05      0.01      0.00     99.91<br>01:10:01 PM     all      0.03      0.00      0.05      0.00      0.00     99.91<br>01:20:01 PM     all      0.23      0.00      0.10      0.01      0.00     99.66<br>01:30:01 PM     all      0.11      0.00      0.06      0.00      0.00     99.82<br>01:40:01 PM     all      0.06      0.00      0.06      0.01      0.00     99.87<br>01:50:01 PM     all      0.05      0.00      0.06      0.01      0.00     99.89<br>======================<br><br>VMWare vSphere 상에서 &quot;CPU has disabled&quot;라는 로그가 남았다고 합니다.<br><br>위 로그 발생 및 OS unexpected reboot 원인에 대해 분석 요청 드립니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>* 제품 정보 (고객 서버 정보입니다)<br><br>- 관련 패키지의 버전 정보<br><br>  예) 커널 관련 증상일 경우 &quot;uname -a&quot; 정보<br><br>[root@localhost sosreport-sfdeccal01-20150919180731]# cat uname<br>Linux sfdeccal01 3.10.0-229.1.2.el7.x86_64 #1 SMP Fri Mar 27 03:04:26 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux<br>[root@localhost sosreport-sfdeccal01-20150919180731]#<br>======================<br>- 제품의 아키텍처 (예, x86_64, x86)<br>x86_64<br>======================<br><br><br>* 하드웨어 정보 (고객 서버 정보입니다)             <br><br>- Model: VMWare<br><br>- CPU: 17core<br>processor       : 0<br>vendor_id       : GenuineIntel<br>cpu family      : 6<br>model           : 63<br>model name      : Intel(R) Xeon(R) CPU E5-2690 v3 @ 2.60GHz<br>stepping        : 2<br>microcode       : 0x2d<br>cpu MHz         : 2599.998<br>cache size      : 30720 KB<br>physical id     : 0<br>siblings        : 1<br>core id         : 0<br>cpu cores       : 1<br>apicid          : 0<br>initial apicid  : 0<br>fpu             : yes<br>fpu_exception   : yes<br>cpuid level     : 15<br>wp              : yes<br>flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss syscall nx <br><br>pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts nopl xtopology tsc_reliable nonstop_tsc aperfmperf<br> eagerfpu pni pclmulqdq vmx ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand <br><br>hypervisor lahf_lm abm ida arat epb xsaveopt pln pts dtherm tpr_shadow vnmi ept vpid fsgsbase tsc_adjust bmi1<br>avx2 smep bmi2 invpcid<br>bogomips        : 5199.99<br>clflush size    : 64<br>cache_alignment : 64<br>address sizes   : 42 bits physical, 48 bits virtual<br>power management:<br><br><br>- Memory:<br>[root@localhost sosreport-sfdeccal01-20150919180731]# cat proc/meminfo<br>MemTotal:       280479700 kB<br>MemFree:        263135568 kB<br>MemAvailable:   264222960 kB<br>Buffers:           18520 kB<br>Cached:          8834736 kB<br>SwapCached:            0 kB<br>Active:          6246172 kB<br>Inactive:        8424304 kB<br>Active(anon):    5993060 kB<br>Inactive(anon):  7467336 kB<br>Active(file):     253112 kB<br>Inactive(file):   956968 kB<br>Unevictable:           0 kB<br>Mlocked:               0 kB<br>SwapTotal:      285208572 kB<br>SwapFree:       285208572 kB<br>Dirty:             12128 kB<br>Writeback:             0 kB<br>AnonPages:       5817960 kB<br>Mapped:          7791580 kB<br>Shmem:           7643196 kB<br>Slab:             185956 kB<br>SReclaimable:      92496 kB<br>SUnreclaim:        93460 kB<br>KernelStack:       16368 kB<br>PageTables:       247224 kB<br>NFS_Unstable:          0 kB<br>Bounce:                0 kB<br>WritebackTmp:          0 kB<br>CommitLimit:    425448420 kB<br>Committed_AS:   243178736 kB<br>VmallocTotal:   34359738367 kB<br>VmallocUsed:     1050108 kB<br>VmallocChunk:   34358640640 kB<br>HardwareCorrupted:     0 kB<br>AnonHugePages:   4632576 kB<br>HugePages_Total:       0<br>HugePages_Free:        0<br>HugePages_Rsvd:        0<br>HugePages_Surp:        0<br>Hugepagesize:       2048 kB<br>DirectMap4k:      198464 kB<br>DirectMap2M:    10287104 kB<br>DirectMap1G:    276824064 kB<br>[root@localhost sosreport-sfdeccal01-20150919180731]#<br>======================<br><br><br><br>- 기타 관련 설정 정보:<br>VM on VMWare vSphere 6<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>- 발생 시점<br>9/19(토) 01:37:30 AM 추정<br><br><br>- 발생 빈도<br>수 차례<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 김성훈 사원<br>- 회사명(부서명) : 삼성SDS 금융시스템그룹 (삼성화재 담당)<br>- 전화번호 : 010-4581-2766<br>- 메일주소 : sh1221.kim@samsung.com<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 문경윤 차장<br>- 회사명(부서명) : 오픈소스컨설팅<br>- 전화번호 : 010-6477-1206<br>- 메일주소 : moon@osci.kr<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.0</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000Ga7rBIAR"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-24T01:58:11Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-24T01:58:10Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>Errata가 release되고 별도의 업데이트가 없으셔서 본 케이스를 Close하도록 하겠습니다.<br><br>본 케이스와 관련되어 추가 문의 사항이 있으시면 케이스를 Re-open하셔도 되며, 새로운 문의사항은 새로운 케이스를 오픈하시면 해당 케이스를 통해서 지원하도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-24T01:58:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GYIpsIAH"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-02-17T01:33:35Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-02-17T01:33:35Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스와 관련되어 패치가 Release되어 아래와 같이 Errata Link를 아래 안내 드립니다.<br><br>Errata: https://rhn.redhat.com/errata/RHSA-2016-0185.html<br>======================<br>감사합니다.<br><br><publishedDate>2016-02-17T01:33:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G6rFdIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-01-18T02:46:08Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-01-18T02:46:08Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스와 관련되어 현재 Bugzilla의 상태를 업데이트 드립니다.<br><br>현재 버그에 대한 패치는 적용이 되어 QA팀에서 테스트 단계를 거쳐 다음 release에 맞춰서 release가 될 예정입니다.<br><br>추후 패치가 release가 되면 다시 안내드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-01-18T02:46:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000FUjAbIAL"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-12-18T00:31:56Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-12-18T00:31:56Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>해당 버그와 관련되어 현재 패치를 적용하고 있으며, 테스트를 진행중인 상태로 확인됩니다.<br><br>추후에 변화가 있을시에 다시 업데이트 드리도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2015-12-18T00:31:56Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000FQ1JpIAL"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-11-18T06:21:38Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-11-18T06:21:38Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>소식 감사합니다. 업무에 참고하겠습니다.<br><br>좋은 하루 되세요.<br><br><br>2015. 11. 18. 10:20 Red Hat Support &lt;support@redhat.com&gt; 작성:<br><br><publishedDate>2015-11-18T06:21:37Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000FPynEIAT"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-11-18T01:20:08Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-11-18T01:20:08Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>Bugzilla 관련되어 현재 상태를 업데이트 드립니다.<br><br>현재 패치작업을 진행중에 있습니다.<br><br><br>패치와 관련되어 추후 업데이트가 있으면, 업데이트 드리도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2015-11-18T01:20:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EL3lgIAD"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-21T00:29:35Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-21T00:29:35Z</b><br><br>안녕하세요, 문경윤입니다.<br><br>vmcore가 또 발생하여 dropbox에 업로드하였습니다.<br>이번에는 압축을 하지 않은 채 고객사로부터 제공받은 것을 업로드하였습니다.<br><br>sfdbwsal01-vmcore<br><br>sfdbwsal01-vmcore-dmesg<br><br><publishedDate>2015-10-21T00:29:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EKiakIAD"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-19T09:43:50Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-19T09:43:50Z</b><br><br>오픈소스컨설팅 문경윤입니다.<br><br>VMWare 정보 알려 드립니다.<br><br>1. VMware ESXi 버젼 및 build 버전<br> : ESXi-6.0.0-2494585-standard<br><br>2. VMware Tool version<br> : 9.10.0.43888 (build-2476743)<br><br>3. VM HW version<br> : VirtualHW.version = 11<br><br><publishedDate>2015-10-19T09:43:49Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EKg7jIAD"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-19T04:21:57Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-19T04:21:57Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>고객사 시스템에서 확인한 md5sum 전달 드립니다. 변조가 일어나지는 않은 것 같습니다.<br><br><br>안녕하세요, 서버운영 김성훈 사원입니다.<br> <br>아래와같이 md5sum 결과 보내드립니다.<br>10/08 발생값<br>[root@sfqmdgal01 127.0.0.1-2015.10.08-04:14:51]# md5sum vmcore<br>6f51b63c363432f55197f9311bc95a44  vmcore<br> <br>10/14 발생값<br>[root@sfqmdgal01 127.0.0.1-2015.10.14-04:58:01]# md5sum vmcore<br>5caca29aedf403011626f8ef5b884887  vmcore<br> <br>[root@sfqmdgal01 crash]# ls -lrt<br>total 0<br>drwxr-xr-x 2 root root 42 Jun 12 12:19 127.0.0.1-2015.06.12-12:19:41<br>drwxr-xr-x 2 root root 87 Oct  8 13:38 127.0.0.1-2015.10.08-04:14:51<br>drwxr-xr-x 2 root root 67 Oct 16 10:04 127.0.0.1-2015.10.14-04:58:01<br>[root@sfqmdgal01 crash]# cd 127.0.0.1-2015.10.08-04\:14\:51/<br>[root@sfqmdgal01 127.0.0.1-2015.10.08-04:14:51]# ls -lrt<br>total 3237948<br>-rw-r--r-- 1 root root    1078286 Oct  8 04:14 vmcore-dmesg.txt<br>-rw------- 1 root root 1432522249 Oct  8 04:15 vmcore<br>-rw------- 1 root root 1432522249 Oct  8 13:38 vmcore_bak<br>-rw-r--r-- 1 root root  449524508 Oct  8 13:41 sfqmdgal01-vmcore.tar<br>[root@sfqmdgal01 127.0.0.1-2015.10.08-04:14:51]# md5sum vmcore<br>6f51b63c363432f55197f9311bc95a44  vmcore<br>[root@sfqmdgal01 127.0.0.1-2015.10.08-04:14:51]# cd ../127.0.0.1-2015.10.14-04\:58\:01/<br>[root@sfqmdgal01 127.0.0.1-2015.10.14-04:58:01]# ls -al<br>total 1618632<br>drwxr-xr-x 2 root root        67 Oct 16 10:04 .<br>drwxr-xr-x 5 root root       114 Oct 14 04:58 ..<br>-rw-r--r-- 1 root root 763197440 Oct 14 15:20 j<br>-rw------- 1 root root 762700192 Oct 14 04:58 vmcore<br>-rw-r--r-- 1 root root    485127 Oct 14 04:58 vmcore-dmesg.txt<br>-rw-r--r-- 1 root root 131083373 Oct 14 15:23 vmcore.tar<br>[root@sfqmdgal01 127.0.0.1-2015.10.14-04:58:01]# md5sum vmcore<br>5caca29aedf403011626f8ef5b884887  vmcore<br>[root@sfqmdgal01 127.0.0.1-2015.10.14-04:58:01]#<br>======================<br>(HAN, JINKOO에 회신)<br>&gt; 안녕하세요,<br>&gt; Red Hat 한진구 입니다.<br>&gt; <br>&gt; 우선 추가로 보내주신 vmcore에 대한 md5sum 값을 고객 시스템안에서 확인 바랍니다.<br>&gt; <br>&gt; 현재 보내주신 20151014-0458-sfqmdgal01-vmcore.tar.bz2 파일을 압축을 해제하여 vmcore를 확인하면 해당 파일이 변조가 되어 저희 Red Hat에서 배포하고 있는 커널과 다른 것으로 나타납니다.<br>&gt; <br>&gt; crash: &lt;path&gt;/3.10.0-229.1.2.el7.x86_64/vmlinux and &lt;path&gt;/vmcore do not match!&quot;<br>&gt; <br>&gt; <br>&gt; 해당 이슈가 혹시 파일을 반출하는 시스템에서 보안의 이슈로 인하여 파일을 변조한 것이 아닌가 싶습니다. 해당 이슈는 앞으로도 vmcore, sosreport 등 문제가 발생했을때 이 문제를 해결하기 위해서 확인이 필요할 것 같습니다.<br>&gt; <br>&gt; 고객사 시스템에서 해당 vmcore파일의 md5sum값을 확인 바랍니다.<br>&gt; <br>&gt; <br>&gt; $ md5sum vmcore <br>&gt; 5caca29aedf403011626f8ef5b884887  vmcore<br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2015-10-19T04:21:57Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EKfXvIAL"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-19T01:50:36Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-19T01:50:36Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 추가로 보내주신 vmcore에 대한 md5sum 값을 고객 시스템안에서 확인 바랍니다.<br><br>현재 보내주신 20151014-0458-sfqmdgal01-vmcore.tar.bz2 파일을 압축을 해제하여 vmcore를 확인하면 해당 파일이 변조가 되어 저희 Red Hat에서 배포하고 있는 커널과 다른 것으로 나타납니다.<br><br>crash: &lt;path&gt;/3.10.0-229.1.2.el7.x86_64/vmlinux and &lt;path&gt;/vmcore do not match!&quot;<br><br><br>해당 이슈가 혹시 파일을 반출하는 시스템에서 보안의 이슈로 인하여 파일을 변조한 것이 아닌가 싶습니다. 해당 이슈는 앞으로도 vmcore, sosreport 등 문제가 발생했을때 이 문제를 해결하기 위해서 확인이 필요할 것 같습니다.<br><br>고객사 시스템에서 해당 vmcore파일의 md5sum값을 확인 바랍니다.<br><br><br>$ md5sum vmcore <br>5caca29aedf403011626f8ef5b884887  vmcore<br><br><br>감사합니다.<br><br><publishedDate>2015-10-19T01:50:36Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EKc4EIAT"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-17T02:16:03Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-17T02:16:03Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>raw data 를 dropbox에 업로드하였습니다.<br><br>-rw-rw-r--  1 root root 429M Oct 17 10:24 20151008-0415-sfqmdgal01-vmcore.tar.bz2<br>-rw-rw-r--  1 root root 126M Oct 17 10:23 20151014-0458-sfqmdgal01-vmcore.tar.bz2<br>-rw-rw-r--  1 root root 8.2M Oct 17 10:23 sosreport-sfqmdgal01-20151015135629.tar.xz<br><br> 10/14에도 vmcore가 생성되어 함께 올려 드렸습니다.<br><br><publishedDate>2015-10-17T02:16:03Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EKG1HIAX"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-15T05:13:53Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-15T05:13:53Z</b><br><br>안녕하세요, 문경윤입니다.<br><br>패치가 만들어졌다니 다행입니다. 좋은 소식 감사합니다.<br><br>vmcore, sosreport 재업로드 요청하신 건은 현재 담당자가 휴가 중이라 대체 업무자 분을 통해서 받기로 하고 회신을 기다리는 중입니다.<br>입수하는 대로 재업해 드리도록 하겠습니다. 감사합니다.<br><br><publishedDate>2015-10-15T05:13:53Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EKEz2IAH"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-15T01:23:45Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-15T01:23:45Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br><br>이전에 설명드렸던 본 케이스와 관련되어 오픈된 bugzilla의 상태에 대해서 업데이트 드립니다.<br><br>현재 VMware 엔지니어가 해당 버그질라에 참여하여 버그질라에 대한 버그를 확인하였고, 해당 버그에 대한 패치가 이미 자체적으로 패치되어 현재 Upstream Kernel에도 반영을 위해서 대기중인 상태라고 합니다.<br><br><br>향후, 해당 패치가 저희 제품에도 반영이 될 것으로 보입니다.<br><br><br>업무에 참고하시기 바라며, 해당 버그질라와 관련되어 추후 업데이트되는 내용이 있으면 업데이트 드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2015-10-15T01:23:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EJdSAIA1"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-12T01:18:58Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-12T01:18:59Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 보내주신 파일 두개 모두(vmcore, sosreport)가 파일이 깨진 것으로 의심됩니다.<br><br>현재 보내주신 md5sum 값이 고객사의 시스템에서 확인한 값인지요? 왜냐면, vmcore랑 sosreport가 모두 깨진 것이라 upload중에 깨졌을 가능성도 있고.. 현재의 vmcore 파일이 어쩌면 incomplete가 아닌 파일을 반출하면서 파일의 일부를 변경함에 따라 파일을 저희쪽에서 못 읽는 것은 아닌가 싶은 생각이 들어서 확인 요청 드렸습니다.<br><br>$ crash vmcore vmlinux<br><br>[...]<br><br>crash: invalid kernel virtual address: 200000002  type: &quot;possible&quot;<br>WARNING: cannot read cpu_possible_map<br>crash: invalid kernel virtual address: bc  type: &quot;present&quot;<br>WARNING: cannot read cpu_present_map<br>crash: invalid kernel virtual address: 1e87  type: &quot;online&quot;<br>WARNING: cannot read cpu_online_map<br>crash: invalid kernel virtual address: 200000002  type: &quot;active&quot;<br>WARNING: cannot read cpu_active_map<br>crash: /retrace/repos/kernel/x86_64/usr/lib/debug/lib/modules/3.10.0-229.1.2.el7.x86_64/vmlinux and vmcore do not match!<br>======================<br>* vmcore 분석 결과<br><br>보내주신 vmcore가 현재 정상적이지 않지만 log상의 데이터만을 확인하였을때.. 이전과 동일한 vmci + vmw_vsock_vmci_transport의 이슈인 것으로 확인됩니다.<br><br>[7841607.490531] bad: scheduling from the idle thread!<br>[7841607.491150] CPU: 2 PID: 0 Comm: swapper/2 Tainted: PF       W  O--------------   3.10.0-229.1.2.el7.x86_64 #1<br>[7841607.491764] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2014<br>[7841607.492360]  ffff881fbe653680 96e4100a3a62a64f ffff881fbe643af0 ffffffff81604afa<br>[7841607.492963]  ffff881fbe643b08 ffffffff810ad1b0 ffff881fbe653680 ffff881fbe643b30<br>[7841607.493550]  ffffffff810a302e 000000013a62a64f ffff881f91592220 ffff881f91592220<br>[7841607.494124] Call Trace:<br>[7841607.494691]  &lt;IRQ&gt;  [&lt;ffffffff81604afa&gt;] dump_stack+0x19/0x1b<br>[7841607.495276]  [&lt;ffffffff810ad1b0&gt;] dequeue_task_idle+0x30/0x90<br>[7841607.495848]  [&lt;ffffffff810a302e&gt;] dequeue_task+0x5e/0xa0<br>[7841607.496412]  [&lt;ffffffff810a65f3&gt;] deactivate_task+0x23/0x30<br>[7841607.496969]  [&lt;ffffffff81609ad1&gt;] __schedule+0x481/0x7b0<br>[7841607.497531]  [&lt;ffffffff81609e29&gt;] schedule+0x29/0x70<br>[7841607.498093]  [&lt;ffffffff81607d69&gt;] schedule_timeout+0x209/0x2d0<br>[7841607.498657]  [&lt;ffffffff810a0858&gt;] ? __wake_up_common+0x58/0x90<br>[7841607.499248]  [&lt;ffffffff810a2484&gt;] ? __wake_up+0x44/0x50<br>[7841607.499906]  [&lt;ffffffff8160a336&gt;] wait_for_completion+0x116/0x170<br>[7841607.500471]  [&lt;ffffffff810a9610&gt;] ? wake_up_state+0x20/0x20<br>[7841607.501031]  [&lt;ffffffff81113b00&gt;] ? __call_rcu+0x2c0/0x2c0<br>[7841607.501595]  [&lt;ffffffff81093f4b&gt;] wait_rcu_gp+0x5b/0x80<br>[7841607.502154]  [&lt;ffffffff81093ed0&gt;] ? ftrace_raw_output_rcu_utilization+0x50/0x50<br>[7841607.502722]  [&lt;ffffffff811133ab&gt;] synchronize_sched+0x3b/0x50<br>[7841607.503284]  [&lt;ffffffffa037d9d0&gt;] vmci_event_unsubscribe+0x70/0xb0 [vmw_vmci]<br>[7841607.503837]  [&lt;ffffffffa0444611&gt;] vmci_transport_destruct+0x21/0xe0 [vmw_vsock_vmci_transport]<br>[7841607.504404]  [&lt;ffffffffa0436867&gt;] vsock_sk_destruct+0x17/0x60 [vsock]<br>[7841607.504977]  [&lt;ffffffff814e7aff&gt;] __sk_free+0x1f/0x170<br>[7841607.505541]  [&lt;ffffffff814e7c71&gt;] sk_free+0x21/0x30<br>[7841607.506099]  [&lt;ffffffffa04452bb&gt;] vmci_transport_recv_stream_cb+0x1fb/0x2e0 [vmw_vsock_vmci_transport]<br>[7841607.506671]  [&lt;ffffffff81099ed1&gt;] ? run_posix_cpu_timers+0x51/0x840<br>[7841607.507232]  [&lt;ffffffff810b3642&gt;] ? task_tick_fair+0x222/0x670<br>[7841607.507795]  [&lt;ffffffff815fed96&gt;] ? nohz_balance_exit_idle.part.58+0x16/0x34<br>[7841607.508380]  [&lt;ffffffffa037cf1c&gt;] vmci_datagram_invoke_guest_handler+0xbc/0xf0 [vmw_vmci]<br>[7841607.508985]  [&lt;ffffffffa037de6f&gt;] vmci_dispatch_dgs+0xcf/0x230 [vmw_vmci]<br>[7841607.509641]  [&lt;ffffffff81077a3d&gt;] tasklet_action+0x7d/0x140<br>[7841607.510201]  [&lt;ffffffff81077bf7&gt;] __do_softirq+0xf7/0x290<br>[7841607.510766]  [&lt;ffffffff8161635c&gt;] call_softirq+0x1c/0x30<br>[7841607.511324]  [&lt;ffffffff81015de5&gt;] do_softirq+0x55/0x90<br>[7841607.511886]  [&lt;ffffffff81077f95&gt;] irq_exit+0x115/0x120<br>[7841607.512449]  [&lt;ffffffff81616ef8&gt;] do_IRQ+0x58/0xf0<br>[7841607.513006]  [&lt;ffffffff8160c0ed&gt;] common_interrupt+0x6d/0x6d<br>[7841607.513569]  &lt;EOI&gt;  [&lt;ffffffff8109b928&gt;] ? hrtimer_start+0x18/0x20<br>[7841607.514141]  [&lt;ffffffffa0445420&gt;] ? vmci_transport_recv_pkt_work+0x80/0xb80 [vmw_vsock_vmci_transport]<br>[7841607.514727]  [&lt;ffffffff81052dd6&gt;] ? native_safe_halt+0x6/0x10<br>[7841607.515294]  [&lt;ffffffff8101c93f&gt;] default_idle+0x1f/0xc0<br>[7841607.515858]  [&lt;ffffffff8101d236&gt;] arch_cpu_idle+0x26/0x30<br>[7841607.516422]  [&lt;ffffffff810c6945&gt;] cpu_startup_entry+0xf5/0x290<br>[7841607.516983]  [&lt;ffffffff810423ca&gt;] start_secondary+0x1ba/0x230<br>======================<br><br>* 추가 문의사항<br>현재 버그질라와 관련되어 Engineering쪽에서 확인하고 있는 내용들이 있어서 문의 드립니다.<br><br>1. VMware ESXi 버젼 및 build 버젼<br>2. VMware Tool version<br>3. VM HW version<br>======================<br>결론적으로,<br>- 추가로 발생한 vmcore 파일 역시 이전 vmcore와 동일한 이슈로 분석되며,<br>- 현재 vmcore와 sosreport 파일을 반출하는 과정에서 파일의 변조가 있는지에 대한 확인이 필요할 것 같습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2015-10-12T01:18:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EJbMeIAL"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-10T23:36:05Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-10T23:36:05Z</b><br><br>안녕하세요, 문경윤입니다. md5 회신 드립니다.<br><br>[root@fence customer]# md5sum sosreport-sfqmdgal01-20151008140702.tar.xz<br>a708abd8f1ca75a7a6e82fa781185657  sosreport-sfqmdgal01-20151008140702.tar.xz<br>[root@fence customer]#<br><br>[root@fence customer]# md5sum vmcore<br>6f51b63c363432f55197f9311bc95a44  vmcore<br>[root@fence customer]#<br><br>어떤 파일이 깨진 것인지 알려 주세요.<br>감사합니다.<br><br>(HAN, JINKOO에 회신)<br>&gt; 안녕하세요,<br>&gt; Red Hat 한진구 입니다.<br>&gt; <br>&gt; 보내주신 sosreport와 vmcore에 대한 md5sum을 확인해주시겠습니까?<br>&gt; <br>&gt; 6f51b63c363432f55197f9311bc95a44  vmcore<br>&gt; a708abd8f1ca75a7a6e82fa781185657  sosreport-sfqmdgal01-20151008140702.tar.xz<br>&gt; <br>&gt; 현재 파일이 깨진 것 같아서 확인 바랍니다.<br>&gt; <br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2015-10-10T23:36:05Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EJElqIAH"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-08T08:07:43Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-08T08:07:44Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>보내주신 sosreport와 vmcore에 대한 md5sum을 확인해주시겠습니까?<br><br>6f51b63c363432f55197f9311bc95a44  vmcore<br>a708abd8f1ca75a7a6e82fa781185657  sosreport-sfqmdgal01-20151008140702.tar.xz<br><br>현재 파일이 깨진 것 같아서 확인 바랍니다.<br>======================<br>감사합니다.<br><br><publishedDate>2015-10-08T08:07:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EJEDKIA5"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-08T07:03:13Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-08T07:03:13Z</b><br><br>문경윤입니다.<br><br>10/8 vmcore(1.4G)가 발생하였습니다. 앞서 분석된 내용과 유사한 call trace로 보입니다.<br><br>ftp에 업로드해 드렸습니다.<br>ftp://dropbox.redhat.com/incoming/sfqmdgal01-vmcore.tar.bz2<br>ftp://dropbox.redhat.com/incoming/vmcore-dmesg.txt<br><br>[root@fence customer]# ls -lrt | grep vmcore<br>-rw-------  1 root root 1432522249 Oct  8 04:15 vmcore<br>-rw-r--r--  1 ftp  ftp     1078286 Oct  8 15:49 vmcore-dmesg.txt<br>-rw-r--r--  1 ftp  ftp   449524508 Oct  8 15:51 sfqmdgal01-vmcore.tar.bz2<br>[root@fence customer]#<br><br><br>[7841607.075176] CPU: 2 PID: 0 Comm: swapper/2 Tainted: PF          O--------------   3.10.0-229.1.2.el7.x86_64 #1<br>[7841607.075869] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2014<br>[7841607.076578]  ffff881fbe643ce0 96e4100a3a62a64f ffff881fbe643b30 ffffffff81604afa<br>[7841607.077284]  ffff881fbe643b40 ffffffff815fec24 ffff881fbe643ba0 ffffffff81609d54<br>[7841607.077989]  ffff881f915a7fd8 0000000000013680 ffff881f915a7fd8 0000000000013680<br>[7841607.078680] Call Trace:<br>[7841607.079362]  &lt;IRQ&gt;  [&lt;ffffffff81604afa&gt;] dump_stack+0x19/0x1b<br>[7841607.080067]  [&lt;ffffffff815fec24&gt;] __schedule_bug+0x4d/0x5b<br>[7841607.080764]  [&lt;ffffffff81609d54&gt;] __schedule+0x704/0x7b0<br>[7841607.081447]  [&lt;ffffffff81609e29&gt;] schedule+0x29/0x70<br>[7841607.082130]  [&lt;ffffffff81607d69&gt;] schedule_timeout+0x209/0x2d0<br>[7841607.082815]  [&lt;ffffffff810a0858&gt;] ? __wake_up_common+0x58/0x90<br>[7841607.083492]  [&lt;ffffffff810a2484&gt;] ? __wake_up+0x44/0x50<br>[7841607.084164]  [&lt;ffffffff8160a336&gt;] wait_for_completion+0x116/0x170<br>[7841607.084851]  [&lt;ffffffff810a9610&gt;] ? wake_up_state+0x20/0x20<br>[7841607.085518]  [&lt;ffffffff81113b00&gt;] ? __call_rcu+0x2c0/0x2c0<br>[7841607.086187]  [&lt;ffffffff81093f4b&gt;] wait_rcu_gp+0x5b/0x80<br>[7841607.086845]  [&lt;ffffffff81093ed0&gt;] ? ftrace_raw_output_rcu_utilization+0x50/0x50<br>[7841607.087503]  [&lt;ffffffff811133ab&gt;] synchronize_sched+0x3b/0x50<br>[7841607.088174]  [&lt;ffffffffa037d9d0&gt;] vmci_event_unsubscribe+0x70/0xb0 [vmw_vmci]<br>[7841607.088843]  [&lt;ffffffffa0444611&gt;] vmci_transport_destruct+0x21/0xe0 [vmw_vsock_vmci_transport]<br>[7841607.089518]  [&lt;ffffffffa0436867&gt;] vsock_sk_destruct+0x17/0x60 [vsock]<br>[7841607.090189]  [&lt;ffffffff814e7aff&gt;] __sk_free+0x1f/0x170<br>[7841607.090860]  [&lt;ffffffff814e7c71&gt;] sk_free+0x21/0x30<br>[7841607.091523]  [&lt;ffffffffa04452bb&gt;] vmci_transport_recv_stream_cb+0x1fb/0x2e0 [vmw_vsock_vmci_transport]<br>[7841607.092204]  [&lt;ffffffff81099ed1&gt;] ? run_posix_cpu_timers+0x51/0x840<br>[7841607.092893]  [&lt;ffffffff810b3642&gt;] ? task_tick_fair+0x222/0x670<br>[7841607.093568]  [&lt;ffffffff815fed96&gt;] ? nohz_balance_exit_idle.part.58+0x16/0x34<br>[7841607.094243]  [&lt;ffffffffa037cf1c&gt;] vmci_datagram_invoke_guest_handler+0xbc/0xf0 [vmw_vmci]<br>[7841607.094930]  [&lt;ffffffffa037de6f&gt;] vmci_dispatch_dgs+0xcf/0x230 [vmw_vmci]<br>[7841607.095611]  [&lt;ffffffff81077a3d&gt;] tasklet_action+0x7d/0x140<br>[7841607.096291]  [&lt;ffffffff81077bf7&gt;] __do_softirq+0xf7/0x290<br>[7841607.096970]  [&lt;ffffffff8161635c&gt;] call_softirq+0x1c/0x30<br>[7841607.097640]  [&lt;ffffffff81015de5&gt;] do_softirq+0x55/0x90<br>[7841607.098312]  [&lt;ffffffff81077f95&gt;] irq_exit+0x115/0x120<br>[7841607.098981]  [&lt;ffffffff81616ef8&gt;] do_IRQ+0x58/0xf0<br>[7841607.099648]  [&lt;ffffffff8160c0ed&gt;] common_interrupt+0x6d/0x6d<br>[7841607.100316]  &lt;EOI&gt;  [&lt;ffffffff8109b928&gt;] ? hrtimer_start+0x18/0x20<br>[7841607.101003]  [&lt;ffffffffa0445420&gt;] ? vmci_transport_recv_pkt_work+0x80/0xb80 [vmw_vsock_vmci_transport]<br>[7841607.101701]  [&lt;ffffffff81052dd6&gt;] ? native_safe_halt+0x6/0x10<br>[7841607.102399]  [&lt;ffffffff8101c93f&gt;] default_idle+0x1f/0xc0<br><br><publishedDate>2015-10-08T07:03:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Es4GbIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-07T01:35:27Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-07T01:37:48Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>VMware의 vShpere 6에서 해당 vmci기능의 deprecate되었다는 공식적인 답변이 있다면, 해당 기능을 제공한 workaround를 통해서 turn off하는 것이 바람직하리라 생각됩니다.<br><br>향후, 버그질라에서 업데이트가 있으면 바로 안내드릴 예정이며, 케이스와 관련되어 update가 있으시면 케이스에 update 바랍니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2015-10-07T01:35:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ers7aIAB"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-06T04:11:59Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-06T04:11:59Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>제 설명이 부족한것 같아서 다시 안내드립니다.<br><br><br>* vmcore 분선 결과<br><br>1. vmcore 파일은 현재 완전한 상태가 아닌 incomplete상태로 해당 vmcore로는 정확하게 분석은 어려운 상태입니다.<br><br>2. 현재 vmcore에서는 시스템이 죽기전에 출력한 로그가 추출이 가능하며 아래와 같이 죽을 당시 backtrace 정보를 남기고 죽음에 따라 해당 Call Trace로 분석을 진행하였습니다.<br><br>3. 로그 분석<br><br>- 로그는 아래와 같습니다.<br><br>[4462302.065387] BUG: scheduling while atomic: swapper/4/0/0x10000100<br>[4462302.065697] Modules linked in: iptable_filter ip_tables seos(POF) snapapi26(POF) sg vmw_vsock_vmci_transport vsock coretemp ppdev vmw_balloon kvm_intel kvm crct10dif_pclmul crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr serio_raw parport_pc parport i2c_piix4 vmw_vmci shpchp nfsd auth_rpcgss nfs_acl lockd sunrpc uinput binfmt_misc xfs libcrc32c sr_mod cdrom sd_mod crc_t10dif crct10dif_common ata_generic pata_acpi vmwgfx drm_kms_helper ttm ahci libahci drm ata_piix libata vmxnet3 vmw_pvscsi i2c_core dm_mirror dm_region_hash dm_log dm_mod [last unloaded: edd]<br>[4462302.080709] CPU: 4 PID: 0 Comm: swapper/4 Tainted: PF          O--------------   3.10.0-229.1.2.el7.x86_64 #1<br>[4462302.081442] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2014<br>[4462302.082172]  ffff880fe7548000 a5453f7c76d233b0 ffff880ffe683bc8 ffffffff81604afa<br>[4462302.082901]  ffff880ffe683bd8 ffffffff815fec24 ffff880ffe683c38 ffffffff81609d54<br>[4462302.083625]  ffff880fe754bfd8 0000000000013680 ffff880fe754bfd8 0000000000013680<br>[4462302.084356] Call Trace:<br>[4462302.085069]  &lt;IRQ&gt;  [&lt;ffffffff81604afa&gt;] dump_stack+0x19/0x1b<br>[4462302.085807]  [&lt;ffffffff815fec24&gt;] __schedule_bug+0x4d/0x5b<br>[4462302.086520]  [&lt;ffffffff81609d54&gt;] __schedule+0x704/0x7b0<br>[4462302.087222]  [&lt;ffffffff810a6866&gt;] __cond_resched+0x26/0x30<br>[4462302.087912]  [&lt;ffffffff8160a20a&gt;] _cond_resched+0x3a/0x50<br>[4462302.088597]  [&lt;ffffffff8160a24f&gt;] wait_for_completion+0x2f/0x170<br>[4462302.089293]  [&lt;ffffffff810a94e6&gt;] ? try_to_wake_up+0x1b6/0x280<br>[4462302.089975]  [&lt;ffffffff810a691d&gt;] ? ttwu_do_activate.constprop.85+0x5d/0x70<br>[4462302.090658]  [&lt;ffffffff81113b00&gt;] ? __call_rcu+0x2c0/0x2c0<br>[4462302.091339]  [&lt;ffffffff81093f4b&gt;] wait_rcu_gp+0x5b/0x80<br>[4462302.092016]  [&lt;ffffffff81093ed0&gt;] ? ftrace_raw_output_rcu_utilization+0x50/0x50<br>[4462302.092701]  [&lt;ffffffff811133ab&gt;] synchronize_sched+0x3b/0x50<br>[4462302.093391]  [&lt;ffffffffa06dd9d0&gt;] vmci_event_unsubscribe+0x70/0xb0 [vmw_vmci]<br>[4462302.094076]  [&lt;ffffffffa04f9611&gt;] vmci_transport_destruct+0x21/0xe0 [vmw_vsock_vmci_transport]<br>[4462302.094769]  [&lt;ffffffffa04ef867&gt;] vsock_sk_destruct+0x17/0x60 [vsock]<br>[4462302.095462]  [&lt;ffffffff814e7aff&gt;] __sk_free+0x1f/0x170<br>[4462302.096156]  [&lt;ffffffff814e7c71&gt;] sk_free+0x21/0x30<br>[4462302.096842]  [&lt;ffffffffa04fa2bb&gt;] vmci_transport_recv_stream_cb+0x1fb/0x2e0 [vmw_vsock_vmci_transport]<br>[4462302.097546]  [&lt;ffffffffa04fa23c&gt;] ? vmci_transport_recv_stream_cb+0x17c/0x2e0 [vmw_vsock_vmci_transport]<br>[4462302.098257]  [&lt;ffffffffa06dcf1c&gt;] vmci_datagram_invoke_guest_handler+0xbc/0xf0 [vmw_vmci]<br>[4462302.098972]  [&lt;ffffffffa06dde6f&gt;] vmci_dispatch_dgs+0xcf/0x230 [vmw_vmci]<br>[4462302.099685]  [&lt;ffffffff81077a3d&gt;] tasklet_action+0x7d/0x140<br>[4462302.100394]  [&lt;ffffffff81077bf7&gt;] __do_softirq+0xf7/0x290<br>[4462302.101102]  [&lt;ffffffff8161635c&gt;] call_softirq+0x1c/0x30<br>[4462302.101805]  [&lt;ffffffff81015de5&gt;] do_softirq+0x55/0x90<br>[4462302.102501]  [&lt;ffffffff81077f95&gt;] irq_exit+0x115/0x120<br>[4462302.103194]  [&lt;ffffffff81616ef8&gt;] do_IRQ+0x58/0xf0<br>[4462302.103884]  [&lt;ffffffff8160c0ed&gt;] common_interrupt+0x6d/0x6d<br>[4462302.104569]  &lt;EOI&gt;  [&lt;ffffffff8109b928&gt;] ? hrtimer_start+0x18/0x20<br>[4462302.105265]  [&lt;ffffffffa04fa420&gt;] ? vmci_transport_recv_pkt_work+0x80/0xb80 [vmw_vsock_vmci_transport]<br>[4462302.105980]  [&lt;ffffffff81052dd6&gt;] ? native_safe_halt+0x6/0x10<br>[4462302.106686]  [&lt;ffffffff8101c93f&gt;] default_idle+0x1f/0xc0<br>[4462302.107389]  [&lt;ffffffff8101d236&gt;] arch_cpu_idle+0x26/0x30<br>[4462302.108087]  [&lt;ffffffff810c6945&gt;] cpu_startup_entry+0xf5/0x290<br>[4462302.108788]  [&lt;ffffffff810423ca&gt;] start_secondary+0x1ba/0x230<br><br><br>해당 로그에서 알수 있는 것은<br>- 시스템이 idle 상태에서 vmw_vsock_vmci_transport driver가 호출되었으며, 해당 VMware의 VMCI 기능을 위한 코드가 동작하였습니다.<br>- 그런데 해당 Call Trace를 분석해보면, <br>vmw_vsock_vmci_transport driver의 vmci_transport_destruct함수가 atomic context안에 vmci_event_unsubscribe 함수를 호출하게 됩니다.<br>- 그런데 해당 함수  vmci_event_unsubscribe는 sleep이 될 수 있고, lock 갖을 수 있는 함수를 호출하게 됩니다. <br>- 이것은 문제의 atomic context상태에서 가져서는 안될 문제의 코드로 볼 수 있습니다.<br><br><br>206 int vmci_event_unsubscribe(u32 sub_id)<br>207 {<br>208         struct vmci_subscription *s;<br>209 <br>210         mutex_lock(&amp;subscriber_mutex);<br>211         s = event_find(sub_id);<br>212         if (s)<br>213                 list_del_rcu(&amp;s-&gt;node);<br>214         mutex_unlock(&amp;subscriber_mutex);<br>215 <br>216         if (!s)<br>217                 return VMCI_ERROR_NOT_FOUND;<br>218 <br>219         synchronize_rcu();<br>220         kfree(s);<br>221 <br>222         return VMCI_SUCCESS;<br>223 }<br>224 EXPORT_SYMBOL_GPL(vmci_event_unsubscribe);<br><br><br>결론적으로, <br>- 현재 vmcore를 기반으로 분석할 결과는, VMware의 VMCI기능과 관련되 커널내 VMware Driver의 버그로 보이며,<br>- 이 문제 해결을 위하여 현재 Bugzilla가 오픈되어 있습니다.<br>======================<br>* 해당 이슈에 대한 Workaround<br><br>1. Red Hat은 현재 Bugzilla를 통해서 해당 코드를 수정할 수 있는 VMware와의 협업을 위해서 현재 대기중인 상태이며,<br><br>2. workaround로써 해당 기능을 끄는 방법을 안내하고 있습니다.<br><br>vi &lt;server_name&gt;.vmx<br>vmci0.present = &quot;FALSE&quot;<br>#vmci0.pciSlotNumber = &quot;32&quot;<br>#vmci0.id = &quot;1868206774&quot;<br>======================<br><br>* 요청사항<br><br>1. VMWare 파트너사로부터 &quot;VMWare vSphere 6에서 vmci 기능은 deprecate되어 있다 합니다.&quot;라는 말씀을 주셨는데요.. 일반적으로 deprecate되었다는 것은 코드가 해당 vSphere6에서 현재 완전히 사라진 것은 아닌것으로 보입니다. 즉, 해당 기능이 점차적으로 사라직 기능으로 점차 사용을 하지않아야 하는 코드라는 의미입니다.<br><br>해당 내용에 대해서 VMware의 공식적인 문서가 있으면 확인 바랍니다.<br>그리고 해당 내용이 공식적인 것이라면 Vsphere6에서는 현재 Red Hat이 제공하고 있는 workaround를 통해서 해당 기능을 Disable 해주는 것이 맞을 것으로 판단됩니다.<br><br> <br>2. 현재 완전하지는 않은 vmcore파일을 VMware쪽에 전달하여 해당 이슈에 대한 패치가 있는지? 또는 L2 or L3 엔지니어에서 이러한 결과에 대해서 검토하고 Kernel Upstream에 패치를 할 수 있도록 Escalation이 필요할 것으로 보입니다.<br>======================<br>감사합니다.<br><br><publishedDate>2015-10-06T04:11:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErrIOIAZ"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-06T00:52:19Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-06T00:52:19Z</b><br><br>안녕하세요, 문경윤입니다.<br><br>아래 문구가 잘 이해되지 않아 문의 드립니다.<br>&quot;해당 vmw_vsock_vmci_transport driver가 kernel-3.10 upstream에 VMware에서 반영을 함에따라 현재 저희 RHEL안에 코드가 들어는 가있는 것으로 확인됩니다.&quot;<br><br>vmw_vsock_vmci_transport driver를 kernel-3.10 upstream에 반영해 줄 것을 VMWare가 레드햇에 요청하여 레드햇이 이를 받아들여 반영했다는 뜻인지요?<br><br><br>하나 더 문의 드립니다.<br><br>VMWare vSphere 6에서 vmci 기능은 deprecate되어 있다 합니다.<br>레드햇 커널은 vmci 기능 on/off 여부와는 상관없이 vmci가 on 된 것으로 간주하고 동작하도록 코드가 만들어져 있는지요? vmci가 deprecate된 경우에 대비하지 못하도록 소스 코딩이 되어 있는 것이 아닌지 분석이 필요해 보입니다. 결국 코드 레벨에서 third party의 deprecated 여부에 대비한 일종의 function 회피 코드가 커널에 포함되지 못한데서 비롯된 이슈가 아닌가 싶습니다.<br><br><br>확인 요청 드립니다.<br>감사합니다.<br><br><publishedDate>2015-10-06T00:52:18Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000ErrCyIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-06T00:29:39Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-06T00:29:40Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>보내주신 vmcore를 통해 확인된 바를 아래 정리하여 안내드립니다.<br><br>우선 보내주신 vmcore는 incomplete상태임에 따라 vmcore에서 자세한 분석은 어려운 상황입니다. 다만, 문제가 발생했을 당시 로그를 추출하여 유사한 문제를 확인하였습니다.<br><br>[4462302.065387] BUG: scheduling while atomic: swapper/4/0/0x10000100<br>[4462302.065697] Modules linked in: iptable_filter ip_tables seos(POF) snapapi26(POF) sg vmw_vsock_vmci_transport vsock coretemp ppdev vmw_balloon kvm_intel kvm crct10dif_pclmul crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr serio_raw parport_pc parport i2c_piix4 vmw_vmci shpchp nfsd auth_rpcgss nfs_acl lockd sunrpc uinput binfmt_misc xfs libcrc32c sr_mod cdrom sd_mod crc_t10dif crct10dif_common ata_generic pata_acpi vmwgfx drm_kms_helper ttm ahci libahci drm ata_piix libata vmxnet3 vmw_pvscsi i2c_core dm_mirror dm_region_hash dm_log dm_mod [last unloaded: edd]<br>[4462302.080709] CPU: 4 PID: 0 Comm: swapper/4 Tainted: PF          O--------------   3.10.0-229.1.2.el7.x86_64 #1<br>[4462302.081442] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2014<br>[4462302.082172]  ffff880fe7548000 a5453f7c76d233b0 ffff880ffe683bc8 ffffffff81604afa<br>[4462302.082901]  ffff880ffe683bd8 ffffffff815fec24 ffff880ffe683c38 ffffffff81609d54<br>[4462302.083625]  ffff880fe754bfd8 0000000000013680 ffff880fe754bfd8 0000000000013680<br>[4462302.084356] Call Trace:<br>[4462302.085069]  &lt;IRQ&gt;  [&lt;ffffffff81604afa&gt;] dump_stack+0x19/0x1b<br>[4462302.085807]  [&lt;ffffffff815fec24&gt;] __schedule_bug+0x4d/0x5b<br>[4462302.086520]  [&lt;ffffffff81609d54&gt;] __schedule+0x704/0x7b0<br>[4462302.087222]  [&lt;ffffffff810a6866&gt;] __cond_resched+0x26/0x30<br>[4462302.087912]  [&lt;ffffffff8160a20a&gt;] _cond_resched+0x3a/0x50<br>[4462302.088597]  [&lt;ffffffff8160a24f&gt;] wait_for_completion+0x2f/0x170<br>[4462302.089293]  [&lt;ffffffff810a94e6&gt;] ? try_to_wake_up+0x1b6/0x280<br>[4462302.089975]  [&lt;ffffffff810a691d&gt;] ? ttwu_do_activate.constprop.85+0x5d/0x70<br>[4462302.090658]  [&lt;ffffffff81113b00&gt;] ? __call_rcu+0x2c0/0x2c0<br>[4462302.091339]  [&lt;ffffffff81093f4b&gt;] wait_rcu_gp+0x5b/0x80<br>[4462302.092016]  [&lt;ffffffff81093ed0&gt;] ? ftrace_raw_output_rcu_utilization+0x50/0x50<br>[4462302.092701]  [&lt;ffffffff811133ab&gt;] synchronize_sched+0x3b/0x50<br>[4462302.093391]  [&lt;ffffffffa06dd9d0&gt;] vmci_event_unsubscribe+0x70/0xb0 [vmw_vmci]<br>[4462302.094076]  [&lt;ffffffffa04f9611&gt;] vmci_transport_destruct+0x21/0xe0 [vmw_vsock_vmci_transport]<br>[4462302.094769]  [&lt;ffffffffa04ef867&gt;] vsock_sk_destruct+0x17/0x60 [vsock]<br>[4462302.095462]  [&lt;ffffffff814e7aff&gt;] __sk_free+0x1f/0x170<br>[4462302.096156]  [&lt;ffffffff814e7c71&gt;] sk_free+0x21/0x30<br>[4462302.096842]  [&lt;ffffffffa04fa2bb&gt;] vmci_transport_recv_stream_cb+0x1fb/0x2e0 [vmw_vsock_vmci_transport]<br>[4462302.097546]  [&lt;ffffffffa04fa23c&gt;] ? vmci_transport_recv_stream_cb+0x17c/0x2e0 [vmw_vsock_vmci_transport]<br>[4462302.098257]  [&lt;ffffffffa06dcf1c&gt;] vmci_datagram_invoke_guest_handler+0xbc/0xf0 [vmw_vmci]<br>[4462302.098972]  [&lt;ffffffffa06dde6f&gt;] vmci_dispatch_dgs+0xcf/0x230 [vmw_vmci]<br>[4462302.099685]  [&lt;ffffffff81077a3d&gt;] tasklet_action+0x7d/0x140<br>[4462302.100394]  [&lt;ffffffff81077bf7&gt;] __do_softirq+0xf7/0x290<br>[4462302.101102]  [&lt;ffffffff8161635c&gt;] call_softirq+0x1c/0x30<br>[4462302.101805]  [&lt;ffffffff81015de5&gt;] do_softirq+0x55/0x90<br>[4462302.102501]  [&lt;ffffffff81077f95&gt;] irq_exit+0x115/0x120<br>[4462302.103194]  [&lt;ffffffff81616ef8&gt;] do_IRQ+0x58/0xf0<br>[4462302.103884]  [&lt;ffffffff8160c0ed&gt;] common_interrupt+0x6d/0x6d<br>[4462302.104569]  &lt;EOI&gt;  [&lt;ffffffff8109b928&gt;] ? hrtimer_start+0x18/0x20<br>[4462302.105265]  [&lt;ffffffffa04fa420&gt;] ? vmci_transport_recv_pkt_work+0x80/0xb80 [vmw_vsock_vmci_transport]<br>[4462302.105980]  [&lt;ffffffff81052dd6&gt;] ? native_safe_halt+0x6/0x10<br>[4462302.106686]  [&lt;ffffffff8101c93f&gt;] default_idle+0x1f/0xc0<br>[4462302.107389]  [&lt;ffffffff8101d236&gt;] arch_cpu_idle+0x26/0x30<br>[4462302.108087]  [&lt;ffffffff810c6945&gt;] cpu_startup_entry+0xf5/0x290<br>[4462302.108788]  [&lt;ffffffff810423ca&gt;] start_secondary+0x1ba/0x230<br><br>해당 이슈는 vmw_vsock_vmci_transport driver안에서 vmci_transport_destruct 에서 vmci_event_unsubscribe 호출되어진 곳에서 이슈가 발생한 것으로 분석됩니다.<br><br>206 int vmci_event_unsubscribe(u32 sub_id)<br>207 {<br>208         struct vmci_subscription *s;<br>209 <br>210         mutex_lock(&amp;subscriber_mutex);<br>211         s = event_find(sub_id);<br>212         if (s)<br>213                 list_del_rcu(&amp;s-&gt;node);<br>214         mutex_unlock(&amp;subscriber_mutex);<br>215 <br>216         if (!s)<br>217                 return VMCI_ERROR_NOT_FOUND;<br>218 <br>219         synchronize_rcu();<br>220         kfree(s);<br>221 <br>222         return VMCI_SUCCESS;<br>223 }<br>224 EXPORT_SYMBOL_GPL(vmci_event_unsubscribe);<br><br><br>위와 관련되어 Red Hat 내부적으로 보고된 버그질라(#1253971)에 의해서 현재 해당 이슈가 다뤄지고 있는 상태입니다.<br><br>해당 vmw_vsock_vmci_transport driver가 kernel-3.10 upstream에 VMware에서 반영을 함에따라 현재 저희 RHEL안에 코드가 들어는 가있는 것으로 확인됩니다.<br>VMware에서 해당 이슈에 대한 수정은 upstream에서 VMware측에서 분석하고 코드를 잘 알고있는 VMware사에서의 반영이 필요한 사항입니다.<br><br><br>해당 이슈와 관련되어서 현재 Red Hat에서는 workaround로 아래와 같이 제공하고 있습니다.<br><br>vi &lt;server_name&gt;.vmx<br>vmci0.present = &quot;FALSE&quot;<br>#vmci0.pciSlotNumber = &quot;32&quot;<br>#vmci0.id = &quot;1868206774&quot;<br><br><br>관련된 VMware의 문서로 추정되는 문서를 첨부하여 드립니다.<br>http://kb.vmware.com/kb/1010806<br><br><br>해당 기능을 끄는 것은 일시적인 해결방법으로 해당 기능을 사용치 못하게 하는 것이기 때문에 근본적인 원인 해결을 위해서 현재의 이슈를 통해서 VMware사에 이러한 이슈에 대해서 Follow up할 수 있도록 해주시면 문제를 해결하는데 있어서 도움이 될 것같습니다.<br><br>또한, 해당 이슈를 해결하는데 있어서 Red Hat의 도움이 필요한 부분이 있다면 co-work할 수 있도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2015-10-06T00:29:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErfC1IAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-05T01:14:34Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-05T01:20:28Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>저희 엔지니어가 사전에 영어로 먼저 업데이트 드린 내용의 bugzilla는 현재 진행중에 있는 상태입니다.<br>그리고 해당 버그질라는 해당 이슈가 Red Hat Enterprise Linux 이슈라기 보다 VMware의 VMCI의 버그로 보고하고 있습니다.<br><br>그래서 향후 해당 버그는 close되거나 vmware와 함께 collaboration을 통해서 문제해결을 해 낳아가는데 초점이 될 예정이라서 시간이 많이 소요될 것으로 보입니다.<br><br>앞서 코멘트에서처럼 workaround 적용이 우선은 필요할 것으로 보입니다.<br><br><br>좀 더 자세한 설명을 위해서 유선전화를 드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2015-10-05T01:14:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErcXqIAJ"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-03T00:52:46Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-03T00:52:46Z</b><br><br>안녕하세요, 문경윤입니다.<br><br>명시해 주신 번호가 버그질라 번호가 맞죠? 익명 권한으로는 열람할 수 없네요.<br>https://bugzilla.redhat.com/show_bug.cgi?id=1253971<br><br>이번에 처음 보고된 버그인지요? 그렇다면 패치가 제작 중인지요?<br>bug가 fix되기까지 기다려야 한다면 workaround를 먼저 가이드하는 것이 맞다고 생각이 드는데요. 현 시점에서의 레드햇의 공식 가이드를 요청 드립니다.<br><br><publishedDate>2015-10-03T00:52:46Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000ErZfkIAF"><br>======================<br><b>생성계정 : Krzesinski, Herton</b><br><b>생성날짜 : 2015-10-02T17:25:58Z</b><br><b>마지막 답변자 : Krzesinski, Herton</b><br><b>마지막 수정 일자 : 2015-10-02T17:25:58Z</b><br><br>This is the main issue, at least from what's on the log:<br><br>[4462302.065387] BUG: scheduling while atomic: swapper/4/0/0x10000100<br>[4462302.065697] Modules linked in: iptable_filter ip_tables seos(POF) snapapi26(POF) sg vmw_vsock_vmci_transport vsock coretemp ppdev vmw_balloon kvm_intel kvm crct10dif_pclmul crc32_pclmul crc32c_intel ghash_clmulni_intel aesni_intel lrw gf128mul glue_helper ablk_helper cryptd pcspkr serio_raw parport_pc parport i2c_piix4 vmw_vmci shpchp nfsd auth_rpcgss nfs_acl lockd sunrpc uinput binfmt_misc xfs libcrc32c sr_mod cdrom sd_mod crc_t10dif crct10dif_common ata_generic pata_acpi vmwgfx drm_kms_helper ttm ahci libahci drm ata_piix libata vmxnet3 vmw_pvscsi i2c_core dm_mirror dm_region_hash dm_log dm_mod [last unloaded: edd]<br>[4462302.080709] CPU: 4 PID: 0 Comm: swapper/4 Tainted: PF          O--------------   3.10.0-229.1.2.el7.x86_64 #1<br>[4462302.081442] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2014<br>[4462302.082172]  ffff880fe7548000 a5453f7c76d233b0 ffff880ffe683bc8 ffffffff81604afa<br>[4462302.082901]  ffff880ffe683bd8 ffffffff815fec24 ffff880ffe683c38 ffffffff81609d54<br>[4462302.083625]  ffff880fe754bfd8 0000000000013680 ffff880fe754bfd8 0000000000013680<br>[4462302.084356] Call Trace:<br>[4462302.085069]  &lt;IRQ&gt;  [&lt;ffffffff81604afa&gt;] dump_stack+0x19/0x1b<br>[4462302.085807]  [&lt;ffffffff815fec24&gt;] __schedule_bug+0x4d/0x5b<br>[4462302.086520]  [&lt;ffffffff81609d54&gt;] __schedule+0x704/0x7b0<br>[4462302.087222]  [&lt;ffffffff810a6866&gt;] __cond_resched+0x26/0x30<br>[4462302.087912]  [&lt;ffffffff8160a20a&gt;] _cond_resched+0x3a/0x50<br>[4462302.088597]  [&lt;ffffffff8160a24f&gt;] wait_for_completion+0x2f/0x170<br>[4462302.089293]  [&lt;ffffffff810a94e6&gt;] ? try_to_wake_up+0x1b6/0x280<br>[4462302.089975]  [&lt;ffffffff810a691d&gt;] ? ttwu_do_activate.constprop.85+0x5d/0x70<br>[4462302.090658]  [&lt;ffffffff81113b00&gt;] ? __call_rcu+0x2c0/0x2c0<br>[4462302.091339]  [&lt;ffffffff81093f4b&gt;] wait_rcu_gp+0x5b/0x80<br>[4462302.092016]  [&lt;ffffffff81093ed0&gt;] ? ftrace_raw_output_rcu_utilization+0x50/0x50<br>[4462302.092701]  [&lt;ffffffff811133ab&gt;] synchronize_sched+0x3b/0x50<br>[4462302.093391]  [&lt;ffffffffa06dd9d0&gt;] vmci_event_unsubscribe+0x70/0xb0 [vmw_vmci]<br>[4462302.094076]  [&lt;ffffffffa04f9611&gt;] vmci_transport_destruct+0x21/0xe0 [vmw_vsock_vmci_transport]<br>[4462302.094769]  [&lt;ffffffffa04ef867&gt;] vsock_sk_destruct+0x17/0x60 [vsock]<br>[4462302.095462]  [&lt;ffffffff814e7aff&gt;] __sk_free+0x1f/0x170<br>[4462302.096156]  [&lt;ffffffff814e7c71&gt;] sk_free+0x21/0x30<br>[4462302.096842]  [&lt;ffffffffa04fa2bb&gt;] vmci_transport_recv_stream_cb+0x1fb/0x2e0 [vmw_vsock_vmci_transport]<br>[4462302.097546]  [&lt;ffffffffa04fa23c&gt;] ? vmci_transport_recv_stream_cb+0x17c/0x2e0 [vmw_vsock_vmci_transport]<br>[4462302.098257]  [&lt;ffffffffa06dcf1c&gt;] vmci_datagram_invoke_guest_handler+0xbc/0xf0 [vmw_vmci]<br>[4462302.098972]  [&lt;ffffffffa06dde6f&gt;] vmci_dispatch_dgs+0xcf/0x230 [vmw_vmci]<br>[4462302.099685]  [&lt;ffffffff81077a3d&gt;] tasklet_action+0x7d/0x140<br>[4462302.100394]  [&lt;ffffffff81077bf7&gt;] __do_softirq+0xf7/0x290<br>[4462302.101102]  [&lt;ffffffff8161635c&gt;] call_softirq+0x1c/0x30<br>[4462302.101805]  [&lt;ffffffff81015de5&gt;] do_softirq+0x55/0x90<br>[4462302.102501]  [&lt;ffffffff81077f95&gt;] irq_exit+0x115/0x120<br>[4462302.103194]  [&lt;ffffffff81616ef8&gt;] do_IRQ+0x58/0xf0<br>[4462302.103884]  [&lt;ffffffff8160c0ed&gt;] common_interrupt+0x6d/0x6d<br>[4462302.104569]  &lt;EOI&gt;  [&lt;ffffffff8109b928&gt;] ? hrtimer_start+0x18/0x20<br>[4462302.105265]  [&lt;ffffffffa04fa420&gt;] ? vmci_transport_recv_pkt_work+0x80/0xb80 [vmw_vsock_vmci_transport]<br>[4462302.105980]  [&lt;ffffffff81052dd6&gt;] ? native_safe_halt+0x6/0x10<br>[4462302.106686]  [&lt;ffffffff8101c93f&gt;] default_idle+0x1f/0xc0<br>[4462302.107389]  [&lt;ffffffff8101d236&gt;] arch_cpu_idle+0x26/0x30<br>[4462302.108087]  [&lt;ffffffff810c6945&gt;] cpu_startup_entry+0xf5/0x290<br>[4462302.108788]  [&lt;ffffffff810423ca&gt;] start_secondary+0x1ba/0x230<br><br>The problem above apparently lies within the vmw_vsock_vmci_transport driver: vmci_transport_destruct calls vmci_event_unsubscribe in atomic context: the problem is that vmci_event_unsubscribe can sleep, it calls mutex_lock and synchronize_rcu()...:<br><br>206 int vmci_event_unsubscribe(u32 sub_id)<br>207 {<br>208         struct vmci_subscription *s;<br>209 <br>210         mutex_lock(&amp;subscriber_mutex);<br>211         s = event_find(sub_id);<br>212         if (s)<br>213                 list_del_rcu(&amp;s-&gt;node);<br>214         mutex_unlock(&amp;subscriber_mutex);<br>215 <br>216         if (!s)<br>217                 return VMCI_ERROR_NOT_FOUND;<br>218 <br>219         synchronize_rcu();<br>220         kfree(s);<br>221 <br>222         return VMCI_SUCCESS;<br>223 }<br>224 EXPORT_SYMBOL_GPL(vmci_event_unsubscribe);<br><br>The destruct callbacks are called due to sk_put at end of vmci_transport_recv_stream_cb. sk_put can be called in BH context/atomic context...<br><br>There is an internal bug about this issue (1253971), I'm attaching this case to it.<br><br>It seems that to avoid the problem, as a workaround, VMCI could be disabled on ESX host. For example, these are instructions from the internal bug:<br><br>--------<br>To disable VMCI<br>Edit the .vmx file and change the value of vmci0.present to &quot;FALSE&quot; and comment out vmci0 lines.<br><br>vi &lt;server_name&gt;.vmx<br>vmci0.present = &quot;FALSE&quot;<br>#vmci0.pciSlotNumber = &quot;32&quot;<br>#vmci0.id = &quot;1868206774&quot;<br><br>--------<br><br>Other way probably is to follow the reverse instructions from http://kb.vmware.com/kb/1010806<br><br>Regards,<br>Herton Krzesinski<br>Software Maintenance Engineer<br>Support Engineering Group - Red Hat<br><br><publishedDate>2015-10-02T17:25:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErTMuIAN"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-02T05:26:57Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-02T05:26:58Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>보내주신 vmcore 파일을 분석 한 후 답변드리도록 하겠습니다.<br><br>일반적으로 vmcore는 영업일 기준 3일 정도가 소요되며, 물론 그 전에 분석이 완료될 경우 바로 안내드리고 있습니다.<br><br><br>분석 후, 답변 드리도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2015-10-02T05:26:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErTAFIA3"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-02T04:39:57Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-02T04:39:58Z</b><br><br>문경윤입니다.<br>sfqsbxal01 시스템에서만 vmcore가 확인되었습니다.<br>ftp://dropbox.redhat.com 에 업로드하였습니다.<br><br>ftp://dropbox.redhat.com/incoming/sfqsbxal01-vmcore.tar.bz2<br><br>[root@fence customer]# ls -lk sfqsbxal01-vmcore/<br>total 701724<br>-rw-r--r-- 1 ftp ftp 700680 Oct  2 13:30 vmcore<br>-rw-r--r-- 1 ftp ftp   1038 Oct  2 13:28 vmcore-dmesg.txt<br>[root@fence customer]#<br><br>감사합니다.<br>======================<br><br>(HAN, JINKOO에 회신)<br>&gt; 안녕하세요,<br>&gt; Red Hat 한진구 입니다<br>&gt; <br>&gt; 방금 유선통화했던 내용 정리하여 드립니다.<br>&gt; <br>&gt; 1. 우선 고객사에 있는 vmcore 파일이 생성된 것들이 있으면 Red Hat으로 전달 부탁드립니다.<br>&gt; 2. 추후의 vmcore 생성을 위해서 기존의 /var/crash 디렉토리 안의 공간을 clear했으면 합니다.<br>&gt; <br>&gt; 기타 업데이트 내용이 있으면 업데이트 바라며, vmcore 확인되면 업로드 바랍니다.<br>&gt; <br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2015-10-02T04:39:57Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000ErShNIAV"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-02T02:22:43Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-02T02:22:43Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다<br><br>방금 유선통화했던 내용 정리하여 드립니다.<br><br>1. 우선 고객사에 있는 vmcore 파일이 생성된 것들이 있으면 Red Hat으로 전달 부탁드립니다.<br>2. 추후의 vmcore 생성을 위해서 기존의 /var/crash 디렉토리 안의 공간을 clear했으면 합니다.<br><br>기타 업데이트 내용이 있으면 업데이트 바라며, vmcore 확인되면 업로드 바랍니다.<br>======================<br>감사합니다.<br><br><publishedDate>2015-10-02T02:22:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErSGWIA3"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-02T00:25:54Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-02T00:25:54Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>분석 감사합니다. 고객께는 내용을 모두 전달하였습니다.<br><br>kernel.panic 커널 파라미터를 디폴트인 kernel.panic = 0 으로 둔 이유는 kexec 때문입니다.<br>커널 패닉이 나면 OS가 kdump를 수행하기 위해 kexec에 의해 auto reboot이 되므로 kernel.panic 옵션을 굳이 활성화시킬 필요가 없었기 때문입니다.<br><br>감사합니다.<br><br><publishedDate>2015-10-02T00:25:54Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000ErIOvIAN"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-01T07:15:28Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-01T07:15:29Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 보내주신 4대의 sosreport를 확인을 하였으나 재부팅과 관련되어 큰 관련성있는 원인을 추정할만한 단서를 찾지는 못하였습니다.<br><br>그런데.. 공통적으로.. 처음 보내주신 시스템 및 기타 시스템들에서 /var/crash 디렉토리안이 비어있지 않은 것으로 보입니다.<br><br>1. 혹시 해당 디렉토리 안에 vmcore 정보가 있는지 imcomplete라도 있는지 재 확인 바랍니다.<br><br>sosreport-sfdeccal01-20150919180731/sos_commands/filesys/df_-al<br>Filesystem                     1K-blocks     Used Available Use% Mounted on<br><br>/dev/mapper/KDUMPVG-kdump_lv   314415108 15676664 298738444   5% /var/crash<br><br><br>&lt;sfqbisal01&gt;<br>    System MemTotal (uncompressed core size) { 47.12 GiB }<br>    Available free space on target path's fs { 17.59 GiB }  (fs=/var/crash)<br><br>&lt;sfqdssal01&gt;<br>    System MemTotal (uncompressed core size) { 31.34 GiB }<br>    Available free space on target path's fs { 17.57 GiB }  (fs=/var/crash)<br><br>&lt;sfdeccal01&gt;<br>Filesystem                     1K-blocks     Used Available Use% Mounted on<br>/dev/mapper/KDUMPVG-kdump_lv   314415108 15676664 298738444   5% /var/crash<br><br>&lt;sfqsbxal01&gt;<br>Filesystem                         1K-blocks     Used Available Use% Mounted on<br>/dev/mapper/KDUMPVG-kdump_lv       110042628 29109340  80933288  27% /var/crash<br><br><br>2. 또한 해당 디렉토리안에 데이터가 있을 경우, 추후 crash발생시에 dump가 저장되지 않을 수 있으므로 해당 데이터를 정리하여 주시기 바랍니다.<br><br><br>현재로써는 추가 이슈가 발생하여 vmcore가 생성되어야 문제의 원인을 찾는데 도움이 될 것 같습니다. 그런데 두대의 시스템에서 sysrq 기능이 켜져 있지 않은 것 같습니다. <br><br>sfqdssal01, sfqbisal01<br><br>3. sysrq 기능을 켜두시는 것을 권장드리며, 켜는 방법은 아래 문서를 링크 드립니다.<br><br>- https://access.redhat.com/articles/231663<br>======================<br>4. 지금 모든 시스템들이 커널이 crash 될고나면 시스템을 자동 재부팅되지 않게 설정되어있습니다.<br><br>    kernel.panic [secs] =  0  (no autoreboot on panic)<br><br><br>이렇게 설정된 특별한 이유가 있으신지요?<br>그리고.. 추가 4대의 경우 시스템이 모두 자동 재부팅되었다고 하셨는데.. 혹시 VMware에서 어떤 cluster 구성이 되어있는지요? 시스템이 hang이 될때 rebooting 시키는 어떤 조건들이 있는지 확인 바랍니다.<br><br><br>5. 현재 VMware에서 출력하는 로그는 kernel이 hang이 발생하는 당시에도 발생할 수 상활일때 발생할 수 있는 로그로 보이는데 특정 시스템에서 hung_task가 발생했던 로그가 있습니다.<br><br><br>&lt;sfqdssal01&gt;<br><br>Sep 24 19:25:27 sfqdssal01 kernel: INFO: task mms:3423 blocked for more than 120 seconds.<br>Sep 24 19:25:27 sfqdssal01 kernel: &quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot; disables this message.<br>Sep 24 19:25:27 sfqdssal01 kernel: mms           D 0000000000000000     0  3423      1 0x00000000<br>Sep 24 19:25:27 sfqdssal01 kernel: ffff8807e9817b18 0000000000000082 0000000000000000 ffffffffa00041fc<br>Sep 24 19:25:27 sfqdssal01 kernel: ffff8807e9817ae8 00000000d7d60843 0000000000000000 ffff8808255a9480<br>Sep 24 19:25:27 sfqdssal01 kernel: ffff88080f3b3ab8 ffff8807e9817fd8 000000000000fb88 ffff88080f3b3ab8<br>Sep 24 19:25:27 sfqdssal01 kernel: Call Trace:<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffffa00041fc&gt;] ? dm_table_unplug_all+0x5c/0x100 [dm_mod]<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff814fdfc3&gt;] io_schedule+0x73/0xc0<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff811b663e&gt;] __blockdev_direct_IO_newtrunc+0x6fe/0xb90<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff811b6b2e&gt;] __blockdev_direct_IO+0x5e/0xd0<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff811b33e0&gt;] ? blkdev_get_blocks+0x0/0xc0<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff811b4247&gt;] blkdev_direct_IO+0x57/0x60<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff811b33e0&gt;] ? blkdev_get_blocks+0x0/0xc0<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff81115fcb&gt;] generic_file_aio_read+0x6bb/0x700<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff8117aeaa&gt;] do_sync_read+0xfa/0x140<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff810533f3&gt;] ? __wake_up+0x53/0x70<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff810920d0&gt;] ? autoremove_wake_function+0x0/0x40<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff8131347f&gt;] ? extract_entropy_user+0xbf/0x130<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff8121fd8b&gt;] ? selinux_file_permission+0xfb/0x150<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff81213136&gt;] ? security_file_permission+0x16/0x20<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff8117b8b5&gt;] vfs_read+0xb5/0x1a0<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff8117bbe2&gt;] sys_pread64+0x82/0xa0<br>Sep 24 19:25:27 sfqdssal01 kernel: [&lt;ffffffff8100b0f2&gt;] system_call_fastpath+0x16/0x1b<br><br><br>그리고 현재 모든 시스템에 hang발생시에 kernel이 crash되도록 설정하는 것이 어떨까 싶습니다. 물론 처음 시스템처럼 nmi도 기능을 켜주었으면 합니다.<br><br>    kernel.hung_task_panic =  1<br>    kernel.panic_on_io_nmi =  1<br>======================<br>위의 확인 요청드린 내용에 대해서 추가 확인 부탁드리며, hang 발생시에도 crash 시킬 수 있도록 일시적으로 설정이 가능할지도 확인 바랍니다.<br>======================<br>6. 추가적으로 kdump는 모두 설정된 것으로 보이나, 실제로 kdump가 crash시에 정상적으로 동작하는지에 대해서도 한 번 테스트 해보셨는지 확인 바랍니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2015-10-01T07:15:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErH8cIAF"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-01T02:20:00Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-01T02:20:00Z</b><br><br>오픈소스컨설팅 문경윤입니다.<br><br>VMware Log 및 이슈 발생시각 보내드립니다.<br>The CPU has been disabled by the guest operating system. Power off or reset the virtual machine.<br>sfqsbxal01    8/30    11:00<br>sfqbisal01    9/12    10:40<br>sfqdssal01    9/19    09:27:59<br>sfdeccal01    9/19    07:13:13<br><br><publishedDate>2015-10-01T02:19:59Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000ErGyNIAV"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-10-01T01:35:07Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-10-01T01:35:07Z</b><br><br>네, 확인해서 회신 드리겠습니다.<br><br>(HAN, JINKOO에 회신)<br>&gt; 안녕하세요,<br>&gt; Red Hat 한진구 입니다.<br>&gt; <br>&gt; 보내주신 데이터를 확인후에 업데이트 드리겠습니다.<br>&gt; <br>&gt; 3대에도 모두 VMware에서 &quot;CPU has been disabled...&quot;라는 메시지를 찍은 것인지요? 그리고.. 혹시.. 그 시간들을 VMware에서  확인가능할런지요? 확인 부탁드립니다.<br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2015-10-01T01:35:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000ErGxFIAV"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-10-01T01:30:21Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-10-01T01:30:21Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>보내주신 데이터를 확인후에 업데이트 드리겠습니다.<br><br>3대에도 모두 VMware에서 &quot;CPU has been disabled...&quot;라는 메시지를 찍은 것인지요? 그리고.. 혹시.. 그 시간들을 VMware에서  확인가능할런지요? 확인 부탁드립니다.<br><br><br>감사합니다.<br><br><publishedDate>2015-10-01T01:30:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000ErBquIAF"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-09-30T15:30:10Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-09-30T15:30:10Z</b><br><br>안녕하세요, 문경윤입니다. 파일 첨부해 드렸습니다.<br><br><publishedDate>2015-09-30T15:30:10Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Er6HhIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-09-30T06:24:51Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-09-30T06:24:51Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>3대는 auto reboot 되었다고 하셨는데요.. 혹시 해당 시스템의 sosreport (and vmcore)를 받아볼 수 있을까요?<br><br><br>확인 바랍니다.<br>======================<br>감사합니다.<br><br><publishedDate>2015-09-30T06:24:51Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Er5BBIAZ"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-09-30T02:13:30Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-09-30T02:13:30Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>장애 당시 증상은 아래와 같습니다.<br><br>3대는 auto reboot<br><br>1대는 down<br>콘솔 검은 화면<br>핑 X<br>키보드 입력 X<br>수동 reboot 처리<br>======================<br><br>기술적으로 분석이 어려울 시 유사 사례라도 알려 달라는 고객사의 요청이 있음을 전달 드립니다.<br><br>감사합니다.<br><br><publishedDate>2015-09-30T02:13:29Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Er4uoIAB"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-09-30T01:09:16Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-09-30T01:09:17Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>VMware에서 VM(Virtual Machine)에 core수를 설정하는 방법을 안내받은 것으로 보입니다.<br><br>우선, CPU가 갑자기 disable된 것이 WMware의 이슈인지 OS차원에서의 이슈인지 아직은 정확하지는 않습니다. 그래서 이것을 좀 더 분석하기 위해서는 vmcore파일이 절실히 필요한 상태입니다.<br>그런데.. 이렇게 CPU가 갑작스럽게 disable되는 상황에서 간혹 kdump가 제대로 동작하지 않을 수 있을 수 있는 것으로 보입니다. 이러한 경우에는 화면상태에 상태 정보라도 capture되었으면 합니다.<br><br><br>업무에 참고하여 주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2015-09-30T01:09:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EqXReIAN"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-09-25T08:52:41Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-09-25T08:52:41Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>VMWare 측의 추가 분석 결과 전해 드립니다.<br>======================<br><br><br><br>※ 본 메일로 회신 시 메일 
제목과 서명 정보를 변경하지 마시고, 반드시 본 메일의 본문을 포함하여 회신해 주시기 바랍니다. <br><br>안녕하세요. 고객님, <br><br>고객님의 기술지원 요청사항은 '[Samsung Fire&amp;Marine Insurance] CPU 3개로 설정했지만 2개로 보이는 이슈' 입니다. <br>기존에 업로드하신 로그에서 해당 가상머신:SFQSBXAL01(221.36)을 확인해보니 아래와 같습니다.<br>vcpu 변경은 확인 되지 않습니다.<br><br>numvcpus = &quot;16&quot;<br>cpuid.coresPerSocket = &quot;2&quot;<br>sched.cpu.units = &quot;mhz&quot;<br>sched.cpu.latencySensitivity = &quot;normal&quot;<br>vcpu.hotadd = &quot;true&quot;<br>sched.cpu.min = &quot;0&quot;<br>sched.cpu.shares = &quot;normal&quot;<br><br>추가로, cpu 코어수 셋팅에 관하여 아래 KB참조해 주십시오. <br><br>Setting the number of cores per CPU in a virtual machine (1010184)<br><br>http://kb.vmware.com/kb/1010184<br><br>문의하신 내용에 답변이 되었다면, 케이스 종료 여부 메일로 회신부탁드립니다. <br>VMware 제품을 이용해 주셔서 감사합니다. <br><br>Arisa, Kim <br>Technical Support Engineer <br>Global Support Services, VMware Inc. <br>전화: (국번 없이) 0079-8862-0750 <br>Review your Support Requests Online: http://support.vmware.com/selfsupport/ <br><br>Satisfied customers are our top priority. <br>Please contact my manager, Jackie Jiang: &lt;jjiang@vmware.com&gt; / +86 411 8483 2141 <br>if you would like to provide feedback on your support experience.<br><br><publishedDate>2015-09-25T08:52:41Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EqX2SIAV"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-09-25T07:53:55Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-09-25T07:53:55Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>유선으로 설명드렸듯이 severity는 케이스 중요도에 대한 level 이 아닙니다. 해당 Severity는 1에서 3으로 변경처리할 예정이나, 본 케이스는 현재 담당 Technical Account Manager인 제가 케이스를 follow up 할 예정이기때문에 가장 우선순위에서 케이스가 처리될 예정입니다.<br><br><br>업무에 참고 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2015-09-25T07:53:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EqVr7IAF"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-09-25T05:06:18Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-09-25T05:06:18Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스와 관련되어 유선통화를 하고자 합니다.<br><br>연락처를 남겨주시면 연락드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2015-09-25T05:06:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000EqVdjIAF"><br>======================<br><b>생성계정 : SamsungFire, OSC</b><br><b>생성날짜 : 2015-09-25T04:17:13Z</b><br><b>마지막 답변자 : SamsungFire, OSC</b><br><b>마지막 수정 일자 : 2015-09-25T04:17:13Z</b><br><br>오픈소스컨설팅 문경윤입니다.<br><br>앞으로는 고객 명의의 계정이 아닌 osc4samsungfire 계정으로 로그인하여 문의 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2015-09-25T04:17:12Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EqVd0IAF"><br>======================<br><b>생성계정 : 이, 주호</b><br><b>생성날짜 : 2015-09-25T04:13:59Z</b><br><b>마지막 답변자 : 이, 주호</b><br><b>마지막 수정 일자 : 2015-09-25T04:13:59Z</b><br><br>금번 이슈로 인해 고객께서 RHEL 7.0 도입 여부를 심각하게 고민할 수 있다는 의견을 주셨습니다.<br><br>그러므로 심각도를 최상으로 올려 응대해 주실 것을 요청 드립니다.<br><br><br>감사합니다.<br><br><publishedDate>2015-09-25T04:13:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EqVcWIAV"><br>======================<br><b>생성계정 : 이, 주호</b><br><b>생성날짜 : 2015-09-25T04:12:01Z</b><br><b>마지막 답변자 : 이, 주호</b><br><b>마지막 수정 일자 : 2015-09-25T04:12:01Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>고객사에 NMI Switch 설정법을 가이드한 상태입니다.<br><br>다만 kernel.panic_on_io_nmi = 1 옵션은 HP Gen6, 7 시리즈에만 해당하는 것으로 레드햇 kbase에서 확인되어 이를 제외한 나머지 두 옵션만을 적용하도록 가이드하였습니다.<br><br>No kernel option panic_on_io_nmi in RHEL5 and HP G6/7 NMI can not trigger a crash.<br>https://access.redhat.com/solutions/185163<br>======================<br><br>VMWare의 분석 결과가 두 차례에 걸쳐 나왔습니다. 검토 요청 드립니다.<br>======================<br><br>1차 결과<br><br>※ 본 메일로 회신 시 메일 
제목과 서명 정보를 변경하지 마시고, 반드시 본 메일의 본문을 포함하여 회신해 주시기 바랍니다. <br><br>안녕하세요. 고객님, <br><br>고객님의 기술지원 요청사항은 '[Samsung Fire&amp;Marine Insurance] VM auto rebooting issue' 입니다. <br> <br> <br>파트너 엔지니어 분과 유선 상으로 말씀드린 내용 다시 한 번 정리해드립니다. <br>이슈 발생 VM : SFQSBXAL01(221.36)의 로그를 확인해 본 결과, 이슈 발생 시간 대에 아래와 같은 메시지가 기록된 것으로 확인되었습니다. <br> <br>The CPU has been disabled by the guest operating system. Power off or reset the virtual machine. <br> <br>esx-SFQESXMV01-2015-09-21--07.23/vmfs/volumes/55410a5a-892a12b3-7d5b-90e2ba820524/SFQSBXAL01(221.36)<br> <br>2015-08-30T02:00:01.453Z| vcpu-0| I120: Vix: [863584 vmxCommands.c:7739]: VMAutomation_HandleCLIHLTEvent. Do nothing. <br>2015-08-30T02:00:01.453Z| vcpu-0| I120: MsgHint: msg.monitorevent.halt <br>2015-08-30T02:00:01.453Z| vcpu-0| I120+ The CPU has been disabled by the guest operating system. Power off or reset the virtual machine. <br>2015-08-30T02:00:01.453Z| vcpu-0| I120+ --------------------------------------- <br>2015-08-30T02:00:01.454Z| vcpu-0| I120: Vigor_MessageRevoke: message 'msg.monitorevent.halt' (seq 11893647) is revoked<br> <br>2015-08-30T02:00:01.453Z| vcpu-0| I120: Vix: [863584 vmxCommands.c:7739]: VMAutomation_HandleCLIHLTEvent. Do nothing.<br> <br>이 이슈는 KB2000542 에 설명된 내용으로 가상머신 Guest OS에서의 심각한 에러에 의해 발생합니다. <br> <br>Understanding the message: The CPU has been disabled by the guest operating system (2000542)<br>http://kb.vmware.com/kb/2000542<br> <br>kb의 내용에 따르면, 해당 이슈는 Guest OS 에 의해 발생하는 이슈이므로, 해당 Guest OS 벤더를 통해 지원 받으시기를 권해드립니다.<br> <br>Symptoms<br>A VMware virtual machine stops running, reporting that the CPU has been disabled by the guest operating system.<br>·    The user interface reports a message similar to:<br>o The CPU has been disabled by the guest operating system. Power off or reset the virtual machine.<br>o The CPU has been disabled by the guest operating system. You will need to power off or reset the virtual machine at this point.<br> <br>·    The virtual machine's log file reports a message similar to:<br><br>Vix: [nnnnnnn vmxCommands.c:nnnn]: VMAutomation_HandleCLIHLTEvent. Do nothing.<br>Purpose<br>This message is seen when a guest operating system running in a VMware virtual machine intentionally halts the virtual CPU by executing the instructions CLI and HLT in succession. This can occur during a critical error or fault within the Guest OS.<br>Resolution<br>This event is caused by actions within the Guest OS. To determine the reason for the guest operating system executing these instructions, collect all information from the virtual machine prior to beginning analysis.<br> <br> <br><br>VMware 제품을 이용해 주셔서 감사합니다. <br><br>소초롱 <br>Technical Support Engineer <br>Global Support Services, VMware Inc. <br>전화: (국번 없이) 0079-8862-0750 <br>Review your Support Requests Online: http://support.vmware.com/selfsupport/ <br><br>Satisfied customers are our top priority. <br>Please contact my manager, Jackie Jiang: &lt;jjiang@vmware.com&gt; / +86 411 8483 2141 <br><br>if you would like to provide feedback on your support experience.<br>======================<br><br><br><br>2차 결과<br><br>※ 본 메일로 회신 시 메일 
제목과 서명 정보를 변경하지 마시고, 반드시 본 메일의 본문을 포함하여 회신해 주시기 바랍니다. <br><br>안녕하세요. 고객님, <br><br>고객님의 기술지원 요청사항은 '[Samsung Fire&amp;Marine Insurance] VM auto rebooting issue' 입니다. <br><br>추가 문의한 내용을 설명을 드리자면, CLI및 HLT 는 게스트 OS 의 심각한 오류 또는 장애시 발생할수 있습니다. <br><br>게스트 OS에서 CLI 및 HLT 명령을 계속 실행하고 가상 CPU를 의도적으로 중지 된 경우에 표시됩니다. OS의 커널에 의해 생성된 오류메시지는 콘솔 또는 로그 파일에서 확인할수 있습니다, 이는 게스트 OS 공급업체에 문의하십시오. <br><br>CLI 명령어는 게스트 OS 커널 등의 특권 시스템 소프트웨어에서만 실행할수 있습니다.  HLT 명령 일반적으로 게스트 OS 커널에 심각한 장애를 나타내지만 근본 원인을 규명하려면 자세한 분석이 필요합니다. <br><br>CLI 명령은 인터럽트가 발생하지 않도록 하고, HLT 명령은 다음의 인터럽트가 발생할때까지 CPU 를 중지합니다. <br><br>그리하여, 이 두의 조합은 이후의 인터럽트가 발생하지 않고 cpu가 의도적으로 정지됩니다. <br><br>이부분에 대하여 추가 설명은 게스트 OS 공급업체에 문의하시는걸 권장드립니다.<br><br>문의에 대한 답변이 되었다면, 해당 케이스 종료하도록 회신 부탁드립니다<br>VMware 제품을 이용해 주셔서 감사합니다. <br><br>Arisa, Kim <br>Technical Support Engineer <br>Global Support Services, VMware Inc. <br>전화: (국번 없이) 0079-8862-0750 <br>Review your Support Requests Online: http://support.vmware.com/selfsupport/ <br><br>Satisfied customers are our top priority. <br>Please contact my manager, Jackie Jiang: &lt;jjiang@vmware.com&gt;/ +86 411 8483 2141 <br>if you would like to provide feedback on your support experience.<br><br><publishedDate>2015-09-25T04:12:01Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EqJQsIAN"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-09-24T00:48:09Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-09-24T00:48:09Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>nmi를 모두 turn on하기 위한 것이라면.. 해당 문서대로 설정하시면 될 것 같습니다. 다만, nmi를 모두 켜 두려고 하는 것이면.. 추가적으로 아래 파라미터도 활성화 바랍니다.<br><br>kernel.panic_on_unrecovered_nmi = 1<br>kernel.unknown_nmi_panic = 1<br><br>and<br><br>kernel.panic_on_io_nmi = 1<br><br><br>기존에 kdump가 설정이 되어있던 것으로 보이기 때문에 별도의 리부팅은 반드시 하지는 않아도 될 것 같으나, kdump가 잘 생성되는지 magic키로 한 번더 체크를 해보는 것을 권장드립니다.<br><br><br>그리고 저희 문서상에서 VMware vSphere에서 강제로 crash 시키는 방법을 추후 사용할 계획이시라면... 이에 대해서는 자세한 내용을 VMWare 쪽에 한 번 더 확인해보시기 바랍니다.<br>======================<br><br>감사합니다.<br><br><br>Jinkoo<br>APAC Technical Account Manager<br><br><publishedDate>2015-09-24T00:48:09Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Eq8t6IAB"><br>======================<br><b>생성계정 : 이, 주호</b><br><b>생성날짜 : 2015-09-23T05:49:37Z</b><br><b>마지막 답변자 : 이, 주호</b><br><b>마지막 수정 일자 : 2015-09-23T05:49:37Z</b><br><br>안녕하세요, 오픈소스컨설팅 문경윤입니다.<br><br>확인 요청 주신 건들은 확인 중에 있습니다.<br><br><br>어제 레드햇 박준완 부장님과 함께 들어간 미팅에서 OS측 가이드로 NMI switch 설정을 하기로 하였습니다.<br>NMI switch 사용을 위한 OS 설정이 하드웨어, OS버전 별로 방법이 조금씩 다른 것을 확인하였습니다.<br><br>VMWare vSpherer 6의 VM에 설치된 RHEL 7.0에 아래 방법을 적용하면 되는 것인지 확인 요청 드립니다.<br><br>How to use VMWare ESX command line to force NMI panic on RHEL guest O/S<br>https://access.redhat.com/solutions/338003<br><br>OS restart가 필요한지도 확인 부탁드립니다.<br><br><br>감사합니다.<br><br><publishedDate>2015-09-23T05:49:37Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000EpyOpIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2015-09-22T07:42:01Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2015-09-22T07:42:01Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>우선 보내주신 데이터를 확인한 결과, <br>- 말씀하신 9/19 01:37분경에 시스템 재부팅이 발생한 것으로 확인됩니다.<br><br>Sep 19 01:37:23 sfdeccal01 kernel: Initializing cgroup subsys cpuset<br>Sep 19 01:37:23 sfdeccal01 kernel: Initializing cgroup subsys cpu<br>Sep 19 01:37:23 sfdeccal01 kernel: Initializing cgroup subsys cpuacct<br>Sep 19 01:37:23 sfdeccal01 kernel: Linux version 3.10.0-229.1.2.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.2 20140120 (Red Hat 4.8.2-16) (GCC) ) #1 SMP Fri Mar 27 03:04:26 UTC 2015<br>Sep 19 01:37:23 sfdeccal01 kernel: Command line: BOOT_IMAGE=/vmlinuz-3.10.0-229.1.2.el7.x86_64 root=/dev/mapper/rhel-root ro rd.lvm.lv=rhel/root vconsole.keymap=us vconsole.font=latarcyrheb-sun16 crashkernel=aut<br>o net.ifnames=0 LANG=en_US.UTF-8<br><br><br>그런데.. 몇 가지 문의사항이 있어서 문의 드립니다.<br><br>1. 현재 시스템이 VMware 상에 존재하는 것으로 보입니다. 혹시.. 해당 VM이 위치한 물리적 H/W에 돌고 있는 다른 Guest들이 있나요? 있으면.. 다른 이상은 없는지요?<br><br>2. VMware상에서 혹시 확인할 수 있는 메시지가 있는지요? 그리고 확인을 혹시 해보셨는지요?<br><br>3. 현재 VMware상에서 &quot;VMWare vSphere 상에서 &quot;CPU has disabled&quot;라는 로그가 남았다고 합니다.&quot; 라고 하셨는데요.. 해당 메시지와 확인하면서 VMware KB에서 VMware version과 H/W version 설정과 관련된 설정이 있는데요.. 혹시 이 부분은 확인이 되실런지요?<br><br>- http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1003746<br><br><br>확인 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2015-09-22T07:42:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>