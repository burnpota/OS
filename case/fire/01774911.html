======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2017-01-18T05:18:53Z</b><br><b>마지막 답변자 : support os</b><br><b>마지막 수정 일자 : 2017-01-25T04:00:01Z</b><br><b>id : 500A000000W9h3kIAB</b><br>======================<br><br><b><font size=15>
제목  : 삼성화재[ERP] fence-agents-ipmilan update 기능 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>https://access.redhat.com/errata/product/70/ver=/rhel---7.2/x86_64/RHBA-2016:2971<br>에 보면 fence-agents-ipmilan 이 상대노드의 ipmilan  을 모니터 실패이후에도 정상으로 동작하는 버그 수정인데 버그 수정이후에는 상대 ipmilan 모니터 실패이후에 어떻게 동작하는지요?<br>동작 방법이나 옵션을 알고싶습니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Defect / Bug</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><folderNumber>74173</folderNumber><br><comment id="a0aA000000IkSMIIA3"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-25T03:59:47Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-25T03:59:46Z</b><br><br>답변 감사합니다.<br>해당 케이스는 close 하겠습니다.<br>새해 복 많이 받으세요<br><br><publishedDate>2017-01-25T03:59:46Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IfuGlIAJ"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-01-24T06:27:18Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-01-24T06:27:18Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>fence_ipmilan 모니터링이 stopped 가 되었을때 아래와 같은 명령어를 통해 <br>stonith 상태를 복구 시킬수 있습니다. 한쪽 노드에서만 실행 하시면 됩니다. <br><br># pcs stonith cleanup<br><br>만약에 관련 해서 추가 질문의 있으시면 다시 연락 주시기 바랍니다. <br><br>추운 겨울에 감기를 조심 하시고 새해 복 많이 받으세요!<br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-01-24T06:27:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IfhmNIAR"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-23T12:38:05Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-23T12:38:05Z</b><br><br>답변 감사합니다.<br><br>fence_ipmilan 모니터링이 stopped 가 되었을때 이를 수동으로 started   상태로 변경 할려면 어떻게 해야 하는지요?<br><br><publishedDate>2017-01-23T12:38:05Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000If7VPIAZ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-01-20T05:51:00Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-01-20T05:51:00Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>그럼 fence_ipmilan 의 버그 패치를 하게되면 <br>일시적으로 ipmilan 모니터링을 하는 도중에 ipmilan 통신이 일시적으로 안되어서 sonith 모니터링 stop 된 상태가 되었다고 가정하고<br>그 시점 이후에 시스템에서 페일오버 상황이 발생하게 되면 stonith 는 stoped 상태로 전환이 되어 있기 때문에  fencing 이 실패가 된다고 이해해도 되는지요?<br><br>==&gt; stonith 리소스 모니터링이 stopped된 상황에서 팬싱 작업이 무조건 실패되는것은 아닙니다.<br><br>stonith 리소스 모니터링은 팬싱 디바이스와의 연결 상태를 지속적으로 모니터링하여 팬싱 작업 진행시 팬싱이 정상적으로 <br>실행되는것을 보장하기 위하여 진행하는것입니다.<br>따라서 일시적으로 팬싱 디바이스와의 연결이 끊기어 해당 모니터링이 stopped 상태로 되어 있을 경우에도 <br>팬싱 작업이 발생될 시 만일 팬싱 디바이스가 정상적으로 팬싱 신호를 처리하게 되면 정상적으로 failover 작업을 진행하게 됩니다.<br><br>감사합니다.<br><br><publishedDate>2017-01-20T05:51:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000If67FIAR"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-20T01:54:14Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-20T01:54:14Z</b><br><br>답변 감사합니다.<br><br><br>그럼 fence_ipmilan 의 버그 패치를 하게되면 <br>일시적으로 ipmilan 모니터링을 하는 도중에 ipmilan 통신이 일시적으로 안되어서 sonith 모니터링 stop 된 상태가 되었다고 가정하고<br><br>그 시점 이후에 시스템에서 페일오버 상황이 발생하게 되면 stonith 는 stoped 상태로 전환이 되어 있기 때문에  fencing 이 실패가 된다고 <br>이해해도 되는지요?<br><br><publishedDate>2017-01-20T01:54:14Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IerZnIAJ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-01-19T02:43:26Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-01-19T02:43:26Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>stonith ipmilan 설정이 된 아이피 모니터링이 실패가 되면 저동으로 stonith 상태가 stop 으로 변경하게 되나요?<br><br>==&gt; 네, 모니터링이 실패되면 관련 리소스를 스톱 하였다가 다시 기동하게 되며 만일<br>기동시 실패되면 해당 리소스를 stopped로 변경하게 됩니다.<br><br>stop 이 되면 ip 통신이 가능하게 되면 started 상태로 변경이 되는지요?<br><br>==&gt; 스톱된 리소스는 자동으로 start 되지 않으며 수동으로 기동해 주셔야 됩니다.<br><br>실제 ipmilan  명령어로  로그인 테스트를 하게 되면 간혹 불규칙적으로 실패가 나올때가 있어서 문의 드립니다.<br><br>==&gt; fence_ipmilan 명령어가 불규칙적으로 실패되는 원인을 분석해볼 필요가 있을것으로 보입니다.<br><br>감사합니다.<br><br><publishedDate>2017-01-19T02:43:26Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IeeLdIAJ"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-18T07:12:39Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-18T07:12:39Z</b><br><br>답변 감사합니다.<br>stonith ipmilan 설정이 된 아이피 모니터링이 실패가 되면 저동으로 stonith 상태가 stop 으로 변경하게 되나요?<br>stop 이 되면 ip 통신이 가능하게 되면 started 상태로 변경이 되는지요?<br><br>실제 ipmilan  명령어로  로그인 테스트를 하게 되면 간혹 불규칙적으로 실패가 나올때가 있어서 문의 드립니다.<br><br><publishedDate>2017-01-18T07:12:39Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IedtqIAB"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-01-18T06:14:32Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-01-18T06:14:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>말씀하신 버그는 픽스전 fence-agents-ipmilan 버전은 fence_ipmilan stonith resource 에<br>설정된 IP와의 통신이 불가능할 경우에도 모니터링 작업 결과가 성공하게 되는 이슈를 해결하였습니다.<br><br>픽스 전후의 테스트 결과는 아래 테스트 과정을 참고하시면 이해하는데 도움이 될것으로 보입니다.<br><br><br>1) BEFORE fix - fence-agents-ipmilan-4.0.11-27.el7_2.9<br>=============<br><br>### false-positive &quot;monitor&quot; action result (rc=0) when IP address is not accessible:<br> <br># fence_ipmilan -o monitor -l login -p password -a 10.10.10.20<br>NOTICE: List option is not working on this device yet<br># echo $?<br>0<br><br><br>### stonith device creation:<br># pcs stonith create test fence_ipmilan ipaddr=&quot;10.10.10.20&quot; login=&quot;login&quot; passwd=&quot;password&quot; verbose=true op monitor interval=10 timeout=20<br><br># pcs stonith | grep test<br> test   (stonith:fence_ipmilan):        Started virt-029<br><br><br>### stonithd debug log shows false-positive &quot;monitor&quot; action result (rc=0):<br><br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: schedule_stonith_command:      Scheduling monitor on test for c9e1c0f8-3fa5-45bf-8834-5b7de86959c7 (timeout=20s)<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_command:       Processed st_execute from lrmd.27258: Operation now in progress (-115)<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_action_create: Initiating action monitor for agent fence_ipmilan (target=(null))<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: internal_stonith_action_execute:       forking<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: internal_stonith_action_execute:       sending args<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_device_execute:        Operation monitor on test now running with pid=1624, timeout=20s<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_action_async_done:     Child process 1624 performing action 'monitor' exited with rc 0<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: st_child_done: Operation 'monitor' on 'test' completed with rc=0 (0 remaining)<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: log_operation: Operation 'monitor' [1624] for device 'test' returned: 0 (OK)<br>Nov 24 14:05:58 [27257] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: log_operation: test:1624 [ NOTICE: List option is not working on this device yet ]<br>======================<br><br>2) AFTER fix - fence-agents-ipmilan-4.0.11-27.el7_2.10<br>============<br><br>### &quot;monitor&quot; action fails as expected (rc=1) when IP address is not accessible:<br><br># fence_ipmilan -o monitor -l login -p password -a 10.10.10.20<br>Failed: Unable to obtain correct plug status or plug is not available<br><br># echo $?<br>1<br><br><br># pcs stonith | grep test<br> test   (stonith:fence_ipmilan):        Stopped<br><br><br>### stonithd debug log shows that &quot;monitor&quot; action fails (rc=1):<br><br>Nov 24 14:20:53 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: schedule_stonith_command:       Scheduling monitor on test for 478cb6e7-a360-4a76-8eee-e8945370573c (timeout=20s)<br>Nov 24 14:20:53 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_command:        Processed st_execute from lrmd.2123: Operation now in progress (-115)<br>Nov 24 14:20:53 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_action_create:  Initiating action monitor for agent fence_ipmilan (target=(null))<br>Nov 24 14:20:53 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: internal_stonith_action_execute:        forking<br>Nov 24 14:20:53 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: internal_stonith_action_execute:        sending args<br>Nov 24 14:20:53 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_device_execute: Operation monitor on test now running with pid=2337, timeout=20s<br>Nov 24 14:20:58 [2121] virt-029.cluster-qe.lab.eng.brq.redhat.com        cib:     info: cib_process_ping:       Reporting our current digest to virt-028: ed10e84b7cb32298dafab5acbb0e80f7 for 0.30.40 (0x18e3180 0)<br>Nov 24 14:21:03 [2122] virt-029.cluster-qe.lab.eng.brq.redhat.com stonith-ng:    debug: stonith_action_async_done:      Child process 2337 performing action 'monitor' exited with rc 1<br><br><br>감사합니다.<br><br><publishedDate>2017-01-18T06:14:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>에 보면 fence-agents-ipmilan 이 상대노드의 ipmilan  을 모니터 실패이후에도 정상으로 동작하는 버그 수정인데 버그 수정이후에는 상대 ipmilan 모니터 실패이후에 어떻게 동작하는지요?<br>동작 방법이나 옵션을 알고싶습니다.</issue><cep>false</cep><folderName>ERP-ALL</folderName></case>