======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2018-06-04T05:58:08Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-07-05T10:03:50Z</b><br><b>id : 500A000000au9zYIAQ</b><br>======================<br><br><b><font size=15>
제목  : 가상화 서버(RHEL7.2) reboot 건
</font></b><br><br>======================<br><b>사전문의<br></b><br>1.<br>안녕하세요, 이틀전 가상화 서버  1대가 갑작스럽게 재기동 되는 현상이 있었습니다.<br>이에 대한 원인분석 요청드립니다.<br><br>[root@sfdeccal01 ~]# cat /etc/redhat-release<br>Red Hat Enterprise Linux Server release 7.2 (Maipo)<br>[root@sfdeccal01 ~]# uptime<br> 11:12:49 up 2 days, 10:46,  2 users,  load average: 0.45, 0.33, 0.33<br><br>해당 서버는 7.2 버젼이며 재기동된 시점은 지난 6월 2일로 추정됩니다.<br><br>시스템 로그를 확인해 보려했습니다만 6월 2일자의 로그가 기록되지 않아<br>원인 파악이 어렵다고 판단되었습니다.<br><br>그래도 혹시 리부팅의 원인으로 파악할 수 있을만한 내용이 있는지 확인부탁드리며<br>해당 서버(sfdeccal01)의 sosreport 첨부해 드립니다.<br><br>=========================================================================<br><br>2.<br> 위에서도 언급하였지만, 현재 서버의 로그분석을 위해 /var/log/messages 를 확인해 봤는데 <br>6월 2일의 로그가 확인이 되지 않습니다.<br>혹시 로그 수집하는 설정상 어떤 문제가 있는것은 아닌지 확인부탁드립니다.<br><br>현 서버는 한달 주기로 로그를 끊어서 저장을 해놓도록 logrotate 설정이 되어있는데,<br>저장된 로그를 확인해보면 당월 초부터 말까지의 대부분의 로그들이 저장 되지않는 것으로 확인됩니다.<br><br>rsyslog.service는 enabled 상태이며, <br>/etc/rsyslog.conf 에 설정되어있는 messages, secure, cron, maillog 중 secure 로그만 정상적으로 수집이 되고 있습니다.<br><br>해당 원인에 대해서 분석해 주시면 감사하겠습니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><hostname>sfdeccal01</hostname><br><br><br><comment id="a0aA000000MtVEOIA3"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-06-20T08:00:53Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-06-20T08:00:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해 주셔서 감사합니다.<br><br>말씀하신 부분처럼 현재는 sosreport 만으로 원인을 찾기 어려우며 vmcore 가 필요합니다.<br>vmcore 가 생성되지 않은 부분에 대해서 확인해본 결과 /etc/kdump.conf 파일의 잘못된 설정으로 생성되지 않았을 것으로 예상됩니다.<br>다음은 각 서버의 /etc/kdump.conf 파일 설정 상태입니다.<br><br>&lt; sfdeccal01 &gt;<br><br> $ cat sos_commands/block/blkid_-c_.dev.null | egrep KDUMPVG-kdump_lv<br>  /dev/mapper/KDUMPVG-kdump_lv: UUID=&quot;c6b9938b-acb5-4c64-bc3a-031a5f5c5c2f&quot; TYPE=&quot;xfs&quot;  &lt;== 실제 장치의 UUID<br><br> $ cat etc/kdump.conf | grep -v ^#<br>  xfs UUID=919be816-903f-4d16-87ea-db04fa11b5c5  &lt;== 잘못 설정된 UUID<br>  path /var/crash<br>  core_collector makedumpfile -l --message-level 1 -d 31<br><br> $ cat df | grep crash<br>  /dev/mapper/KDUMPVG-kdump_lv        314415108  6618332 307796776   3% /var/crash<br><br><br>&lt; sfdpmsal01 &gt;<br><br> $ cat sos_commands/block/blkid_-c_.dev.null | egrep KDUMPVG-kdump_lv<br>  /dev/mapper/KDUMPVG-kdump_lv: UUID=&quot;cf31328d-52ae-4d53-b751-e3fe1af5e842&quot; TYPE=&quot;xfs&quot;  &lt;== 실제 장치의 UUID<br><br> $ cat etc/kdump.conf | grep -v ^#<br>  xfs UUID=919be816-903f-4d16-87ea-db04fa11b5c5  &lt;== 잘못 설정된 UUID<br>  path /var/crash<br>  core_collector makedumpfile -l --message-level 1 -d 31<br><br> $ cat df | grep crash<br>  /dev/mapper/KDUMPVG-kdump_lv        262016000   5772692 256243308   3% /var/crash<br><br>위에 보시는 것처럼 /etc/kdump.conf 파일에 설정된 xfs UUID=&quot; &quot; 항목과 실제 /var/crash 에 마운트 된 장치의 UUID 가 일치 하지 않음을 알 수 있습니다.<br>/etc/kdump.conf 파일의 xfs 설정을 제거 하시거나 올바른 UUID 로 변경 후 kdump 서비스를 재시작 하시기 바랍니다.<br>가능하시다면 설정 변경 후 테스트를 해보시면 좋을 것 같습니다.<br>kdump 관련 자세한 정보는 아래의 KCS 를 참조하시기 바랍니다.<br><br>&quot;How to troubleshoot kernel crashes, hangs, or reboots with kdump on Red Hat Enterprise Linux&quot;<br>https://access.redhat.com/solutions/6038<br><br>kdump 를 재설정 하신 후 vmcore 발생시 업로드 부탁드립니다.<br>추가적으로 vmware hypervisor 수준에서 vm 이 재부팅될 때 발생한 특이 사항도 확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-20T08:00:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MtDAcIAN"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2018-06-19T09:14:43Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2018-06-19T09:14:43Z</b><br><br>안녕하세요, 추가로 리부팅 된 건이 있어 이어서 문의드립니다.<br><br>금일 두 대의  가상서버 [ sfdeccal01 ] [ sfdpmsal01 ] 가 재기동 되어 분석 요청드립니다.<br><br>[ sfdeccal01 ] <br>2일 리부팅 되었던 sfdeccal01 서버가 금일(19일) 14시 53분 경에 또다시 리부팅 되었습니다.<br><br>이전에 답변해주신 내용에서 await와 svctm 의 수치가 급등하는 현상이 재기동의 원인으로 의심되었는데, <br>금일 리부팅된 시점에서의 await와 svctm  수치는 이상한점이 발견되지 않아 확인 부탁드립니다.<br><br>리부팅 시점의 코어덤프는 생성되지 않았으며 sosreport 첨부 드립니다.<br><br>[ sfdpmsal01 ]<br>금일 14시 22분 경 재기동된 것으로 보입니다.<br><br>sar 데이터를 확인해보았을때 재기동 직전인 14:00 경에 dev253-14 에서 await와 svctm 수치가 급격히 상승하였는데<br>이 내용이 지난 2일 sfdeccal01가 리부팅되었을때의 상태와 유사합니다.<br><br>서버의 I/O await와 svctm 수치가 급등한것 이외에 다른 의심될 만한 문제점은 없는지 다시 한번 확인 부탁드립니다. <br><br>마찬가지로 코어덤프는 생성되지 않았으며, sosreport 첨부드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-19T09:14:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MsVU9IAN"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-06-15T02:26:50Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-06-15T02:26:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-06-15T02:26:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MhdOdIAJ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-06-05T07:09:02Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-06-05T07:11:31Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해 주셔서 감사합니다.<br><br>Q1) reboot 원인 분석<br>A1) sosreport 확인 결과 마지막 reboot 시간은 6월 2일 00:25:56 으로 확인됩니다.<br><br>Jun 02 00:25:56 sfdeccal01 kernel: Linux version 3.10.0-327.53.1.el7.x86_64 (mockbuild@x86-037.build.eng.bos.redhat.com)<br><br>말씀하신 것처럼 /var/log/messages에는 기록이 없기 때문에 직접적인 원인을 찾기 어렵습니다.<br>다만 6월 2일 sar data 분석 결과 특이점이 확인되었습니다. 아래는 6월2일 sar data 입니다.<br><br>12:00:01 AM       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util<br>12:10:01 AM   dev8-96      0.04      0.05      0.02      1.95      0.14   3932.86   3932.86     14.42   &lt;&lt;<br>12:10:01 AM dev253-14      0.04      0.05      0.02      1.95      0.14   3932.86   3932.86     14.42   &lt;&lt;<br><br>00시 10분 경에 await과 svctm 수치가 급등하는 것을 볼 수 있습니다.<br>dev253-14 장치는 DATAVG001-arch_lv 볼륨이며 /ARCHIVE에 마운트 되어있습니다.<br>해당 시점에 스토리지와 VMware 수준에서 이상 로그 또는 증상이 있었는지 확인해볼 필요가 있습니다.<br><br>Q2) 로그 생성 문제 분석<br>A2) 아래는 messages에서 확인된 rsyslog 관련 로그입니다. 확인해보았으나 특이점이 없어서 현재로서는 원인을 알기 어려운 상태입니다.<br>다만 5월 31일 03:12:54에 rsyslog가 시작되면서 warning: ~ action is deprecated, consider using the 'stop' statement instead 메시지가 확인되었습니다.<br>이 메시지는 '~' 옵션이 'stop' 으로 변경됨에 따라 발생하는 메시지 입니다.<br>혹시 해당 시점에 '~' 옵션으로 설정하신 후 /etc/rsyslog.conf 파일만 원복하셨다면 다시한번 rsyslog 데몬을 재시작 해보시기 바랍니다.<br><br>...<br>Apr  1 03:19:02 sfdeccal01 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;1624&quot; x-info=&quot;http://www.rsyslog.com&quot;] rsyslogd was HUPed<br>May  1 03:22:01 sfdeccal01 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;1624&quot; x-info=&quot;http://www.rsyslog.com&quot;] rsyslogd was HUPed<br>May 31 03:12:54 sfdeccal01 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;1690&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>May 31 03:12:54 sfdeccal01 rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop' statement instead [try http://www.rsyslog.com/e/2307 ]  &lt;&lt;<br>May 31 03:12:54 sfdeccal01 rsyslogd-2307: warning: ~ action is deprecated, consider using the 'stop' statement instead [try http://www.rsyslog.com/e/2307 ]  &lt;&lt;<br>Jun  1 03:25:01 sfdeccal01 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;1690&quot; x-info=&quot;http://www.rsyslog.com&quot;] rsyslogd was HUPed<br>...<br><br>*추가 확인 사항<br> - 시스템 reboot 발생시 vmcore 생성은 되었는지요?<br> - kernel 파라메터 확인시 kernel.softlockup_panic 항목이 비활성화 되어있습니다. 가능하시다면 아래와 같이 softlockup 발생시 vmcore를 생성하도록 설정하는 것이 원인 분석에 도움이 됩니다.<br><br>&lt; kdump 관련 kernel 파라메터 설정 &gt;<br>1. /etc/sysctl.conf 파일에 아래 설정을 추가하고 저장합니다.<br> # vi /etc/sysctl.conf<br>   kernel.softlockup_panic =  1<br><br>2. 저장한 파라메터를 시스템에 적용합니다.<br> # sysctl -p<br><br>감사합니다.<br><br><publishedDate>2018-06-05T07:09:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MhaivIAB"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-06-05T01:28:27Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-06-05T01:28:27Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>해당 케이스에 대하여 확인중에 있습니다.<br>확인 후 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-05T01:28:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>