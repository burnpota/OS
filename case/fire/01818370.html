======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2017-03-27T05:36:58Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-04-13T10:05:02Z</b><br><b>id : 500A000000WkYeDIAV</b><br>======================<br><br><b><font size=15>
제목  : [삼성화재][ERP] cluster 서비스 아이피 변경에 대한 방법 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>cluster 서버들의 아이피가 변경되어 cluster 서버들이 사용하고 있는 아이피 와 resource 에 등록되어 있는 아이피를 변경 할 예정입니다. 작업 방법에 대해서 아래와 같이 계획중인데 방법이 맞는지와 다른 방법이 있는지 확인 부탁 드립니다.<br><br>변경할 리소스는 아래와 같습니다.<br><br>1.cluster 노드 아이피 <br>: 실제 설정은  /etc/hosts 에 등록되어 있고 <br>cluster 구성이 호스트 이름을 구성하였습니다. 따라서 /etc/hosts 에서 아이피를 변경하고 cluster 를 시작하면<br>될것 같습니다.<br><br>2. rsc_ping<br> gateway 로 ping 모니터링 하는 리소스 입니다 .<br> <br>pcs resource update rsc_ping host_list=GATEWAY <br>명령어로 변경할 예정입니다.<br><br>3. rsc_vip1 <br>서비스 vip 입니다.<br>마찬가지로 pcs resource update rsc_vip1 ip=GATEWAY<br>변경할 예정입니다.<br><br>작업 순서는 <br>1. pcs property set maintance_mode =true , stointh_enabled  =false <br>2. ping 모니터링 아이피 변경<br>3.  rsc_vip1 아이피 변경<br>4. pcs cluster stop --all<br>5. 실제 시스템 아이피 변경<br>6. /etc/hosts . 아이피 변경<br>7. pcs cluster start --all<br>8.pcs property set maintance_mode =false , stointh_enabled  =ture<br><br>아래는 현재 설정되어 있는 내역입니다. <br><br>Cluster Name: quoc_cluster<br>Corosync Nodes:<br> quocld01-HB quocld02-HB<br>Pacemaker Nodes:<br> quocld01-HB quocld02-HB<br><br>Resources:<br> Clone: rsc_ping-clone<br>  Resource: rsc_ping (class=ocf provider=pacemaker type=ping)<br>   Attributes: multiplier=10 host_list=42.8.231.1<br>   Operations: start interval=0s timeout=60 (rsc_ping-start-interval-0s)<br>               stop interval=0s timeout=20 (rsc_ping-stop-interval-0s)<br>               monitor interval=10 timeout=60 (rsc_ping-monitor-interval-10)<br> Group: grp1<br>  Resource: rsc_vip1 (class=ocf provider=heartbeat type=IPaddr2)<br>   Attributes: ip=42.8.231.83<br>   Operations: start interval=0s timeout=20s (rsc_vip1-start-interval-0s)<br>               stop interval=0s timeout=20s (rsc_vip1-stop-interval-0s)<br>               monitor interval=10s timeout=20s (rsc_vip1-monitor-interval-10s)<br>  Resource: rsc_ascs1 (class=ocf provider=sfmi type=MySAP)<br>   Attributes: start=/home/qfpadm/mysap_start stop=/home/qfpadm/mysap_stop monitor=/home/qfpadm/mysap_monitor<br>   Operations: start interval=0s timeout=60 (rsc_ascs1-start-interval-0s)<br>               stop interval=0s timeout=60 (rsc_ascs1-stop-interval-0s)<br>               monitor interval=60s enabled=false (rsc_ascs1-monitor-interval-60s)<br><br><br>Stonith Devices:<br> Resource: kdump_stonith (class=stonith type=fence_kdump)<br>  Attributes: pcmk_host_check=static-list pcmk_monitor_action=metadata pcmk_status_action=metadata pcmk_reboot_action=off pcmk_host_list=&quot;quocld01-HB quocld02-HB&quot; pcmk_off_timeout=90<br>  Operations: monitor interval=60s (kdump_stonith-monitor-interval-60s)<br> Resource: ipmilan_stonith1 (class=stonith type=fence_ipmilan)<br>  Attributes: pcmk_host_check=static-list pcmk_host_list=quocld01-HB ipaddr=42.8.240.144 login=redhat passwd=quocld01!1 lanplus=on auth=password delay=15<br>  Operations: monitor interval=60s (ipmilan_stonith1-monitor-interval-60s)<br> Resource: ipmilan_stonith2 (class=stonith type=fence_ipmilan)<br>  Attributes: pcmk_host_check=static-list pcmk_host_list=quocld02-HB ipaddr=42.8.240.145 login=redhat passwd=quocld02!1 lanplus=on auth=password<br>  Operations: monitor interval=60s (ipmilan_stonith2-monitor-interval-60s)<br>Fencing Levels:<br><br> Node: quocld01-HB<br>  Level 1 - kdump_stonith<br>  Level 2 - ipmilan_stonith1<br> Node: quocld02-HB<br>  Level 1 - kdump_stonith<br>  Level 2 - ipmilan_stonith2<br>Location Constraints:<br>  Resource: grp1<br>    Enabled on: quocld01-HB (score:10) (id:location-grp1-quocld01-HB-10)<br>  Resource: grp2<br>    Enabled on: quocld02-HB (score:10) (id:location-grp2-quocld02-HB-10)<br>  Resource: ipmilan_stonith1<br>    Disabled on: quocld01-HB (score:-INFINITY) (id:const_ipmilan1)<br>  Resource: ipmilan_stonith2<br>    Disabled on: quocld02-HB (score:-INFINITY) (id:const_ipmilan2)<br>  Resource: rsc_vip1<br>    Enabled on: quocld01-HB (score:10) (id:location-rsc_vip1-quocld01-HB-10)<br>    Constraint: location-rsc_vip1<br>      Rule: score=-INFINITY boolean-op=or  (id:location-rsc_vip1-rule)<br>        Expression: pingd lt 1  (id:location-rsc_vip1-rule-expr)<br>        Expression: not_defined pingd  (id:location-rsc_vip1-rule-expr-1)<br><br>Ordering Constraints:<br>Colocation Constraints:<br><br>Resources Defaults:<br> resource-stickiness: 100<br> migration-threshold: 3<br>Operations Defaults:<br> No defaults set<br><br>Cluster Properties:<br> cluster-infrastructure: corosync<br> cluster-name: quoc_cluster<br> dc-version: 1.1.13-10.el7-44eb2dd<br> have-watchdog: false<br> last-lrm-refresh: 1455954793<br> maintenance-mode: false<br> no-quorum-policy: stop<br> stonith-enabled: true<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><br><br><folderNumber>74173</folderNumber><br><comment id="a0aA000000JAWDpIAP"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-03-28T03:13:53Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-03-28T03:13:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>이슈 작업시 클러스터 리소스들이 running되어 데이터 안정성에 영향을 주는것을 방지하기 위하여<br>먼저 모든 리소스들의 stop 작업을 하시기 바랍니다.<br><br>구체적으로 아래와 같이 작업 하시면 될것으로 보입니다.<br><br>0. pcs cluster standby --all<br>1. pcs property set maintance_mode=true , stointh_enabled=false <br>2. ping 모니터링 아이피 변경<br>3. rsc_vip1 아이피 변경<br>4. pcs cluster stop --all<br>5. 실제 시스템 아이피 변경<br>6. /etc/hosts . 아이피 변경<br>7. pcs cluster start --all<br>8. pcs property set maintance_mode=false , stointh_enabled=ture<br>9. pcs cluster unstandby --all<br><br>감사합니다.<br><br><publishedDate>2017-03-28T03:13:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>변경할 리소스는 아래와 같습니다.<br><br>1.cluster 노드 아이피 <br>: 실제 설정은  /etc/hosts 에 등록되어 있고 <br>cluster 구성이 호스트 이름을 구성하였습니다. 따라서 /etc/hosts 에서 아이피를 변경하고 cluster 를 시작하면<br>될것 같습니다.<br><br>2. rsc_ping<br> gateway 로 ping 모니터링 하는 리소스 입니다 .<br> <br>pcs resource update rsc_ping host_list=GATEWAY <br>명령어로 변경할 예정입니다.<br><br>3. rsc_vip1 <br>서비스 vip 입니다.<br>마찬가지로 pcs resource update rsc_vip1 ip=GATEWAY<br>변경할 예정입니다.<br><br>작업 순서는 <br>1. pcs property set maintance_mode =true , stointh_enabled  =false <br>2. ping 모니터링 아이피 변경<br>3.  rsc_vip1 아이피 변경<br>4. pcs cluster stop --all<br>5. 실제 시스템 아이피 변경<br>6. /etc/hosts . 아이피 변경<br>7. pcs cluster start --all<br>8.pcs property set maintance_mode =false , stointh_enabled  =ture<br><br>아래는 현재 설정되어 있는 내역입니다. <br><br>Cluster Name: quoc_cluster<br>Corosync Nodes:<br> quocld01-HB quocld02-HB<br>Pacemaker Nodes:<br> quocld01-HB quocld02-HB<br><br>Resources:<br> Clone: rsc_ping-clone<br>  Resource: rsc_ping (class=ocf provider=pacemaker type=ping)<br>   Attributes: multiplier=10 host_list=42.8.231.1<br>   Operations: start interval=0s timeout=60 (rsc_ping-start-interval-0s)<br>               stop interval=0s timeout=20 (rsc_ping-stop-interval-0s)<br>               monitor interval=10 timeout=60 (rsc_ping-monitor-interval-10)<br> Group: grp1<br>  Resource: rsc_vip1 (class=ocf provider=heartbeat type=IPaddr2)<br>   Attributes: ip=42.8.231.83<br>   Operations: start interval=0s timeout=20s (rsc_vip1-start-interval-0s)<br>               stop interval=0s timeout=20s (rsc_vip1-stop-interval-0s)<br>               monitor interval=10s timeout=20s (rsc_vip1-monitor-interval-10s)<br>  Resource: rsc_ascs1 (class=ocf provider=sfmi type=MySAP)<br>   Attributes: start=/home/qfpadm/mysap_start stop=/home/qfpadm/mysap_stop monitor=/home/qfpadm/mysap_monitor<br>   Operations: start interval=0s timeout=60 (rsc_ascs1-start-interval-0s)<br>               stop interval=0s timeout=60 (rsc_ascs1-stop-interval-0s)<br>               monitor interval=60s enabled=false (rsc_ascs1-monitor-interval-60s)<br><br><br>Stonith Devices:<br> Resource: kdump_stonith (class=stonith type=fence_kdump)<br>  Attributes: pcmk_host_check=static-list pcmk_monitor_action=metadata pcmk_status_action=metadata pcmk_reboot_action=off pcmk_host_list=&quot;quocld01-HB quocld02-HB&quot; pcmk_off_timeout=90<br>  Operations: monitor interval=60s (kdump_stonith-monitor-interval-60s)<br> Resource: ipmilan_stonith1 (class=stonith type=fence_ipmilan)<br>  Attributes: pcmk_host_check=static-list pcmk_host_list=quocld01-HB ipaddr=42.8.240.144 login=redhat passwd=quocld01!1 lanplus=on auth=password delay=15<br>  Operations: monitor interval=60s (ipmilan_stonith1-monitor-interval-60s)<br> Resource: ipmilan_stonith2 (class=stonith type=fence_ipmilan)<br>  Attributes: pcmk_host_check=static-list pcmk_host_list=quocld02-HB ipaddr=42.8.240.145 login=redhat passwd=quocld02!1 lanplus=on auth=password<br>  Operations: monitor interval=60s (ipmilan_stonith2-monitor-interval-60s)<br>Fencing Levels:<br><br> Node: quocld01-HB<br>  Level 1 - kdump_stonith<br>  Level 2 - ipmilan_stonith1<br> Node: quocld02-HB<br>  Level 1 - kdump_stonith<br>  Level 2 - ipmilan_stonith2<br>Location Constraints:<br>  Resource: grp1<br>    Enabled on: quocld01-HB (score:10) (id:location-grp1-quocld01-HB-10)<br>  Resource: grp2<br>    Enabled on: quocld02-HB (score:10) (id:location-grp2-quocld02-HB-10)<br>  Resource: ipmilan_stonith1<br>    Disabled on: quocld01-HB (score:-INFINITY) (id:const_ipmilan1)<br>  Resource: ipmilan_stonith2<br>    Disabled on: quocld02-HB (score:-INFINITY) (id:const_ipmilan2)<br>  Resource: rsc_vip1<br>    Enabled on: quocld01-HB (score:10) (id:location-rsc_vip1-quocld01-HB-10)<br>    Constraint: location-rsc_vip1<br>      Rule: score=-INFINITY boolean-op=or  (id:location-rsc_vip1-rule)<br>        Expression: pingd lt 1  (id:location-rsc_vip1-rule-expr)<br>        Expression: not_defined pingd  (id:location-rsc_vip1-rule-expr-1)<br><br>Ordering Constraints:<br>Colocation Constraints:<br><br>Resources Defaults:<br> resource-stickiness: 100<br> migration-threshold: 3<br>Operations Defaults:<br> No defaults set<br><br>Cluster Properties:<br> cluster-infrastructure: corosync<br> cluster-name: quoc_cluster<br> dc-version: 1.1.13-10.el7-44eb2dd<br> have-watchdog: false<br> last-lrm-refresh: 1455954793<br> maintenance-mode: false<br> no-quorum-policy: stop<br> stonith-enabled: true</issue><cep>false</cep><folderName>ERP-ALL</folderName></case>