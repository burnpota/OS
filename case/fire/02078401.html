======================<br><b>생성계정 : 주호 이</b><br><b>생성날짜 : 2018-04-16T01:20:24Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-05-04T10:05:49Z</b><br><b>id : 500A000000aOinTIAS</b><br>======================<br><br><b><font size=15>
제목  : hung task 발생
</font></b><br><br>======================<br><b>사전문의<br></b><br>서버에 hung task 메세지 발생(콘솔로그) 후 OS 행 상태 발생.<br>리부팅하여 조치.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.7</b><br><b>타입  : Other</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 4 (Low)</b><br><hostname>msgalp04</hostname><br><br><br><comment id="a0aA000000LW1P5IAL"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2018-04-18T02:35:56Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2018-04-18T02:35:55Z</b><br><br>안녕하세요? Red Hat 송 창 안 입니다.<br><br>공유해주신 내용에 대해서 저희 엔지니어와 확인된 내용을 공유 하도록 하겠습니다.<br><br>먼저 cached memory에 대해서 설명을 드리자면, cached memory는 사용자 프로세스가 읽기 또는 쓰기를 시작할 때마다 사용되는 메모리를 뜻합니다. <br>커널은 사용자가 작업하고있는 파일의 부분을 찾고, 존재하지 않으면 캐시 메모리의 한개의 page를 새로 할당하고 디스크에서 읽은 내용으로 채우게 됩니다.<br>사용자가 파일을 읽는 경우에는 페이지에서 &quot;clean&quot; 이라고 cache page에 표시가 되며, 사용자가 파일을 쓰기를 시작하면서 페이지는 다시 &quot;dirty&quot;로 표시 되게 됩니다.<br>dirty 페이지들에 표시괸 모든 페이지를 디스크에 다시 복사한 다음 다시 &quot;clean&quot; 으로 표시 합니다.<br>메모리에 cache page가 가득 차게 되면, 커널은 메모리가 필요할때 마다 가장 최근에 사용하지 않는 inactive 메모리들을 회수하여 다시 사용하는 과정을 자동적으로 거치게 됩니다.<br><br>아래의 내용에서 보면 pgpgin되는 값과 pgfree로 되는 내용 그리고 vmeff 값을 참고로 하였을때 시스템에서는 많은 memory pressure에 대한 가능성이 있었을 것으로 판단이 되며,<br>아래 내용을 추론 하였을때, kswapd는 지속적으로 메모리 확보를 시도하였지만, 어플리케이션에서 메모리를 읽기를 위해 요구하는 양보다 메모리는 회수하는 경합 과정에서 이슈가 발생 되었을 가능성도 있습니다. <br><br>또한 이런 경우, 아래의 정보에 대해서 제공을 해주신다면 좀더 많은 정보를 통해 확인이 가능 할것으로 판단 됩니다.<br>- pidstat 와 perf를 통한 정보 수집<br>- kernel.hung_task_panic = 1 옵션을 활성화 시켜서 hung이 발생하는 경우,vmcore를 수집 <br><br>또한, 저희 엔지니어와 상의 결과 아래와 같은 값으로 바꿔본후 테스트를 진행 해본다면 아래와 같은 현상에 대해서 해소 가능성이 있을 것으로 판단 됩니다.<br>(현재 설정되어 있는 값)<br>  vm.<br>    dirty_ratio =  &quot;30&quot;  (% of total system memory)<br>    dirty_background_ratio =  &quot;10&quot;  (% of total system memory)<br>    dirty_expire_centisecs =  &quot;3000&quot;<br>    dirty_writeback_centisecs =  &quot;500&quot;<br>    swappiness [0-100] =  &quot;30&quot;<br>    min_free_kbytes = &quot;67584&quot;<br>    transparent_hugepage = &quot;activated&quot;<br><br>(테스트가 필요한 수정된 값)<br> - vm.<br>    dirty_ratio = 10<br>    dirty_background_ratio = 5<br>    dirty_expire_centisecs = 1000<br>    dirty_writeback_centisecs = 100<br>    swappiness = 10<br>    min_free_kbytes = 202752<br> - disabling thp<br><br>제가 확인한 메모리 관련 내용은 아래와 같습니다.<br>* pgpgin/s  : 디스크로부터 초당 paged in 된 page 의 총 수 를 뜻합니다.<br>* papgout/s : 디스크에 초당 paged out 된 page 의 총 수 를 뜻합니다.<br>* pgfree/s  : 시스템에 초당 free list 에있는 페이지 수를 뜻합니다.<br>* vmeff     : pgsteal/pgscan의 수식으로 계산되는이 값은 페이지에 대해서 회수 효율에 대한 측정 기준뜻합니다. <br>                            이 값이 100 %에 가까우면inactive 목록에서 거의 모든 페이지가 회수가 되고 있습니다. <br>                            만약 이값이 너무 낮다면 (예를 들어서 30 % 미만) 가상 메모리에 약간의 회수에 어려움이 있을 것으로 판단 됩니다. <br>                            이 필드는 시간 간격 동안 스캔 된 페이지가 없으면 0으로 표시됩니다.<br><br>12:00:01 AM  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff<br>12:10:01 AM  76057.07     31.08   2173.09      0.08  20065.20  16756.03   1734.05  18490.07    100.00<br>12:20:01 AM  35523.11     40.33   5474.86      0.15  11898.45   7230.20   1673.01   8903.21    100.00<br>12:30:01 AM  73924.46     32.94   2428.98      0.09  20003.46  16357.43   1908.12  18265.55    100.00<br>12:40:01 AM  70075.75     33.37   2387.77      0.09  19242.27  15295.18   2039.41  17334.59    100.00<br>12:50:01 AM  40523.02     31.86   2294.76      0.11  11822.57   8289.10   1859.84  10148.94    100.00<br>01:00:01 AM  77035.87     30.78   2364.48      0.22  20785.20  18092.26   1009.69  19101.95    100.00<br>01:10:01 AM  63017.32     32.52   2753.74      0.18  17441.93  14453.58   1086.66  15540.24    100.00<br>01:20:01 AM  37798.95     34.78   2390.72      0.08  11365.37   8572.85    987.02   9559.87    100.00<br>01:30:01 AM  86620.91     30.52   2331.62      0.14  23074.03  20761.29    631.82  21393.11    100.00<br>01:40:01 AM  52323.86     33.62   2855.78      0.10  14928.23  12888.93     42.12  12931.05    100.00<br>01:50:01 AM  48290.92     33.80   2544.09      0.10  14079.45  12013.75     89.89  12103.65    100.00<br>02:00:01 AM  83420.13     31.98   2433.55      0.10  22316.12  20549.33    105.99  20655.32    100.00<br>02:10:01 AM  55768.63     31.03   2345.56      0.02  15574.01  12944.12    878.61  13822.74    100.00<br>02:20:01 AM  46815.66     34.68   2490.68      0.02  13635.26  10558.95   1191.45  11750.40    100.00<br>02:30:02 AM  79809.79     30.57   2327.62      0.06  21282.70  19653.16     42.50  19695.61    100.00<br>02:40:01 AM  47814.73     30.97   2291.56      0.02  13662.86  11012.92    917.24  11930.21    100.00<br>02:50:01 AM  55971.33     31.47   2387.30      0.02  16406.10  13519.50    948.74  14468.24    100.00<br>03:00:01 AM  75560.83     32.09   2385.28      0.13  19722.46  17730.67    414.35  18145.02    100.00<br>03:10:01 AM  35162.67     31.68   2319.64      0.10  10506.20   7704.46   1136.72   8841.17    100.00<br>03:20:01 AM  75165.19     30.58   2111.57      0.09  20591.55  15235.68   3629.89  18865.57    100.00<br>03:30:01 AM  67142.21     33.21   2609.41      0.14  18214.65  14122.48   2167.05  16289.53    100.00<br>03:40:01 AM  35031.06     47.34   2512.53      0.23  10633.29   8382.53    396.37   8778.89    100.00<br>03:50:01 AM  85420.51     29.55   1851.70      0.09  22704.36  21109.64     54.65  21164.29    100.00<br>04:00:02 AM  53052.40     33.24   2825.58      0.10  14980.87  12374.86    724.27  13099.13    100.00<br>04:10:01 AM  46352.80     31.30   2341.00      0.08  13771.31  11126.35    492.81  11619.16    100.00<br>04:20:01 AM  80967.39     30.92   1923.94      0.03  21475.28  19943.29     72.44  20015.74    100.00<br>04:30:01 AM  47914.38     33.15   2799.55      0.06  13866.87  10989.60    940.62  11930.22    100.00<br>04:40:01 AM  54455.44     31.41   2386.87      0.01  15548.18  11757.78   1783.78  13541.56    100.00<br>04:50:01 AM  77362.98     32.29   1928.42      0.04  20570.48  19028.13     82.16  19110.29    100.00<br>05:00:01 AM  46747.17     34.08   2910.68      0.16  13662.30  10818.02    933.81  11751.83    100.00<br>05:10:01 AM  63618.56     30.70   2360.71      0.05  17702.91  13210.07   2560.33  15770.40    100.00<br>05:20:01 AM  75592.75     30.03   1825.31      0.04  20101.15  16905.06   1796.99  18702.05    100.00<br>05:30:01 AM  47182.91     35.70   2889.81      0.08  13686.22   9948.99   1831.17  11780.15    100.00<br>05:40:01 AM  64520.50     29.04   2295.05      0.03  18087.88  12703.07   3473.15  16176.22    100.00<br>05:50:01 AM  77579.97     32.24   1930.69      0.04  20492.93  17082.73   1971.49  19054.22    100.00<br>06:00:01 AM  44508.78     33.52   2896.56      0.06  13015.25   9760.55   1344.14  11104.70    100.00<br><br>감사합니다.<br>송 창 안 드림.<br><br><publishedDate>2018-04-18T02:35:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LVNmWIAX"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2018-04-16T01:32:58Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2018-04-16T01:32:58Z</b><br><br>안녕하세요? Red Hat Technical Account Manager 송 창 안 입니다.<br><br>공유해주신 sosreport와 캡쳐 파일을 확인 후 업데이트 하도록 하겠습니다.<br>감사합니다.<br><br>송 창 안 드림.<br><br><publishedDate>2018-04-16T01:32:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>