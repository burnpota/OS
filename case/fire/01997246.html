======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2017-12-20T06:12:36Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2018-01-03T05:46:07Z</b><br><b>id : 500A000000ZNpBhIAL</b><br>======================<br><br><b><font size=15>
제목  : vpm4 장비 로그 분석 요처
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>타임게이트 허 민 입니다.<br>vpm4장비에서 아래와 같은 로그가 빈번히 발생하는 것 같아 분석 문의 드립니다.<br>sos 리포트 첨부 드립니다.<br><br>RHEL Version은 6.2 입니다.<br><br>Dec 18 03:38:04 vpm4 kernel: bonding: bond0: link status definitely down for interface eth4, disabling it<br>Dec 18 03:38:04 vpm4 kernel: bonding: bond0: making interface eth6 the new active one.<br>Dec 18 03:38:04 vpm4 kernel: bonding: bond0: link status definitely up for interface eth4.<br>Dec 18 03:40:04 vpm4 pam_asg[7142]: Login for [root] - rhost[42.1.51.102],tty[ssh]<br>Dec 18 03:40:04 vpm4 pam_asg[7142]: Login root not an ASG login<br>Dec 18 04:34:17 vpm4 scagent: scagent was started host=42.1.52.77, pid=19119<br>Dec 18 05:33:02 vpm4 kernel: bonding: bond0: link status definitely down for interface eth6, disabling it<br>Dec 18 05:33:02 vpm4 kernel: bonding: bond0: making interface eth4 the new active one.<br>Dec 18 05:33:03 vpm4 kernel: bonding: bond0: link status definitely up for interface eth6.<br>Dec 18 05:35:42 vpm4 pam_asg[565]: Login for [root] - rhost[42.1.51.100],tty[ssh]<br>Dec 18 05:35:42 vpm4 pam_asg[565]: Login root not an ASG login<br>Dec 18 06:18:38 vpm4 pam_asg[10481]: Login for [root] - rhost[42.1.51.103],tty[ssh]<br>Dec 18 06:18:38 vpm4 pam_asg[10481]: Login root not an ASG login<br>Dec 18 07:17:47 vpm4 scagent: scagent was started host=42.1.52.77, pid=23827<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 4 (Low)</b><br><hostname>vpm4</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000LK3IsIAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-01-03T05:46:04Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-01-03T05:46:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>피드백 감사합니다.본 케이스는 close 상태로 변경시키겠습니다.<br>만약 본 케이스와 관련하여 추가 문의사항이 있으시다면 언제든지 *재오픈*하실 수 있습니다.  <br>  <br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발생됩니다. <br>고객님께서 남기 신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. <br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.  <br>  <br>감사합니다.<br><br><publishedDate>2018-01-03T05:46:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LK3DsIAL"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2018-01-03T05:36:35Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2018-01-03T05:36:35Z</b><br><br>안녕하세요<br><br>타임게이트 허 민 입니다.<br><br>보내주신 내용 적용이 다음주 또는 다다음주 주말에 변경예정입니다.<br>적용 및 모니터링 후 추가문의 있을 경우 다시 문의 드리겠습니다.<br><br><publishedDate>2018-01-03T05:36:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LK2bOIAT"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-01-03T03:28:02Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-01-03T03:28:02Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services입니다.<br><br>마지막 안내후 일정기간 답변이 없으셔서 코멘트 남깁니다.<br>현재 작업상황에 대해 공유해부탁드려도 될가요?<br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-03T03:28:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LFIurIAH"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-28T09:32:42Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-28T09:42:51Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>정보 공유 감사합니다.<br>많은 기존 사례들을 확인해보았지만 slave flapping이 일어나는 원인으로 아래와 같았습니다.<br><br>1.*펌웨어* 문제, 펌웨어 업그레이드 필요 <br>2.*케이블* 문제, 케이블 교체<br>3.*NIC* 카드 문제, NIC 카드 교체 <br><br>현재 하드웨어쪽에는 문제가 없다는 말씀을 <br>NIC 카드, 케이블 등 하드웨어에 문제가 없고 <br>펌웨어도 또한 최신버전인 것으로 인지하고 안내해드리겠습니다.<br>만약 아니라면 고객사와 협의하여 펌웨어 업데이트등을 진행해볼실수 있습니다.<br><br>로그파일에서 slave 인터페이스가 disabling 되면서 fail-over 되는 현상은 자주<br>발생되는 것은 아닌 것으로 보이며 arp 모니터링을 사용하고 있는 것으로 확인이 됩니다.<br><br># cat etc/sysconfig/network-scripts/ifcfg-bond0 <br><br>BONDING_OPTS=&quot;mode=active-backup arp_interval=200 arp_ip_target=42.41.14.1&quot;<br><br>이는 42.41.14.1 에 arp 패킷을 보내는 것으로 링크모니터링을 진행하는 방식이므로 42.41.14.1로의 통신문제로<br>arp 패킷이 보내지지 못했다고 인식하면 fail-over를 진행하게 될것입니다. 따라서 먼저 arp 타겟서버와<br>일시적으로 존재했을 통신문제를 배제하기 위하여 모니터링 방식을 miimon으로 바꾸신후 이슈가 재현이 <br>되는지 확인하실 필요가 있습니다.<br><br># vim /etc/sysconfig/network-scripts/ifcfg-bond0<br>BONDING_OPTS=&quot;mode=1 miimon=100&quot;<br><br>그리고 ifcfg-eth4 파일에서 불필요한 부분을 삭제하시고 아래와 같이 가이드 문서를 참조하여 설정하시길 바랍니다.<br><br># vim /etc/sysconfig/network-scripts/ifcfg-ethX  &lt;---- X는 적정수치로 치환  <br><br>DEVICE=ethX<br>BOOTPROTO=none<br>ONBOOT=yes<br>HOTPLUG=no<br>MASTER=bond0<br>SLAVE=yes<br>USERCTL=no<br>NM_CONTROLLED=no<br><br>[가이드 문서]<br>How do I configure a bonding device on Red Hat Enterprise Linux (RHEL)? <br>https://access.redhat.com/articles/172483#Configuring_bonded_devices_on_Red_Hat_Enterprise_Linux_6<br><br>추가적으로 만약 /etc/modprobe* 파일에 아래와 같은 문구가 있다면 삭제하시기 바랍니다.<br><br>alias bonding bond0<br><br>그리고 네트워크 서비스 재기동해주시면 됩니다.<br><br># service network restart <br><br>상기의 설정으로 테스트후 피드백 부탁드리겠습니다.<br><br>========================<br><br>추가로 /proc/net/bonding/bond0 파일에서 speed 값이 ethtool 커멘드와 다른 부분에 관해서는 버그로 보고되어있습니다.<br><br>커널버전을 kernel-2.6.32-279.el6.i686.rpm 혹은 그이상으로 업그레이드하시길 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-28T09:32:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LFGsqIAH"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-12-28T04:46:29Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-12-28T04:46:28Z</b><br><br>안녕하세요<br><br>우선적으로 고객측에서는 하드웨어의 이슈는 아니라고 판단하고 있습니다.<br>추가 문의사항이 있어서 SR 업데이트 드립니다.<br>해당 vpm4장비를 ethtool 명령어로 본 speed값과  cat /proc/net/bonding/bond0본 speed값이 틀리고 MDI-X값도 틀린데 혹시 어떤 것으로 확인하는 것이 맞는지요?또한 설정값이 다르게 보이는 이유도 궁금 합니다.<br>그리고 sos리포트 확인 해 보시면 현재 설정된  network의 eth4 eht6 및 bond0의 설정 값들의 설정값들을 보시고 추가 옵션이 적용될 내용이 있는지도 확인 부탁드립니다.<br><br>마지막으로 /proc/net/bond/bond0로 본 내용과 ethtool 로 본 내용 추가 드립니다.<br><br>[root@vpm4 tmp]# cat /proc/net/bonding/bond0<br><br>Ethernet Channel Bonding Driver: v3.6.0 (September 26, 2009)<br><br><br> <br><br>Bonding Mode: fault-tolerance (active-backup)<br><br>Primary Slave: None<br><br>Currently Active Slave: eth6<br><br>MII Status: up<br><br>MII Polling Interval (ms): 0<br><br>Up Delay (ms): 0<br><br>Down Delay (ms): 0<br><br>ARP Polling Interval (ms): 200<br><br>ARP IP target/s (n.n.n.n form): 42.41.14.1<br><br><br> <br><br>Slave Interface: eth4<br><br>MII Status: up<br><br>Speed: 100 Mbps<br><br>Duplex: full<br><br>Link Failure Count: 46<br><br>Permanent HW addr: 2c:76:8a:5a:90:5e<br><br>Slave queue ID: 0<br><br><br> <br><br>Slave Interface: eth6<br><br>MII Status: up<br><br>Speed: 100 Mbps<br><br>Duplex: full<br><br>Link Failure Count: 54<br><br>Permanent HW addr: 2c:76:8a:5a:89:a0<br><br>Slave queue ID: 0<br><br>[root@vpm4 tmp]# ethtool eth4<br><br>Settings for eth4:<br><br>        Supported ports: [ TP ]<br><br>        Supported link modes:   10baseT/Half 10baseT/Full<br><br>                                100baseT/Half 100baseT/Full<br><br>                                1000baseT/Half 1000baseT/Full<br><br>        Supports auto-negotiation: Yes<br><br>        Advertised link modes:  10baseT/Half 10baseT/Full<br><br>                                100baseT/Half 100baseT/Full<br><br>                                1000baseT/Half 1000baseT/Full<br><br>        Advertised pause frame use: Symmetric<br><br>        Advertised auto-negotiation: Yes<br><br>        Speed: 1000Mb/s<br><br>        Duplex: Full<br><br>        Port: Twisted Pair<br><br>        PHYAD: 1<br><br>        Transceiver: internal<br><br>        Auto-negotiation: on<br><br>        MDI-X: Unknown<br><br>        Supports Wake-on: g<br><br>        Wake-on: d<br><br>        Current message level: 0x000000ff (255)<br><br>        Link detected: yes<br><br>[root@vpm4 tmp]# ethtool eth6<br><br>Settings for eth6:<br><br>        Supported ports: [ TP ]<br><br>        Supported link modes:   10baseT/Half 10baseT/Full<br><br>                                100baseT/Half 100baseT/Full<br><br>                                1000baseT/Half 1000baseT/Full<br><br>        Supports auto-negotiation: Yes<br><br>        Advertised link modes:  10baseT/Half 10baseT/Full<br><br>                                100baseT/Half 100baseT/Full<br><br>                                1000baseT/Half 1000baseT/Full<br><br>        Advertised pause frame use: Symmetric<br><br>        Advertised auto-negotiation: Yes<br><br>        Speed: 1000Mb/s<br><br>        Duplex: Full<br><br>        Port: Twisted Pair<br><br>        PHYAD: 1<br><br>        Transceiver: internal<br><br>        Auto-negotiation: on<br><br>        MDI-X: Unknown<br><br>        Supports Wake-on: g<br><br>        Wake-on: d<br><br>        Current message level: 0x000000ff (255)<br><br>        Link detected: yes<br><br>[root@vpm4 tmp]# mii-tool eth4<br><br>eth4: negotiated 100baseTx-FD, link ok<br><br>[root@vpm4 tmp]# mii-tool eth6<br><br>eth6: negotiated 100baseTx-FD, link ok<br><br>이상입니다.<br>확인 바랍니다.<br><br><publishedDate>2017-12-28T04:46:28Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LF6JhIAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-27T03:27:56Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-27T03:27:56Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 추가적으로 문의하실 사항이 있으신가요?<br><br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-27T03:27:56Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LEOhIIAX"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-21T02:29:30Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-21T02:29:29Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>bonding slave flapping 이슈가 발생하고 있습니다.<br><br>var/log/messages:Dec 18 03:38:04 vpm4 kernel: bonding: bond0: link status definitely down for interface eth4, disabling it<br>var/log/messages:Dec 18 03:38:04 vpm4 kernel: bonding: bond0: making interface eth6 the new active one.<br>var/log/messages:Dec 18 03:38:04 vpm4 kernel: bonding: bond0: link status definitely up for interface eth4.<br>var/log/messages:Dec 18 05:33:02 vpm4 kernel: bonding: bond0: link status definitely down for interface eth6, disabling it<br>var/log/messages:Dec 18 05:33:02 vpm4 kernel: bonding: bond0: making interface eth4 the new active one.<br>var/log/messages:Dec 18 05:33:03 vpm4 kernel: bonding: bond0: link status definitely up for interface eth6.<br>var/log/messages:Dec 18 09:32:12 vpm4 kernel: bonding: bond0: link status definitely down for interface eth4, disabling it<br>var/log/messages:Dec 18 09:32:12 vpm4 kernel: bonding: bond0: making interface eth6 the new active one.<br>var/log/messages:Dec 18 09:32:12 vpm4 kernel: bonding: bond0: link status definitely up for interface eth4.<br><br>일반적으로 이런 이슈는 NIC 카드/펌웨어 및 케이블 문제로 발생한다고 보고되어 있습니다.<br><br>먼저 벤더사에 펌웨어 업데이트를 문의해보시는 것을 권장드리겠습니다.<br>펌웨어 업데이트후 여전히 같은 이슈가 발생하신다면 피드백 주시면 계속 지원해드도록 하겠습니다.<br><br>관련내용은 아래의 KCS에서 확인하실수 있습니다.<br><br>Why one of the slave interface Link is flapping continuosly in bonding ?<br>-https://access.redhat.com/solutions/441883<br><br>감사합니다.<br><br><publishedDate>2017-12-21T02:29:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LEOF2IAP"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-12-21T01:22:41Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-12-21T01:22:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 문의주신 내용을 자세히 살펴보고 있는 중이며 답변이 정리되는 대로 <br>코멘트를 업데이트 해드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-21T01:22:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>