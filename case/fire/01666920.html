======================<br><b>생성계정 : 주호 이</b><br><b>생성날짜 : 2016-07-12T23:06:03Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-08-05T10:06:48Z</b><br><b>id : 500A000000UqDu8IAF</b><br>======================<br><br><b><font size=15>
제목  : CPU 성능 이슈 및 기타 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>1. 아래와 같이 Stand-by 포트에서 Network Dropped Packet 이 다량으로 발생되는 원인<br>[root@pmsalp06:/tmp]#netstat -in4<br>Kernel Interface table<br>Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg<br>bond0     1500 35616770962      8 120039297 0      43081137091      0      0      0 BMmRU<br>bond1     1500 168486722      0 107662074 0      983018195      0      0      0 BMmRU<br>em1       1500        0      0      0 0             0      0      0      0 BMU<br>lo       65536 2725078761      0      0 0      2725078761      0      0      0 LRU<br>p3p1      1500 116244227      0     14 0      1014832093      0      0      0 BMsRU<br>p4p1      1500 54262520      0 54262520 0             0      0      0      0 BMsRU<br>p5p1      1500 35653641582      4     16 0      43289333850      0      0      0 BMsRU<br>p6p1      1500 60980107      4 60980107 0             0      0      0      0 BMsRU<br><br>2. Performance Tuning<br>RHEL V7.X에서는 기본으로 numa balancing 값이 활성화되어 있어 DB아 시스템을 사용 시 성능이 저하되는 원인이 될 수 있어 이 값을 비활성화하는 것에 대해서 BC 에서 문의가 있습니다.<br>→ kernel.numa_balancing = 1  값을 kernel.numa_balancing = 0 으로 변경에 대해서 영향도를 검토 드립니다.<br><br>3. Physical NIC의 offload 값을 아래와 같이 Disable 하는 것에 대한 문의가 있는데, 영향도 및 CPU 부하를 줄이는 데  혹시 도움이 되는지 문의드립니다.<br># ethtool -K p5p1 tso off<br><br>4. 현재 NW 버퍼 사이즈가 적정한지 확인 및 증가를 고려하고 싶은데 확인 방법을 문의드립니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>. SAP AP 서버에서 CPU 사용률이 계속 100%에 근접하여 여러가지 부분을 확인하였고 관련하여 SAP dispatcher 가 'cmp와 mov' 수행을 빈번하게 하고 있는 것을 확인하였습니다. 이와 관련하여 튜닝 포인트를 찾고자 문의드립니다.<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>. 해당서버의 sosreport 와 sap BC 에서 관련 프로세스 strace 결과를 첨부합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 4 (Low)</b><br><br><br><folderNumber>74173</folderNumber><br><comment id="a0aA000000HUm7GIAT"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-07-20T07:01:17Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-07-20T07:01:17Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 해당 서버에 특별한 이슈가 확인이 되지 않고 있으며<br>전체 시스템 설정과 환경에 문제가 있는지는 확인하기 어려운데 <br>혹시 특별히 확인해 드릴 부분이 있는지 알려주시면 분석해 보도록 하겠습니다.<br><br>&gt; WEB 접속이 안되어 아무내용도 보지 못하고 있습니다. 케이스 다시 열면 볼 수 있을까요?.. <br><br>앞서 기타 케이스는 확인이 가능한신것으로 보아 새로운 케이스를 생성하시면 확인 가능하실수<br>있을것으로 보입니다. 따라서 테스트 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-07-20T07:01:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HULD7IAP"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-07-18T08:17:56Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-07-18T08:17:56Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>유선상으로 안내해드린 정보를 코멘트로 남겨드립니다.<br><br>&gt;&gt; 고객은  mprotect 함수를 사용하지 못하게 할 방법을 문의 하고 있습니다. 또, 사용하지 못하게 했을 때 문제가 된 사례를 확인 해 달라는 요청입니다.<br><br>mprotect는 system call로 비활성화하는 방법이 없는것으로 확인됩니다.<br><br>&gt;&gt; 지난번 점검시 10G interface 의 mtu 설정이 1500 으로 되어 있는데요, mtu size 가 작아서 문제가 되지는 않을런지요.<br>&gt;&gt; switch-server간 jumbo frame 설정이 필요하지 않을지 문의드릅니다.<br><br>현재 올려주신 sosreport를 확인해보면 reassemble 이슈가 존재하지 않는것으로 보아<br>mtu 설정이 필요하지 않을것으로 보입니다.<br><br>현재 웹 access.redhat.com 으로 해당 SR 확인시 404 에러가나서 SR에 질의를 못올리는 상황이기때문에<br>추가 질문이 있으시면 gss-korea@redhat.com 으로 보내주시면 제가 해당 케이스로 옮겨서 업데이트 해드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-07-18T08:17:56Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HTmhdIAD"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-07-15T00:59:52Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-07-15T00:59:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>1. 아래와 같이 Stand-by 포트에서 Network Dropped Packet 이 다량으로 발생되는 원인<br><br>아래의 문서를 보시다시피 RHEL7버전에서 Stand-by 인터페이스에서의 팻킷 드랍이슈는<br>버그로 리포팅되었으며 이는 RHEL7.3 버전에서 픽스할 예정입니다.<br>해당 이슈가 Stand-by 인터페이스에서 발생되기때문에 실제 데이터 손실이 없을것으로 보입니다.<br><br>Packet loss reported on inactive slave interface of a bond<br>https://access.redhat.com/solutions/2076223<br><br>2. Performance Tuning<br>RHEL V7.X에서는 기본으로 numa balancing 값이 활성화되어 있어 DB아 시스템을 사용 시 성능이 저하되는 원인이 될 수 있어 이 값을 비활성화하는 것에 대해서 BC 에서 문의가 있습니다.<br>→ kernel.numa_balancing = 1  값을 kernel.numa_balancing = 0 으로 변경에 대해서 영향도를 검토 드립니다.<br><br>기존사례를 확인해본바에 의하면 오라클 DB와 numa balancing를 활성화 할 경우 성능 저하 이슈가 발생되는것으로<br>버그질라에 보고되어 있으며 현재 원인분석 중에 있는것으로 확인됩니다.<br>따라서 kernel.numa_balancing = 0 으로 설정하시고 이슈가 해소되는지 확인 부탁드립니다.<br><br>numa_balancing는 numa 환경에서 더 좋은 퍼포먼스를 위하여 추가된 기능입니다.<br>해당 기능에 대한 더 상세한 설명은 아래의 KCS 문서를 참고하시기 바랍니다.<br> <br>Automatic NUMA balancing in RHEL7<br>https://access.redhat.com/solutions/1533463<br><br>4. 현재 NW 버퍼 사이즈가 적정한지 확인 및 증가를 고려하고 싶은데 확인 방법을 문의드립니다.<br><br>서버의 버퍼 사이즈가 적정한지는 시스템에서 모니터링을 통하여 확인해 보아야 됩니다.<br>아래의 문서를 참고하셔서 테스트를 진행해 보시기 바랍니다.<br><br>How do I monitor network buffer usage?<br>https://access.redhat.com/solutions/170713<br><br>추가문의:<br>금일 SAP America에서 리눅스 메모리 분석을 실시하였는데 strace를 보고 말하는것 같습니다.<br>SAP Expert 엔지니어께서 mprotect가 과하게 많이 보인다고 얘기하시네요.<br>해당 함수를 On/Off가 가능한지, 문제가된 사례가 있는지등에 대해 답변을 부탁 드립니다.<br><br>mprotect 함수는 아래와 같이 메모리 관련 함수인것으로 확인됩니다. on/off는 서버에서 사용하지<br>못하게 설정한다는 말씀이신지요?<br><br>mprotect() changes protection for the calling process's memory page(s) containing any part of the address range in the interval [addr, addr+len-1]. addr must be aligned to a page boundary.<br><br>If the calling process tries to access memory in a manner that violates the protection, then the kernel generates a SIGSEGV signal for the process.<br><br><br>감사합니다.<br><br><publishedDate>2016-07-15T00:59:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HTmG8IAL"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2016-07-14T23:26:16Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2016-07-14T23:26:16Z</b><br><br>아래는 고객의 질문입니다. <br><br>--아래--<br>금일 SAP America에서 리눅스 메모리 분석을 실시하였는데 strace를 보고 말하는것 같습니다.<br>SAP Expert 엔지니어께서 mprotect가 과하게 많이 보인다고 얘기하시네요.<br>해당 함수를 On/Off가 가능한지, 문제가된 사례가 있는지등에 대해 답변을 부탁 드립니다.<br><br><publishedDate>2016-07-14T23:26:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HTILfIAP"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-07-13T07:49:54Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-07-13T07:49:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 해당 이슈에 대하여 올려주신 정보를 살펴보고 있는중입니다.<br>새로운 발견이 있는대로 업데이트 드리도록 하겠습니다.<br><br>아래는 3번 질문에 대한 답변을 먼저 안내해 드립니다.<br><br>3. Physical NIC의 offload 값을 아래와 같이 Disable 하는 것에 대한 문의가 있는데, 영향도 및 CPU 부하를 줄이는 데  혹시 도움이 되는지 문의드립니다.<br># ethtool -K p5p1 tso off<br><br>tso 기능을 비활성화하시면 NIC에 의하여 처리되던 packet checksumming, scatter-gather 이와 같은 작업이<br>CPU에 의하여 처리되기 때문에 CPU 부하가 높아질수 있습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-07-13T07:49:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>[root@pmsalp06:/tmp]#netstat -in4<br>Kernel Interface table<br>Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg<br>bond0     1500 35616770962      8 120039297 0      43081137091      0      0      0 BMmRU<br>bond1     1500 168486722      0 107662074 0      983018195      0      0      0 BMmRU<br>em1       1500        0      0      0 0             0      0      0      0 BMU<br>lo       65536 2725078761      0      0 0      2725078761      0      0      0 LRU<br>p3p1      1500 116244227      0     14 0      1014832093      0      0      0 BMsRU<br>p4p1      1500 54262520      0 54262520 0             0      0      0      0 BMsRU<br>p5p1      1500 35653641582      4     16 0      43289333850      0      0      0 BMsRU<br>p6p1      1500 60980107      4 60980107 0             0      0      0      0 BMsRU<br><br>2. Performance Tuning<br>RHEL V7.X에서는 기본으로 numa balancing 값이 활성화되어 있어 DB아 시스템을 사용 시 성능이 저하되는 원인이 될 수 있어 이 값을 비활성화하는 것에 대해서 BC 에서 문의가 있습니다.<br>→ kernel.numa_balancing = 1  값을 kernel.numa_balancing = 0 으로 변경에 대해서 영향도를 검토 드립니다.<br><br>3. Physical NIC의 offload 값을 아래와 같이 Disable 하는 것에 대한 문의가 있는데, 영향도 및 CPU 부하를 줄이는 데  혹시 도움이 되는지 문의드립니다.<br># ethtool -K p5p1 tso off<br><br>4. 현재 NW 버퍼 사이즈가 적정한지 확인 및 증가를 고려하고 싶은데 확인 방법을 문의드립니다.</issue><environment>. SAP AP 서버에서 CPU 사용률이 계속 100%에 근접하여 여러가지 부분을 확인하였고 관련하여 SAP dispatcher 가 'cmp와 mov' 수행을 빈번하게 하고 있는 것을 확인하였습니다. 이와 관련하여 튜닝 포인트를 찾고자 문의드립니다.</environment><timeFramesAndUrgency>. 해당서버의 sosreport 와 sap BC 에서 관련 프로세스 strace 결과를 첨부합니다.</timeFramesAndUrgency><cep>false</cep><folderName>ERP-ALL</folderName></case>