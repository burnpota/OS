======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2018-05-03T10:01:55Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-05-19T10:10:00Z</b><br><b>id : 500A000000aQwYTIA0</b><br>======================<br><br><b><font size=15>
제목  : sftp upload 전용 계정 생성시  업로드 후 파일삭제 방지방법
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>sftp-server 에서 upload 전용계정을 아래와 같이 만들어서 테스트를 하였습니다.<br><br>/etc/ssh/sshd_config<br><br>Subsystem sftp  internal-sftp <br>    Match User sftpupload <br>    PasswordAuthentication yes<br>    ChrootDirectory /upload/sftponly <br>    AllowTCPForwarding no<br>    X11Forwarding no<br>    #SftpUmask 0777<br>    #SftpPermitChmod no<br>    #SftpPermitChown no<br>    ForceCommand internal-sftp -u777 <br><br>실제 생성된 파일의 퍼미션이 00000 인데도 실제 sftp 에서는 파일이 삭제 됩니다.<br>umask 가 적용되는데도 실제 파일이 삭제가 되는데 이를 방지할려면 어떻게 해야 하는지요?<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><hostname>[sftp user 설정문의]</hostname><br><br><br><comment id="a0aA000000MSNYOIA5"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2018-05-04T07:08:09Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2018-05-04T07:08:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>아쉽게도 파일 삭제 작업을 하는 유저가 해당 파일이 있는 디렉토리에 대하여 쓰기 권한이 있다면<br>삭제 작업이 가능하게 됩니다. <br><br>참고문서:<br>How to set permissions on directories shared via SFTP in RHEL6?<br>https://access.redhat.com/solutions/539133<br><br>감사합니다.<br><br><publishedDate>2018-05-04T07:08:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MSMMUIA5"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2018-05-04T05:06:01Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2018-05-04T05:06:01Z</b><br><br>/upload/sftponly  퍼미션<br><br>[root@localhost upload]# ls -al  /upload/sftponly<br>합계 0<br>drwxr-xr-x 3 root       root       19  5월  3 05:30 .<br>drwxr-xr-x 3 root       root       21  5월  4 00:49 ..<br>drwxr-xr-x 2 sftpupload sftpupload  6  5월  4 00:57 public<br><br>[root@localhost sftponly]# ls -al /upload/sftponly/public/<br>합계 0<br>d-wx-wx--- 2 sftpupload sftpupload  6  5월  4 01:03 .<br>drwxr-xr-x 3 root       root       19  5월  3 05:30 ..<br>======================<br>openssh 버전입니다.<br><br>[root@localhost upload]# rpm -qi openssh-server<br>Name        : openssh-server<br>Version     : 6.6.1p1<br>Release     : 22.el7<br>Architecture: x86_64<br>Install Date: <br>Group       : System Environment/Daemons<br>Size        : 939032<br>License     : BSD<br>Signature   : RSA/SHA256, 2015년 09월 30일 (수) 오전 08시 06분 26초, Key ID 199e2f91fd431d51<br>Source RPM  : openssh-6.6.1p1-22.el7.src.rpm<br>Build Date  : <br>Build Host  : x86-021.build.eng.bos.redhat.com<br>Relocations : (not relocatable)<br>Packager    : Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;<br>Vendor      : Red Hat, Inc.<br>URL         : http://www.openssh.com/portable.html<br>Summary     : An open source SSH server daemon<br>Description :<br>OpenSSH is a free version of SSH (Secure SHell), a program for logging<br>into and executing commands on a remote machine. This package contains<br>the secure shell daemon (sshd). The sshd daemon allows SSH clients to<br>securely connect to your SSH server.<br><br>테스트 방법입니다.<br><br># sftp sftpupload@192.168.122.77<br>sftpupload@192.168.122.77's password: <br>Connected to 192.168.122.77.<br>sftp&gt; ls<br>public  <br>sftp&gt; cd public/<br>sftp&gt; ls -al<br>remote readdir(&quot;/public&quot;): Permission denied<br>sftp&gt; put 1.txt<br>Uploading 1.txt to /public/1.txt<br>1.txt                                                                  100% 8980     5.9MB/s   00:00    <br>sftp&gt; ls -al<br>remote readdir(&quot;/public&quot;): Permission denied<br><br>서버에서 확인하면 퍼미션이 아래와 같아서 umask 가 제대로 동작하는것 같습니다.<br><br>[root@localhost sftponly]# cd public/<br>[root@localhost public]# ls -al<br>합계 12<br>d-wx-wx--- 2 sftpupload sftpupload   18  5월  4 01:04 .<br>drwxr-xr-x 3 root       root         19  5월  3 05:30 ..<br>---------- 1 sftpupload sftpupload 8980  5월  4 01:04 1.txt<br><br><br>하지만 sftp 에서 파일이름을 입력하면 삭제가 됩니다.<br><br>sftp&gt; rm 1.txt<br>Removing /public/1.txt<br>sftp&gt;<br><br><publishedDate>2018-05-04T05:06:01Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MSLPKIA5"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2018-05-04T03:27:49Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2018-05-04T03:27:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>/upload/sftponly 디렉토리 퍼미션은 어떠한지요?<br>또한 테스트 진행시 절차를 케이스에 첨부 부탁 드리며 openssh 버전 확인 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-05-04T03:27:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>/etc/ssh/sshd_config<br><br>Subsystem sftp  internal-sftp <br>    Match User sftpupload <br>    PasswordAuthentication yes<br>    ChrootDirectory /upload/sftponly <br>    AllowTCPForwarding no<br>    X11Forwarding no<br>    #SftpUmask 0777<br>    #SftpPermitChmod no<br>    #SftpPermitChown no<br>    ForceCommand internal-sftp -u777 <br><br>실제 생성된 파일의 퍼미션이 00000 인데도 실제 sftp 에서는 파일이 삭제 됩니다.<br>umask 가 적용되는데도 실제 파일이 삭제가 되는데 이를 방지할려면 어떻게 해야 하는지요?</issue><cep>false</cep></case>