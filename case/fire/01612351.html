======================<br><b>생성계정 : 주호 이</b><br><b>생성날짜 : 2016-04-05T23:26:41Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-04-23T10:09:49Z</b><br><b>id : 500A000000U7JWfIAN</b><br>======================<br><br><b><font size=15>
제목  : /etc/ntp.conf 에 NTP 서버를 2개 설정 시 NTP sync 가 안되는 문제
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>/etc/ntp.conf 에 NTP 서버를 아래와 같이 2개 설정 시 sync 가 안되는 문제 발생.<br> . ntp.conf 에 하단 추가<br>   server x.x.x.x prefer<br>   server x.x.x.x<br> . ntpq - p 로 확인 시 앞에 x 로 표시 되거나 한 개만 sync 됨. 시간이 지난 후 다시 sync 안됨<br><br>※ ntp 서버를 한개의 IP 만 설정 시 이상없이 잘 되고 있음. (특정 커널버전 이후의 OS 버전부터 발생하는 것으로 확인됨)<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><br><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-04-08T06:36:30Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-04-08T06:36:30Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 보내주신 데이터와 로그들을 검토하였으나, 특별히 원인을 분석하는데 자료가 부족한 것 같아서 아래와 같이 데이터 수집을 요청드립니다.<br><br><br>1. 우선 장애시와 테스트를 진행시에 tcpdump 수집<br>2. 기존 2개를 설정할때의 구성정보화 함께 설정파일을 한 후,<br><br>server 42.1.160.101 prefer<br>server 42.1.160.102<br><br># ntpstat -p<br># ntpdc<br>&gt; showpeer 42.1.160.101<br>&gt; showpeer 42.1.160.102<br>&gt; sysinfo<br>&gt; peers<br># ntpq -p<br># ntpdate -d  42.1.160.101<br># ntpdate -d  42.1.160.102<br># ntptime -s 42.1.160.101<br># ntptime -s 42.1.160.102<br><br><br>3. clock source 정보<br># cat /sys/devices/system/clocksource/clocksource0/current_clocksource<br><br><br>4. 기본적으로 ntp는 서버의 설정을 기본적으로 4개를 적용하는 것을 권장하고 있습니다. 다만, 현재 2개의 상황에서 시간의 차이가 발생하게 되면 sigterm으로 데몬을 종료하는 것으로 현재로써는 유추됩니다.<br>또한 &quot;prefer&quot;를 설정했을 경우, 해당 네트워크의 연결이 문제시에도 termination될 수 있는 조건이 형성하는 것으로 파악됩니다.<br><br><br>그럼에 따라 특별한 이유가 없다면 &quot;prefer&quot;를 제거하여 운영을 해보는 것과 동시에 두 서버 statrum의 시간정보에 대해서 추가적인 모니터링이 필요해 보입니다.<br><br><br>우선 위의 정보를 수집을 요청 드립니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-04-08T06:36:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GoXxLIAV"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-04-06T05:04:04Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-04-06T05:04:04Z</b><br><br>안녕하세요.<br><br>ntp 이슈 관련하여,<br>테스트시 발생한 debug 로그 및 비교시스템 정보를 업로드 합니다.<br><br>테스트를 수행한 시스템은 sltalp04 입니다.<br><br>테스트 시나리오는 하기와 같습니다.<br>--------------------------------------------------------------------------<br>#     TEST SCENARIOS<br>--------------------------------------------------------------------------<br>1. TEST-01<br><br>ntpd debug without &quot;-4&quot; options.<br>2. TEST-02<br><br>ntpd debug with &quot;-4&quot; options.<br>3.  TEST-03<br><br>Use one server. Config changed in /etc/ntp.conf<br><br>ntpd debug without &quot;-4&quot; options.<br>4.  TEST-05<br><br>Use one server. Config changed in /etc/ntp.conf<br><br>ntpd debug without &quot;-4&quot; options.<br>5.  TEST-07<br><br>ntp OK status<br>6. TEST-08<br><br>checked output &quot;systemctl status ntpd&quot; with other system.<br>7. TEST-09<br><br>bwsalp01 host's NTP INFO<br>--------------------------------------------------------------------------<br><br><br>감사합니다.<br><br><publishedDate>2016-04-06T05:04:04Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GoXltIAF"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-04-06T04:28:48Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-04-06T04:28:48Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>우선 현재 로그들을 분석하고는 있으나, 추가적인 데이터가 필요하여 요청드립니다.<br><br># journalctl &gt; journalctl.txt<br><br>그리고.. 추가적으로 ntpd 서비스가 죽었다고 판단될때, 아래 정보도 같이 수집 바랍니다.<br><br># systemdctl status ntpd.service -l<br># journalctl -xn<br>======================<br>감사합니다.<br><br><publishedDate>2016-04-06T04:28:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GoXRjIAN"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-04-06T03:18:17Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-04-06T03:18:17Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br><br>문의주신 내용에 대해서 확인 후, 업데이트 드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-04-06T03:18:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br> . ntp.conf 에 하단 추가<br>   server x.x.x.x prefer<br>   server x.x.x.x<br> . ntpq - p 로 확인 시 앞에 x 로 표시 되거나 한 개만 sync 됨. 시간이 지난 후 다시 sync 안됨<br><br>※ ntp 서버를 한개의 IP 만 설정 시 이상없이 잘 되고 있음. (특정 커널버전 이후의 OS 버전부터 발생하는 것으로 확인됨)</issue><cep>false</cep><folderName>ERP-ALL</folderName></case>