======================<br><b>생성계정 : Seung-Pil Kim</b><br><b>생성날짜 : 2016-12-28T06:15:19Z</b><br><b>마지막 답변자 : Jay Shin</b><br><b>마지막 수정 일자 : 2017-01-20T05:00:32Z</b><br><b>id : 500A000000W7bORIAZ</b><br>======================<br><br><b><font size=15>
제목  : nr_cpus=6 disable_cpu_apicid=0 does not generate vmcore in KDUMP_COMMANDLINE_APPEND /etc/sysconfig/kdump [삼성화재][보험ERP][운영계] quoald - kdump커널 진입 실패
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>################################################################################<br>시스템 CRASH테스트 수행시, kdump커널 진입이 실패합니다.<br>관련한 문제의 원인파악 및 해결방안이 필요 합니다.<br><br><br># cat /etc/sysconfig/kdump<br>KDUMP_COMMANDLINE_APPEND=&quot;nr_cpus=6 disable_cpu_apicid=0&quot;<br><br># echo c &gt; /proc/sysrq-trigger<br>################################################################################<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>################################################################################<br><br><br>System Information<br>        Manufacturer: Dell Inc.<br>        Product Name: PowerEdge R930<br>        Version: Not Specified<br>        Wake-up Type: Power Switch<br>        SKU Number: SKU=NotProvided;ModelName=PowerEdge R930<br>        Family: Not Specified<br><br><br>RHEL Version : Red Hat Enterprise Linux Server release 7.2 (Maipo)<br>Kernel Version : 3.10.0-327.el7.x86_64<br>kexec Package Version : kexec-tools-2.0.7-38.el7.x86_64<br><br><br># lscpu <br>Architecture:          x86_64<br>CPU op-mode(s):        32-bit, 64-bit<br>Byte Order:            Little Endian<br>CPU(s):                40<br>On-line CPU(s) list:   0-39<br>Thread(s) per core:    1<br>Core(s) per socket:    10<br>Socket(s):             4<br>NUMA node(s):          4<br>Vendor ID:             GenuineIntel<br>CPU family:            6<br>Model:                 63<br>Model name:            Intel(R) Xeon(R) CPU E7-8891 v3 @ 2.80GHz<br>Stepping:              4<br>CPU MHz:               1200.062<br>BogoMIPS:              5593.92<br>Virtualization:        VT-x<br>L1d cache:             32K<br>L1i cache:             32K<br>L2 cache:              256K<br>L3 cache:              46080K<br>NUMA node0 CPU(s):     0,4,8,12,16,20,24,28,32,36<br>NUMA node1 CPU(s):     1,5,9,13,17,21,25,29,33,37<br>NUMA node2 CPU(s):     2,6,10,14,18,22,26,30,34,38<br>NUMA node3 CPU(s):     3,7,11,15,19,23,27,31,35,39<br><br><br># systemctl restart kdump<br>dracut: dracut-<br>dracut: Executing: /sbin/dracut -f /boot/initramfs-3.10.0-327.el7.x86_64.tmp 3.10.0-327.el7.x86_64<br>dracut: dracut module 'busybox' will not be installed, because command 'busybox' could not be found!<br>dracut: dracut module 'nbd' will not be installed, because command 'nbd-client' could not be found!<br>dracut: dracut module 'busybox' will not be installed, because command 'busybox' could not be found!<br>dracut: dracut module 'nbd' will not be installed, because command 'nbd-client' could not be found!<br>dracut: *** Including module: bash ***<br>dracut: *** Including module: nss-softokn ***<br>dracut: *** Including module: i18n ***<br>dracut: *** Including module: network ***<br>dracut: *** Including module: ifcfg ***<br>dracut: *** Including module: drm ***<br>dracut: *** Including module: plymouth ***<br>dracut: *** Including module: dm ***<br>dracut: Skipping udev rule: 64-device-mapper.rules<br>dracut: Skipping udev rule: 60-persistent-storage-dm.rules<br>dracut: Skipping udev rule: 55-dm.rules<br>dracut: *** Including module: kernel-modules ***<br>dracut: *** Including module: lvm ***<br>dracut: Skipping udev rule: 64-device-mapper.rules<br>dracut: Skipping udev rule: 56-lvm.rules<br>dracut: Skipping udev rule: 60-persistent-storage-lvm.rules<br>dracut: *** Including module: fcoe ***<br>dracut: *** Including module: resume ***<br>dracut: *** Including module: rootfs-block ***<br>dracut: *** Including module: terminfo ***<br>dracut: *** Including module: udev-rules ***<br>dracut: Skipping udev rule: 91-permissions.rules<br>dracut: *** Including module: biosdevname ***<br>dracut: *** Including module: systemd ***<br>dracut: *** Including module: usrmount ***<br>dracut: *** Including module: base ***<br>dracut: *** Including module: fs-lib ***<br>dracut: *** Including module: shutdown ***<br>dracut: *** Including modules done ***<br>dracut: *** Installing kernel module dependencies and firmware ***<br>dracut: *** Installing kernel module dependencies and firmware done ***<br>dracut: *** Resolving executable dependencies ***<br>dracut: *** Resolving executable dependencies done***<br>dracut: *** Hardlinking files ***<br>dracut: *** Hardlinking files done ***<br>dracut: *** Stripping files ***<br>dracut: *** Stripping files done ***<br>dracut: *** Generating early-microcode cpio image ***<br>dracut: *** Constructing GenuineIntel.bin ****<br>dracut: *** Store current command line parameters ***<br>dracut: *** Creating image file ***<br>dracut: *** Creating image file done ***<br><br># cat /var/log/messages<br>kdumpctl: kexec: loaded kdump kernel<br>kdumpctl: Starting kdump: [OK]<br><br>################################################################################<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>################################################################################<br>1. 시스템에서 여러 개의 CPU 소켓이 있으며, 특정 CPU에 문제가 발생하는 경우에도 정상적인 kdump 진입 및 vmcore 수집을 하고자 아래의 설정값을 추가 함.<br># cat /etc/sysconfig/kdump<br>KDUMP_COMMANDLINE_APPEND=&quot;nr_cpus=6 disable_cpu_apicid=0&quot;<br><br>2. 기존의 시스템은 모두 &quot;nr_cpus=6 disable_cpu_apicid=0&quot; 설정값을 설정하였으며, kdump 진입 및 vmcore 수집이 정상적으로 수행 됨.<br><br>3. 현재 시스템은 아래와같이 설정값 조건별로 kdump진입 성공/실패 결과가 달라짐.<br><br><br># echo c &gt; /proc/sysrq-trigger<br><br><br>3-1) nr_cpus=6 disable_cpu_apicid=0 ( kdump진입 실패 )<br><br>3-2) nr_cpus=1 disable_cpu_apicid=0 ( kdump진입 성공 )<br><br>3-3) nr_cpus=6 <br>======================<br><br><br>( kdump진입 성공 )<br><br>3-4) nr_cpus=1 <br>======================<br><br><br>( kdump진입 성공 )<br><br>4. 아래의 명령을 이용하면, 위 3-1)의 설정인 상태에서도 kdump진입이 성공 함.<br># kexec -d -l /boot/vmlinuz-3.10.0-327.el7.x86_64 --initrd=&quot;/boot/initramfs-3.10.0-327.el7.x86_64kdump.img 3.10.0-327.el7.x86_64&quot;<br># kexec -d -e<br>################################################################################<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1596892</b><br><notes>2016년 12 월 이후 R930 장비 체크 필요</notes><br><b>심각도  : 4 (Low)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><folderNumber>74173</folderNumber><br><comment id="a0aA000000If7E9IAJ"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-20T05:00:31Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-20T05:00:31Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>먼저, 본 기술 문의를 직접 종료해주셔서 감사합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>감사합니다.<br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2017-01-20T05:00:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000If72mIAB"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-20T04:30:29Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-20T04:30:28Z</b><br><br>감사합니다.  케이스는 close 하도록 하겠습니다.<br><br><publishedDate>2017-01-20T04:30:28Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IedEDIAZ"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-18T04:52:27Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-18T04:52:27Z</b><br><br>일단 엔지니어링팀에서 좀 더 분석과 테스트가 필요한 시점이며, 몇몇 논의가 이루어지고 있습니다만,<br>아직 별다른 업데이트는 없는 것으로 확인됩니다.<br><br>추후 업데이트가 있으면 알려드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-01-18T04:52:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ied7bIAB"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-18T04:33:08Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-18T04:33:08Z</b><br><br>네 감사합니다.<br><br><publishedDate>2017-01-18T04:33:08Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IeMOfIAN"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-17T07:32:54Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-17T07:32:54Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>엔지니어링 팀의 밥변 및 문의 전달해드립니다.<br><br>It is a little weird, kdump will actually append &quot;disable_cpu_apicid=0&quot; by default if no &quot;disable_cpu_apicid=X&quot; specified, so in theory it makes no difference between &quot;nr_cpus=6 disable_cpu_apicid=0&quot; and &quot;nr_cpus=6&quot;. Did you check the final boot command line passed to kdump kernel for &quot;nr_cpus=6&quot; to see if it contains &quot;disable_cpu_apicid=0&quot;? If so, I wonder if this is a random issue?<br><br>편의상 의역해드리자면,<br>&quot;disable_cpu_apicid=X&quot; 가 특정되지 않으면, 기본 설정에 &quot;disable_cpu_apicid=0&quot; 이 추가됩니다.<br>이론 적으로 &quot;nr_cpus=6 disable_cpu_apicid=0&quot; 과 &quot;nr_cpus=6&quot; 과는 차이가 없습니다.<br><br>&quot;disable_cpu_apicid=0&quot; 을 추가했다면, &quot;nr_cpus=6&quot; 이 kdump 커널에 최종 부트 커맨드라인에 추가되는걸 확인했는지요?<br>만일 그렇다면, 문제가 랜덤하게 발생하는지요?<br><br>테스트 시나리오에 대해, kdump 커널 부트 커맨드라인에 반영되었는지를 묻고있는것 같습니다.<br><br>해당 부분에 대해 답변이 가능하실지요?<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-17T07:32:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ie6ziIAB"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2017-01-16T02:35:24Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2017-01-16T02:35:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>피드백 감사드립니다.<br>금일 담당 엔지니어가 휴가 중인 관계로<br>일단 해당 케이스는 대기상태로 놔두도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-01-16T02:35:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IdabDIAR"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-12T05:11:46Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-12T05:11:46Z</b><br><br>임의 조치로 하도록 하겠습니다.<br>답변 감사합니다.<br><br><publishedDate>2017-01-12T05:11:46Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IdaDfIAJ"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-12T04:26:24Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-12T04:26:24Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>아래 커널 파라메터 설명에 나와있는 것 처럼, nr_cpus가 1이상일 경우에 사용되는 것이 일반적입니다.<br><br>disable_cpu_apicid= [X86,APIC,SMP]<br>                        Format: &lt;int&gt;<br>                        The number of initial APIC ID for the<br>                        corresponding CPU to be disabled at boot,<br>                        mostly used for the kdump 2nd kernel to<br>                        disable BSP to wake up multiple CPUs without<br>                        causing system reset or hang due to sending<br>                        INIT from AP to BSP.<br><br>disable_cpu_apicid<br>    This parameter allows the kdump kernel to disable BSP during boot and then to successfully boot up with multiple processors. This resolves the problem of lack of available interrupt vectors for systems with a high number of devices and ensures that kdump can now successfully capture a core dump on these systems. <br><br><br>disable_cpu_apicid<br>Specify initial APIC id of CPU#0<br><br><br>* You should enable multi-cpu support in dump-capture kernel if you intend<br>  to use multi-thread programs with it, such as parallel dump feature of<br>  makedumpfile. Otherwise, the multi-thread program may have a great<br>  performance degradation. To enable multi-cpu support, you should bring up an<br>  SMP dump-capture kernel and specify maxcpus/nr_cpus, disable_cpu_apicid=[X]<br>  options while loading it.<br><br>본 기술문의를 버그질라 오픈하여 엔지니어의 추가적인 분석을 기대해보도록 하겠습니다.<br>https://bugzilla.redhat.com/show_bug.cgi?id=1412453<br>본 버그는 인터널로 오픈되어 외부에 공개되지는 않습니다. 추가 정보가 확인되면 안내해드리도록 하겠습니다.<br><br>다소 시간이 소요될 수 있으니, 운영중인 시스템이라면 nr_cpus=1 로 설정하여 임시 조치를 하시기 바랍니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-12T04:26:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IdZxFIAV"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-12T03:47:05Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-12T03:47:04Z</b><br><br>답변 감사합니다.<br><br>nr_cpus=6 disable_cpu_apicid=5  옵션으로 진행해도 dump 파일이 생성되지 않습니다.<br>nr_cpus=1 disable_cpu_apicid=0 으로 수정했을때 정상적으로 생성이 됩니다.<br><br>disable_cpu_apicid 옵션은 npr_cpus 내용이 1 이상일때 쓰는것으로 알고 있는데<br>이 옵션이 의미하는게 무엇인가요?<br><br><publishedDate>2017-01-12T03:47:04Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IdMC3IAN"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-11T07:25:14Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-11T07:25:14Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin<br>Technical Support Engineer<br>GSS, Asia Pacific, Red Hat Inc<br><br><publishedDate>2017-01-11T07:25:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IcpzbIAB"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-09T06:26:15Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-09T06:26:15Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>동작하는 조합 중에 다음 설정도 동작이 되지 않는지 확인해주시기 바랍니다.<br><br>nr_cpus=6 disable_cpu_apicid=5<br><br>여전히 동작이 되지않는다면 동작이 확인된 설정으로 운영하는 것이 필요합니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-09T06:26:15Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IcZVqIAN"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-06T04:46:06Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-06T04:46:06Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>kdump 는 싱글 프로세스에서 동작하게 설계되어있는 것으로 보입니다.<br>따라서, nr_cpus=1 가 기본 설정이며 변경시에는 동작 여부를 확인할 수 없을 것 같습니다.<br><br> Optional: Disable Symmetric Multi-Processing (SMP) support:<br><br>Kdump can only work with a single processor. If you have only a single processor or run your machine with SMP support disabled, you can safely set this parameter to (n).<br><br>CONFIG_SMP=n<br><br>On the other hand, if your kernel must use SMP for whatever reason, you will want to set this directive to (y). However, you will have to remember this during the Kdump configuration. We will have to set Kdump to use only a single CPU. It is very important that you remember this!<br><br>To recap, you can either disable SMP during the compilation - OR - enable SMP but instruct Kdump to use a single CPU. This instruction is done by changing the Kdump configuration file. It is NOT a part of the kernel compilation configuration.<br><br>The configuration file change requires that one of the options be configured in a particular manner. Specifically, the directive below needs to be set in the Kdump configuration file under /etc/sysconfig/kdump AFTER the kernel has been compiled and installed.<br><br>KDUMP_COMMANDLINE_APPEND=&quot;maxcpus=1 &quot; <br><br>http://www.dedoimedo.com/computers/kdump.html<br>/usr/share/doc/kernel-doc-3.10.0/Documentation/kdump/kdump.txt<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-06T04:46:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IcYuaIAF"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-06T02:33:07Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-06T02:33:07Z</b><br><br>답변 감사합니다.<br><br>1.<br>아래 맨페이지를 확인해보면 --append 와 --command-line 옵션이 있습니다.<br><br>$ man kexec<br><br>              --append=string<br>                     Append string to the kernel command line.<br><br>              --command-line=string<br>                     Set the kernel command line to string.<br><br>해당 설정으로 조합하여 수동으로 kexec 를 수행해보시기 바랍니다.<br><br>https://access.redhat.com/solutions/2351931<br><br><br>이렇게 할 경우  아래와 같이하면 되는지요?<br><br>[root@rhel7 ~]# kexec -l /boot/vmlinuz-kernelversion  --initrd=/boot/initramfs-kernelversion-kdump.img --append=root=/dev/mapper/rhel-root<br>[root@rhel7 ~]#kexec -e<br><br>### MACHINE REBOOTS ###<br>======================<br>2.아래 문서는 Hitachi 서버의 경우 nr_cpus=4로 변경하면 kdump 가 정상 수행된다고 안내하고 있는 것으로보아, bios 설정등에 관련이 있는 것이 아닌지 의심됩니다.<br>https://access.redhat.com/solutions/1175723<br><br><br>nr_cpus= 옵션은 1~6 까지 테스트 해보았습니다. bios 설정은 dell 엔지니어가 확인해 주었습니다.<br><br><br>3.아래 델 R930 바이오스 업데이트 내역을 확인하여 최신버전의 바이오스 업데이트 이후 테스트도 진행해보면 좋겠습니다.<br>http://www.dell.com/support/home/us/en/04/Drivers/DriversDetails?driverId=CFN7Y<br>http://www.dell.com/support/home/us/en/04/Drivers/DriversDetails?driverId=CMKVG<br><br>바이오스는 <br>최신 버전 2.2.0 , 2.1.3, 2.0.16 세가지 모두 테스트 해보았습니다.<br>동일한 증상입니다.<br><br><publishedDate>2017-01-06T02:33:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IcYaxIAF"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-06T01:38:52Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-06T01:38:52Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>&gt; 그래서 해당 옵션을 가지고 kexec 를 수동으로 실행 시키는 방법이 있는지 확인 부탁 드립니다.<br><br>&gt; 아니면 nr_cpus=6 disable_cpu_apicid=0 옵션을 변경해야 하는지요?<br><br>아래 맨페이지를 확인해보면 --append 와 --command-line 옵션이 있습니다.<br><br>$ man kexec<br><br>              --append=string<br>                     Append string to the kernel command line.<br><br>              --command-line=string<br>                     Set the kernel command line to string.<br><br>해당 설정으로 조합하여 수동으로 kexec 를 수행해보시기 바랍니다.<br><br>https://access.redhat.com/solutions/2351931<br><br>아래 문서는 Hitachi 서버의 경우 nr_cpus=4로 변경하면 kdump 가 정상 수행된다고 안내하고 있는 것으로보아, bios 설정등에 관련이 있는 것이 아닌지 의심됩니다.<br>https://access.redhat.com/solutions/1175723<br><br>아래 델 R930 바이오스 업데이트 내역을 확인하여 최신버전의 바이오스 업데이트 이후 테스트도 진행해보면 좋겠습니다.<br>http://www.dell.com/support/home/us/en/04/Drivers/DriversDetails?driverId=CFN7Y<br>http://www.dell.com/support/home/us/en/04/Drivers/DriversDetails?driverId=CMKVG<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-06T01:38:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IcLnRIAV"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-05T07:33:28Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-05T07:33:28Z</b><br><br>동영상은 보안 환경때문에 찍을 수가 없어서 불가한 상황입니다.<br><br>nr_cpus=6 disable_cpu_apicid=0  옵션이 적용된 상태에서는 <br>echo c &gt; /proc/sysrq-trigger   실행시 아무런 메세지가 나오지 않고 바로 리부팅 화면으로 들어갑니다.<br>해당 테스트는 직접 콘솔에서 작업을 하였습니다.  <br>kdump 진입자체를 못한것 아닌가 하는 추정이 듭니다.<br><br>그래서 해당 옵션을 가지고 kexec 를 수동으로 실행 시키는 방법이 있는지 확인 부탁 드립니다.<br><br>아니면 nr_cpus=6 disable_cpu_apicid=0 옵션을 변경해야 하는지요?<br><br><publishedDate>2017-01-05T07:33:28Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IcKJNIA3"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-05T03:09:35Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-05T03:09:35Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>vmcore 수집 실패시에 콘솔에 메시지가 표시된다면 동영상으로 저장하여 보내주시기바랍니다.<br>혹은 메시지가 없다면, 시리얼 콘솔 설정으로 로그가 표시될 수도 있으니, 시리얼 콘솔 설정이 가능한지도 확인해주시기 바랍니다.<br>https://access.redhat.com/solutions/1300623<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-05T03:09:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ic3d9IAB"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-04T04:43:13Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-04T04:43:13Z</b><br><br>답변 감사합니다.<br><br><br>지금까지 설치한 장비의 kdump_commandline_append 옵션입니다.<br><br>KDUMP_COMMANDLINE_APPEND=&quot; irqpoll nr_cpus=6 disable_cpu_apicid=0 reset_devices cgroup_disable=memory mce=off numa=off udev.children-max=2 panic=10 rootflags=nofail acpi_no_memhotplug transparent_hugepage=never rd.driver.blacklist=seos rdloaddriver=megaraid_sas rdloaddriver=lpfc&quot;<br><br>위에 옵션과 함께<br><br>/etc/kdump.conf 에서 default shell  로 설정하고 <br><br>&quot;echo c &gt; /proc/sysrq-trigger &quot; 실행 할  경우 바로 리부팅 합니다. 쉘로 빠지지 않습니다.<br><br>현재 아래의 옵션을 사용하여 적용하니 kdump 가 정상적으로 동작합니다. <br><br>KDUMP_COMMANDLINE_APPEND=&quot; irqpoll nr_cpus=1 disable_cpu_apicid=0 reset_devices cgroup_disable=memory mce=off numa=off udev.children-max=2 panic=10 rootflags=nofail acpi_no_memhotplug transparent_hugepage=never rd.driver.blacklist=seos rdloaddriver=megaraid_sas rdloaddriver=lpfc&quot;<br><br>nr_cpus 는 6,5,4,3,2,1, 순차적으로 적용해 보았습니다.<br><br>정상적으로 kdump 가 발생하는 것은 nr_cpus=1  일 경우 입니다.<br><br><publishedDate>2017-01-04T04:43:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Ic3UvIAJ"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-04T04:14:03Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-04T04:14:02Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>nr_cpus 는 소켓 갯수가 아닌 core 갯수도 아닌 논리적인 cpu의 숫자입니다.<br>시스템은 4소켓 10코어 40 개의 논리적인 cpu가 존재하는 것으로 확인됩니다.<br>따라서 nr_cpus=40 이 최대값으로 설정될 수 있습니다.<br><br>다음 설정은 시스템 기본으로 설정되는 값입니다.<br><br>KDUMP_COMMANDLINE_APPEND=&quot;irqpoll nr_cpus=1 reset_devices cgroup_disable=memory mce=off numa=off udev.children-max=2 panic=10 rootflags=nofail acpi_no_memhotplug transparent_hugepage=never&quot;<br><br>/etc/kdump.conf 설정중에 default shell 이라는 설정이 있습니다. 이는 덤프가 실패할 경우 쉘을 로딩하게 된다고 맨페이지에 언급되어있습니다.<br><br>$ man kdump.conf<br><br>       default &lt;reboot | halt | poweroff | shell | dump_to_rootfs&gt;<br>              Action to perform in case dumping to the intended target fails. The  default  is  &quot;reboot&quot;.   reboot:<br>              Reboot  the  system (this is what most people will want, as it returns the system to a normal state).<br>              halt: Halt the system and lose the vmcore.  poweroff: The system will be powered down.   shell:  Drop<br>              to  a  shell  session  inside  the initramfs, from which you can manually perform additional recovery<br>              actions.  Exiting this shell reboots the system.   Note:  kdump  uses  bash  as  the  default  shell.<br>              dump_to_rootfs:   If   non-root  dump  target  is  specified,  the  default  action  can  be  set  as<br>              dump_to_rootfs.  That means when dumping to target fails, dump vmcore to rootfs from  initramfs  con‐<br>              text and reboot.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-04T04:14:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ic2zzIAB"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2017-01-04T02:15:42Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2017-01-04T02:15:42Z</b><br><br>저희 같은 경우 <br><br>KDUMP_COMMANDLINE_APPEND=&quot;irqpoll nr_cpus=6 disable_cpu_apicid=0 <br>가 추가되어 있습니다.<br><br>nr_cpus=6 에서 순차적으로 값을 줄여봐도 결국 nr_cpus=1 이 아닌경우에는 kdump 진입이 실패가 됩니다.<br>다만 nr_cpus=1 일 경우에는 정상적으로 kdump 가 발생합니다. nr_cpus 는 시스템에서 가지고 있는 cpu의 무슨 갯수를 <br>의미하나요? 소켓 갯수인 가요? core 갯수인가요?<br><br>추가적인 질문은<br>kdump 를  echo c &gt; /proc/sysrq-trigger 대신에 수동으로 command line 에서 진입할수 있는 방법이 있나요?<br>수동으로 진입이 가능 하다면  에러 메세지를 볼수 있을것 같은데 바로 리부팅 하기 때문에 어떤 상황인지 알수 가 없습니다.<br>kdump 진입을 debug 형태로 볼수 있는 방법은 없는지요?<br><br><publishedDate>2017-01-04T02:15:42Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IXeiGIAT"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2017-01-03T06:09:23Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2017-01-03T06:09:23Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>시스템에 따라서 kdump 서비스가 동작하는데 필요한 설정이 달라지기도 합니다.<br><br>아래 문서에서도 언급하다시피 화웨이 시스템의 경우 특정 kdump 파라메터를 활성화하여<br>kdump 서비스가 정상적으로 동작시키게 됩니다.<br><br>KDUMP_COMMANDLINE_APPEND=&quot;irqpoll nr_cpus=4 disable_cpu_apicid=0 reset_devices cgroup_disable=memory mce=off&quot;<br><br>* What changes do I need to make to kdump configuration to ensure successful operation on a Huawei KunLun 9016 system? <br>  https://access.redhat.com/solutions/2599941<br><br>따라서, 동작하는 설정을 이미 확인하셨다면, 해당 설정으로 커널 패닉시에 kdump 서비스를 정상적으로 구동할 수 있을 것입니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br><br>Jay Shin, Technical Support Engineer<br><br>Office: +82 2 3490 5200 - ext 3 (기술문의)<br>Email: jaeshin@redhat.com <br><br>Red Hat, Asia-Pacific Pty Ltd <br>Website: www.redhat.com<br><br><publishedDate>2017-01-03T06:09:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IX8FfIAL"><br>======================<br><b>생성계정 : Haveri, Tejashwini</b><br><b>생성날짜 : 2016-12-28T06:43:02Z</b><br><b>마지막 답변자 : Haveri, Tejashwini</b><br><b>마지막 수정 일자 : 2016-12-28T06:43:02Z</b><br><br>안녕하세요,<br><br> <br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br> <br><br>고객님의 계약 사항과 문제 심각도에 따라서 본 기술 문의는 한국 업무 시간에 지원됨을 안내해드립니다.<br><br>한국 업무 시간 : 월 - 금, 오전 9시 - 오후 5시<br><br> <br><br>감사합니다.<br><br><publishedDate>2016-12-28T06:43:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>시스템 CRASH테스트 수행시, kdump커널 진입이 실패합니다.<br>관련한 문제의 원인파악 및 해결방안이 필요 합니다.<br><br><br># cat /etc/sysconfig/kdump<br>KDUMP_COMMANDLINE_APPEND=&quot;nr_cpus=6 disable_cpu_apicid=0&quot;<br><br># echo c &gt; /proc/sysrq-trigger<br>################################################################################</issue><environment>################################################################################<br><br><br>System Information<br>        Manufacturer: Dell Inc.<br>        Product Name: PowerEdge R930<br>        Version: Not Specified<br>        Wake-up Type: Power Switch<br>        SKU Number: SKU=NotProvided;ModelName=PowerEdge R930<br>        Family: Not Specified<br><br><br>RHEL Version : Red Hat Enterprise Linux Server release 7.2 (Maipo)<br>Kernel Version : 3.10.0-327.el7.x86_64<br>kexec Package Version : kexec-tools-2.0.7-38.el7.x86_64<br><br><br># lscpu <br>Architecture:          x86_64<br>CPU op-mode(s):        32-bit, 64-bit<br>Byte Order:            Little Endian<br>CPU(s):                40<br>On-line CPU(s) list:   0-39<br>Thread(s) per core:    1<br>Core(s) per socket:    10<br>Socket(s):             4<br>NUMA node(s):          4<br>Vendor ID:             GenuineIntel<br>CPU family:            6<br>Model:                 63<br>Model name:            Intel(R) Xeon(R) CPU E7-8891 v3 @ 2.80GHz<br>Stepping:              4<br>CPU MHz:               1200.062<br>BogoMIPS:              5593.92<br>Virtualization:        VT-x<br>L1d cache:             32K<br>L1i cache:             32K<br>L2 cache:              256K<br>L3 cache:              46080K<br>NUMA node0 CPU(s):     0,4,8,12,16,20,24,28,32,36<br>NUMA node1 CPU(s):     1,5,9,13,17,21,25,29,33,37<br>NUMA node2 CPU(s):     2,6,10,14,18,22,26,30,34,38<br>NUMA node3 CPU(s):     3,7,11,15,19,23,27,31,35,39<br><br><br># systemctl restart kdump<br>dracut: dracut-<br>dracut: Executing: /sbin/dracut -f /boot/initramfs-3.10.0-327.el7.x86_64.tmp 3.10.0-327.el7.x86_64<br>dracut: dracut module 'busybox' will not be installed, because command 'busybox' could not be found!<br>dracut: dracut module 'nbd' will not be installed, because command 'nbd-client' could not be found!<br>dracut: dracut module 'busybox' will not be installed, because command 'busybox' could not be found!<br>dracut: dracut module 'nbd' will not be installed, because command 'nbd-client' could not be found!<br>dracut: *** Including module: bash ***<br>dracut: *** Including module: nss-softokn ***<br>dracut: *** Including module: i18n ***<br>dracut: *** Including module: network ***<br>dracut: *** Including module: ifcfg ***<br>dracut: *** Including module: drm ***<br>dracut: *** Including module: plymouth ***<br>dracut: *** Including module: dm ***<br>dracut: Skipping udev rule: 64-device-mapper.rules<br>dracut: Skipping udev rule: 60-persistent-storage-dm.rules<br>dracut: Skipping udev rule: 55-dm.rules<br>dracut: *** Including module: kernel-modules ***<br>dracut: *** Including module: lvm ***<br>dracut: Skipping udev rule: 64-device-mapper.rules<br>dracut: Skipping udev rule: 56-lvm.rules<br>dracut: Skipping udev rule: 60-persistent-storage-lvm.rules<br>dracut: *** Including module: fcoe ***<br>dracut: *** Including module: resume ***<br>dracut: *** Including module: rootfs-block ***<br>dracut: *** Including module: terminfo ***<br>dracut: *** Including module: udev-rules ***<br>dracut: Skipping udev rule: 91-permissions.rules<br>dracut: *** Including module: biosdevname ***<br>dracut: *** Including module: systemd ***<br>dracut: *** Including module: usrmount ***<br>dracut: *** Including module: base ***<br>dracut: *** Including module: fs-lib ***<br>dracut: *** Including module: shutdown ***<br>dracut: *** Including modules done ***<br>dracut: *** Installing kernel module dependencies and firmware ***<br>dracut: *** Installing kernel module dependencies and firmware done ***<br>dracut: *** Resolving executable dependencies ***<br>dracut: *** Resolving executable dependencies done***<br>dracut: *** Hardlinking files ***<br>dracut: *** Hardlinking files done ***<br>dracut: *** Stripping files ***<br>dracut: *** Stripping files done ***<br>dracut: *** Generating early-microcode cpio image ***<br>dracut: *** Constructing GenuineIntel.bin ****<br>dracut: *** Store current command line parameters ***<br>dracut: *** Creating image file ***<br>dracut: *** Creating image file done ***<br><br># cat /var/log/messages<br>kdumpctl: kexec: loaded kdump kernel<br>kdumpctl: Starting kdump: [OK]<br><br>################################################################################</environment><periodicityOfIssue>################################################################################<br>1. 시스템에서 여러 개의 CPU 소켓이 있으며, 특정 CPU에 문제가 발생하는 경우에도 정상적인 kdump 진입 및 vmcore 수집을 하고자 아래의 설정값을 추가 함.<br># cat /etc/sysconfig/kdump<br>KDUMP_COMMANDLINE_APPEND=&quot;nr_cpus=6 disable_cpu_apicid=0&quot;<br><br>2. 기존의 시스템은 모두 &quot;nr_cpus=6 disable_cpu_apicid=0&quot; 설정값을 설정하였으며, kdump 진입 및 vmcore 수집이 정상적으로 수행 됨.<br><br>3. 현재 시스템은 아래와같이 설정값 조건별로 kdump진입 성공/실패 결과가 달라짐.<br><br><br># echo c &gt; /proc/sysrq-trigger<br><br><br>3-1) nr_cpus=6 disable_cpu_apicid=0 ( kdump진입 실패 )<br><br>3-2) nr_cpus=1 disable_cpu_apicid=0 ( kdump진입 성공 )<br><br>3-3) nr_cpus=6 <br>======================<br><br><br>( kdump진입 성공 )<br><br>3-4) nr_cpus=1 <br>======================<br><br><br>( kdump진입 성공 )<br><br>4. 아래의 명령을 이용하면, 위 3-1)의 설정인 상태에서도 kdump진입이 성공 함.<br># kexec -d -l /boot/vmlinuz-3.10.0-327.el7.x86_64 --initrd=&quot;/boot/initramfs-3.10.0-327.el7.x86_64kdump.img 3.10.0-327.el7.x86_64&quot;<br># kexec -d -e<br>################################################################################</periodicityOfIssue><cep>false</cep><folderName>ERP-ALL</folderName></case>