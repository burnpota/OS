======================<br><b>생성계정 : support os</b><br><b>생성날짜 : 2018-10-19T04:48:03Z</b><br><b>마지막 답변자 : Jay Shin</b><br><b>마지막 수정 일자 : 2018-11-05T03:49:10Z</b><br><b>id : 500A000000cGXWPIA4</b><br>======================<br><br><b><font size=15>
제목  : XFS metadata I/O error 메세지 발생
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>특정 볼륨에서 I/O error 메세지가 다수 발생하여 문의드립니다.<br> <br>현재 매핑된 볼륨 정보와 상세로그 메세지는 아래와 같습니다.<br><br>[root@clddatp01:~]#ls -al /dev/mapper<br>total 0<br>drwxr-xr-x  2 root root     220 Sep 13 16:56 .<br>drwxr-xr-x 21 root root    4180 Oct  1 16:36 ..<br>crw-------  1 root root 10, 236 Sep 13 16:56 control<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg00-crash_lv -&gt; ../dm-4<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg00-home_lv -&gt; ../dm-2<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg00-root_lv -&gt; ../dm-0<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg00-swap_lv -&gt; ../dm-1<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg00-var_lv -&gt; ../dm-3<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg01-log_cloudera -&gt; ../dm-6<br>lrwxrwxrwx  1 root root       7 Sep 13 16:56 vg01-opt_cloudera -&gt; ../dm-7<br>lrwxrwxrwx  1 root root       7 Oct 17 17:58 vg01-osbackup_lv -&gt; ../dm-5<br><br># /var/log/messages<br>Oct 17 17:43:42 clddatp01 kernel: XFS (dm-5): metadata I/O error: block 0x2 (&quot;xfs_trans_read_buf_map&quot;) error 74 numblks 1<br>Oct 17 17:47:42 clddatp01 kernel: XFS (dm-7): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Oct 17 17:47:42 clddatp01 kernel: XFS (dm-7): Unmount and run xfs_repair<br>Oct 17 17:47:42 clddatp01 kernel: XFS (dm-7): First 64 bytes of corrupted metadata buffer:<br>Oct 17 17:47:42 clddatp01 kernel: ffff88203c2b7a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct 17 17:47:42 clddatp01 kernel: ffff88203c2b7a10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct 17 17:47:42 clddatp01 kernel: ffff88203c2b7a20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct 17 17:47:42 clddatp01 kernel: ffff88203c2b7a30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br><br><br>Log 메세지는 위와 같은 패턴으로 10월 1일부터 간헐적으로 발생하였고, 현재는 해당 볼륨을 xfs_repair를 통해 조치하여 메세지가 더이상 보이지는 않습니다.<br><br><br>조치는 되었지만 차후에 동일 현상이 발생할 것을 대비하여 위 문제에 대한 원인을 알고 싶습니다.<br><br>첨부된 sosreport를 확인하시어 분석 부탁드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Other</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><hostname>clddatp01</hostname><br><br><br><comment id="a0aA000000O6l37IAB"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-11-05T03:49:07Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-11-05T03:49:07Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>본 기술 문의의 상태를 처리완료 상태로 변경하고자 합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 본 기술 문의를 *재개*하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-11-05T03:49:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000O66lbIAB"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-11-01T00:33:50Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-11-01T00:33:50Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-11-01T00:33:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000O4nE1IAJ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-10-26T01:53:58Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-10-26T01:53:58Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>추가 로그 분석 결과입니다.<br>dm-2 (sda2) 는 9월 12일에 corrupted 된 기록이 있습니다.<br><br>~~~<br>Sep 12 01:31:09 bdahalp05 kernel: XFS (dm-2): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Sep 12 01:31:09 bdahalp05 kernel: XFS (dm-2): Unmount and run xfs_repair<br>Sep 12 01:31:09 bdahalp05 kernel: XFS (dm-2): First 64 bytes of corrupted metadata buffer:<br>Sep 12 01:31:09 bdahalp05 kernel: ffff88203efbf000: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Sep 12 01:31:09 bdahalp05 kernel: ffff88203efbf010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Sep 12 01:31:09 bdahalp05 kernel: ffff88203efbf020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Sep 12 01:31:09 bdahalp05 kernel: ffff88203efbf030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Sep 12 01:31:09 bdahalp05 kernel: XFS (dm-2): metadata I/O error: block 0x2 (&quot;xfs_trans_read_buf_map&quot;) error 74 numblks 1<br>~~~<br><br>그 이후 시스템이 9월 13일에 재시작이 된 이후에 sdb1 (dm-5, dm-6, dm-7) 에서도 corruption 이 발생하였으며<br>corruption 발생전에 cloudera-scm-agent 서비스 시작하는 부분이 확인됩니다.<br>하지만 cloudera-scm-agent 가 직접적인 원인인지는 알 수 없습니다.<br><br>~~~<br>reboot   system boot  3.10.0-693.el7.x Thu Sep 13 16:56 - 10:09 (34+17:12)<br>...<br>Oct  1 17:41:26 clddatp01 cloudera-scm-agent: Starting cloudera-scm-agent: [  OK  ]  &lt;&lt;<br>...<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): Unmount and run xfs_repair<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): First 64 bytes of corrupted metadata buffer:<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): metadata I/O error: block 0x2 (&quot;xfs_trans_read_buf_map&quot;) error 74 numblks 1<br>...<br>Oct  2 14:40:54 clddatp01 cloudera-scm-agent: Stopping cloudera-scm-agent: [  OK  ]  &lt;&lt;<br>...<br>Oct  2 14:43:35 clddatp01 kernel: XFS (dm-7): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Oct  2 14:43:35 clddatp01 kernel: XFS (dm-7): Unmount and run xfs_repair<br>Oct  2 14:43:35 clddatp01 kernel: XFS (dm-7): First 64 bytes of corrupted metadata buffer:<br>Oct  2 14:43:35 clddatp01 kernel: ffff882023676800: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 14:43:35 clddatp01 kernel: ffff882023676810: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 14:43:35 clddatp01 kernel: ffff882023676820: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 14:43:35 clddatp01 kernel: ffff882023676830: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>...<br>Oct  2 18:35:44 clddatp01 kernel: XFS (dm-5): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Oct  2 18:35:44 clddatp01 kernel: XFS (dm-5): Unmount and run xfs_repair<br>Oct  2 18:35:44 clddatp01 kernel: XFS (dm-5): First 64 bytes of corrupted metadata buffer:<br>Oct  2 18:35:44 clddatp01 kernel: ffff880a83746e00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 18:35:44 clddatp01 kernel: ffff880a83746e10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 18:35:44 clddatp01 kernel: ffff880a83746e20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 18:35:44 clddatp01 kernel: ffff880a83746e30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  2 18:35:44 clddatp01 kernel: XFS (dm-5): metadata I/O error: block 0x2 (&quot;xfs_trans_read_buf_map&quot;) error 74 numblks 1<br>~~~<br><br>다음은 추가로 확인된 디스크의 type 설정입니다.<br>/dev/sdb 가 LVM type 이 아닌 Microsoft basic primary type 으로 설정되어 있습니다.<br><br>~~~<br>$ more fdisk_-l_.dev.sdb<br>WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.<br>Disk /dev/sdb: 4000.2 GB, 4000225165312 bytes, 7812939776 sectors<br>Units = sectors of 1 * 512 = 512 bytes<br>Sector size (logical/physical): 512 bytes / 512 bytes<br>I/O size (minimum/optimal): 512 bytes / 512 bytes<br>Disk label type: gpt<br>Disk identifier: 5A482AF8-661F-4DAE-A831-71BE3A1D6670<br>#         Start          End    Size  Type            Name<br> 1         2048   7812937727    3.7T  Microsoft basic primary<br>~~~<br><br>앞서 말씀드린 것처럼 이미 corruption 이 수정된 상황에서 명확한 원인을 찾기는 어렵습니다.<br>추후에 동일한 증상이 발생한다면 xfs_repair 를 실행하시기 전에 xfs_metadump 를 이용하여 dump 파일을 생성 후 업로드 부탁드립니다.<br>dump 생성 방법은 아래 첨무 문서 [1] 을 참조 부탁드립니다.<br><br>[1] How to extract a metadata dump from a XFS filesystem?<br>https://access.redhat.com/solutions/2983101<br><br>감사합니다.<br><br><publishedDate>2018-10-26T01:53:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000O4FhqIAF"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-10-24T08:27:24Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-10-24T08:27:23Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>아래는 최초 metadata error 가 발생하기 직전의 로그입니다<br>당시에 yum 을 이용하여 패키지를 추가로 설치하고 cloudera-scm-agent 서비스를 기동하는 내용이 확인됩니다.<br>하지만 metadata corrupted 와 직접적으로 연관이 있어 보이지 않습니다.<br>아직 지속적으로 분석을 진행하고 있습니다만 시스템의 로그만으로는 원인을 찾기 어려울 것 같습니다.<br>당시의 정황 또는 진행하고 있었던 작업이 있으셨는지 확인부탁드립니다.<br><br>~~~<br>Oct  1 17:28:04 clddatp01 yum[108021]: Installed: MySQL-python-1.2.5-1.el7.x86_64<br>Oct  1 17:28:04 clddatp01 yum[108021]: Installed: postgresql-libs-9.2.21-1.el7.x86_64<br>Oct  1 17:28:04 clddatp01 yum[108021]: Installed: python-psycopg2-2.5.1-3.el7.x86_64<br>Oct  1 17:28:49 clddatp01 yum[108021]: Installed: cloudera-manager-daemons-5.15.0-1.cm5150.p0.62.el7.x86_64<br>Oct  1 17:28:49 clddatp01 yum[108021]: Installed: libsepol-devel-2.5-6.el7.x86_64<br>Oct  1 17:28:49 clddatp01 yum[108021]: Installed: spax-1.5.2-13.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: pcre-devel-8.32-17.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: libselinux-devel-2.5-11.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: libcom_err-devel-1.42.9-10.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: redhat-lsb-submod-security-4.1-27.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: redhat-lsb-core-4.1-27.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: libverto-devel-0.2.5-4.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: keyutils-libs-devel-1.5.8-3.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: krb5-devel-1.15.1-8.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: 1:openssl-devel-1.0.2k-8.el7.x86_64<br>Oct  1 17:28:50 clddatp01 yum[108021]: Installed: 1:mod_ssl-2.4.6-67.el7.x86_64<br>Oct  1 17:28:53 clddatp01 systemd: Configuration file /usr/lib/systemd/system/SeOS.service is marked world-inaccessible. This has no effect as configuration data is accessible via APIs without restrictions. Proceeding anyway.<br>Oct  1 17:28:53 clddatp01 systemd: Binding to IPv6 address not available since kernel does not support IPv6.<br>Oct  1 17:28:53 clddatp01 yum[108021]: Installed: cloudera-manager-agent-5.15.0-1.cm5150.p0.62.el7.x86_64<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit dmraid-activation.service, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit iscsi.service, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit multipathd.service, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit alsa-state.service, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit alsa-restore.service, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit avahi-daemon.socket, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 systemd: Cannot add dependency job for unit NetworkManager-wait-online.service, ignoring: Unit is masked.<br>Oct  1 17:41:25 clddatp01 su: (to root) root on none<br>Oct  1 17:41:26 clddatp01 cloudera-scm-agent: Starting cloudera-scm-agent: [  OK  ]<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): Unmount and run xfs_repair<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): First 64 bytes of corrupted metadata buffer:<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: ffff880e2f2bce30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Oct  1 17:45:31 clddatp01 kernel: XFS (dm-7): metadata I/O error: block 0x2 (&quot;xfs_trans_read_buf_map&quot;) error 74 numblks 1<br>~~~<br><br>감사합니다.<br><br><publishedDate>2018-10-24T08:27:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000O4BlXIAV"><br>======================<br><b>생성계정 : os, support</b><br><b>생성날짜 : 2018-10-24T01:38:48Z</b><br><b>마지막 답변자 : os, support</b><br><b>마지막 수정 일자 : 2018-10-24T01:38:48Z</b><br><br>안녕하세요 sosreport 다시 첨부 드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-10-24T01:38:48Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000O3bAaIAJ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-10-22T01:28:10Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-10-22T01:28:09Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Platform Support 를 담당하고 있는 Technical Support Engineer 박현익 입니다.<br>sosreport 가 누락된 것 같습니다.<br>sosreport 를 다시 첨부 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-10-22T01:28:09Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>