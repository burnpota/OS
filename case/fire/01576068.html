======================<br><b>생성계정 : Seung-Pil Kim</b><br><b>생성날짜 : 2016-02-01T11:09:14Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-04-03T10:10:38Z</b><br><b>id : 500A000000TSSLuIAP</b><br>======================<br><br><b><font size=15>
제목  : [삼성화재][보험ERP][가동계][quoa] xfs volume unexpectly unmount and file system corrupt
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>##################################################<br># Failed Info AND Messages<br>##################################################<br>요약 : xfs volume unexpectly unmount and file system corrupt<br><br>1) 하기의 로그가 시스템 메세지( /var/log/messages )에 기록되고, xfs 파일시스템 영역이 Unmounted 됨<br><br>Jan 29 15:36:00 quoalp01 systemd: Unmounted /usr/sap.<br>Jan 29 15:36:00 quoalp01 systemd: Unit usr-sap.mount entered failed state.<br>Jan 29 15:36:01 quoalp01 systemd: Started Session 7715 of user root.<br>Jan 29 15:36:01 quoalp01 systemd: Starting Session 7715 of user root.<br>Jan 29 15:36:40 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/sap_lv...<br>Jan 29 15:36:40 quoalp01 systemd-fsck: /sbin/fsck.xfs: XFS file system.<br>Jan 29 15:36:40 quoalp01 systemd: Started File System Check on /dev/DATAVG001/sap_lv.<br>Jan 29 15:36:40 quoalp01 systemd: usr-sap.mount: Directory /usr/sap to mount over is not empty, mounting anyway.<br>Jan 29 15:36:40 quoalp01 systemd: Mounting /usr/sap...<br>Jan 29 15:36:40 quoalp01 kernel: XFS (dm-15): Mounting V4 Filesystem<br>Jan 29 15:36:40 quoalp01 kernel: XFS (dm-15): Ending clean mount<br>Jan 29 15:36:40 quoalp01 systemd: Mounted /usr/sap.<br>Jan 29 15:37:01 quoalp01 systemd: Started Session 7716 of user root.<br>Jan 29 15:37:01 quoalp01 systemd: Starting Session 7716 of user root.<br>Jan 29 15:37:15 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/sapQFP_lv...<br>Jan 29 15:37:15 quoalp01 systemd-fsck: /sbin/fsck.xfs: XFS file system.<br>Jan 29 15:37:15 quoalp01 systemd: Started File System Check on /dev/DATAVG001/sapQFP_lv.<br>Jan 29 15:37:15 quoalp01 systemd: Mounting /usr/sap/QFP...<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): Mounting V4 Filesystem<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc800020 (&quot;xlog_bread_noalign&quot;) error 19 numblks 1<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): empty log check failed<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount/recovery failed: error -19<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount failed<br>Jan 29 15:37:15 quoalp01 mount: mount: unknown filesystem type 'xfs'<br>Jan 29 15:37:15 quoalp01 systemd: usr-sap-QFP.mount mount process exited, code=exited status=32<br>Jan 29 15:37:15 quoalp01 systemd: Failed to mount /usr/sap/QFP.<br>Jan 29 15:37:15 quoalp01 systemd: Unit usr-sap-QFP.mount entered failed state.<br>Jan 29 15:38:01 quoalp01 systemd: Started Session 7717 of user root.<br>Jan 29 15:38:01 quoalp01 systemd: Starting Session 7717 of user root.<br>Jan 29 15:38:41 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/APP_lv...<br>Jan 29 15:38:41 quoalp01 systemd-fsck: /sbin/fsck.xfs: XFS file system.<br>Jan 29 15:38:41 quoalp01 systemd: Started File System Check on /dev/DATAVG001/APP_lv.<br>Jan 29 15:38:41 quoalp01 systemd: Mounting /APP...<br>Jan 29 15:38:41 quoalp01 kernel: XFS (dm-17): Mounting V4 Filesystem<br>Jan 29 15:38:41 quoalp01 kernel: XFS (dm-17): Ending clean mount<br>Jan 29 15:38:41 quoalp01 systemd: Mounted /APP.<br><br>2) LVM duplicate messages가 발생하는 것을 회피하기위하여, lvm2-monitor 서비스를 중단 함.<br>    이후 하기의 로그가 시스템 메세지( /var/log/messages )에 기록되고, <br>  Unmounted된 xfs 파일시스템 영역이 xfs_repair 명령 수행 후에도 마운트 되어 지지 않음.<br><br>Jan 29 15:40:05 quoalp01 systemd: Stopped Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling.<br>Jan 29 15:40:05 quoalp01 lvm: 4 logical volume(s) in volume group &quot;vg00&quot; unmonitored<br>Jan 29 15:41:01 quoalp01 systemd: Started Session 7720 of user root.<br>Jan 29 15:41:01 quoalp01 systemd: Starting Session 7720 of user root.<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>Jan 29 15:42:01 quoalp01 systemd: Started Session 7721 of user root.<br>Jan 29 15:42:01 quoalp01 systemd: Starting Session 7721 of user root.<br>Jan 29 15:42:40 quoalp01 kernel: XFS (dm-16): Mounting V4 Filesystem<br>Jan 29 15:42:40 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc800020 (&quot;xlog_bread_noalign&quot;) error 19 numblks 1<br>Jan 29 15:42:40 quoalp01 kernel: XFS (dm-16): empty log check failed<br>Jan 29 15:42:40 quoalp01 kernel: XFS (dm-16): log mount/recovery failed: error -19<br>Jan 29 15:42:40 quoalp01 kernel: XFS (dm-16): log mount failed<br>Jan 29 15:42:50 quoalp01 kernel: XFS (dm-16): Mounting V4 Filesystem<br>Jan 29 15:42:50 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc800020 (&quot;xlog_bread_noalign&quot;) error 19 numblks 1<br>Jan 29 15:42:50 quoalp01 kernel: XFS (dm-16): empty log check failed<br>Jan 29 15:42:50 quoalp01 kernel: XFS (dm-16): log mount/recovery failed: error -19<br>Jan 29 15:42:50 quoalp01 kernel: XFS (dm-16): log mount failed<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><br><br><folderNumber>74166</folderNumber><br><comment id="a0aA000000GY4nJIAT"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-02-16T05:45:37Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-02-16T05:45:37Z</b><br><br>Hi Seung-Pil,<br><br>Thanks for your feedback.<br>If you have any question about this ticket after discussing with storage engineer, please let us know.<br><br>Best Regards,<br>Catherine<br>Technical Support Engineer<br><br><publishedDate>2016-02-16T05:45:37Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GY4ktIAD"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-02-16T05:37:13Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-02-16T05:37:13Z</b><br><br>Hi,<br>Thank you for your update and explain about syslog.<br><br>That log was logged when it was testing SAN storage availability. (at that time.)<br>Like your comment,  I guess it may caused from SAN( or multipathd ) fail-over timing issue.<br><br>So, I'm discussing this case with HITACHI STORAGE engineer .<br>I'll update the result later.<br><br><br>FYI)<br>Storage Model : HITACHI VSP G1000 GAD( global-active device )<br>Multipath : RHEL7 native dm-multipath ( /etc/multipath.conf )<br><br># cat /etc/multipath.conf<br>defaults {<br><br>user_friendly_names<br>yes<br><br>find_multipaths<br>yes<br><br>no_path_retry<br>fail<br><br>polling_interval<br>10<br>#<br>polling_interval<br>60<br>}<br><br>blacklist {<br><br>devnode &quot;^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*&quot;<br><br>devnode &quot;^hd[a-z]&quot;<br><br>wwid<br>36141877049fcac001e1581d004fa989e<br><br>wwid<br>36141877049fcac001e1ed941b7ebba9d<br>}<br><br>...snip...<br><br>devices {<br><br>device {<br><br><br>vendor<br><br><br>&quot;HITACHI&quot;<br><br><br>product<br><br><br>&quot;OPEN.*&quot;<br><br><br>path_grouping_policy<br>multibus<br><br><br>path_checker<br><br>tur<br><br><br>failback<br><br>immediate<br>#<br><br>features<br><br>&quot;1 queue_if_no_path&quot;<br>#<br><br>features<br><br>&quot;0&quot;<br><br><br>no_path_retry<br><br>fail<br><br>}<br>}<br><br>thanks, Seung-Pil<br><br>(Douwsma, Donald에 회신)<br>&gt; Hi, <br>&gt; <br>&gt; I'm a software maintenance engineer specialising in filesystems and assisting with your case. <br>&gt; <br>&gt; My understanding is we are currently trying to address two questions. <br>&gt; - Customer would like to know what cause the metadata I/O error occurred?<br>&gt; - Since the issued xfs file system has removed at this time, we can't collect metadata dump.<br>&gt;   Then, can we find the root cause from the sosreport?<br>&gt; <br>&gt; I don't think the filesystem is the direct cause of these problems. The logs show a series of events where the filesystem shutdown due to the path to the underlying storage device becoming unavailable. Unfortunately the filesystem shutdown appears to have caused more confusion because it was never completely unmounted, which ended up confusing the systemd scripts used on your system.<br>&gt; <br>&gt; I'll attempt to explain these events with references to your syslogs. <br>&gt; <br>&gt; From var/log/messages<br>&gt; <br>&gt;     Jan 29 15:21:19 quoalp01 systemd: Device dev-disk-by\x2did-scsi\x2d360060e8007c643000030c643000010ac.device appeared<br><br><publishedDate>2016-02-16T05:37:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GXrBPIA1"><br>======================<br><b>생성계정 : Douwsma, Donald</b><br><b>생성날짜 : 2016-02-15T04:43:13Z</b><br><b>마지막 답변자 : Douwsma, Donald</b><br><b>마지막 수정 일자 : 2016-02-15T04:43:13Z</b><br><br>Did my last update help your understanding of what happened?<br><br>Regards, <br>Donald<br><br><publishedDate>2016-02-15T04:43:13Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GXM50IAH"><br>======================<br><b>생성계정 : Douwsma, Donald</b><br><b>생성날짜 : 2016-02-12T04:49:42Z</b><br><b>마지막 답변자 : Douwsma, Donald</b><br><b>마지막 수정 일자 : 2016-02-12T04:49:42Z</b><br><br>Hi, <br><br>I'm a software maintenance engineer specialising in filesystems and assisting with your case. <br><br>My understanding is we are currently trying to address two questions. <br>- Customer would like to know what cause the metadata I/O error occurred?<br>- Since the issued xfs file system has removed at this time, we can't collect metadata dump.<br>  Then, can we find the root cause from the sosreport?<br><br>I don't think the filesystem is the direct cause of these problems. The logs show a series of events where the filesystem shutdown due to the path to the underlying storage device becoming unavailable. Unfortunately the filesystem shutdown appears to have caused more confusion because it was never completely unmounted, which ended up confusing the systemd scripts used on your system.<br><br>I'll attempt to explain these events with references to your syslogs. <br><br>From var/log/messages<br><br>    Jan 29 15:21:19 quoalp01 systemd: Device dev-disk-by\x2did-scsi\x2d360060e8007c643000030c643000010ac.device appeared twice with different sysfs paths /sys/devices/pci0000:80/0000:80:03.2/0000:84:00.1/host4/rport-4:0-3/target4:0:1/4:0:1:0/block/sdag and /sys/devices/pci0000:80/0000:80:01.0/0000:81:00.1/host2/rport-2:0-2/target2:0:0/2:0:0:0/block/sdaq<br>    Jan 29 15:21:19 quoalp01 systemd: Device dev-disk-by\x2did-wwn\x2d0x60060e8007c643000030c643000010ac.device appeared twice with different sysfs paths /sys/devices/pci0000:80/0000:80:03.2/0000:84:00.1/host4/rport-4:0-3/target4:0:1/4:0:1:0/block/sdag and /sys/devices/pci0000:80/0000:80:01.0/0000:81:00.1/host2/rport-2:0-2/target2:0:0/2:0:0:0/block/sdaq<br>    <br>Something has gone quite wrong with the storage beneath the filesystem, well before the xfs errors started to appear. <br>Presumably this is as a result of the multipath testing?<br><br>    Jan 29 15:32:03 quoalp01 systemd: Stopped target Local File Systems.<br>    Jan 29 15:32:03 quoalp01 systemd: Stopping Local File Systems.<br>    Jan 29 15:32:03 quoalp01 systemd: Unmounting /usr/sap/QFP...<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Unmounting Filesystem<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc80002a (&quot;xlog_iodone&quot;) error 19 numblks 64<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): xfs_do_force_shutdown(0x2) called from line 1180 of file fs/xfs/xfs_log.c.  Return address = 0xffffffffa030ab1e<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Log I/O Error Detected.  Shutting down filesystem<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Unable to update superblock counters. Freespace may not be correct on next mount.<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): xfs_log_force: error -5 returned.<br>    Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Please umount the filesystem and rectify the problem(s)<br>    Jan 29 15:32:03 quoalp01 systemd: Unmounted /usr/sap/QFP.<br>    Jan 29 15:32:03 quoalp01 systemd: Stopped File System Check on /dev/DATAVG001/sapQFP_lv.<br>    Jan 29 15:32:03 quoalp01 systemd: Stopping File System Check on /dev/DATAVG001/sapQFP_lv...<br>    <br>ENODEV 19 No such device<br><br>The filesystem was being stopped, and errored while updating its metadata. <br>This resulted in the filesystem being shutdown, but NOT unmounted.<br>A manual umount, or perhaps unmount -f may have succeeded at this point, systemd was not able to automatically recover. <br>    <br>    Jan 29 15:32:04 quoalp01 systemd: Unmounted /usr/sap/trans.<br>    Jan 29 15:32:04 quoalp01 systemd: Unmounting /usr/sap...<br>    Jan 29 15:32:04 quoalp01 umount: umount: /usr/sap: target is busy.<br>    Jan 29 15:32:04 quoalp01 umount: (In some cases useful info about processes that use<br>    <br>The parent of this filesystem also tried to unmount, but the XFS filesystem on dm-16 is in a shutdown state.<br>This is the cuase of 'target is busy'<br>    <br>    Jan 29 15:32:05 quoalp01 systemd: Failed unmounting /usr/sap.<br>    Jan 29 15:32:05 quoalp01 systemd: Unit usr-sap.mount is bound to inactive unit dev-DATAVG001-sap_lv.device. Stopping, too.<br>    Jan 29 15:32:05 quoalp01 systemd: Unmounting /usr/sap...<br>    Jan 29 15:32:05 quoalp01 umount: umount: /usr/sap: target is busy.<br>    Jan 29 15:32:05 quoalp01 umount: (In some cases useful info about processes that use<br>    Jan 29 15:32:05 quoalp01 umount: the device is found by lsof(8) or fuser(1))<br>    Jan 29 15:32:05 quoalp01 systemd: usr-sap.mount mount process exited, code=exited status=32<br>    Jan 29 15:32:05 quoalp01 systemd: Failed unmounting /usr/sap.<br>    Jan 29 15:32:05 quoalp01 systemd: Unit usr-sap.mount is bound to inactive unit dev-DATAVG001-sap_lv.device. Stopping, too.<br>    Jan 29 15:32:05 quoalp01 systemd: Unmounting /usr/sap...<br>    Jan 29 15:32:05 quoalp01 kernel: XFS (dm-15): Unmounting Filesystem<br>    Jan 29 15:32:05 quoalp01 systemd: Unmounted /usr/sap.<br>    Jan 29 15:32:05 quoalp01 systemd: Unit usr-sap.mount entered failed state.<br>    Jan 29 15:32:05 quoalp01 systemd: Stopped File System Check on /dev/DATAVG001/sap_lv.<br>    Jan 29 15:32:05 quoalp01 systemd: Stopping File System Check on /dev/DATAVG001/sap_lv...<br>    Jan 29 15:32:10 quoalp01 kernel: rport-2:0-11: blocked FC remote port time out: removing rport<br>    Jan 29 15:33:01 quoalp01 systemd: Started Session 7712 of user root.<br>    ...<br>    Jan 29 15:35:32 quoalp01 systemd-logind: Removed session 7697.<br>    Jan 29 15:35:58 quoalp01 kernel: XFS (dm-15): Mounting V4 Filesystem<br>    Jan 29 15:35:59 quoalp01 kernel: XFS (dm-15): Ending clean mount<br>    Jan 29 15:35:59 quoalp01 systemd: Unit usr-sap.mount is bound to inactive unit dev-DATAVG001-sap_lv.device. Stopping, too.<br>    Jan 29 15:35:59 quoalp01 systemd: Unmounting /usr/sap...<br>    Jan 29 15:35:59 quoalp01 kernel: XFS (dm-15): Unmounting Filesystem<br>    Jan 29 15:36:00 quoalp01 systemd: Unmounted /usr/sap.<br>    Jan 29 15:36:00 quoalp01 systemd: Unit usr-sap.mount entered failed state.<br>    Jan 29 15:36:01 quoalp01 systemd: Started Session 7715 of user root.<br>    Jan 29 15:36:01 quoalp01 systemd: Starting Session 7715 of user root.<br>    Jan 29 15:36:40 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/sap_lv...<br>    Jan 29 15:36:40 quoalp01 systemd: usr-sap.mount: Directory /usr/sap to mount over is not empty, mounting anyway.<br>    <br>I cant see any evidence that /usr/sap was ever unmounted successfully.<br>And the warning above seems to indicated there was still a problem with that. <br>It shouldnt be possible to mount over it a second time but it looks like what we're seeing.<br>    <br>    Jan 29 15:36:40 quoalp01 systemd: Mounting /usr/sap...<br>    Jan 29 15:36:40 quoalp01 kernel: XFS (dm-15): Mounting V4 Filesystem<br>    Jan 29 15:36:40 quoalp01 kernel: XFS (dm-15): Ending clean mount<br>    Jan 29 15:36:40 quoalp01 systemd: Mounted /usr/sap.<br>    Jan 29 15:37:01 quoalp01 systemd: Started Session 7716 of user root.<br>    Jan 29 15:37:01 quoalp01 systemd: Starting Session 7716 of user root.<br>    Jan 29 15:37:15 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/sapQFP_lv...<br>    Jan 29 15:37:15 quoalp01 systemd-fsck: /sbin/fsck.xfs: XFS file system.<br>    Jan 29 15:37:15 quoalp01 systemd: Started File System Check on /dev/DATAVG001/sapQFP_lv.<br>    Jan 29 15:37:15 quoalp01 systemd: Mounting /usr/sap/QFP...<br>    Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): Mounting V4 Filesystem<br>    Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc800020 (&quot;xlog_bread_noalign&quot;) error 19 numblks 1<br>    Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): empty log check failed<br>    Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount/recovery failed: error -19<br>    Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount failed<br>    Jan 29 15:37:15 quoalp01 mount: mount: unknown filesystem type 'xfs'<br>    Jan 29 15:37:15 quoalp01 systemd: usr-sap-QFP.mount mount process exited, code=exited status=32<br>    Jan 29 15:37:15 quoalp01 systemd: Failed to mount /usr/sap/QFP.<br>    Jan 29 15:37:15 quoalp01 mount: mount: unknown filesystem type 'xfs'<br>    <br>The XFS filesystem that was shutdown on dm-16 is still there, nothing has successfully unmounted it since then. <br>XFS is still getting ENODEV, something is still wrong from the storage layer.<br><br>I'm not sure what caused the &quot;unknown filesystem type 'xfs'&quot; at this point. <br>It may have helped to check dmesg at that time, but the dmesg in the sosreport appears to be after the system was restarted. <br><br>    Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>    Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>    Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br><br>Again this is the filesystem shutdown at Jan 29 15:32:03.<br><br>I think the underlying problem was caused by the one ENODEV returned to XFS, everything else followed from that.<br>But its also clear that the sap systemd script did not handle this situation well. <br><br>Regards, <br>Donald<br><br><publishedDate>2016-02-12T04:49:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GAR3gIAH"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-02-05T08:59:33Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-02-05T08:59:33Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>현재 해당 이슈에 대하여 테스트 환경을 구축하여 원인 분석중에 있습니다.<br>비슷한 현상을 재현되였으나 발생원인은 아직 확인이 되지 않은 상황입니다.<br>분석 결과가 있는대로 바로 업데이트 해드리도록 하겠습니다.<br><br>새해 복 많이 받으세요~!<br><br>감사합니다.<br><br><publishedDate>2016-02-05T08:59:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G9wEmIAJ"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-02-03T04:20:43Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-02-03T04:20:43Z</b><br><br>안녕하세요.<br><br>1. 문제가 되었던 당시의 xfs volume ( /dev/mapper/DATAVG001-sapQFP_lv , dm-16 )은, 현재 LVM을 재구성하여 xfs 파일시스템 생성후 사용중입니다.<br>   즉 문제가 발생한 당시 LV인 sapQFP_lv는 2016.01.29 17:53 경에, lvremove와 lvcreate를 수행하여 재생성 하였습니다.<br><br>etc/lvm/archive/DATAVG001_00006-765549432.vg:6:description = &quot;Created *before* executing 'lvremove /dev/mapper/DATAVG001-sapQFP_lv'&quot;<br>etc/lvm/archive/DATAVG001_00007-205676001.vg:6:description = &quot;Created *before* executing 'lvcreate -l 3200 -n sapQFP_lv DATAVG001'&quot;<br><br>2. 당시와 같은 문제가 왜 발생했는지 이유와 시스템 메세지에 기록된 내용의 의미를 파악하고, 재발방지를 위해 조치하여야 합니다.<br><br>3. 만약 Multipath로 구성된 SAN의 일부 Path가 fail 된 것과 연관이 있다면, 납득할 수 있는 연관관계 또는 개연성에대한 상세설명이 필요할 것 입니다.<br><br>추가로 필요하신 사항이 있으시다면, 언제든 연락 주시기 바랍니다.<br>감사합니다.<br><br><br>(Hwang, Yeong에 회신)<br>&gt; 안녕하세요,<br>&gt; <br>&gt; Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br>&gt; <br>&gt; 이슈 발생후 서버가 리부팅이 되어 dm-16이 대응되는 xfs 파일시스템을 확인하기 어려운 상황입니다.<br>&gt; 현재 서버에서 /dev/mapper/DATAVG001-sapQFP_lv 만 mount가 되지 않는 이슈가 발생되었다고 하니<br>&gt; 리부팅전 이슈가 발생된 xfs 파일시스템이 해당 디바이스일 가능성이 높을것으로 보입니다.<br>&gt; <br>&gt; 기존 로그에 의하면 이 파일시스템이 1월 29일 15:32:03 시점에 unmount 될때 파일시스템 metadata I/O 에라가 처음으로 발견된것으로<br>&gt; 보입니다.<br>&gt; <br>&gt; Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Unmounting Filesystem<br>&gt; Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc80002a (&quot;xlog_iodone&quot;) error 19 numblks 64<br>&gt; Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): xfs_do_force_shutdown(0x2) called from line 1180 of file fs/xfs/xfs_log.c.  Return address = 0xffffffffa030ab1e<br>&gt; Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Log I/O Error Detected.  Shutting down filesystem<br>&gt; Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Unable to update superblock counters. Freespace may not be correct on next mount.<br>&gt; Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): xfs_log_force: error -5 returned.<br>&gt; Jan 29 15:32:03 quoalp0<br><br><publishedDate>2016-02-03T04:20:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000G9w5QIAR"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-02-03T03:48:35Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-02-03T03:48:34Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>이슈 발생후 서버가 리부팅이 되어 dm-16이 대응되는 xfs 파일시스템을 확인하기 어려운 상황입니다.<br>현재 서버에서 /dev/mapper/DATAVG001-sapQFP_lv 만 mount가 되지 않는 이슈가 발생되었다고 하니<br>리부팅전 이슈가 발생된 xfs 파일시스템이 해당 디바이스일 가능성이 높을것으로 보입니다.<br><br>기존 로그에 의하면 이 파일시스템이 1월 29일 15:32:03 시점에 unmount 될때 파일시스템 metadata I/O 에라가 처음으로 발견된것으로<br>보입니다.<br><br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Unmounting Filesystem<br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc80002a (&quot;xlog_iodone&quot;) error 19 numblks 64<br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): xfs_do_force_shutdown(0x2) called from line 1180 of file fs/xfs/xfs_log.c.  Return address = 0xffffffffa030ab1e<br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Log I/O Error Detected.  Shutting down filesystem<br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Unable to update superblock counters. Freespace may not be correct on next mount.<br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): xfs_log_force: error -5 returned.<br>Jan 29 15:32:03 quoalp01 kernel: XFS (dm-16): Please umount the filesystem and rectify the problem(s)<br><br>다음 약 7초후에 아래와 같이 rport time out 로그가 기록된 것으로 확인됩니다.<br>Jan 29 15:32:10 quoalp01 kernel: rport-2:0-11: blocked FC remote port time out: removing rport<br><br>그후 서버에서 mount 시도를 재차 해보았지만 metadata 에러로 실패된 것으로 확인됩니다.<br><br>Jan 29 15:37:15 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/sapQFP_lv...<br>Jan 29 15:37:15 quoalp01 systemd-fsck: /sbin/fsck.xfs: XFS file system.<br>Jan 29 15:37:15 quoalp01 systemd: Started File System Check on /dev/DATAVG001/sapQFP_lv.<br>Jan 29 15:37:15 quoalp01 systemd: Mounting /usr/sap/QFP...<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): Mounting V4 Filesystem<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc800020 (&quot;xlog_bread_noalign&quot;) error 19 numblks 1<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): empty log check failed<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount/recovery failed: error -19<br>Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount failed<br>Jan 29 15:37:15 quoalp01 mount: mount: unknown filesystem type 'xfs'<br>Jan 29 15:37:15 quoalp01 systemd: usr-sap-QFP.mount mount process exited, code=exited status=32<br>Jan 29 15:37:15 quoalp01 systemd: Failed to mount /usr/sap/QFP.<br>Jan 29 15:37:15 quoalp01 systemd: Unit usr-sap-QFP.mount entered failed state.<br><br>그리하여 해당 이슈가 스토리지와의 연결이 끊기는 시점에 해당 XFS 파일시스템의 metadata I/O 에러가 발견되어 마운트가 실패된것으로<br>보입니다. 다만 metadata I/O 에러가 발생된 정확한 원인은 아직 확인이 되지 않고 있습니다.<br><br>앞서 /etc/DATAVG001/sapQFP_lv이 xfs_repair 명령 수행 후에도 마운트 되어 지지 않는다고 하셨는데<br>현재 올려주신 sosreport를 확인해 보면 /etc/DATAVG001/sapQFP_lv 가 마운트되어 있는것으로 보이는데<br>지금은 정상적으로 마운트 가능하신지요?<br><br><br>감사합니다.<br><br><publishedDate>2016-02-03T03:48:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G9iAiIAJ"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-02-02T04:14:39Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-02-02T04:14:38Z</b><br><br>안녕하세요.<br><br>1. 작업내용 및 시간대는 하기와 같습니다.<br># 참고 - Available TEST - Time Table<br>1) System CPU/Memory stress test<br>Jan 26 18:40 경 부터 Jan 27 06:40 경 까지 , CPU / MEMORY에대한 stress 테스트를 수행 하였음.( stress 명령어를 이용 )<br><br>2) NAS Storage test<br>Jan 27 11:00 경 부터 Jan 27 15:30 경 까지 , NAS Storage에서 가용성 테스트를 수행 하였음.( 각 시스템에게 할당된 NAS 볼륨 중 1개에 DD를 이용한 I/O 쓰기 작업 확인 )<br><br>3) SAN Storage test<br>Jan 29 12:00 경 부터 Jan 29 20:00 경 까지 , SAN Storage에서 가용성 테스트를 수행 하였음.( eccalp01 / eccalp02 호스트에서, SAN 영역에 DD를 이용한 부하 생성 )<br><br>4) Multipath fail-over test<br>Jan 29 13:00 경 부터 Jan 29 20:00 경 까지 , Multipath 테스트를 수행하였음.( 시스템에서 HBA 포트 1개를 절체하여, path Fail-Over 되는지와 I/O가 유지되는지 확인 )<br>======================<br>2. 파일시스템 corrupt가 발생한 볼륨은 QFP 영역으로 xfs_repair 수행 후에도 mount가 되지 않았습니다. 다시 확인 요청드립니다.<br><br>Jan 29 15:37:15 quoalp01 systemd: Starting File System Check on /dev/DATAVG001/sapQFP_lv... Jan 29 15:37:15 quoalp01 systemd-fsck: /sbin/fsck.xfs: XFS file system. Jan 29 15:37:15 quoalp01 systemd: Started File System Check on /dev/DATAVG001/sapQFP_lv. Jan 29 15:37:15 quoalp01 systemd: Mounting /usr/sap/QFP... Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): Mounting V4 Filesystem Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): metadata I/O error: block 0xc800020 (&quot;xlog_bread_noalign&quot;) error 19 numblks 1 Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): empty log check failed Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount/recovery failed: error -19 Jan 29 15:37:15 quoalp01 kernel: XFS (dm-16): log mount failed<br><br><br>감사합니다.<br><br>(Hwang, Yeong에 회신)<br>&gt; 안녕하세요,<br>&gt; <br>&gt; Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br>&gt; <br>&gt; 현재 마운트가 되지 않는 파일시스템은 /dev/DATAVG001/APP_lv 디바이스위에 있는 파일시스템 인것으로<br>&gt; 확인됩니다.<br>&gt; <br>&gt; 혹시 이슈 발생전 lvm2-monitor 서비스를 중단 한외에 해당 파일시스템에 어떤 작업이 있었는지요? 확인 부탁드립니다.<br>&gt; 처음으로 해당 파일시스템에 I/O 에러가 발생된 시점은 1월 29일 15:41.25 인것으로 확인됩니다.<br>&gt; <br>&gt; var/log/messages:Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>&gt; var/log/messages:Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2016-02-02T04:14:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000G9i0OIAR"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2016-02-02T03:49:06Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2016-02-02T03:49:06Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>현재 마운트가 되지 않는 파일시스템은 /dev/DATAVG001/APP_lv 디바이스위에 있는 파일시스템 인것으로<br>확인됩니다.<br><br>혹시 이슈 발생전 lvm2-monitor 서비스를 중단 한외에 해당 파일시스템에 어떤 작업이 있었는지요? 확인 부탁드립니다.<br>처음으로 해당 파일시스템에 I/O 에러가 발생된 시점은 1월 29일 15:41.25 인것으로 확인됩니다.<br><br>var/log/messages:Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br>var/log/messages:Jan 29 15:41:25 quoalp01 kernel: Buffer I/O error on device dm-16, logical block 26214404<br><br><br>감사합니다.<br><br><publishedDate>2016-02-02T03:49:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>