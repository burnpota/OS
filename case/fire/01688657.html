======================<br><b>생성계정 : Seung-Pil Kim</b><br><b>생성날짜 : 2016-08-22T09:34:02Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-09-10T10:05:36Z</b><br><b>id : 500A000000V6eeIIAR</b><br>======================<br><br><b><font size=15>
제목  : [삼성화재][보험ERP][가동계]  &quot;Link Up Event&quot; has occured suddenly on HBA without any physical action.
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>###############################<br>###############################<br>1. 시스템에 2개의 2port HBA 카드가 있음.<br>2.  그중 하나인 host2 HBA 는 시스템 부팅 직후 Link Up 되어 동작 함.<br>3. 나머지 하나인 host4 HBA는 시스템 부팅 후, 약 사흘(3일)이 지난 시점에 Link Up 되어 짐.<br>4. host4가 Link Up 될 당시, 물리적으로나 시스템 상에 HBA와 관련한 작업은 없었음.<br><br>관련하여 원인 분석이 필요합니다.<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br># uname -a<br>Linux sltalp04 3.10.0-327.el7.x86_64<br><br># cat /etc/redhat-release<br>Red Hat Enterprise Linux Server release 7.2 (Maipo)<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br># System Booting<br>Aug 12 13:59:17 eccalp03 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;6523&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>Aug 12 13:59:09 eccalp03 journal: Runtime journal is using 8.0M (max allowed 4.0G, trying to leave 4.0G free of 503.6G available → current limit 4.0G).<br>Aug 12 13:59:09 eccalp03 kernel: Initializing cgroup subsys cpuset<br>Aug 12 13:59:09 eccalp03 kernel: Initializing cgroup subsys cpu<br>Aug 12 13:59:09 eccalp03 kernel: Initializing cgroup subsys cpuacct<br>Aug 12 13:59:09 eccalp03 kernel: Linux version 3.10.0-327.el7.x86_64 (mockbuild@x86-034.build.eng.bos.redhat.com) (gcc version 4.8.3 20140911 (Red Hat 4.8.3-9) (GCC) ) #1 SMP Thu Oct 29 17:29:29 EDT 2015<br>Aug 12 13:59:09 eccalp03 kernel: Command line: BOOT_IMAGE=/vmlinuz-3.10.0-327.el7.x86_64 root=/dev/mapper/vg00-root_lv ro crashkernel=512M rd.lvm.lv=vg00/root_lv rd.lvm.lv=vg00/swap_lv nomodeset biosdevname=1 rhgb quiet LANG=en_US.UTF-8 nmi_watchdog=0 transparent_hugepage=never elevator=deadline rdloaddriver=megaraid_sas rdloaddriver=lpfc vga=794<br><br>...snip...<br><br>Aug 12 13:59:09 eccalp03 kernel: scsi host1: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus 82 device 00 irq 82<br>Aug 12 13:59:10 eccalp03 kernel: lpfc 0000:82:00.0: 0:3176 Port Name 0 Physical Link is functional<br>Aug 12 13:59:10 eccalp03 kernel: scsi host2: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus 82 device 01 irq 87<br>Aug 12 13:59:10 eccalp03 kernel: lpfc 0000:82:00.1: 1:3176 Port Name 1 Physical Link is functional<br>Aug 12 13:59:10 eccalp03 kernel: scsi host3: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus c1 device 00 irq 92<br>Aug 12 13:59:10 eccalp03 kernel: lpfc 0000:c1:00.0: 2:3176 Port Name 0 Physical Link is functional<br>Aug 12 13:59:10 eccalp03 kernel: scsi host4: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus c1 device 01 irq 97<br>Aug 12 13:59:11 eccalp03 kernel: lpfc 0000:c1:00.1: 3:3176 Port Name 1 Physical Link is functional<br><br>...snip...<br><br># host2 Link UP<br>Aug 12 13:59:12 eccalp03 kernel: lpfc 0000:82:00.1: 1:1303 Link Up Event x1 received Data: x1 x0 x80 x0 x0 x0 0<br><br>...snip...<br><br># host4 Link UP<br>Aug 15 09:13:15 eccalp03 xinetd[7261]: EXIT: scagent status=0 pid=58183 duration=1(sec)<br>Aug 15 10:08:22 eccalp03 kernel: lpfc 0000:c1:00.1: 3:1303 Link Up Event x1 received Data: x1 x0 x80 x0 x0 x0 0<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:0: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] 104857600 512-byte logical blocks: (53.6 GB/50.0 GiB)<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: Attached scsi generic sg34 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] Write Protect is off<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br>Aug 15 10:08:22 eccalp03 kernel: sdah: unknown partition table<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:1: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] Attached SCSI disk<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: Attached scsi generic sg35 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] 104857600 512-byte logical blocks: (53.6 GB/50.0 GiB)<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] Write Protect is off<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:2: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sdai: unknown partition table<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: Attached scsi generic sg36 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] Attached SCSI disk<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] 104857600 512-byte logical blocks: (53.6 GB/50.0 GiB)<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] Write Protect is off<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:3: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sdaj: unknown partition table<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:3: Attached scsi generic sg37 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] Attached SCSI disk<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><br><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-08-26T00:27:52Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-08-26T00:27:52Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>본 케이스와 관련되어 저희 전문엔지니어와 상의한 바, Link up을 위해서 하드웨어의 포트 상태의 시그널을 받아서 초기화와 같은 작업들을 진행하고 또 네고시에이션과 같은 작업들을 하게 됩니다.<br><br>현재 메시지가 출력되는 부분도 이벤트로 발생되어 메시지들이 출력된 루틴입니다.<br><br>3264 void<br>3265 lpfc_mbx_cmpl_read_topology(struct lpfc_hba *phba, LPFC_MBOXQ_t *pmb)<br>3266 {<br>3267     struct lpfc_vport *vport = pmb-&gt;vport;<br>3268     struct Scsi_Host  *shost = lpfc_shost_from_vport(vport);<br>3269     struct lpfc_mbx_read_top *la;<br>3270     MAILBOX_t *mb = &amp;pmb-&gt;u.mb;<br>3271     struct lpfc_dmabuf *mp = (struct lpfc_dmabuf *) (pmb-&gt;context1);<br><br>[...]<br><br>3313     phba-&gt;link_events++;<br>3314     if ((bf_get(lpfc_mbx_read_top_att_type, la) == LPFC_ATT_LINK_UP) &amp;&amp;<br>3315         !(phba-&gt;sli.sli_flag &amp; LPFC_MENLO_MAINT)) {<br>3316         phba-&gt;fc_stat.LinkUp++;<br>3317         if (phba-&gt;link_flag &amp; LS_LOOPBACK_MODE) {<br>3318             lpfc_printf_log(phba, KERN_ERR, LOG_LINK_EVENT,<br>3319                     &quot;1306 Link Up Event in loop back mode &quot;<br>3320                     &quot;x%x received Data: x%x x%x x%x x%x\n&quot;,<br>3321                     la-&gt;eventTag, phba-&gt;fc_eventTag,<br>3322                     bf_get(lpfc_mbx_read_top_alpa_granted,<br>3323                            la),<br>3324                     bf_get(lpfc_mbx_read_top_link_spd, la),<br>3325                     phba-&gt;alpa_map[0]);<br>3326         } else {<br>3327             lpfc_printf_log(phba, KERN_ERR, LOG_LINK_EVENT,<br>3328                     &quot;1303 Link Up Event x%x received &quot;<br>3329                     &quot;Data: x%x x%x x%x x%x x%x x%x %d\n&quot;,<br>3330                     la-&gt;eventTag, phba-&gt;fc_eventTag,<br>3331                     bf_get(lpfc_mbx_read_top_alpa_granted,<br>3332                            la),<br>3333                     bf_get(lpfc_mbx_read_top_link_spd, la),<br>3334                     phba-&gt;alpa_map[0],<br>3335                     bf_get(lpfc_mbx_read_top_mm, la),<br>3336                     bf_get(lpfc_mbx_read_top_fa, la),<br>3337                     phba-&gt;wait_4_mlo_maint_flg);<br>3338         }<br>3339         lpfc_mbx_process_link_up(phba, la);<br><br><br>이와 관련되어 SAN Switch에서 동작 및 당시 상태에 대한 점검도 한 번 해보시는 것을 제안드립니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-08-26T00:27:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Hk0RpIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-08-23T00:26:27Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-08-23T00:26:27Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>문의주신 내용에 대해서 우선 검토 후, 업데이트 드리도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-08-23T00:26:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>###############################<br>1. 시스템에 2개의 2port HBA 카드가 있음.<br>2.  그중 하나인 host2 HBA 는 시스템 부팅 직후 Link Up 되어 동작 함.<br>3. 나머지 하나인 host4 HBA는 시스템 부팅 후, 약 사흘(3일)이 지난 시점에 Link Up 되어 짐.<br>4. host4가 Link Up 될 당시, 물리적으로나 시스템 상에 HBA와 관련한 작업은 없었음.<br><br>관련하여 원인 분석이 필요합니다.</issue><environment># uname -a<br>Linux sltalp04 3.10.0-327.el7.x86_64<br><br># cat /etc/redhat-release<br>Red Hat Enterprise Linux Server release 7.2 (Maipo)</environment><periodicityOfIssue># System Booting<br>Aug 12 13:59:17 eccalp03 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;7.4.7&quot; x-pid=&quot;6523&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>Aug 12 13:59:09 eccalp03 journal: Runtime journal is using 8.0M (max allowed 4.0G, trying to leave 4.0G free of 503.6G available → current limit 4.0G).<br>Aug 12 13:59:09 eccalp03 kernel: Initializing cgroup subsys cpuset<br>Aug 12 13:59:09 eccalp03 kernel: Initializing cgroup subsys cpu<br>Aug 12 13:59:09 eccalp03 kernel: Initializing cgroup subsys cpuacct<br>Aug 12 13:59:09 eccalp03 kernel: Linux version 3.10.0-327.el7.x86_64 (mockbuild@x86-034.build.eng.bos.redhat.com) (gcc version 4.8.3 20140911 (Red Hat 4.8.3-9) (GCC) ) #1 SMP Thu Oct 29 17:29:29 EDT 2015<br>Aug 12 13:59:09 eccalp03 kernel: Command line: BOOT_IMAGE=/vmlinuz-3.10.0-327.el7.x86_64 root=/dev/mapper/vg00-root_lv ro crashkernel=512M rd.lvm.lv=vg00/root_lv rd.lvm.lv=vg00/swap_lv nomodeset biosdevname=1 rhgb quiet LANG=en_US.UTF-8 nmi_watchdog=0 transparent_hugepage=never elevator=deadline rdloaddriver=megaraid_sas rdloaddriver=lpfc vga=794<br><br>...snip...<br><br>Aug 12 13:59:09 eccalp03 kernel: scsi host1: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus 82 device 00 irq 82<br>Aug 12 13:59:10 eccalp03 kernel: lpfc 0000:82:00.0: 0:3176 Port Name 0 Physical Link is functional<br>Aug 12 13:59:10 eccalp03 kernel: scsi host2: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus 82 device 01 irq 87<br>Aug 12 13:59:10 eccalp03 kernel: lpfc 0000:82:00.1: 1:3176 Port Name 1 Physical Link is functional<br>Aug 12 13:59:10 eccalp03 kernel: scsi host3: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus c1 device 00 irq 92<br>Aug 12 13:59:10 eccalp03 kernel: lpfc 0000:c1:00.0: 2:3176 Port Name 0 Physical Link is functional<br>Aug 12 13:59:10 eccalp03 kernel: scsi host4: Emulex LPe16000 16Gb PCIe Fibre Channel Adapter on PCI bus c1 device 01 irq 97<br>Aug 12 13:59:11 eccalp03 kernel: lpfc 0000:c1:00.1: 3:3176 Port Name 1 Physical Link is functional<br><br>...snip...<br><br># host2 Link UP<br>Aug 12 13:59:12 eccalp03 kernel: lpfc 0000:82:00.1: 1:1303 Link Up Event x1 received Data: x1 x0 x80 x0 x0 x0 0<br><br>...snip...<br><br># host4 Link UP<br>Aug 15 09:13:15 eccalp03 xinetd[7261]: EXIT: scagent status=0 pid=58183 duration=1(sec)<br>Aug 15 10:08:22 eccalp03 kernel: lpfc 0000:c1:00.1: 3:1303 Link Up Event x1 received Data: x1 x0 x80 x0 x0 x0 0<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:0: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] 104857600 512-byte logical blocks: (53.6 GB/50.0 GiB)<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: Attached scsi generic sg34 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] Write Protect is off<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br>Aug 15 10:08:22 eccalp03 kernel: sdah: unknown partition table<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:1: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:0: [sdah] Attached SCSI disk<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: Attached scsi generic sg35 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] 104857600 512-byte logical blocks: (53.6 GB/50.0 GiB)<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] Write Protect is off<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:2: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sdai: unknown partition table<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: Attached scsi generic sg36 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:1: [sdai] Attached SCSI disk<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] 104857600 512-byte logical blocks: (53.6 GB/50.0 GiB)<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] Write Protect is off<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA<br>Aug 15 10:08:22 eccalp03 kernel: scsi 4:0:0:3: Direct-Access     HITACHI  OPEN-V           8001 PQ: 0 ANSI: 3<br>Aug 15 10:08:22 eccalp03 kernel: sdaj: unknown partition table<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:3: Attached scsi generic sg37 type 0<br>Aug 15 10:08:22 eccalp03 kernel: sd 4:0:0:2: [sdaj] Attached SCSI disk</periodicityOfIssue><cep>false</cep><folderName>ERP-ALL</folderName></case>