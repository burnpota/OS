======================<br><b>생성계정 : Seung-Pil Kim</b><br><b>생성날짜 : 2016-03-01T19:52:05Z</b><br><b>마지막 답변자 : JINKOO HAN</b><br><b>마지막 수정 일자 : 2016-03-31T00:40:22Z</b><br><b>id : 500A000000TdyqQIAR</b><br>======================<br><br><b><font size=15>
제목  : [삼성화재][보험ERP][가동계] How to calculate the connection timeout and What is effect of changing kernel parameter like tcp_syn_retries and tcp_synack_retries?
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>##################################################<br># Failed(Request) Info AND Messages<br>##################################################<br>요약 :<br>tcp_syn_retries과 tcp_synack_retries 커널 파라미터의 값 변경에대한 계산방법 확인 및 영향도 분석<br><br>1) 시스템에서 운영하는 SAP Application에서, DB와의 세션 연결이 종료되기까지 소요되는 시간을 줄이고자 함.<br>2) 커널 파라미터 tcp_syn_retries와 tcp_synack_retries의 값을 Default 값보다 각각 높이거나 줄이는 경우,<br>    시스템에 어떠한 영향이 있는지 확인이 필요합니다.<br>3) tcp_syn_retries와 tcp_synack_retries의 값을 변경하는 경우,<br>    각각 계산 방식과 Interval의 확인이 필요합니다.<br>    예3-1) net.ipv4.tcp_syn_retries = 5<br>    예3-2) net.ipv4.tcp_syn_retries = 1<br>    예3-3) net.ipv4.tcp_synack_retries = 4<br>    예3-4) net.ipv4.tcp_synack_retries = 1<br><br>4) 가동계 RHEL7.2 시스템에서 확인한 tcp_syn_retries와 tcp_synack_retries Default값이 하기와 같음<br><br># sysctl -a<br>...snip...<br>net.ipv4.tcp_syn_retries = 6<br>net.ipv4.tcp_synack_retries = 5<br>...snip...<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 4 (Low)</b><br><br><br><folderNumber>74166</folderNumber><br><comment id="a0aA000000GmXM0IAN"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-03-31T00:40:20Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-03-31T00:40:20Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>약 4주간 본 케이스에 추가 업데이트가 없음에 따라 해당 케이스를 Close하도록 하겠습니다.<br><br>혹시 추가 업데이트가 사항이 있으시면 케이스를 &quot;Re-Open&quot;하시거나 또는 새로운 케이스를 오픈하시면 해당 케이스를 통해서 지원하도록 하겠습니다.<br>======================<br><br>감사합니다.<br><br><publishedDate>2016-03-31T00:40:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GdneTIAR"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-03-09T06:05:35Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-03-09T06:05:35Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>저희 엔지니어의 설명에 따르면, 각각의 값이 1일 경우에 아래와 같다고 보시면 됩니다.<br><br>아래는 tcp_syn_retries 기준으로 보시면 됩니다.<br><br><br>1) t=0   SYN<br>     (1 second RTO)<br>2) t=1   1st retry of SYN<br>     (2 second RTO)<br>     (64...)<br>3) t=66 decide that connection is dead<br>======================<br>감사합니다.<br><br><publishedDate>2016-03-09T06:05:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GdnN0IAJ"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-03-09T05:40:58Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-03-09T05:40:58Z</b><br><br>안녕하세요.<br>답변 감사합니다.<br>하기와같이 tcp_syn_retries오 tcp_synack_retries를 각각 1로 설정하였을 때의 connection time-out 값에대한 확인이 누락되었습니다.<br><br>1. 최소 connection time-out 총 소요시간 <br>@ tcp_syn_retries <br>- 적용값: 1 <br>- 계산법: 2^(tcp_syn_retries) + 63 seconds = 약 65 Seconds <br>@ tcp_synack_retries <br>- 적용값: 1 <br>- 계산법: 2^(tcp_synack_retries) + 31 seconds = 약 33 seconds<br><br>아니면, <br>tcp_syn_retries오 tcp_synack_retries를 각각 1로 설정하면 <br>2초로 설정된 다는 것인지요? ( 그렇다고한다면, 계산법과 달라서  혼선이 있습니다. )<br><br>다시 확인 부탁 드립니다.<br><br>(HAN, JINKOO에 회신)<br>&gt; 안녕하세요,<br>&gt; Red Hat 한진구 입니다.<br>&gt; <br>&gt; 문의주신 내용에 대해서 저희 엔지니어의 답변을 참고하시면 됩니다.<br>&gt; <br>&gt; 1) t=0   SYN<br>&gt;      (1 second RTO)<br>&gt; 2) t=1   1st retry of SYN<br>&gt;      (2 second RTO)<br>&gt; 3) t=3   2nd retry<br>&gt;      (4 second RTO)<br>&gt; 4) t=7   3rd retry<br>&gt;      (8 second RTO)<br>&gt; 5) t=15  4th retry<br>&gt;      (16...)<br>&gt; 6) t=31  5th retry<br>&gt;      (32...)<br>&gt; 7) t=63  6th (and last) retry<br>&gt;      (64...)<br>&gt; 8) t=127 decide that connection is dead<br>&gt; <br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2016-03-09T05:40:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GdiirIAB"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-03-09T00:28:24Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-03-09T00:28:24Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>문의주신 내용에 대해서 저희 엔지니어의 답변을 참고하시면 됩니다.<br><br>1) t=0   SYN<br>     (1 second RTO)<br>2) t=1   1st retry of SYN<br>     (2 second RTO)<br>3) t=3   2nd retry<br>     (4 second RTO)<br>4) t=7   3rd retry<br>     (8 second RTO)<br>5) t=15  4th retry<br>     (16...)<br>6) t=31  5th retry<br>     (32...)<br>7) t=63  6th (and last) retry<br>     (64...)<br>8) t=127 decide that connection is dead<br>======================<br>감사합니다.<br><br><publishedDate>2016-03-09T00:28:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GdatLIAR"><br>======================<br><b>생성계정 : Harris, Jeremy</b><br><b>생성날짜 : 2016-03-08T14:25:01Z</b><br><b>마지막 답변자 : Harris, Jeremy</b><br><b>마지막 수정 일자 : 2016-03-08T14:25:00Z</b><br><br>1) t=0   SYN<br>     (1 second RTO)<br>2) t=1   1st retry of SYN<br>     (2 second RTO)<br>3) t=3   2nd retry<br>     (4 second RTO)<br>4) t=7   3rd retry<br>     (8 second RTO)<br>5) t=15  4th retry<br>     (16...)<br>6) t=31  5th retry<br>     (32...)<br>7) t=63  6th (and last) retry<br>     (64...)<br>8) t=127 decide that connection is dead<br><br><publishedDate>2016-03-08T14:25:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GdVKsIAN"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-03-08T05:11:24Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-03-08T05:11:23Z</b><br><br>안녕하세요.<br>답변 감사 드립니다.<br><br>확인하여 주신 계산법을 기준으로 한다면, connection time-out 발생까지 최소 소요시간은 하기와 같으리라 예상합니다.<br><br>1. 최소 connection time-out 총 소요시간<br>@ tcp_syn_retries<br> - 적용값: 1<br> - 계산법: 2^(tcp_syn_retries) + 63 seconds = 약 65 Seconds <br><br>@ tcp_synack_retries<br> - 적용값: 1<br> - 계산법: 2^(tcp_synack_retries) + 31 seconds = 약 33 seconds<br><br>2. 각 재시도(retries)간 Interval 시간<br> 1) 1 회차 retry = 처음 syn time-out이 발생하고 약 1 Seconds 후 <br>2) 2 회차 retry = 1회차 retry syn의 time-out이 발생하는 약 2 Seconds 후<br>3) 3 회차 retry = 2회차 retry syn의 time-out이 발생하는 약 4 Seconds 후<br>4) 4 회차 retry = 3회차 retry syn의 time-out이 발생하는 약 8 Seconds 후<br>5) 5 회차 retry = 4회차 retry syn의 time-out이 발생하는 약 16 Seconds 후<br>6) 6 회차 retry = 5회차 retry syn의 time-out이 발생하는 약 32 Seconds 후<br><br>맞는지요?<br>확인 부탁 드립니다.<br><br>고맙습니다.<br><br>(HAN, JINKOO에 회신)<br>&gt; 안녕하세요,<br>&gt; Red Hat 한진구 입니다.<br>&gt; <br>&gt; 저희 엔지니어가 업데이트 드린 내용과 man page를 정리하면 해당 값의 계산법은 아래와 같습니다.<br>&gt; <br>&gt; @ tcp_syn_retries<br>&gt; <br>&gt; - 기본값: 6<br>&gt; - 계산법: 2^(tcp_syn_retries) + 63 seconds = 약 127 Seconds<br>&gt; <br>&gt; <br>&gt; <br>&gt; <br>&gt; @ tcp_synack_retries<br>&gt; - 기본값: 5<br>&gt; - 계산법: 2^(tcp_synack_retries) + 31 seconds = 약 63 seconds<br>&gt; <br>&gt; <br>&gt; 두값 모두 255이상의 설정이 불가능 합니다.<br>&gt; <br>&gt; <br>&gt; <br>&gt; 감사합니다.<br><br><publishedDate>2016-03-08T05:11:23Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GdBk1IAF"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-03-07T01:57:05Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-03-07T01:57:05Z</b><br><br>안녕하세요,<br>Red Hat 한진구 입니다.<br><br>저희 엔지니어가 업데이트 드린 내용과 man page를 정리하면 해당 값의 계산법은 아래와 같습니다.<br><br>@ tcp_syn_retries<br><br>- 기본값: 6<br>- 계산법: 2^(tcp_syn_retries) + 63 seconds = 약 127 Seconds<br>======================<br><br>@ tcp_synack_retries<br>- 기본값: 5<br>- 계산법: 2^(tcp_synack_retries) + 31 seconds = 약 63 seconds<br><br><br>두값 모두 255이상의 설정이 불가능 합니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-03-07T01:57:05Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gcj4SIAR"><br>======================<br><b>생성계정 : Harris, Jeremy</b><br><b>생성날짜 : 2016-03-04T10:15:31Z</b><br><b>마지막 답변자 : Harris, Jeremy</b><br><b>마지막 수정 일자 : 2016-03-04T10:15:31Z</b><br><br>For a count of 6, timeouts up until the last one starts have already taken 64 seconds.  The sixth one then runs for 64 seconds.  Total 128.<br><br>Documentation file:  Documentation/networking/ip-sysctl.txt  in the kernel source.<br><br><publishedDate>2016-03-04T10:15:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GcLlyIAF"><br>======================<br><b>생성계정 : Harris, Jeremy</b><br><b>생성날짜 : 2016-03-03T13:46:11Z</b><br><b>마지막 답변자 : Harris, Jeremy</b><br><b>마지막 수정 일자 : 2016-03-03T13:46:10Z</b><br><br>The values are a &quot;number of retries&quot;.<br>The interval between retries for SYN starts at 1 second and exponentially increases; for a count of 6 the ultimate timeout occurs after 127 seconds.<br><br><publishedDate>2016-03-03T13:46:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GbqwtIAB"><br>======================<br><b>생성계정 : Harris, Jeremy</b><br><b>생성날짜 : 2016-03-02T16:23:35Z</b><br><b>마지막 답변자 : Harris, Jeremy</b><br><b>마지막 수정 일자 : 2016-03-02T16:23:35Z</b><br><br>&gt;  - what kind of effect is there if they change the values(tcp_syn_retires, tcp_synack_retires)?<br><br>Larger values will give better reliability but longer times before deciding on actual failure.  Smaller values will give the opposite.<br>There is no one magic &quot;best&quot; set of values.<br><br>What actual problem is being seen?<br><br><publishedDate>2016-03-02T16:23:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GbiRjIAJ"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-03-02T02:14:46Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-03-02T02:14:46Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>문의주신 내용에 대해서 확인 후, 케이스에 업데이트 드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-03-02T02:14:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br># Failed(Request) Info AND Messages<br>##################################################<br>요약 :<br>tcp_syn_retries과 tcp_synack_retries 커널 파라미터의 값 변경에대한 계산방법 확인 및 영향도 분석<br><br>1) 시스템에서 운영하는 SAP Application에서, DB와의 세션 연결이 종료되기까지 소요되는 시간을 줄이고자 함.<br>2) 커널 파라미터 tcp_syn_retries와 tcp_synack_retries의 값을 Default 값보다 각각 높이거나 줄이는 경우,<br>    시스템에 어떠한 영향이 있는지 확인이 필요합니다.<br>3) tcp_syn_retries와 tcp_synack_retries의 값을 변경하는 경우,<br>    각각 계산 방식과 Interval의 확인이 필요합니다.<br>    예3-1) net.ipv4.tcp_syn_retries = 5<br>    예3-2) net.ipv4.tcp_syn_retries = 1<br>    예3-3) net.ipv4.tcp_synack_retries = 4<br>    예3-4) net.ipv4.tcp_synack_retries = 1<br><br>4) 가동계 RHEL7.2 시스템에서 확인한 tcp_syn_retries와 tcp_synack_retries Default값이 하기와 같음<br><br># sysctl -a<br>...snip...<br>net.ipv4.tcp_syn_retries = 6<br>net.ipv4.tcp_synack_retries = 5<br>...snip...</issue><cep>false</cep><folderName>ERP-SAP-ASCS_ERS</folderName></case>