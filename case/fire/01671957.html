======================<br><b>생성계정 : Seung-Pil Kim</b><br><b>생성날짜 : 2016-07-21T15:54:30Z</b><br><b>마지막 답변자 : Chang-An Song</b><br><b>마지막 수정 일자 : 2016-08-02T00:41:52Z</b><br><b>id : 500A000000UrAwQIAV</b><br>======================<br><br><b><font size=15>
제목  : [삼성화재][보험ERP][가동계] issue on connecting 1 Gbps Network Switch ports with 10 Gbps NIC port .
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>1) Environments<br>Network Switch gbic ports : 1 Gbps  <br>System NIC gbic ports : 10 Gbps<br><br>2) Expectation : <br>Link up, 1 Gbps speed and full Duplex.<br><br>3)  Results<br>Sometimes, It seems Link is not set up properly .<br>( especially when booting )<br>Link : down<br>Speed : unknown.<br><br><br>#############################################################################<br>#cat /proc/net/bonding/bond0<br>Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)<br><br>Bonding Mode: fault-tolerance (active-backup)<br>Primary Slave: None<br>Currently Active Slave: p4p1<br>MII Status: up<br>MII Polling Interval (ms): 100<br>Up Delay (ms): 0<br>Down Delay (ms): 0<br><br>Slave Interface: p4p1<br>MII Status: up<br>Speed: 1000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: a0:36:9f:9c:eb:54<br>Slave queue ID: 0<br><br>Slave Interface: p5p1<br>MII Status: up<br>Speed: 1000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: a0:36:9f:9c:f9:80<br>Slave queue ID: 0<br>[root@epswlp05:/var/log]#ifdown p5p1<br>[root@epswlp05:/var/log]#ifup p5p1<br>Cannot set new settings: Invalid argument<br>  not setting speed<br>  not setting duplex<br>[root@epswlp05:/var/log]#cat /etc/sysconfig/network-scripts/ifcfg-p5p1<br>BOOTPROTO=none<br>NAME=p5p1<br>DEVICE=p5p1<br>DEVICETYPE=Bond<br>NM_CONTROLLED=no<br>ONBOOT=yes<br>SLAVE=yes<br>MASTER=bond0<br>#ETHTOOL_OPTS=&quot; -G ${DEVICE} rx 4096 tx 4096; -s ${DEVICE} speed 1000 duplex full autoneg off&quot;<br>#ETHTOOL_OPTS=&quot; -s ${DEVICE} speed 1000 duplex full autoneg off&quot;<br>#ETHTOOL_OPTS=&quot; speed 1000 duplex full ; -G ${DEVICE} rx 4096 tx 4096&quot;<br>ETHTOOL_OPTS=&quot;speed 1000 duplex full&quot;<br>[root@epswlp05:/var/log]#cat /etc/sysconfig/network-scripts/ifcfg-bond0<br>BOOTPROTO=none<br>NAME=bond0<br>DEVICE=bond0<br>DEVICETYPE=Bond<br>NM_CONTROLLED=no<br>ONBOOT=yes<br>IPADDR=42.X<br>NETMASK=255.255.255.0<br>GATEWAY=42.X<br>BONDING_OPTS=&quot;mode=1 miimon=100&quot;<br>======================<br>[root@ ]# cat /var/log/messages<br>Jul  7 11:27:03 epswld04 kernel: bond0: Setting MII monitoring interval to 100<br>Jul  7 11:27:03 epswld04 kernel: bond0: Adding slave p4p2<br>Jul  7 11:27:03 epswld04 kernel: ixgbe 0000:83:00.1: registered PHC device on p4p2<br>Jul  7 11:27:03 epswld04 kernel: IPv6: ADDRCONF(NETDEV_UP): p4p2: link is not ready<br>Jul  7 11:27:03 epswld04 kernel: bond0: Enslaving p4p2 as a backup interface with a down link<br>Jul  7 11:27:03 epswld04 network: Bringing up interface bond0:  Cannot set new settings: Invalid argument<br>Jul  7 11:27:03 epswld04 network: not setting speed<br>Jul  7 11:27:03 epswld04 network: not setting duplex<br>Jul  7 11:27:03 epswld04 kernel: ixgbe 0000:83:00.1 p4p2: detected SFP+: 6<br>Jul  7 11:27:03 epswld04 kernel: bond0: Adding slave p5p2<br>Jul  7 11:27:03 epswld04 kernel: ixgbe 0000:05:00.1: registered PHC device on p5p2<br>Jul  7 11:27:04 epswld04 kernel: IPv6: ADDRCONF(NETDEV_UP): p5p2: link is not ready<br>Jul  7 11:27:04 epswld04 kernel: bond0: Enslaving p5p2 as a backup interface with a down link<br>Jul  7 11:27:04 epswld04 network: Cannot set new settings: Invalid argument<br>Jul  7 11:27:04 epswld04 network: not setting speed<br>Jul  7 11:27:04 epswld04 network: not setting duplex<br>Jul  7 11:27:04 epswld04 kernel: IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready<br>Jul  7 11:27:04 epswld04 kernel: ixgbe 0000:83:00.1 p4p2: NIC Link is Up 1 Gbps, Flow Control: None<br>Jul  7 11:27:04 epswld04 kernel: bond0: link status definitely up for interface p4p2, 1000 Mbps full duplex<br>Jul  7 11:27:04 epswld04 kernel: bond0: making interface p4p2 the new active one<br>Jul  7 11:27:04 epswld04 kernel: bond0: first active interface up!<br>Jul  7 11:27:04 epswld04 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): bond0: link becomes ready<br>Jul  7 11:27:04 epswld04 kernel: ixgbe 0000:05:00.1 p5p2: detected SFP+: 6<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>링크가 정상적으로 이루어지지 않는 문제가 주로 발생하는 시점<br>1) 시스템 부팅 시<br>2) 네트워크 서비스 재시작<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1596892</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags><tag><name>NIC</name></tag></tags><folderNumber>74168</folderNumber><br><comment id="a0aA000000HXQnsIAH"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-08-02T00:04:08Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-08-02T00:04:08Z</b><br><br>안녕하세요.<br><br>본 기술문의는 종료하여 주시기 바랍니다.<br>이후 추가되는 사항이나 재발시, 다시 기술문의를 재개 하겠습니다.<br><br>지원에 감사 드립니다.<br><br><publishedDate>2016-08-02T00:04:08Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HWtpiIAD"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2016-07-29T08:25:05Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2016-07-29T08:25:05Z</b><br><br>안녕하세요? Red Hat Technical account manager 송 창 안 입니다.<br><br>시스템에 설정하신, advertised negotiation modes는 실제적인 동작은 ethtool를 통해서 do_seee()함수를 통해서 <br>커널로 전달이 되며, 커널에서의 10G NIC 드라이버는 (ixgbe/ixgbe_ethtool.c) Intel NIC 카드로 ixgbe_set_settings 함수로 전달되어,  <br>Intel 825999 NIC 인 경우, (ixgbe/ixgbe_82599.c) ixgbe_setup_phy_link_speed_generic 함수을 통해서, 실제적으로<br>Intel 10G NIC 의 컨트롤러 칩에게 현재의 1000 Mbps의 설정 하는 과정을 거치게 됩니다.<br><br>현재 링크가 연결이 안되었던 이슈에서 NIC에 설정을 세팅하여, 연결에 이슈가 해결된 것으로 판단이 되며, <br>10 NIC 와 switch 간의 physical layer에서 발생한 이슈로 판단이 됩니다.<br><br>따라서 auto-negotiation ON, ethtool -s ethX advertise 0x020를 설정하시길 바랍니다.<br><br>감사합니다.<br>송 창 안 드림.<br><br><publishedDate>2016-07-29T08:25:05Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HWsBnIAL"><br>======================<br><b>생성계정 : Kim, Seung-Pil</b><br><b>생성날짜 : 2016-07-29T04:35:14Z</b><br><b>마지막 답변자 : Kim, Seung-Pil</b><br><b>마지막 수정 일자 : 2016-07-29T04:35:14Z</b><br><br>안녕하세요.<br>지원에 감사 드립니다.<br><br>현재 진행상태를 업데이트 드립니다.<br><br>1. 네트워크 스위치 Log 확인<br>   - 진행 중 <br>   - 이전에, 네트워크 스위치 로그를 확인 요청한 전례가 있으나,<br>      해당 스위치 포트에서 link up / down이 반복되었다는 것 외 특별한 내용은 없다는 답변을 받은 이력이 있음.<br><br>2. negotiation 설정 테스트 진행 중<br>   - 인터페이스 설정파일에 아래 설정을 추가하여 테스트 중이며, link up과 speed가 1000 Mbps로 정상 설정되어 동작하고 있음을 확인 하였음.<br>   ETHTOOL_OPTS=&quot;speed 1000 duplex full advertise 0x020 &quot;<br><br>고맙습니다.<br><br>(Song, Chang-An에 회신)<br>&gt; 안녕하세요? Red Hat Technical account manager 송 창 안 입니다.<br>&gt; <br>&gt; 현재까지 확인된 내용에 대해서 업데이트 하도록 하겠습니다.<br>&gt; 저희 전문엔지니어의 함께 확인 결과, auto-neg off 후, speed 를 설정하는 것은 세팅에 대해서는 권고 하지 않습니다..<br>&gt; <br>&gt; 아래의 링크를 확인 하시면, 표준에 1000BASE-T와 10000BASE-TX 그리고 10GBASE-T 는 표준에서는 auto-negotiation는 항상 권고 하고 있습니다.<br>&gt; https://en.wikipedia.org/wiki/Autonegotiation<br>&gt; &quot;The standards for 1000BASE-T, 1000BASE-TX and 10GBASE-T require autonegotiation to be always present and enabled.&quot;<br>&gt; <br>&gt; auto-negotiation의 이슈는 OS에서 발생 원인 보다는 물리계층에서 상대쪽 노드와 연결하는 단계에서 발생하는 내용입니다.<br>&gt; 좀더 자세히 아시고 싶다면 , node A 와 node B에서 주고 받는 신호에 대해서 아래에 링크의 문서에서 page7에서 확인이 가능합니다.<br>&gt; http://www.ieee802.org/3/10GBT/public/jan04/lynskey_1_0104.pdf<br>&gt; <br>&gt; 현재 확인 해야 될 내용은 아래와 같습니다.<br>&gt; 1. auto-negotiation가 안되는 원인을 찾아야 할것으로 확인<br>&gt;    - 문제가 발생할때 반대쪽에 연결되는 node 측인 1G switch에서 어떤 이슈가 발생되는지 확인.<br>&gt; <br>&gt; 2. auto-negotiation의 이슈 발생 때, 호스트 에서 ethtool -r &lt;디바이스명&gt;를 다시 시도하여, auto-negotiation하여, 문제 해결 유무<br>&gt; <br>&gt; 3. auto-negotiation의 이슈 발생 때, 호스트에서 ethtool -S &lt;디바이스명&gt;의 값에 대한 정보.<br>&gt; <br>&gt; 감사합니다.<br>&gt; <br>&gt; 송 창 안 드림.<br><br><publishedDate>2016-07-29T04:35:14Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HVXSVIA5"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2016-07-25T02:12:30Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2016-07-25T02:45:25Z</b><br><br>안녕하세요? Red Hat Technical account manager 송 창 안 입니다.<br><br>현재까지 확인된 내용에 대해서 업데이트 하도록 하겠습니다.<br>저희 전문엔지니어의 함께 확인 결과, auto-neg off 후, speed 를 설정하는 것은 세팅에 대해서는 권고 하지 않습니다..<br><br>아래의 링크를 확인 하시면, 표준에 1000BASE-T와 10000BASE-TX 그리고 10GBASE-T 는 표준에서는 auto-negotiation는 항상 권고 하고 있습니다.<br>https://en.wikipedia.org/wiki/Autonegotiation<br>&quot;The standards for 1000BASE-T, 1000BASE-TX and 10GBASE-T require autonegotiation to be always present and enabled.&quot;<br><br>auto-negotiation의 이슈는 OS에서 발생 원인 보다는 물리계층에서 상대쪽 노드와 연결하는 단계에서 발생하는 내용입니다.<br>좀더 자세히 아시고 싶다면 , node A 와 node B에서 주고 받는 신호에 대해서 아래에 링크의 문서에서 page7에서 확인이 가능합니다.<br>http://www.ieee802.org/3/10GBT/public/jan04/lynskey_1_0104.pdf<br><br>현재 확인 해야 될 내용은 아래와 같습니다.<br>1. auto-negotiation가 안되는 원인을 찾아야 할것으로 확인<br>   - 문제가 발생할때 반대쪽에 연결되는 node 측인 1G switch에서 어떤 이슈가 발생되는지 확인.<br><br>2. auto-negotiation의 이슈 발생 때, 호스트 에서 ethtool -r &lt;디바이스명&gt;를 다시 시도하여, auto-negotiation하여, 문제 해결 유무<br><br>3. auto-negotiation의 이슈 발생 때, 호스트에서 ethtool -S &lt;디바이스명&gt;의 값에 대한 정보.<br><br>감사합니다.<br><br>송 창 안 드림.<br><br><publishedDate>2016-07-25T02:12:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HVEDuIAP"><br>======================<br><b>생성계정 : HAN, JINKOO</b><br><b>생성날짜 : 2016-07-22T00:45:30Z</b><br><b>마지막 답변자 : HAN, JINKOO</b><br><b>마지막 수정 일자 : 2016-07-22T00:45:30Z</b><br><br>안녕하세요,<br>Red Hat Technical Account Manager 한진구 입니다.<br><br>문의주신 내용에 대해서 확인 후, 업데이트 드리도록 하겠습니다.<br>======================<br>감사합니다.<br><br><publishedDate>2016-07-22T00:45:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>Network Switch gbic ports : 1 Gbps  <br>System NIC gbic ports : 10 Gbps<br><br>2) Expectation : <br>Link up, 1 Gbps speed and full Duplex.<br><br>3)  Results<br>Sometimes, It seems Link is not set up properly .<br>( especially when booting )<br>Link : down<br>Speed : unknown.<br><br><br>#############################################################################<br>#cat /proc/net/bonding/bond0<br>Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)<br><br>Bonding Mode: fault-tolerance (active-backup)<br>Primary Slave: None<br>Currently Active Slave: p4p1<br>MII Status: up<br>MII Polling Interval (ms): 100<br>Up Delay (ms): 0<br>Down Delay (ms): 0<br><br>Slave Interface: p4p1<br>MII Status: up<br>Speed: 1000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: a0:36:9f:9c:eb:54<br>Slave queue ID: 0<br><br>Slave Interface: p5p1<br>MII Status: up<br>Speed: 1000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: a0:36:9f:9c:f9:80<br>Slave queue ID: 0<br>[root@epswlp05:/var/log]#ifdown p5p1<br>[root@epswlp05:/var/log]#ifup p5p1<br>Cannot set new settings: Invalid argument<br>  not setting speed<br>  not setting duplex<br>[root@epswlp05:/var/log]#cat /etc/sysconfig/network-scripts/ifcfg-p5p1<br>BOOTPROTO=none<br>NAME=p5p1<br>DEVICE=p5p1<br>DEVICETYPE=Bond<br>NM_CONTROLLED=no<br>ONBOOT=yes<br>SLAVE=yes<br>MASTER=bond0<br>#ETHTOOL_OPTS=&quot; -G ${DEVICE} rx 4096 tx 4096; -s ${DEVICE} speed 1000 duplex full autoneg off&quot;<br>#ETHTOOL_OPTS=&quot; -s ${DEVICE} speed 1000 duplex full autoneg off&quot;<br>#ETHTOOL_OPTS=&quot; speed 1000 duplex full ; -G ${DEVICE} rx 4096 tx 4096&quot;<br>ETHTOOL_OPTS=&quot;speed 1000 duplex full&quot;<br>[root@epswlp05:/var/log]#cat /etc/sysconfig/network-scripts/ifcfg-bond0<br>BOOTPROTO=none<br>NAME=bond0<br>DEVICE=bond0<br>DEVICETYPE=Bond<br>NM_CONTROLLED=no<br>ONBOOT=yes<br>IPADDR=42.X<br>NETMASK=255.255.255.0<br>GATEWAY=42.X<br>BONDING_OPTS=&quot;mode=1 miimon=100&quot;<br>======================<br>[root@ ]# cat /var/log/messages<br>Jul  7 11:27:03 epswld04 kernel: bond0: Setting MII monitoring interval to 100<br>Jul  7 11:27:03 epswld04 kernel: bond0: Adding slave p4p2<br>Jul  7 11:27:03 epswld04 kernel: ixgbe 0000:83:00.1: registered PHC device on p4p2<br>Jul  7 11:27:03 epswld04 kernel: IPv6: ADDRCONF(NETDEV_UP): p4p2: link is not ready<br>Jul  7 11:27:03 epswld04 kernel: bond0: Enslaving p4p2 as a backup interface with a down link<br>Jul  7 11:27:03 epswld04 network: Bringing up interface bond0:  Cannot set new settings: Invalid argument<br>Jul  7 11:27:03 epswld04 network: not setting speed<br>Jul  7 11:27:03 epswld04 network: not setting duplex<br>Jul  7 11:27:03 epswld04 kernel: ixgbe 0000:83:00.1 p4p2: detected SFP+: 6<br>Jul  7 11:27:03 epswld04 kernel: bond0: Adding slave p5p2<br>Jul  7 11:27:03 epswld04 kernel: ixgbe 0000:05:00.1: registered PHC device on p5p2<br>Jul  7 11:27:04 epswld04 kernel: IPv6: ADDRCONF(NETDEV_UP): p5p2: link is not ready<br>Jul  7 11:27:04 epswld04 kernel: bond0: Enslaving p5p2 as a backup interface with a down link<br>Jul  7 11:27:04 epswld04 network: Cannot set new settings: Invalid argument<br>Jul  7 11:27:04 epswld04 network: not setting speed<br>Jul  7 11:27:04 epswld04 network: not setting duplex<br>Jul  7 11:27:04 epswld04 kernel: IPv6: ADDRCONF(NETDEV_UP): bond0: link is not ready<br>Jul  7 11:27:04 epswld04 kernel: ixgbe 0000:83:00.1 p4p2: NIC Link is Up 1 Gbps, Flow Control: None<br>Jul  7 11:27:04 epswld04 kernel: bond0: link status definitely up for interface p4p2, 1000 Mbps full duplex<br>Jul  7 11:27:04 epswld04 kernel: bond0: making interface p4p2 the new active one<br>Jul  7 11:27:04 epswld04 kernel: bond0: first active interface up!<br>Jul  7 11:27:04 epswld04 kernel: IPv6: ADDRCONF(NETDEV_CHANGE): bond0: link becomes ready<br>Jul  7 11:27:04 epswld04 kernel: ixgbe 0000:05:00.1 p5p2: detected SFP+: 6</issue><periodicityOfIssue>링크가 정상적으로 이루어지지 않는 문제가 주로 발생하는 시점<br>1) 시스템 부팅 시<br>2) 네트워크 서비스 재시작</periodicityOfIssue><cep>false</cep><folderName>ERP-NON_SAP</folderName></case>