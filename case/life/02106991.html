======================<br><b>생성계정 : Ted Won</b><br><b>생성날짜 : 2018-05-25T08:30:03Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-07-04T10:02:39Z</b><br><b>id : 500A000000at3XhIAI</b><br>======================<br><br><b><font size=15>
제목  : [삼성생명] 아파치 2.4로 교채 후 간혈적으로 hang 현상이 발생되어 서비스에 영향이 미치고 있습니다.
</font></b><br><br>======================<br><b>사전문의<br></b><br>hang 현상이 발생될 때 netstat 확인해보니 &quot;SYN_RECV&quot; 상태 입니다.<br>-------------<br>w3sli@IDHPSWB1 /supp1/apache/edirect_domain/bin # netstat -an|grep 121.253.31.169<br>tcp      512      0 121.253.31.169:80       0.0.0.0:*               LISTEN<br>tcp        0      0 121.253.31.169:80       211.55.159.233:50324    SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.3:11878      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:12047      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.3:32332      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:42655      SYN_RECV<br>tcp        0      0 121.253.31.169:80       203.244.212.21:24887    SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:31590      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:28099      SYN_RECV<br>tcp        0      0 121.253.31.169:80       203.241.147.14:60667    SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:53722      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.3:8224       SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.3:5892       SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:50509      SYN_RECV<br>tcp        0      0 121.253.31.169:80       100.5.64.151:60583      SYN_RECV<br>tcp        0      0 121.253.31.169:80       203.244.212.22:12711    SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:14867      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.3:5383       SYN_RECV<br>tcp        0      0 121.253.31.169:80       100.5.64.151:60729      SYN_RECV<br>tcp        0      0 121.253.31.169:80       100.5.64.151:60342      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:24740      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.2:17841      SYN_RECV<br>tcp        0      0 121.253.31.169:80       121.253.31.3:13706      SYN_RECV<br>tcp        0      0 121.253.31.169:80       100.5.64.151:60363      SYN_RECV<br>--------------------<br><br>Apache 가 EWS 2.2에서 Bundle 2.4로, OS는 6.3에서 7.4로 업그레이드 된 상황에서<br>Linux 6.3 Apache 2.2에서는 나타나지 않았던 간혈적 hang입니다.<br><br>1. SYN_RECV 가 발생될 경우 OS에서 확인해야되는 부분이 있는지요?<br>2. os 및 web server의 버전차이로 TCP 튜닝이 필요한 부분이 있는지요?<br><br>확인 부탁 드립니다. 감사합니다.<br><br><br>* 고객 정보 - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>    - 성함(직급) : 김종선 책임<br>    - 회사명(부서명) : 삼성생명 정보전략그룹<br>    - 전화번호 : 02-751-8631 <br>    - 메일주소 : jseon.kim@samsung.com<br>  <br>* 파트너 정보 - 실제 고객의 시스템을 유지보수하는 업체 또는 현 Case를 핸들링하는 유저<br>    - 성함(직급) : 송원재 책임<br>    - 회사명(부서명) : 타임게이트(엔터프라이즈 솔루션)<br>    - 전화번호 : 010-8553-5634<br>    - 메일주소 : support@time-gate.com<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000MspzPIAR"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-18T02:24:24Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-18T02:24:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Technical Support 서비스를 이용해주셔서 감사합니다.<br><br>케이스 진행 확인차 follow up 코멘트 드립니다. 해당 이슈 관련 진행 사항이 있으신가요? 혹시 더 필요한 사항이 있으신지요?<br><br>답변이 없으시면 케이스가 자동으로 close 된다는 것을 알려 드립니다. 궁금한 사항이 있으면 연락주시기 바랍니다.<br><br>그럼 수고하세요.<br>감사합니다.<br><br><publishedDate>2018-06-18T02:24:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MiHBRIA3"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-07T08:22:02Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-07T08:22:01Z</b><br><br>안녕하세요,<br><br>업데이트 감사합니다.<br><br>Red Hat Customer Portal 링크 [1]에서 현재 최신 버전 정보를 확인 할 수 있습니다.<br><br>문의하신 RHEL7 httpd 최신 버전은 2.4.6-80.el7 입니다.<br><br>감사합니다.<br><br>[1] https://access.redhat.com/downloads/content/rhel---7/x86_64/2456/httpd/2.4.6-80.el7/x86_64/fd431d51/package<br><br><publishedDate>2018-06-07T08:22:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MiFiDIAV"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-06-07T06:35:12Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-07T06:35:12Z</b><br><br>안녕하세요. 타임게이트 입니다.<br><br>금일 OS팀으로 부터 Apache access log를 전달받았으나, weblogic  access log 취합이 안되어 있습니다.<br>일주일동안 자료 수집 후 고객에게 전달 받기로 하여 잠시 holding  하겠습니다.<br><br>bundle apache 2.4.3.6 버전이 가장 최신인지요?<br>만약 최신 패치가 적용된 버전이 있다면 공유 부탁 드립니다.<br><br>감사합니다. 수고하세요.<br><br><publishedDate>2018-06-07T06:35:12Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MhaeoIAB"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-05T01:21:12Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-05T01:21:11Z</b><br><br>안녕하세요,<br><br>먼저 해당 [weblogic:error/debug] 부분은 WebLogic Proxy Plug-In 구현체의 로그 입니다. Oracle 제품 모듈 부분으로써 Red Hat 측에서 확인 할 수 없는 부분입니다.<br>업데이트 해주신 내용을 보면 [WRITE_ERROR_TO_CLIENT] 는 요청 처리 중 상태에서 클라이언트 측에서 어떤 이유로 취소를 하여 connection이 끊기는 경우로써 무시 할 수 있는 로그라고 말하고 있습니다. 그러므로 해당 경우는 본 케이스인 hang 이슈와 연관이 있다고 보기 매우 어렵습니다.<br><br>또한 본 이슈 발생시 발생하는 &quot;SYN_RECV&quot; 는 처리 중이 아니라 최초의 요청을 시도하는 중 상태, 즉 connection이 EASTABLISHED 되기 전 상태입니다. 이는 [WRITE_ERROR_TO_CLIENT]와 전혀 다른 그 이전 상태입니다.<br><br>[WRITE_ERROR_TO_CLIENT] 보다는 &quot;Weblogic server로의 연결 요청에 대해서 응답을 받지 못하고 timeout&quot; 에러 부분이 본 케이스의 이슈와 연관성이 있어보이므로 먼저 확인이 필요한 부분입니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-05T01:21:11Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MhKDmIAN"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-04T07:30:49Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-04T07:30:49Z</b><br><br>안녕하세요,<br><br>WebLogic Plug-in output error 메시지에 대한 내용을 보면, 우선 해당 hang 이슈의 원인이 &quot;Weblogic server로의 연결 요청에 대해서 응답을 받지 못하고 timeout이 발생할때&quot; 보여집니다.<br><br>hang 현상이 발생하는 시점에 해당 에러가 발생하는지 확인해보시기 바랍니다.<br><br>&quot;SYN_RECV&quot; 상태도 Listen 상태에서 EASTABLISHED 로 넘어가는 과정이기 때문에 더욱 그렇게 보여집니다.<br><br>&gt;&gt; 혹시 TCP_DEFER_ACCEPT 소켓 값이 WLSocketTimeoutSecs 에 영향이 있는지요?<br>WLSocketTimeoutSecs 옵션은 &quot;WebLogic Proxy Plug-In Implementations&quot;[1]의 내용입니다. 해당 내용에 대해 답변드릴 수 있는 정보가 존재하지 않습니다. Oracle에 문의해보시는 것이 맞을 것 같습니다.<br><br>다만, TCP_DEFER_ACCEPT 에 관한 내용을 Red Hat Knowledgebase article [2]과 [3]에서 상세 내용을 참조 하실 수 있습니다.<br>참고로 &quot;SYN_RECV&quot; 상태에 관해서는 아래와 같이 옵션을 추가해서 TCP_DEFER_ACCEPT 사용을 diable 해서 즉시 EASTABLISHED 상태로 넘어가도록 할 수 있습니다. [4] 문의하신 영향에 대해서 확인 할 수 있는 한가지 방법으로 생각되어 함께 코멘트 드립니다.<br>~~~<br>AcceptFilter http none<br>~~~<br><br>hang 현상이 발생하는 시점에 &quot;Weblogic server로의 연결 요청에 대해서 응답을 받지 못하고 timeout&quot; 에러가 발생하는지 확인해보시기 바랍니다.<br>또한 WebLogic access log 와 GC log 확인 결과와 함께 수집 중인 데이터 확보되면 공유 부탁드립니다.<br><br>방금 추가로 업데이트해주신 내용에 대해서는 좀 더 자세히 들여다보고 다시 업데이트 드리겠습니다.<br><br>감사합니다.<br><br>[1] https://docs.oracle.com/middleware/1212/webtier/PLGWL/oracle.htm#PLGWL4334<br>[2] Why httpd connection are stuck on &quot;SYN_RECV&quot; in RHEL 5 ? https://access.redhat.com/solutions/655213<br>[3] Why do I see SYN_RECV state on httpd port 80 after client establishes a connection? https://access.redhat.com/solutions/2157261<br>[4] https://httpd.apache.org/docs/2.4/mod/core.html<br><br><publishedDate>2018-06-04T07:30:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MhIx3IAF"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-06-04T05:39:42Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-04T05:39:41Z</b><br><br>안녕하세요. 타임게이트 입니다.<br><br>선생님.<br>앞서 5월 29일 4시 30분경에 &quot;2. ssl_error_ess_log.zip&quot; 파일 첨부한 것 중에 <br>ssl_error_wmobile_log_2018_05_08, ssl_error_wmobile_log_2018_05_09 는 <br>말씀하신 Plug_in output message가 맞습니다.<br><br>그러나 좀더 상세히 봐주셔야 하는 로그가 debug 레벨로 조정하여 출력한 ssl_error_ess_log_2018_05_24 파일에서 [WLRITE_ERROR_TO_CLIENT] 부분입니다.<br>[debug_error_log]---------------------------<br>[Thu May 24 12:56:41.851737 2018] [weblogic:error] [pid 41111:tid 139875013592832] [client 1.177.157.185:62303] &lt;4111115271341927&gt; *******Exception type [WRITE_ERROR_TO_CLIENT] raised at line 560 of BaseProxy.cpp, referer: https://ess.samsunglife.com/list.do<br>[Thu May 24 12:56:41.851855 2018] [weblogic:debug] [pid 41111:tid 139875013592832] ap_proxy.cpp(625): [client 1.177.157.185:62303] &lt;4111115271341927&gt; got exception in sendResponse phase: WRITE_ERROR_TO_CLIENT [os error=0,  line 560 of BaseProxy.cpp]:  at line 625, referer: https://ess.samsunglife.com/list.do<br>[Thu May 24 12:56:41.851859 2018] [weblogic:debug] [pid 41111:tid 139875013592832] ap_proxy.cpp(633): [client 1.177.157.185:62303] &lt;4111115271341927&gt; *NOT* failing over after sendResponse() exception: WRITE_ERROR_TO_CLIENT, referer: https://ess.samsunglife.com/list.do<br>[Thu May 24 12:56:41.851861 2018] [weblogic:debug] [pid 41111:tid 139875013592832] ap_proxy.cpp(636): [client 1.177.157.185:62303] ap_proxy: trying POST /getUserZipFile.do at backend host 100.5.64.27/15510; got exception 'WRITE_ERROR_TO_CLIENT [os error=0,  line 560 of BaseProxy.cpp]: '; state: writing response body to client; not failing over, referer: https://ess.samsunglife.com/list.do<br>----------------------------------------------<br><br>고객께서는 이때 발생한 시점이 Apache Hang 으로 의심되는 시점이라 합니다.<br><br>Oracle에서 확인된 [WLRITE_ERROR_CLIENT] 는 client쪽에서 먼저 connection을 끊는 경우 주로 발생하기 때문에 특이하게 조치할 사항이 없습니다.<br>[WRITE_ERROR_TO_CLIENT ]----[Oracle 답변]----------------------------------------------------------------------------------<br>이는 다음 문서에 보시듯이 일반적으로 무시가능한 메세지 이며, <br>response를 client로 보내는 과정에서 connection 이 close될때 볼수 있습니다. <br>주로 client의 browser에서 다른 page로 이동되어 cancel되거나 page가 닫히는 경우 발생합니다. <br>- [WRITE_ERROR_TO_CLIENT] Message Is Logged As Error Level When Client Terminates Response ( Doc ID 2353439.1 ) <br>---------------------------------------------------------------------------------------------------------------------------------------<br><br>이상입니다. 수고하세요.<br><br><publishedDate>2018-06-04T05:39:41Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MhIn3IAF"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-06-04T05:22:57Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-04T05:22:57Z</b><br><br>안녕하세요. 타임게이트 입니다.<br><br>선생님. <br><br>1. 삼성생명 인프라팀에 config 및 log 요청 시 파일이 커서 config 파일만 일부 전달 된 것으로 보여집니다.<br>2. 요청하신 access log에 대해 현재 삼성생명 인프라팀에 요청하여 대기 중에 있습니다.<br><br>3. 말씀하신 WebLogic Plug-in putput error 메시지에 대한 Oracle 측 확인 결과 전달 드립니다.<br>[error log]----------<br>[Wed May 09 06:09:46.318346 2018] [weblogic:error] [pid 34025:tid 140186000594688] [client 112.168.192.146:40179] &lt;3402515258137842&gt; parseServerList: 100.5.64.26:17600 apr_socket_connect error [70007] The timeout specified has expired<br>[Wed May 09 06:10:25.034835 2018] [weblogic:error] [pid 34183:tid 140185845065472] [client 223.62.204.211:39860] &lt;34183152581382317&gt; *******Exception type [NO_RESOURCES] (apr_socket_connect call failed with error=70007, host=100.5.64.27, port=17600 ) raised at line 1682 of URL.cpp<br>-----------------------<br>[Oracle]--------------<br>NO_RESOURCES <br>이 메세지는 다음 문서에 보시듯이, 뒷단 Weblogic server로의 연결 요청에 대해서 응답을 받지 못하고 timeout이 발생할때 보여지는 메세지 입니다. <br>WLSocketTimeoutSecs 파라미터를 수정하여 Weblogic Proxy Plug-in에서 좀더 오래간 응답을 기다릴수 있도록 튜닝할수있습니다. <br>- https://docs.oracle.com/middleware/1212/webtier/PLGWL/oracle.htm#PLGWL4334 <br>2.5.3 NO_RESOURCES Errors <br>-----------------------<br><br>4. hang 발생 시 &quot;netstat -neopa &gt; output.txt&quot; 는 요청 중에 있습니다.<br><br>여기에서 3번에 대한 질문 드립니다.<br>Oracle에서는 WebLogic과 연결하는 동안 소켓의 제한 시간으로 인해 [NO_RESOURCES] 에러가 발생된 것으로 보여져 WLSocketTimeoutSecs (기본값 2초) 을 늘리라는 가이드가 있습니다.<br>혹시 TCP_DEFER_ACCEPT 소켓 값이 WLSocketTimeoutSecs 에 영향이 있는지요?<br><br>지원해 주셔서 감사합니다. 확인 부탁 드립니다.<br><br><publishedDate>2018-06-04T05:22:57Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MhGuCIAV"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-04T00:42:56Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-04T00:42:56Z</b><br><br>안녕하세요 송원재 책임님,<br><br>첨부 파일 내용 확인해 보고 있습니다만, 첨부 내용에 이전 코멘트에서 요청드렸던 이슈 확인에 반드시 필요한 내용들이 존재하지 않는 것 같습니다.<br><br>다시 한 번 정리해드리면,<br>1. Apache configuration 과 log가 기본적으로 필요하며, =&gt; configuration 만 제공되었습니다. Apache 로그는 포함되어 있지 않은 것 같습니다.<br>2. 무엇보다 해당 이슈의 경우는 hang 이슈 현상에 대한 명확한 확인을 위해, Apache와 Backend server 간의 access log 확인이 필요합니다.<br>3. 또한 weblogic plugin output error 메시지에 대한 Oracle 측에 확인 결과<br>4. hang 발생시의 &quot;netstat -neopa &gt; output.txt&quot; 결과 캡쳐<br><br>configuration 정보와 sosreport 정보만으로 해당 이슈에 대한 확인이 어렵습니다.<br>이슈 해결을 위해서 먼저 hang 현상에 대한 확인이 먼저 필요하다는 점 다시 한 번 말씀드립니다. 글로벌 전문 엔지니어가 함께 보고 있지만 아직까지 이슈 확인을 위한 어떤 문제점도 찾을 수 없어 진행이 어려운 상태입니다.<br>확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-04T00:42:56Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MhGosIAF"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-04T00:24:29Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-04T00:24:29Z</b><br><br>안녕하세요 송원재 책임님,<br><br>업데이트 감사합니다.<br><br>최대한 빨리 확인될 수 있도록 하겠습니다.<br>다만 글로벌 전문 엔지니어와의 확인과 논의가 필요한 점이 있어서 이점 고려 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-04T00:24:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MhGmIIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-06-04T00:12:56Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-04T00:12:56Z</b><br><br>답변감사합니다.<br>혼동을 최소화 하기위해서 해당 서버<br>IDHPSWB1(운영) 와 SLVHPSWL0A(검증)두 시스템 모든 설정을 <br>새로 업로드 해드리겠습니다.<br><br>장애 시점부터 시일 많이지나서 괜찮으시다면 빠른 케이스 진행 부탁드립니다.<br>감사합니다.<br><br><publishedDate>2018-06-04T00:12:56Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mgyv9IAB"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-01T08:23:15Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-01T08:23:15Z</b><br><br>안녕하세요 송원재 책임님,<br><br>업데이트 감사합니다. 상황을 이해하는데 도움이 되었습니다.<br><br>다음 답변 주실 때까지 케이스 상태를 &quot;Waiting on Customer&quot;으로 변경해두겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-01T08:23:15Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MgxiHIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-06-01T07:06:06Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-01T07:06:06Z</b><br><br>답변감사합니다.<br>호스트네임은 IDHPSWB1  이 맞습니다.<br>다만 IDHPSWB1  운용계 SLVHPSWL0A 는 검증계로<br>두 시스템 모두 동일한 증상이 발생하고 있습니다.<br><br>제가 다시 IDHPSWB1 정보를 수집해서 보내드리도록 하겠습니다.<br><br>혼동을 드려서 죄송합니다.<br><br><publishedDate>2018-06-01T07:06:06Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MgxOlIAJ"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-01T06:36:53Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-01T06:36:53Z</b><br><br>안녕하세요 송원재 책임님,<br><br>추가 확인사항이 있어서 업데이트 드립니다.<br><br>본 케이스 02106991 이슈의 hostname이 어떻게되나요? IDHPSWB1 이 맞지 않나요?<br><br>아래에 새로 첨부된 내용이 본 케이스 02106991 hostname IDHPSWB1 의 해당 hang 이슈의 설정과 로그가 맞나요? 그동안 첨부되었던 configuration 과 내용이 달라서 다른 환경으로 보입니다. 확인 부탁드립니다.<br>~~~<br>Created By: 타임게이트, 타임게이트 at  (6/1/2018 9:54 AM)<br>chatadm_info.tar (332,290 KB) <br>#26 File Attachment  Private<br>Created By: 타임게이트, 타임게이트 at  (6/1/2018 9:53 AM)<br>w3sil_info.tar (191,870 KB) <br>~~~<br><br>추가로 문의 주신 새로운 케이스 02111033 이슈의 내용을 보면 hostname이 SLVHPSWL0A 로 보입니다. 맞나요?<br><br>확인해보면 본 케이스 02106991와 케이스 02111033 의 환경이 각각 다른데 서로 어떤 연관이 있나요? (RHEL 7.4, 7.2)<br><br>케이스에 다른 환경의 내용이 섞여 있어서 각 이슈 상황에 대해서 정확하게 파악을 해야 하는데 혼동스러운 면이 있어서 어려움이 있습니다.<br>현재 구성 환경에 대해 이해할 수 있도록 설명 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-01T06:36:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Mgv3HIAR"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-06-01T01:25:00Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-06-01T01:25:00Z</b><br><br>안녕하세요,<br><br>내용을 살펴보고 다시 업데이트드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-01T01:25:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MgujZIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-06-01T00:52:54Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-01T00:52:54Z</b><br><br>답변감사합니다.<br>혹시 몰라서 해당계정에 대한 로그를 수집하였으니 참고 부탁드립니다.<br><br><publishedDate>2018-06-01T00:52:54Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mgg3oIAB"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-31T07:59:49Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-31T07:59:49Z</b><br><br>안녕하세요,<br><br>이전 코멘트에서 말씀드린 WebLogic Server GC 확인과 weblogic plugin 에러 메시지 확인 관련해서 Oracle 로부터 답변 받은 내용이 있나요? 확인 후 확인 결과 공유가 필요합니다.<br><br>WebLogic access logging 수집 및 response time 수집은 Oracle 제품의 설정입니다. Oracle 에 문의하시기 바랍니다.<br><br>Apache access log 설정은 Red Hat Knowledgebase article [1]을 참조하셔서 설정하시기 바랍니다.<br> - 중요한 점은 **수행 시간 측정 포멧**이 포함되어야 합니다.<br> - 참고 문서의 &quot;Time Taken: %T %D&quot; 부분이 추가될 수 있도록 해야합니다.<br>~~~<br>LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined<br>LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot; common<br>LogFormat &quot;Time Taken: %T %D %h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; \&quot;%{COOKIE}i\&quot; \&quot;%{SET-COOKIE}o\&quot;&quot; custom<br>...(snip)...<br>CustomLog logs/access_log custom<br>~~~<br><br>Permission denied 관련 이슈는 해당 케이스와 개별적으로 추가적인 조사가 필요한 내용입니다.<br>케이스당 하나의 이슈를 처리하는 것을 정책으로 하고 있습니다. 왜냐하면 케이스마다 하나의 KCS(solution article) 생성을 해야 하고, 히스토리 관리 이슈 및 무엇보다 이슈 진행 중 2가지 이상의 이슈가 하나의 케이스에 있는 경우 글로벌 엔지니어와의 협업 진행이 잘 되지 않습니다.<br>확인이 필요하시면 귀찮으시더라도 이슈별로 case를 분리해서 올려주시오.<br><br>또한 새로 올려진 w3sil_http.conf , chatadm_http.conf 같은 경우 기존과 다른 환경의 conf 파일들로 보입니다. 또한 올려주실 때 include되어 있는 관련된 설정들을 다 함께 올려주셔야 합니다. 그리고 기존에 올려진 conf 파일과 어떤 차이가 있는지 설명이 필요합니다. <br><br>감사합니다.<br><br>[1] How to enable friendly access log times in Apache, Tomcat and JBoss? https://access.redhat.com/solutions/16101#Apache<br><br><publishedDate>2018-05-31T07:59:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MgfIzIAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-05-31T07:00:33Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-05-31T07:00:33Z</b><br><br>답변감사합니다.<br>요청하신 부분이<br>Apache 와 backend (WebLogic) 모두에서 access logging 수집 및 response time 맞나요?<br>해당 파일의 위치와 수집 방법을 알려주시면 수집 해서 보내드리도록 하겠습니다.<br><br>추가적으로 아래에서 발생하는 permssion deny가 발생하는 부분이 지연과 관련이 없다 하더라도<br>정상적인 부분으로 볼수가 없는 것으로 보이는데요.<br><br>현재 정상운용중인 서버에서는 아래와 같은 상황이 발생하지 않고 있습니다.<br>확인 부탁드립니다.<br><br><publishedDate>2018-05-31T07:00:33Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MgegVIAR"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-31T06:07:30Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-31T06:07:30Z</b><br><br>안녕하세요,<br><br>글로벌 전문 엔지니어와 논의 결과 해당 내용은 hang 또는 지연 이슈와 연관이 없는 내용이라고 합니다.<br>hang 또는 지연 이슈 관련 확인을 위해서는 이전에 요청드렸던 정보가 필요하며 해당 내용과 지연 발생 이슈와는 연관이 없습니다.<br><br>감사합니다.<br><br><publishedDate>2018-05-31T06:07:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MgeWLIAZ"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-31T05:45:16Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-31T05:45:16Z</b><br><br>[translation to en]<br><br>Thank you for answer.<br>This issue is now considered as an urgent issue within Samsung.<br><br>I send you additional information and sosreport.<br>If you have any additional requirements, please let us know.<br><br>* Question:<br>1. I would ask your opinion on whether below is related to the delay.<br>2. And Is there any possibility of difference between prefork and worker method?<br><br><br>* Additional information:<br><br>The httpd is currently running with two different user (chatadm, w3sli) as two domains.<br><br>The root user forks to chatadm and w3sli.<br><br><br>root@SLVHPSWL0A /etc/httpd # ps -ef | grep httpd<br>root        336  44713  0 18:02 pts/2    00:00:00 grep --color=auto httpd<br>root      23075      1  0 May11 ?        00:00:55 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>chatadm   37488  23075  0 May23 ?        00:00:58 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>w3sli     46184 101411  0 16:03 ?        00:00:03 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>chatadm   47236  23075  0 May23 ?        00:00:55 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>w3sli     80951 101411  0 16:54 ?        00:00:01 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>root     101411      1  0 May29 ?        00:00:04 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br><br><br>If we try to access the process which is running by chatadm, the files generated by root, not chatadm.<br><br>root@SLVHPSWL0A /proc # ll 47236<br>total 0<br>dr-xr-xr-x  2 chatadm w3slibg 0 May 30 16:42 attr<br>-rw-r--r--  1 root    root    0 May 30 16:42 autogroup<br>-r--------  1 root    root    0 May 30 16:42 auxv<br>-r--r--r--  1 root    root    0 May 30 16:42 cgroup<br>--w-------  1 root    root    0 May 30 16:42 clear_refs<br>-r--r--r--  1 root    root    0 May 23 17:00 cmdline<br>-rw-r--r--  1 root    root    0 May 30 16:42 comm<br>-rw-r--r--  1 root    root    0 May 30 16:42 coredump_filter<br>-r--r--r--  1 root    root    0 May 30 16:42 cpuset<br>lrwxrwxrwx  1 root    root    0 May 29 16:34 cwd -&gt; /<br>-r--------  1 root    root    0 May 30 15:48 environ<br>lrwxrwxrwx  1 root    root    0 May 27 05:39 exe -&gt; /usr/sbin/httpd<br>dr-x------  2 root    root    0 May 29 09:10 fd<br>dr-x------  2 root    root    0 May 29 17:13 fdinfo<br>-rw-r--r--  1 root    root    0 May 30 16:42 gid_map<br>-r--------  1 root    root    0 May 30 16:42 io<br>-r--r--r--  1 root    root    0 May 30 16:42 limits<br>-rw-r--r--  1 root    root    0 May 30 16:42 loginuid<br>dr-x------  2 root    root    0 May 30 16:42 map_files<br>-r--r--r--  1 root    root    0 May 29 16:34 maps<br>-rw-------  1 root    root    0 May 30 16:42 mem<br>-r--r--r--  1 root    root    0 May 30 16:42 mountinfo<br>-r--r--r--  1 root    root    0 May 30 16:42 mounts<br>-r--------  1 root    root    0 May 30 16:42 mountstats<br>dr-xr-xr-x  7 chatadm w3slibg 0 May 30 16:42 net<br>dr-x--x--x  2 root    root    0 May 30 16:42 ns<br>-r--r--r--  1 root    root    0 May 30 16:42 numa_maps<br>-rw-r--r--  1 root    root    0 May 30 16:42 oom_adj<br>-r--r--r--  1 root    root    0 May 30 16:42 oom_score<br>-rw-r--r--  1 root    root    0 May 30 16:42 oom_score_adj<br>-r--r--r--  1 root    root    0 May 30 16:42 pagemap<br>-r--r--r--  1 root    root    0 May 30 16:42 personality<br>-rw-r--r--  1 root    root    0 May 30 16:42 projid_map<br>lrwxrwxrwx  1 root    root    0 May 29 16:34 root -&gt; /<br>-rw-r--r--  1 root    root    0 May 30 16:42 sched<br>-r--r--r--  1 root    root    0 May 30 16:42 schedstat<br>-r--r--r--  1 root    root    0 May 30 16:42 sessionid<br>-rw-r--r--  1 root    root    0 May 30 16:42 setgroups<br>-r--r--r--  1 root    root    0 May 30 16:42 smaps<br>-r--r--r--  1 root    root    0 May 30 16:42 stack<br>-r--r--r--  1 root    root    0 May 23 17:00 stat<br>-r--r--r--  1 root    root    0 May 24 21:00 statm<br>-r--r--r--  1 root    root    0 May 23 17:00 status<br>-r--r--r--  1 root    root    0 May 30 16:42 syscall<br>dr-xr-xr-x 20 chatadm w3slibg 0 May 29 16:34 task<br>-r--r--r--  1 root    root    0 May 30 16:42 timers<br>-rw-r--r--  1 root    root    0 May 30 16:42 uid_map<br>-r--r--r--  1 root    root    0 May 25 16:02 wchan<br><br>So when we run &quot;lsof | grep http&quot;<br><br>The &quot;deadlink: Permission denied&quot; message printed out and access is denied.<br><br>For w3sli running in a different domain<br>root@SLVHPSWL0A /proc # ls -al 46184<br>total 0<br>dr-xr-xr-x   9 w3sli w3slibg 0 May 30 16:03 .<br>dr-xr-xr-x 289 root  root    0 May 10 18:52 ..<br>dr-xr-xr-x   2 w3sli w3slibg 0 May 30 16:42 attr<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 autogroup<br>-r--------   1 w3sli w3slibg 0 May 30 16:42 auxv<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:42 cgroup<br>--w-------   1 w3sli w3slibg 0 May 30 16:42 clear_refs<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:03 cmdline<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 comm<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 coredump_filter<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:42 cpuset<br>lrwxrwxrwx   1 w3sli w3slibg 0 May 30 16:25 cwd -&gt; /<br>-r--------   1 w3sli w3slibg 0 May 30 16:42 environ<br>lrwxrwxrwx   1 w3sli w3slibg 0 May 30 16:09 exe -&gt; /usr/sbin/httpd<br>dr-x------   2 w3sli w3slibg 0 May 30 16:25 fd<br>dr-x------   2 w3sli w3slibg 0 May 30 16:26 fdinfo<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 gid_map<br>-r--------   1 w3sli w3slibg 0 May 30 16:42 io<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:42 limits<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 loginuid<br>dr-x------   2 w3sli w3slibg 0 May 30 16:42 map_files<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:25 maps<br><br>It is normally created with w3sli permission.<br><br><publishedDate>2018-05-31T05:45:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MgeIyIAJ"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-31T05:26:44Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-31T05:26:43Z</b><br><br>안녕하세요,<br><br>현재 내용을 자세히 살펴보는 중이며, 확인이 되는 데로 바로 업데이트 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-05-31T05:26:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MgdhfIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-05-31T04:11:27Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-05-31T04:11:27Z</b><br><br>해당 사항이 삼성내부에서도 긴급건으로 분류되어 빠른 답변 부탁드립니다.<br><br><publishedDate>2018-05-31T04:11:27Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MgdhVIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-05-31T04:10:42Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-05-31T04:10:42Z</b><br><br>답변감사합니다.<br>추가 내용 보내드리겠습니다<br>서버에서 현재 http를 두개의 서로 다른 계정(chatadm, w3sli)을 2개의 도메인으로 운용중입니다.<br>root가 chatadm 과 w3sli로 포크하는 방식입니다.<br>======================<br>root@SLVHPSWL0A /etc/httpd # ps -ef | grep httpd<br>root        336  44713  0 18:02 pts/2    00:00:00 grep --color=auto httpd<br>root      23075      1  0 May11 ?        00:00:55 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>chatadm   37488  23075  0 May23 ?        00:00:58 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>w3sli     46184 101411  0 16:03 ?        00:00:03 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>chatadm   47236  23075  0 May23 ?        00:00:55 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>w3sli     80951 101411  0 16:54 ?        00:00:01 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>root     101411      1  0 May29 ?        00:00:04 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br><br><br>chatadm이 실행한  프로세로 접근해보면 생선된 파일들이 chatadm 권한이 아닌 root로 되어있습니다.<br><br>root@SLVHPSWL0A /proc # ll 47236<br>total 0<br>dr-xr-xr-x  2 chatadm w3slibg 0 May 30 16:42 attr<br>-rw-r--r--  1 root    root    0 May 30 16:42 autogroup<br>-r--------  1 root    root    0 May 30 16:42 auxv<br>-r--r--r--  1 root    root    0 May 30 16:42 cgroup<br>--w-------  1 root    root    0 May 30 16:42 clear_refs<br>-r--r--r--  1 root    root    0 May 23 17:00 cmdline<br>-rw-r--r--  1 root    root    0 May 30 16:42 comm<br>-rw-r--r--  1 root    root    0 May 30 16:42 coredump_filter<br>-r--r--r--  1 root    root    0 May 30 16:42 cpuset<br>lrwxrwxrwx  1 root    root    0 May 29 16:34 cwd -&gt; /<br>-r--------  1 root    root    0 May 30 15:48 environ<br>lrwxrwxrwx  1 root    root    0 May 27 05:39 exe -&gt; /usr/sbin/httpd<br>dr-x------  2 root    root    0 May 29 09:10 fd<br>dr-x------  2 root    root    0 May 29 17:13 fdinfo<br>-rw-r--r--  1 root    root    0 May 30 16:42 gid_map<br>-r--------  1 root    root    0 May 30 16:42 io<br>-r--r--r--  1 root    root    0 May 30 16:42 limits<br>-rw-r--r--  1 root    root    0 May 30 16:42 loginuid<br>dr-x------  2 root    root    0 May 30 16:42 map_files<br>-r--r--r--  1 root    root    0 May 29 16:34 maps<br>-rw-------  1 root    root    0 May 30 16:42 mem<br>-r--r--r--  1 root    root    0 May 30 16:42 mountinfo<br>-r--r--r--  1 root    root    0 May 30 16:42 mounts<br>-r--------  1 root    root    0 May 30 16:42 mountstats<br>dr-xr-xr-x  7 chatadm w3slibg 0 May 30 16:42 net<br>dr-x--x--x  2 root    root    0 May 30 16:42 ns<br>-r--r--r--  1 root    root    0 May 30 16:42 numa_maps<br>-rw-r--r--  1 root    root    0 May 30 16:42 oom_adj<br>-r--r--r--  1 root    root    0 May 30 16:42 oom_score<br>-rw-r--r--  1 root    root    0 May 30 16:42 oom_score_adj<br>-r--r--r--  1 root    root    0 May 30 16:42 pagemap<br>-r--r--r--  1 root    root    0 May 30 16:42 personality<br>-rw-r--r--  1 root    root    0 May 30 16:42 projid_map<br>lrwxrwxrwx  1 root    root    0 May 29 16:34 root -&gt; /<br>-rw-r--r--  1 root    root    0 May 30 16:42 sched<br>-r--r--r--  1 root    root    0 May 30 16:42 schedstat<br>-r--r--r--  1 root    root    0 May 30 16:42 sessionid<br>-rw-r--r--  1 root    root    0 May 30 16:42 setgroups<br>-r--r--r--  1 root    root    0 May 30 16:42 smaps<br>-r--r--r--  1 root    root    0 May 30 16:42 stack<br>-r--r--r--  1 root    root    0 May 23 17:00 stat<br>-r--r--r--  1 root    root    0 May 24 21:00 statm<br>-r--r--r--  1 root    root    0 May 23 17:00 status<br>-r--r--r--  1 root    root    0 May 30 16:42 syscall<br>dr-xr-xr-x 20 chatadm w3slibg 0 May 29 16:34 task<br>-r--r--r--  1 root    root    0 May 30 16:42 timers<br>-rw-r--r--  1 root    root    0 May 30 16:42 uid_map<br>-r--r--r--  1 root    root    0 May 25 16:02 wchan<br><br>그래서 lsof | grep http를 하였을때<br><br>deadlink: Permission denied  라는 메세지가 발생하면서 접근이 거부가 됩니다.<br><br>다른 도메인으로 실행한 w3sli의 경우는<br>root@SLVHPSWL0A /proc # ls -al 46184<br>total 0<br>dr-xr-xr-x   9 w3sli w3slibg 0 May 30 16:03 .<br>dr-xr-xr-x 289 root  root    0 May 10 18:52 ..<br>dr-xr-xr-x   2 w3sli w3slibg 0 May 30 16:42 attr<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 autogroup<br>-r--------   1 w3sli w3slibg 0 May 30 16:42 auxv<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:42 cgroup<br>--w-------   1 w3sli w3slibg 0 May 30 16:42 clear_refs<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:03 cmdline<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 comm<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 coredump_filter<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:42 cpuset<br>lrwxrwxrwx   1 w3sli w3slibg 0 May 30 16:25 cwd -&gt; /<br>-r--------   1 w3sli w3slibg 0 May 30 16:42 environ<br>lrwxrwxrwx   1 w3sli w3slibg 0 May 30 16:09 exe -&gt; /usr/sbin/httpd<br>dr-x------   2 w3sli w3slibg 0 May 30 16:25 fd<br>dr-x------   2 w3sli w3slibg 0 May 30 16:26 fdinfo<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 gid_map<br>-r--------   1 w3sli w3slibg 0 May 30 16:42 io<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:42 limits<br>-rw-r--r--   1 w3sli w3slibg 0 May 30 16:42 loginuid<br>dr-x------   2 w3sli w3slibg 0 May 30 16:42 map_files<br>-r--r--r--   1 w3sli w3slibg 0 May 30 16:25 maps<br><br>정상적으로 w3sli 권한으로 생성이 되고 있습니다.<br><br>예상컨데 위의 사항이 해당 지연과 관련이 있는 것인지 견해부탁드립니다.<br>혹시 prefock방식과 worker방식의 차이로 발생가능성도 있을까요?<br><br>더불어 sosreport와 첨부해드리겠습니다.<br>추가 필요한 사항 있으시면 회신 부탁드립니다<br><br><publishedDate>2018-05-31T04:10:42Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MgJzNIAV"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-30T01:50:13Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-30T01:50:12Z</b><br><br>안녕하세요,<br><br>우선 주어진 data를 가지고 글로벌 전문 엔지니어와 논의한 내용 공유드립니다.<br><br>error_log 에서 hang이 발생한 시점을 구분해서 알 수 없습니다.<br>로그 상에 &quot;apr_socket_connect error [70007] The timeout specified has expired&quot; 와 같은 weblogc plugin output으로 error 메시지가 많이 존재합니다. 단순 메시지 내용만으로 볼 때는 backend server의 slow response 가 에러의 원인으로 생각됩니다. 하지만 weblogic plugin 메시지에 관해서는 저희쪽에서 정확하게 알 수가 없습니다. weblogic plugin 로그들에 관해서 Oracle 에 문의하셔야 합니다. 문의 결과를 저희에게도 공유해주시면 케이스 진행에 도움이 될 것 같습니다.<br><br>또 다른 error 메시지인 &quot;AH01797: client denied by server configuration&quot; 같은 경우는 hang 또는 slow response 와 연관은 없어 보입니다.<br><br><br>&gt;&gt; 데이터가 크거나, 한 페이지에 큰 이미지 파일등 출력할 때 브라우져에서 응답이 없었고,<br>&gt;&gt; netstat 로 확인해 보니 &quot;SYN_RECV&quot; 상태임이 확인 되었습니다.<br>&gt;&gt;     WebLogic에서는 별다른 에러 로그가 없었습니다.<br><br>해당 내용은 backend server 의 WebLogic server 나 application 의 이슈 때문일 수 있습니다. 해당 내용만으로 Apache hang 이슈라고 보기 어렵습니다. 또한 &quot;slow response&quot; 이슈의 경우 일반적으로 backend server에 에러 로그가 남지 않습니다.<br><br>아직까지 명확하게 Apache 의 hang 발생인지 backend WebLogic server의 slow response 이슈인지 명확하지 않습니다.<br>명확한 확인이 필요하고 이를 통해 이슈의 범위를 좁혀야 합니다.<br><br>이전 코멘트에서 요청드린 Apache 와 backend (WebLogic) 모두에서 access logging 수집 및 response time을 확인 요청드립니다.<br>또한 WebLogic Server에 GC 문제는 없었는지 확인과 weblogic plugin 에러 메시지 관련 Oracle을 통해서 확인 부탁드립니다.<br>이를 통해서 정확하게 hang 이슈에 대한 파악이 필요합니다.<br><br>분석의 도움을 위해 로그상에서 hang 이슈 발생 시점을 알려주세요. 또한 혹시 Apaceh 서버와 backend server 시간 차이가 있는 경우 들이 있는데, 시간 차이가 존재한다면 시간 차이 간격을 함께 알려주세요.<br><br>감사합니다.<br><br><publishedDate>2018-05-30T01:50:12Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Mg3bAIAR"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-29T07:52:59Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-29T07:52:59Z</b><br><br>안녕하세요,<br><br>업데이트 감사합니다.<br><br>다만 정확한 이슈 확인을 위해서는 netstat 결과 확인과 문의드린 Apache와 backend 의 access log 비교 확인이 반드시 필요하므로 꼭 확인 부탁드리겠습니다.<br><br>글로벌 전문 엔지니어와 논의 후 다시 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-05-29T07:52:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Mg3FnIAJ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-05-29T07:29:13Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-05-29T07:29:13Z</b><br><br>안녕하세요.<br><br>1. 요청하신 apache config, error_log 전달 드립니다.<br>   access_log는 취합 중입니다.<br><br>2. 간혈적으로 hang이 발생되기 때문에 현재 netstat 추출이 소용없습니다.<br>     발생 시에 추출하여 전달받기로 했습니다.<br><br>3. 발생되는 시기는 업무처리량이 많은 시점이나 사용자가 많은 시점이 아닌, 정 반대인 한가한 상황에서 간혈적으로 발생됩니다.<br>     데이터가 크거나, 한 페이지에 큰 이미지 파일등 출력할 때 브라우져에서 응답이 없었고,<br>     netstat 로 확인해 보니 &quot;SYN_RECV&quot; 상태임이 확인 되었습니다.<br>     WebLogic에서는 별다른 에러 로그가 없었습니다.<br><br>    3.2 운영서버에 진행해야되기 때문에 다른 시스템에도 영향이 미칠것으로 확인됩니다.<br>            고객께서 내부적으로 검토 하시어 확인 후 전달 하기로 했습니다.<br><br>이상입니다. 수고하세요.<br><br><publishedDate>2018-05-29T07:29:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mg1bDIAR"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-29T04:58:13Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-29T04:58:13Z</b><br><br>안녕하세요,<br><br>글로벌 전문 Web Server 엔지니어의 답변을 받아 업데이트 드립니다.<br><br>1. 먼저 Apache 전체 configuration 및 로그 파일 확인이 필요합니다.<br>* conf/httpd.conf, conf.d/*.conf, conf.modules.d/*.conf 그리고 &quot;include&quot; 로 포함된 파일<br>* log files: 모든 error_log 그리고 access_log<br><br>2. &quot;netstat -neopa &gt; output.txt&quot; 명령 실행 후 output.txt 파일 공유 부탁드립니다.<br>SYN_RECV 뿐만 아니라 ESTABLISHED를 포함해서 얼마나 많은 connection 이 존재하는지 확인이 필요합니다. <br><br>3. 정말 Apache httpd hang 이 맞는지 확인을 요청드립니다.<br>해당 이슈가 &quot;hang&quot; 인지 혹은 &quot;slow response&quot; 인지 어떻게 판단하셨는지요?<br>Apache httpd side 와 backend side (WebLogic) 모두에서 access logging의 response time을 확인하셨나요? 어땠나요?<br><br>3.1. 만약 backend 도 response time이 느리게 나왔다면, application 이 응답이 느리거나 backend server가 long GC pause 같은 이유로 성능상의 문제가 있는 경우 일 것입니다.<br><br>3.2. 만약 Apache httpd에서만 response time이 느리게 나왔다면, Apache httpd 내부의 어떤 처리가 오래 걸리는 것입니다. 만약 이런 경우에 해당한다면 Red Hat Knowledgebase article [1]의 내용을 참조해서 pstack을 캡쳐해서 공유해주십시오.<br><br>감사합니다.<br><br>[1] How to use pstack to identify hanging threads or high CPU usage in Apache HTTPD https://access.redhat.com/solutions/319673<br><br><publishedDate>2018-05-29T04:58:13Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Mg0PQIAZ"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-29T01:39:42Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-29T01:39:42Z</b><br><br>안녕하세요,<br><br>답변이 늦어져서 죄송합니다.<br><br>먼저 SYN_RECV 발생 관련으로는 해당 케이스의 내용으로 Red Hat Knowledgebase article [1] 이 있습니다. httpd가 TCP_DEFER_ACCEPT socket 옵션을 사용하고 소스 코드 상에서 30초 기본값을 사용한다고 합니다.<br>~~~<br>TCP(7)<br>       TCP_DEFER_ACCEPT (since Linux 2.4)<br>              Allow  a listener to be awakened only when data arrives on the socket.  Takes an integer value (seconds), this can bound the maximum number<br>              of attempts TCP will make to complete the connection.  This option should not be used in code intended to be portable.<br>~~~<br><br>&gt;&gt; 1. RedHat 7.4 버전에서 Apache 2.4 core dump 강제 추출하는 가이드 문서가 있는지 공유 부탁 드립니다.<br>Red Hat Knowledgebase article [2]를 참조하시기 바랍니다.<br><br>추가 상세 내용에 관해서 글로벌 Web Servers 전문 엔지니어 그룹에 도움이 필요하여 도움을 문의한 상태입니다. 답변이 확인이 되는데로 업데이트 하도록 하겠습니다.<br><br>최대한 빨리 답변드리도록 하겠습니다.<br><br>감사합니다.<br><br>[1] Why do I see SYN_RECV state on httpd port 80 after client establishes a connection? https://access.redhat.com/solutions/2157261<br>[2] How to collect core dump file of a crashing program that is shipped in Red Hat Enterprise Linux 6/7? https://access.redhat.com/solutions/56021<br><br><publishedDate>2018-05-29T01:39:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Mg01dIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-05-29T00:46:40Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-05-29T00:46:40Z</b><br><br>안녕하세요. <br><br>금일까지 간혈적으로 Apache Web Server가 hang 발생이 되어 서비스에 영향이 많이 미치고 있습니다.<br><br>해당 SR 진행을 위해 고객깨서 core dump를 강제적으로 추출하려고 하다보니 고객께서 실패 하였는데,<br><br>1. RedHat 7.4 버전에서 Apache 2.4 core dump 강제 추출하는 가이드 문서가 있는지 공유 부탁 드립니다.<br><br>2. kill -11 &lt;deamon_PID&gt; 실행 시 프로세스만 죽었습니다. 혹시 진행과정에서 잘못된 부분이 있는지 확인이 가능할까요?<br>     1) httpd.conf에서 CoreDumpDirectory 를 이용하여 core dump 디렉터리 생성<br>     2) kill -11 &lt;deamon_PID&gt; 실행 시 deamon만 종료됨. <br>           &quot;/usr/sbin/httpd&quot; deamon에 Setuid 설정 후 일반 계정으로 가동/중지 하고 있음.<br>           setuid 설정이 core dump 추출 시 down되는 영향이 미치는지 확인 부탁 드립니다.<br><br>3. child 프로세스를 core dump 추출해야되는 건지요? 만약 child 프로세스라면 여러개의 프로세스 중 어떤걸 해야되는건지요?<br><br>확인 부탁 드립니다. 감사합니다.<br><br><publishedDate>2018-05-29T00:46:40Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mfn6vIAB"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-27T22:25:02Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-27T22:25:02Z</b><br><br>안녕하세요<br><br>금일 갑작스럽게 제가 부재중인 관계로 내일까지 답변드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-05-27T22:25:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MfVizIAF"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-05-25T08:34:43Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-05-25T08:34:43Z</b><br><br>안녕하세요<br><br>Red Hat Global Technical Support 서비스를 이용해주셔서 감사합니다.<br><br>Middleware Support 를 담당하고 있는 Software Maintenance Engineer 원종석 입니다.<br><br>현재 이 케이스의 내용을 자세히 살펴보는 중이며, 곧 업데이트 하도록 하겠습니다.<br><br>감사합니다.<br><br>Best Regards,<br>Ted Won<br>Senior Software Maintenance Engineer<br>Red Hat Global Support Services<br><br><publishedDate>2018-05-25T08:34:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>