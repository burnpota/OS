======================<br><b>생성계정 : JIMIN KIM</b><br><b>생성날짜 : 2019-01-23T02:16:04Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2019-02-19T05:05:17Z</b><br><b>id : 5002K00000dBhjjQAC</b><br>======================<br><br><b><font size=15>
제목  : multipath 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>아래와 같이 2대의 서버의 multipath 결과가 있는데요.<br>multipath -ll의 결과가 조금 다른 방식으로 보이는 것 같아서<br>차이점을 문의드리려고 합니다.<br><br>root@SLPAFIAL01 /root # multipath -ll<br>ext5 (360060e8006d5e6000000d5e600002a5e) dm-12 HITACHI ,OPEN-V<br>size=100G features='0' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 14:0:0:16 sdai 66:32  active ready running<br>  `- 15:0:0:16 sdaj 66:48  active ready running<br>ext4 (360060e8006d5e6000000d5e600002a04) dm-11 HITACHI ,OPEN-V<br>size=100G features='0' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 14:0:0:4  sdg  8:96   active ready running<br>  `- 15:0:0:4  sdw  65:96  active ready running<br>ext3 (360060e8006d5e6000000d5e600002a03) dm-10 HITACHI ,OPEN-V<br>size=100G features='0' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 14:0:0:3  sdf  8:80   active ready running<br>  `- 15:0:0:3  sdv  65:80  active ready running<br>ext2 (360060e8006d5e6000000d5e600002a02) dm-9 HITACHI ,OPEN-V<br>size=100G features='0' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 14:0:0:2  sde  8:64   active ready running<br>  `- 15:0:0:2  sdu  65:64  active ready running<br>ext1 (360060e8006d5e6000000d5e600002a01) dm-8 HITACHI ,OPEN-V<br>size=100G features='0' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 14:0:0:1  sdd  8:48   active ready running<br>  `- 15:0:0:1  sdt  65:48  active ready running<br>ext0 (360060e8006d5e6000000d5e600002a00) dm-7 HITACHI ,OPEN-V<br>size=100G features='0' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 14:0:0:0  sdc  8:32   active ready running<br>  `- 15:0:0:0  sds  65:32  active ready running<br><br>root@SLPATCDL01 /var/log # multipath -ll<br>ORA_DATA3 (360060e8010215890051114c90000012e) dm-0 HITACHI ,DF600F<br>size=700G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>|-+- policy='service-time 0' prio=1 status=active<br>| `- 10:0:0:2 sdh 8:112 active ready running<br>`-+- policy='service-time 0' prio=0 status=enabled<br>  `- 8:0:0:2  sdd 8:48  active ready running<br>ORA_DATA2 (360060e8010215890051114c90000012d) dm-3 HITACHI ,DF600F<br>size=700G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>|-+- policy='service-time 0' prio=1 status=active<br>| `- 8:0:0:1  sdc 8:32  active ready running<br>`-+- policy='service-time 0' prio=0 status=enabled<br>  `- 10:0:0:1 sdg 8:96  active ready running<br>ORA_DATA1 (360060e8010215890051114c90000012c) dm-1 HITACHI ,DF600F<br>size=700G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>|-+- policy='service-time 0' prio=1 status=active<br>| `- 10:0:0:0 sdf 8:80  active ready running<br>`-+- policy='service-time 0' prio=0 status=enabled<br>  `- 8:0:0:0  sdb 8:16  active ready running<br>ORA_DATA4 (360060e8010215890051114c90000012f) dm-2 HITACHI ,DF600F<br>size=700G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>|-+- policy='service-time 0' prio=1 status=active<br>| `- 8:0:0:3  sde 8:64  active ready running<br>`-+- policy='service-time 0' prio=0 status=enabled<br>  `- 10:0:0:3 sdi 8:128 active ready running<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPATCDL01</hostname><br><br><br><comment id="a0a2K00000P8Ie7QAF"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-01-31T23:41:35Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-01-31T23:41:34Z</b><br><br>안녕하세요. Red Hat 김마현 입니다.<br><br>문의주신 내용에 대해 답변드리겠습니다.<br><br>multipath.conf에서 device {}를 지정하지 않으면 multipathd는 '공급업체/제품문자열'과 일치하는 문자열 패턴 일치를 수행하고 이를 알려진 내부 구성과 비교합니다.<br>참고로 sosreport를 첨부해 주신 해당 서버들은 multipath.conf에 device {}를 지정하지 않았습니다.<br><br>OPEN-*과 DF-*는 레드햇 문서(맨아래 참조)에서 언급 한 것처럼 multipathd에 내장 된 내부 구성을 가지고 있으며 아래 명령으로 확인해 볼 수 있습니다.<br><br># multipath -t | grep HITACHI -A 10 -B 1<br><br>device {<br><br><br>vendor &quot;(HITACHI|HP)&quot;<br><br><br>product &quot;OPEN-.*&quot;<br><br><br>path_grouping_policy &quot;multibus&quot;<br><br><br>path_checker &quot;tur&quot;<br><br><br>features &quot;0&quot;<br><br><br>hardware_handler &quot;0&quot;<br><br><br>prio &quot;const&quot;<br><br><br>rr_weight &quot;uniform&quot;<br><br>}<br><br>device {<br><br><br>vendor &quot;HITACHI&quot;<br><br><br>product &quot;DF.*&quot;<br><br><br>path_grouping_policy &quot;group_by_prio&quot;<br><br><br>path_checker &quot;tur&quot;<br><br><br>features &quot;1 queue_if_no_path&quot;<br><br><br>hardware_handler &quot;0&quot;<br><br><br>prio &quot;hds&quot;<br><br><br>failback immediate<br><br><br>rr_weight &quot;uniform&quot;<br><br>}<br><br>device {<br><br><br>위 테이블에서 각 product에 맞게 확인 가능합니다.<br>- product &quot;OPEN-.*&quot; : OPEN-V<br>- product &quot;DF.*     : DF600<br><br><br>아래는 관련된 레드햇 문서입니다. <br>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/dm_multipath/storage_support<br>AND<br>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/dm_multipath/mpio_configfile<br><br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-01-31T23:41:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000P85zoQAB"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2019-01-31T09:12:58Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2019-01-31T09:12:58Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>상세한 답변 감사드립니다.<br><br>OPEN-V의 아래 부분과<br><br>path_grouping_policy &quot;multibus&quot;  &lt;&lt;= all paths in 1 priority group<br>prio &quot;const&quot;                     &lt;&lt;= assign all paths same priority<br><br>DF600의 아래 부분은<br><br>path_grouping_policy &quot;group_by_prio&quot;  &lt;&lt;= group paths based on priority score<br>prio &quot;hds&quot;                            &lt;&lt;= program used to obtain priority from controller<br><br>혹시 OS에서는 어떤 명령을 통해서 확인이 가능한지 문의드려도될까요?<br><br>감사합니다.<br><br><publishedDate>2019-01-31T09:12:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000P80I5QAJ"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-01-31T00:56:43Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-01-31T00:58:40Z</b><br><br>안녕하세요. Red Hat 김마현 입니다.<br><br>확인된 내용 업데이트해 드리겠습니다.<br><br>패스를 다중화하는(멀티패스) 환경에서 disk array를 구성하는 방식은 크게 두 가지 타입이 있습니다.<br>Type 1. Active/Active<br>Type 2. Active/Passive<br><br>참고 URL<br>- Active/Active and Active/Passive Disk Arrays<br>https://pubs.vmware.com/vi3/sanconfig/wwhelp/wwhimpl/common/html/wwhelp.htm?context=sanconfig&amp;file=esx_san_cfg_SANconcepts.4.12.html<br><br><br>multipath 명령을 통해 확인된것처럼 각각의 서버에 연결된 disk array(Storage)는 Active/Active, Active/Passive 로 구성된 경우입니다.<br><br>- Type 1 (SLPAFIAL01) - Active/Active<br>root@SLPAFIAL01 ~ # multipath -ll<br>DM-MULTIPATH<br>  ext5 (360060e8006d5e6000000d5e600002a5e) dm-12 HITACHI ,OPEN-V          <br>  size=100G features='0' hwhandler='0' wp=rw<br>  `-+- policy='service-time 0' prio=1 status=active<br>    |- 14:0:0:16 sdai 66:32  active ready running<br>    `- 15:0:0:16 sdaj 66:48  active ready running<br>~~ snip ~~<br><br>OPEN-V는 SP가 들어오는 IO를 받아 들여 모든 Path에 대해 처리할 수 있는 Active / Active 구성입니다.<br>path_grouping_policy &quot;multibus&quot;  &lt;&lt;= all paths in 1 priority group<br>prio &quot;const&quot;                     &lt;&lt;= assign all paths same priority<br><br>두 Path 모두 multipathd 에서 동일한 const prio score(1)를 할당하고 이 경로가 단일 &quot;Active&quot; Path 그룹으로 그룹화되므로 이 array는 우선순위가 사용되지 않습니다.<br>즉, sdai와 sdaj 는 동일한 const prio scroe를 가지고 Active / Active 하게 IO가 발생합니다.<br><br># cat ./sosreport-SLPAFIAL01-20190128210404/sos_commands/multipath/multipath_-v4_-ll | grep -e &quot;sdai: const prio&quot; -e &quot;sdaj: const prio&quot;<br>Jan 28 21:07:17 | sdai: const prio = 1<br>Jan 28 21:07:17 | sdaj: const prio = 1<br><br><br>- Type 2 (SLPATCDL01) - Active/Passive<br>root@SLPATCDL01 ~ # multipath -ll<br>DM-MULTIPATH<br>  ORA_DATA3 (360060e8010215890051114c90000012e) dm-0 HITACHI ,DF600F          <br>  size=700G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>  |-+- policy='service-time 0' prio=1 status=active<br>  | `- 10:0:0:2 sdh 8:112 active ready running<br>  `-+- policy='service-time 0' prio=0 status=enabled<br>    `- 8:0:0:2  sdd 8:48  active ready running<br>~~ snip ~~<br><br>DF600F는 두 개의 다른 Path 그룹이 &quot;active&quot;, &quot;enabled&quot;인 것으로 확인되며, 따라서 해당 array는 Active / Passive 타입의 구성으로 확인됩니다.<br>path_grouping_policy &quot;group_by_prio&quot;  &lt;&lt;= group paths based on priority score<br>prio &quot;hds&quot;                            &lt;&lt;= program used to obtain priority from controller<br><br><br>hds 우선 순위 설정은 LDEV에 inquiry 명령을 보내고 컨트롤러는 SP 소유를 나타내는 'ODD | EVEN 1 | 0' 에 request를 반환합니다.<br># cat ./sosreport-SLPATCDL01-20190128210441/sos_commands/multipath/multipath_-v4_-ll | grep &quot;sdh: hds prio&quot;<br>Jan 28 21:05:28 | sdh: hds prio: CTRL EVEN, LDEV EVEN, PRIO 1                ---&gt; 이 device가 Active로 동작 합니다.<br>Jan 28 21:05:28 | sdh: hds prio = 1<br><br># cat ./sosreport-SLPATCDL01-20190128210441/sos_commands/multipath/multipath_-v4_-ll | grep &quot;sdd: hds prio&quot;<br>Jan 28 21:05:28 | sdd: hds prio: CTRL ODD, LDEV EVEN, PRIO 0<br>Jan 28 21:05:28 | sdd: hds prio = 0<br><br><br>정리하자면 각각의 서버는 동일하게 2 path로 구성된 멀티패스 환경이지만,<br>array (스토리지)단에서 아래와 같은 2가지 타입의 구성을 통해 IO를 컨트롤 하는 방식이 분류됩니다.<br>- 모든 패스에 대해 IO를 컨트롤<br>- 하나의 패스에서만 IO를 컨트롤, 나머지 패스는 Passive 모드로 동작<br>이 차이점에 따라 multipah -ll 의 출력의 결과값이 상이하게 보였던 것입니다.<br><br>함께 보시면 도움이 될만한 문서 첨부해 드리니 참고하십시오.<br>- Is it possible to change Hitachi DF600F SAN/Storage array from Active/Passive to Active/Active?<br>https://access.redhat.com/solutions/238953<br><br>- Why do I see I/O errors on a RHEL system using devices from an active/passive storage array?<br>https://access.redhat.com/solutions/18746<br><br><br>추가적으로 IO 컨트롤 구성과 동작 방식에 대해 궁금하신 점 있으시다면 스토리지 벤더측에 문의해 보시는것도 좋을 듯 합니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-01-31T00:56:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000P7QNIQA3"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-01-29T05:53:42Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-01-29T05:53:42Z</b><br><br>안녕하세요. Red Hat 김마현입니다.<br><br>확인 후 업데이트해 드리도록 하겠습니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-01-29T05:53:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000P7Ah3QAF"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2019-01-28T12:32:46Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2019-01-28T12:32:46Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>02297801_파일로 dropbox에 업로드하였습니다.<br><br>감사합니다.<br><br><publishedDate>2019-01-28T12:32:46Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000OtqPPQAZ"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-01-24T06:15:13Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-01-24T06:15:12Z</b><br><br>안녕하세요. Red Hat 김마현 입니다.<br><br>유선상으로 말씀드린것처럼 해당 서버의 sosreport 파일을 통해 HBA 카드 host 및 multipath conf 등의 정보가 필요할 것으로 보입니다.<br>해당 서버의 sosreport 파일을 업로드해 주시면 확인 후 업데이트해 드리겠습니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-01-24T06:15:12Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OtYpwQAF"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-01-23T05:56:47Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-01-23T05:56:47Z</b><br><br>안녕하세요. Red Hat 김마현 입니다.<br><br>확인 후 업데이트해드리겠습니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-01-23T05:56:47Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OtX9sQAF"><br>======================<br><b>생성계정 : Abbott, Edmund</b><br><b>생성날짜 : 2019-01-23T02:16:30Z</b><br><b>마지막 답변자 : Abbott, Edmund</b><br><b>마지막 수정 일자 : 2019-01-23T02:16:30Z</b><br><br>This comment has been generated via an automated case assistant and is based upon the information provided at case create time.<br>If you have already uploaded or are in the process of creating and uploading a sosreport to this case, please ignore this request.<br><br>Please provide a sosreport.  The lack of a sosreport often impedes our ability to make progress in fully understanding and <br>resolving the reported issue(s) in these types of cases.  If you cannot provide a sosreport for reasons such as its a secure <br>site or other such restrictions, please let us know if not already noted within the case. If this request is not applicable, <br>we do apologize and welcome any feedback or clarifying information you could provide to help us understand the problem. <br><br><br>If the system is or can be booted: <br>======================================================================================  <br><br>  * Create sosreport: ~]# sosreport <br>    Please see the following documentation for more information on the sosreport and how to gather one from the system.<br><br>        What is sosreport and how do I create one in Red Hat Enterprise Linux 4.6 and later?<br>        https://access.redhat.com/knowledge/solutions/3592<br><br>  * Attach to case  : ~]# redhat-support-tool addattachment -c CASE_NUMBER /path/to/sosreport<br>    If needed, an example on attaching a file to a case via the portal UI is available within the following document in <br>    the section entitled &quot;Attaching the file(s) to the ticket and case management through the Customer Portal&quot;.<br><br>        How do I open and manage a support case on the Customer Portal?<br>        https://access.redhat.com/articles/38363#attach<br><br>  * If the sosreport is large in size such that you are not able to upload it into the case, then you can upload it<br>    into the dropbox. For more information on dropbox, please refer the following document.<br><br>        How can I provide large files (such as a vmcore, big log files, or a large sosreport) to Red Hat Support?<br>        https://access.redhat.com/knowledge/solutions/2112<br><br>Please see the following documentation on how to proceed if the system cannot be booted, fails to boot, hangs on boot,<br>crashed during boot, sosreport hangs or otherwise does not complete:<br>====================================================================================== <br><br>  * Additional and alternative steps for gathering a sosreport for Red Hat Enterprise Linux<br>    https://access.redhat.com/articles/2760521<br><br><br>auto-assistant rule reference #:KSOS0150 https://access.redhat.com/articles/2908901<br><br><publishedDate>2019-01-23T02:16:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>