======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-08-03T01:40:51Z</b><br><b>마지막 답변자 : Jay Shin</b><br><b>마지막 수정 일자 : 2018-08-17T04:39:34Z</b><br><b>id : 500A000000bVoP7IAK</b><br>======================<br><br><b><font size=15>
제목  : OOM발생으로 인해 프로세스Kill
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요. 송기호입니다.<br>FLPIDMM03 서버에서 OOM이 발생하여 프로세스가 KILL되었습니다.<br>로그를 보면<br>free 가 min보다 작아짐을 확인<br>Aug  2 04:32:38 FLPIDMM03 kernel: Node 1 Normal free:44756kB min:45092kB low:56364kB high:67636kB active_anon:30220436kB inactive_anon:1777692kB active_file:1668kB inactive_file:1744kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:33095680kB mlocked:0kB dirty:104kB writeback:0kB mapped:22840kB shmem:21560kB slab_reclaimable:17728kB slab_unreclaimable:128132kB kernel_stack:47712kB pagetables:515144kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? no<br><br><br>메모리 사용 급증으로 sawp 0kb<br>Aug  2 04:32:38 FLPIDMM03 kernel: 57900 total pagecache pages<br>Aug  2 04:32:38 FLPIDMM03 kernel: 51613 pages in swap cache<br>Aug  2 04:32:38 FLPIDMM03 kernel: Swap cache stats: add 16849993, delete 16798380, find 2984829/2991122<br>Aug  2 04:32:38 FLPIDMM03 kernel: Free swap  = 0kB<br>Aug  2 04:32:38 FLPIDMM03 kernel: Total swap = 67108856kB<br>Aug  2 04:32:38 FLPIDMM03 kernel: 16777215 pages RAM<br>Aug  2 04:32:38 FLPIDMM03 kernel: 295681 pages reserved<br>Aug  2 04:32:38 FLPIDMM03 kernel: 12818037 pages shared<br>Aug  2 04:32:38 FLPIDMM03 kernel: 16392551 pages non-shared<br><br><br>프로스세스 사용량 분석<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name<br>Aug  2 04:32:39 FLPIDMM03 kernel: [  763]     0   763     2911       31   1     -17         -1000 udevd<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9225]     0  9225    62994      807   1       0             0 rsyslogd<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9237]     0  9237     2738       88   5       0             0 irqbalance<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9251]    32  9251     4746       45   4       0             0 rpcbind<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9269]    29  9269     5839       39   0       0             0 rpc.statd<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9281]     0  9281    53874      181   1       0             0 python<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9286]     0  9286   493497     4475   5       0             0 python<br>Aug  2 04:32:39 FLPIDMM03 kernel: [ 9381]     0  9381    34408       37   3       0             0 pbx_exchange<br>...생략<br>Aug  2 04:32:39 FLPIDMM03 kernel: [12643]    27 12624 31578714 15731481   1       0             0 mysqld&lt;--KILL<br>...생략<br><br>mysqld kill<br>Aug  2 04:32:39 FLPIDMM03 kernel: Out of memory: Kill process 12624 (mysqld) score 825 or sacrifice child<br>Aug  2 04:32:39 FLPIDMM03 kernel: Killed process 12624, UID 27, (mysqld) total-vm:126314856kB, anon-rss:62925720kB, file-rss:840kB<br>Aug  2 04:32:39 FLPIDMM03 kernel: mysqld invoked oom-killer: gfp_mask=0x200da, order=0, oom_adj=0, oom_score_adj=0<br>Aug  2 04:32:39 FLPIDMM03 kernel: mysqld cpuset=/ mems_allowed=0-1<br>Aug  2 04:32:39 FLPIDMM03 kernel: Pid: 12643, comm: mysqld Tainted: P           ---------------    2.6.32-358.23.2.el6.x86_64 #1<br>Aug  2 04:32:39 FLPIDMM03 kernel: Call Trace:<br>ug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff810cb641&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8111ce40&gt;] ? dump_header+0x90/0x1b0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8121d4ec&gt;] ? security_real_capable_noaudit+0x3c/0x70<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8111d2c2&gt;] ? oom_kill_process+0x82/0x2a0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8111d201&gt;] ? select_bad_process+0xe1/0x120<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8111d700&gt;] ? out_of_memory+0x220/0x3c0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8112c3dc&gt;] ? __alloc_pages_nodemask+0x8ac/0x8d0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81160d6a&gt;] ? alloc_pages_vma+0x9a/0x150<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81154aa2&gt;] ? read_swap_cache_async+0xf2/0x160<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff811555c9&gt;] ? valid_swaphandles+0x69/0x150<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81154b97&gt;] ? swapin_readahead+0x87/0xc0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81143eab&gt;] ? handle_pte_fault+0x70b/0xb50<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8105e513&gt;] ? perf_event_task_sched_out+0x33/0x80<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8114452a&gt;] ? handle_mm_fault+0x23a/0x310<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff812776c9&gt;] ? cpumask_next_and+0x29/0x50<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff810474e9&gt;] ? __do_page_fault+0x139/0x480<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8105e513&gt;] ? perf_event_task_sched_out+0x33/0x80<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8151531c&gt;] ? kprobe_flush_task+0xbc/0xe0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81513bfe&gt;] ? do_page_fault+0x3e/0xa0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81510fb5&gt;] ? page_fault+0x25/0x30<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff812829ac&gt;] ? __get_user_8+0x1c/0x23<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff810aa5ad&gt;] ? exit_robust_list+0x5d/0x160<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff810e9576&gt;] ? __delayacct_add_tsk+0x196/0x1b0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8106b423&gt;] ? mm_release+0x113/0x130<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81073026&gt;] ? exit_mm+0x26/0x180<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff810734df&gt;] ? do_exit+0x15f/0x870<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81073c48&gt;] ? do_group_exit+0x58/0xd0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81088f36&gt;] ? get_signal_to_deliver+0x1f6/0x460<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8100a265&gt;] ? do_signal+0x75/0x800<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff81064d70&gt;] ? pick_next_task_fair+0xd0/0x130<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8150df38&gt;] ? schedule+0x178/0x3b2<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff810ace7b&gt;] ? sys_futex+0x7b/0x170<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8100aa80&gt;] ? do_notify_resume+0x90/0xc0<br>Aug  2 04:32:39 FLPIDMM03 kernel: [&lt;ffffffff8100b341&gt;] ? int_signal+0x12/0x17<br><br><br>Free 메모리 확보<br>Aug  2 04:32:39 FLPIDMM03 kernel: Node 0 DMA32 free:120636kB min:4480kB low:5600kB high:6720kB active_anon:2005376kB inactive_anon:506080kB active_file:8kB inactive_file:80kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3288224kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:1896kB slab_unreclaimable:23504kB kernel_stack:1032kB pagetables:9436kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:58644 all_unreclaimable? yes<br><br><br>결론적으로 메모리 부족으로 인한 OOM발생으로 mysqld가 Kill된것으로 확인 되는데요.<br>다시 한번 확인 부탁드립니다.<br>추가적으로 <br>아래와 같이 권고를 할 예정입니다.<br>vm.swappiness = 60 -&gt; 10으로 변경<br>혹시 추가적으로 변경할 만한 파라메터가 있는 지 확인 부탁드립니다.<br><br>감사합니다.<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 김태현 (책임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  82-10-3734-0720<br>- 메일주소 : 김태현 &lt;th0720.kim@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(책임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.4</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>FLPIDMM03</hostname><br><br><br><comment id="a0aA000000Ldu08IAB"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-08-17T04:39:32Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-08-17T04:39:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>본 기술 문의의 상태를 처리완료 상태로 변경하고자 합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 본 기술 문의를 *재개*하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-08-17T04:39:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000N106HIAR"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-08-12T23:42:40Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-08-12T23:42:40Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-08-12T23:42:40Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NK6OZIA1"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-08-03T05:53:13Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-08-03T05:53:13Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>Q1. 결론적으로 메모리 부족으로 인한 OOM발생으로 mysqld가 Kill된것으로 확인 되는데요<br>    다시 한번 확인 부탁드립니다.<br><br>A1. 확인하신 내용대로 해당 시점에 메모리 부족으로 OOM이 발생했던 것으로 보입니다.<br><br>Q2. 혹시 추가적으로 변경할 만한 파라메터가 있는 지 확인 부탁드립니다.<br><br>A2. 아래와 같은 사항을 조정하실수 있습니다.<br><br> - vm.min_free_kbytes = 360448 <br> - tuned 서비스를 enable (tuned-adm profile latency-performance 혹은 throughput-performance)<br> - disable THP (https://access.redhat.com/solutions/46111)<br> - vm.swappiness = 10<br><br>만약 위와 같이 조정후에도 OOM이 자주 발생하게 된다면 물리메모리 증설을 권장드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-03T05:53:13Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NK4eaIAD"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-08-03T02:12:51Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-08-03T02:12:51Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>저는 Platform Support 를 담당하고 있는 Associate Technical Support Engineer 이성빈입니다.<br>올려주신 문의내용은 현재 자세히 살펴보고 있는중이며, 관련된 내용이 확인이 되는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-03T02:12:51Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>