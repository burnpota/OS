======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2019-03-13T01:54:37Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2019-04-02T04:08:12Z</b><br><b>id : 5002K00000dOZruQAG</b><br>======================<br><br><b><font size=15>
제목  : 시스템상에서 특정포트 모니터링
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요. 타임게이트 송기호입니다.<br><br>시스템상에서 특정포트를 모니터링하고<br>만약 포트가 다운될경우 다운되었다는 내용을 messages 혹은 기타다른 로그로 발생시키는 기능이 있는지 혹은 문서가 있는지 문의드립니다.<br><br>예를들면 httpd에서 8080을 사용중에 8080이 다운되면 다운되었다는 내용을 <br>특정한 로그 혹은 messages에 발생시킬수 있는 방법을 문의드립니다.<br><br>좋은하루되세요<br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.7</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>na</hostname><br><br><br><comment id="a0a2K00000PoqBoQAJ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-04-02T04:08:11Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-04-02T04:08:11Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service입니다.<br><br>본 케이스를 종료처리 하고자 합니다.<br>만약 본 케이스와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.  <br>  <br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발생됩니다. <br>고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. <br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.  <br>  <br>감사합니다.<br><br><publishedDate>2019-04-02T04:08:11Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PmyXPQAZ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-25T08:45:08Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-25T08:45:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 추가적으로 문의하실 사항이 있으신가요?<br><br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-25T08:45:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PYur8QAD"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-19T10:11:05Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-19T10:11:05Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>조사를 진행한 바에 의하면 rsyslog 로는 직접적으로 말씀하신 방법을 적용하기 어려운 것 같습니다.<br>먼저 netstat 결과에서 해당 포트가 listen 하고 있는지 여부에 대해서 주기적으로 체크한후 rsyslog.conf 에<br>기입하는 방법을 사용하시면 될 것 같습니다.<br><br>하시만 이미 아시는 내용이시겠지만 저희 기술지원 정책상 스크립트 작성은 지원범위에 포함되지 않는 점 양해 부탁드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-19T10:11:05Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PYq4lQAD"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-19T04:02:43Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-19T04:02:43Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>혹시 프로세스가 살아있고, 포트만 죽는 현상이 발생시 아래의 데이터를 수집 부탁드려도 될가요?<br>아래의 순서로 이슈 발생시에 실행하신후 마지막에 생성된 /tmp/script.out 파일을 올려주시기 바랍니다.<br> <br># script -f /tmp/script.out<br># ps aux <br># netstat -neopa <br># date<br># exit<br><br>추가로 application 단에도 문제가 없는지 병행하여 조사해보시면 좋을 것 같습니다.<br><br>Q. netstat -ntlp에서 나오는 tcp포트를 모니터링후 문제가 생기면 rsyslog를 통해서 messages에 발생시키는 스크립트는 어떨까요??<br>A. 일반적으로, 포트는 어플리케이션이 다운됨에 따라 같이 down 되기 때문에, 포트를 모니터링하는 것보다는 어플리케이션이 down 되는 것을 audit 통해 모니터링하는 것을 권장드립니다. rsyslog 로 해당 스크립트 작성이 가능한지 조사후 코멘트를 업데이트 드리도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2019-03-19T04:02:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PYYvuQAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2019-03-18T06:56:36Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2019-03-18T06:56:35Z</b><br><br>답변 매우 감사합니다.<br>해당 내용을 담당자와 공유하였으나 audit 정책은 내부적으로 사용을 하지 않는다고 하며,<br>사용가능성에 대해서 다시 한번 알아보겠다고 하였습니다.<br><br>말씀하신데로 프로세스를 모니터링 하는 방식이 아닌<br>포트만을 모니터링 하는 방법은 따로 없을까요??<br><br>왜냐하면 <br>담당자가 프로세스가 여전히 살아있는데요. 포트가 죽어서 문제가 발생하고 있는 상황이라고 합니다.<br>다시말해<br>프로세스는 계속 살아있고 포트가 죽었기 때문에 통신이 되지 않는 상황이라고 합니다.ㅠㅠ<br><br>고생스러우시겠지만 부탁드립니다.<br><br>제생각에는 <br>netstat -ntlp에서 나오는 tcp포트를 모니터링후 문제가 생기면 rsyslog를 통해서 messages에 발생시키는 스크립트는 어떨까요??<br>개인적인 생각이였습니다.<br>감사합니다.<br><br><publishedDate>2019-03-18T06:56:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PYDILQA5"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-15T07:21:21Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-15T07:21:21Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>먼저 sosreport 확인해본바에 의하면 시스템 로그에는 해당 어플리케이션이 다운되는 현상에 관련해 특이한 로그가 존재하지 않았고<br>OS단에서는 프로세스 비정상 다운에 관련해 특이사항을 발견할 수 없었습니다. <br><br>~~~<br>SLPLDPAL01:<br><br>Mar  8 17:28:42 SLPLDPAL01 su: pam_unix(su-l:session): session closed for user ldapservice<br>Mar  8 17:28:47 SLPLDPAL01 su: pam_unix(su-l:session): session opened for user ldapservice by (uid=0)<br>Mar  8 17:28:47 SLPLDPAL01 su: pam_unix(su-l:session): session closed for user ldapservice<br>Mar  8 17:28:58 SLPLDPAL01 su: pam_unix(su-l:session): session opened for user ldapservice by (uid=0)<br>Mar  8 17:28:58 SLPLDPAL01 su: pam_unix(su-l:session): session closed for user ldapservice<br>Mar  8 17:29:01 SLPLDPAL01 CROND[2500]: (root) CMD (/usr/lib64/sa/sa1 1 1)<br>Mar  8 17:29:42 SLPLDPAL01 su: pam_unix(su-l:session): session opened for user ldapservice by (uid=0)<br><br>SLPLDPAL02 에서도 java 관련해 특이사항이 없었으나 로그가 길어서 첨부는 안하도록 하겠습니다.<br>~~~<br><br>특정 포트를 모니터링 하기 보다 해당 프로세스가 down 되는지 여부를 모니터링 하는 것이 더 좋은 방법이라고 생각됩니다.<br>프로세스 모니터링은 audit 라는 툴을 통해 진행할 수 있습니다. 아래의 문서의 방법대로 적용하면 프로세스가 kill 될때<br>무엇에 의해 kill 되는지 /var/log/audit/audit.log에 기록이 남을 수 있습니다.<br><br># chkconfig auditd on<br># service auditd start<br><br># auditctl  -a exit,always -F arch=b64 -S kill<br># auditctl  -a exit,always -F arch=b32 -S kill<br># auditctl  -a exit,always -F arch=b64 -S tkill<br># auditctl  -a exit,always -F arch=b32 -S tkill<br># auditctl  -a exit,always -F arch=b64 -S tgkill<br># auditctl  -a exit,always -F arch=b32 -S tgkill<br><br>만약 해당 룰을 재부팅후에도 영구적으로 적용시키려면 /etc/audit/rules.d/audit.rules 에 <br>아래와 같이 기입하신후 audit 서비스를 재기동 하시면 됩니다.<br><br>-a exit,always -F arch=b64 -S kill<br>-a exit,always -F arch=b32 -S kill<br>-a exit,always -F arch=b64 -S tkill<br>-a exit,always -F arch=b32 -S tkill<br>-a exit,always -F arch=b64 -S tgkill<br>-a exit,always -F arch=b32 -S tgkill<br><br>[참고자료]<br> How to track who/what is sending SIGKILL to a process? <br>  https://access.redhat.com/solutions/165993<br><br><br>감사합니다.<br><br><publishedDate>2019-03-15T07:21:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PYCEEQA5"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2019-03-15T05:34:19Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2019-03-15T05:34:19Z</b><br><br>답변감사합니다.<br>아래를 차고 부탁드립니다.<br><br>1. 다운되는 서드파디 서비스명 및 포트<br><br>   - 포트: 10636<br><br>2. 서비스가 죽는 시간<br><br>   - SLPLDPAL01: 3/8 17:28:57<br><br>   - SLPLDPAL02: 2/19, 2/27 17:00~17:30 사이<br><br> <br>좋은하루되세요<br>감사합니다.<br><br><publishedDate>2019-03-15T05:34:19Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PXqfHQAT"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-14T01:06:24Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-14T01:06:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>서드파티 어플리케이션이 비정상적으로 다운 될때의 로그가 포함된 sosreport를 수집하여 보내주시면<br>OS단에 문제가 있는지 확인 해보도록 하겠습니다. 그리고 서드 파티 어플리케이션이 다운되었던 시점도<br>함께 확인해주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-14T01:06:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PXYbSQAX"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2019-03-13T04:34:50Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2019-03-13T04:34:50Z</b><br><br>답변감사합니다.<br><br>1번의 경우입니다.<br><br>담당자와 자세히 이야기를 해보니 <br>서비스가 정상적으로 운영중  포트가 다운되고 서비스가 비정상적으로 다운되는 케이스입니다.<br><br>답변해주신 내용에의하면 이러한 경우의 messages 혹은 journalctl 에 발생한다고 하였는데 journalctl쪽은 확인해보지는 않았지만 messages에서는  포트가 다운되었다는 메시지가 발생하지 않고 있다고 합니다.<br><br>추가적으로 다운되는 포트를 사용하는 어플리케이션의 경우 내부업무에서 사용하는 서드파티 어플리케이션입니다.<br><br><br>감사합니다.<br><br><publishedDate>2019-03-13T04:34:50Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PXY81QAH"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-13T03:37:36Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-13T03:37:35Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>말씀 하신 특정 포트가 down 되었 단 뜻이 제가 이해한 내용이 맞는지 확인부탁드립니다.<br><br>1. tcp listening port 가 *사라지는* 현상 <br>  -- 이런 현상은 해당 포트를 listening 하는 어플리케이션이거나 서비스가 종료 될때 발생합니다.<br>     현재 서비스가 종료되지 않았음에도 불구하고 listening port 가 사라지는 현상이 나타나고 있는지요?<br>     만약 서비스가 정상/비정상 종료되어 listening port가 사라진다면 /var/log/messages 혹은 journalctl 로<br>     확인이 가능할 것으로 예상됩니다.<br><br>2. tcp Established 상태의 session이 중지 되는 현상.<br>  -- 이미 아시겠지만 이것은 해당 세션이 4-way-handshake 로 정상적으로 커넥션 종료를 하거나, <br>     reset 되어 강제적으로 세션이 close 될때 발생하는 정상현상입니다. 이런 경우 따로 모니터링을 <br>     할수있는 방법은 없으며 netstat 혹은 ss 로 확인이 가능합니다.<br><br><br>감사합니다.<br><br><publishedDate>2019-03-13T03:37:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PXXmjQAH"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-13T02:50:23Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-13T02:50:23Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저는 Platform Support 를 담당하고 있는 Technical Support Engineer 이성빈입니다.<br>올려주신 문의내용은 현재 자세히 살펴보고 있는중이며, 관련된 내용이 확인이 되는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-13T02:50:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>