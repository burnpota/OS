======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-07-03T02:03:36Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-07-21T10:06:11Z</b><br><b>id : 500A000000bAo4EIAS</b><br>======================<br><br><b><font size=15>
제목  : kdump vmcore 생성 실패
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요. <br>고객사에서 RHEL7.4 OS 구성중 kdump 이슈가 발생하여 문의드립니다.<br><br>&quot;echo c &gt; /proc/sysrq-trigger&quot; 명령으로 core 생성 테스트를 하면 device를 찾지 못하며 timeout이 발생합니다.<br><br>해당 서버는 kdump를 raw로 설정하였습니다.<br>/etc/kdump.conf<br>   raw /dev/vg9/DUMP<br><br><br>Dracut timeout 발생 후 리부팅<br><br>Kdump.conf에서 “default shell” 설정 후 로그파일 확인결과 /dev/vg9/DUMP 를 찾지 못함<br><br>Raw가 아닌 /CRASH 파일시스템 영역으로 path 설정 후 kdump 테스트 시 정상적으로 vmcore 생성확인<br><br>OS상에서 DUMP lv의 attr 값 확인 결과 정상적으로 active 되어있음을 확인<br><br>추가 작업한 내용<br>1. Boot 영역 내 Initramfs.img  삭제 후 Dracut -f 수행<br>  -&gt; 증상 동일<br>2. Boot 영역 내 Initramfs.kdumpimg  삭제 후 kdump daemon restart, 이미지 재 생성<br>-&gt; 증상 동일<br>3. crashkernel값 512M -&gt; 256M 변경<br> -&gt; 증상 동일<br><br>추가로 고객사에서 현재 sosreport 반출이 불가하여 테스트머신에서 동일한환경으로 구성하여 sosreport 파일을 전달드립니다.<br>해당 내용에 대해 확인 부탁드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>.</hostname><br><br><br><comment id="a0aA000000N9vDqIAJ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-06T07:31:55Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-06T07:31:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>먼저 해당 증상이 발생한 원인은 raw 로 설정했을 때가 주된 문제라기보다는 lvm 을 찾지 못해서 발생한 것 입니다.<br>혹시 이전에는 lvm 이 아닌 일반 블록 장치 (e.i. /dev/sdX ) 를 raw 로 설정하신건 아니신지요?<br>제가 RHEL 7.2 에서 lvm 장치를 raw 로 테스트 했을때도 동일하게 dracut-initqueue[779]: Warning: dracut-initqueue timeout - starting timeout scripts 에러가 발생하였습니다.<br>가능하시다면 RHEL 7.2 로 한번 테스트 해보시면 좋을것 같습니다.<br>아래는 7.2 와 7.4  배포판 별 kexec-tools 버전을 비교한 내용이며, lvm 인식 관련 특별한 업데이트 내용을 찾을 수 없었습니다.<br><br> - RHEL 7.2 : kexec-tools-2.0.7-38.el7.x86_64.rpm<br> - RHEL 7.4 : kexec-tools-2.0.14-17.el7.x86_64.rpm<br><br>==================Change log==================<br><br>﻿* Tue Jun 27 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-17<br>- revert udev rule changes<br><br>* Fri Jun 23 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-16<br>- udev rules: fix the hotplug rule file removing path<br><br>* Thu Jun 22 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-15<br>- Revert &quot;pc64/ppc64le: drop cpu online rule in 40-redhat.rules in kdump initramfs&quot;<br>- udev rules: mask cpu hotplug rules<br><br>* Mon Jun 12 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-14<br>- kdump.conf.5: clarify the fence_kdump_nodes option<br>- kdumpctl: for fence_kdump, the ipaddr of this node should be excluded from list<br><br>* Wed Jun 07 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-13<br>- kdumpctl: change the shebang header to use /bin/bash<br><br>* Thu Jun 01 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-12<br>- kdump.sysconfig.x86_64: remove kaslr in kdump kernel cmdline<br>- Revert commit b590153 kdump.sysconfig/x86_64: Add nokaslr to kdump kernel cmdline<br><br>* Wed May 31 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-11<br>- makedumpfile: Fix refiltering, sadump and virsh dump<br><br>* Mon May 15 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-10<br>- kdumpctl: call strip_comments only when necessary to speedup<br>- Revert &quot;kdumpctl: improve &quot;while read&quot; time for /etc/kdump.conf&quot;<br><br>* Tue May 09 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-9<br>- kdumpctl: bail out earlier in case of no reserved memory<br>- kdumpctrl: kdump feasibility should fail if no crash memory<br>- kdumpctl: improve &quot;while read&quot; time for /etc/kdump.conf<br>- kdumpctl: update check_dump_fs_modified() to use &quot;lsinitrd -f&quot;<br>- kdumpctl: improve check_wdt_modified()<br>- kdumpctl: remove is_mode_switched()<br>- arm64: cmdline: modify to optimize size for memory reservation<br><br>* Mon May 08 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-8<br>- kdump.sysconfig/x86_64: Add nokaslr to kdump kernel cmdline<br><br>* Fri Apr 28 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-7<br>- arm64: Increase the upper limit for RAM segments<br>- kdump: Introduce 'force_no_rebuild' option<br>- kdump-lib-initramfs.sh: ignore the failure of echo<br>- use &quot;systemctl reboot -f&quot; for reboot action<br><br>* Thu Apr 13 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-6<br>- Update kdump anaconda addon<br><br>* Mon Apr 10 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-5<br>- ppc64: Reduce number of ELF LOAD segments<br>- kexec-kdump-howto: Include notes about using debug kernel as crash kernel<br>- Correct two typos in kdumpctl and kdump.conf<br><br>* Sat Apr 01 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-4<br>- kdump-emergency: fix &quot;Transaction is destructive&quot; emergency failure<br>- x86: Support large number of memory ranges<br><br>* Mon Mar 20 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-3<br>- arm64: backport latest kdump patches<br>- Fix `makedumpfile --mem-usage /proc/kcore`<br>- kdump-lib.sh: fix incorrect usage with pipe as input for grep -q in is_pcs_fence_kdump()<br><br>* Mon Mar 06 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-2<br>- kdumpctl: check the existence of /sys/kernel/security/securelevel<br>- kdump.sysconfig.x86_64: Remove 'notsc' from kdump kernel cmdline<br>- kdump.sysconfig: add KDUMP_COMMANDLINE_REMOVE for aarch64 and ia64<br>- kdump.sysconfig: add KDUMP_COMMANDLINE_REMOVE<br>- Document: fix incorrect link in fadump-how.txt<br>- kexec-tools.spec: add %doc for fadump-howto.txt<br><br>* Fri Feb 24 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.14-1<br>- rebase kexec-tools from 2.0.7 to 2.0.14<br><br>* Thu Feb 23 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.7-54<br>- fix the build error of Release 2.0.7-53<br><br>* Thu Feb 23 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.7-53<br>- makedumpfile: rebase makedumpfile from 1.6.0 to 1.6.1<br><br>* Thu Feb 23 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.7-52<br>- kdumpctl: check /etc/fstab modification only when it exists<br>- kdumpctl: remove duplicate statement<br>- kdumpctl: Kill duplicate code related to file modication check<br>- fadump: restore default initrd when fadump mode is disabled<br>- kdump/fadump: fix network interface name when switching from fadump to kdump<br><br>* Thu Feb 23 2017 Pingfan Liu &lt;piliu@redhat.com&gt; - 2.0.7-51<br>- Update kdump anaconda addon<br><br>* Mon Sep 05 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-50<br>- spec: Update to add dependency on dracut-network version &gt;= 033-449<br>- mkdumprd: Do not add &quot;nfs&quot; dracut module explicitly<br>- kexec-kdump-howto: Add doc about the special mount information via &quot;dracut_args&quot;<br>- Support special mount information via &quot;dracut_args&quot;<br><br>* Wed Aug 17 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-49<br>- fa9c082 kexec: Remedy the incomplete fix about persistent memory back porting<br><br>* Wed Jul 27 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-48<br>- arm64: prefer reading memory ranges from iomem over fdt<br><br>* Mon Jul 25 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-47<br>- spec: Update to add dependency on dracut version &gt;= 033-449<br>- watchdog: do not add watchdog module in rd.driver.pre now<br>- howto: Notes on watchdog module handling<br>- kdumpctl: force rebuild in case of watchdog state change<br>- mkdumprd: Add dracut watchdog module as default option<br><br>* Mon Jul 25 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-46<br>- kexec-kdump-howto:Add introduction of parallel dumping<br><br>* Wed Jul 20 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-45<br>- kdump.conf man page fixes<br>- kdump.conf comments fixes<br>- Add persistent memory support<br>- module-setup: Don't handle iBFT in kdump<br><br>* Fri Jul 08 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-44<br>- Update kdump anaconda addon<br>- kdumpctl: Do not rebuild initramfs when $KDUMP_BOOTDIR is read only<br>- get_persistent_dev(): fix name contention with dracut's similar function<br><br>* Mon Jul 04 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-43<br>- kexec/sadump: Back port two patches to fix regression bug of makedumpfile 1.6.0<br>- Makedumpfile: Rebase to 1.6.0<br><br>* Fri Jun 17 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-42<br>- module-setup: Use get_ifcfg_filename() to get the proper ifcfg file<br>- kdump-lib: Add get_ifcfg_filename() to get the proper ifcfg file<br>- doc: add nfs to supported filesystems list<br><br>* Sun Jun 12 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-41<br>- Update kdump anaconda addon<br><br>* Mon Jun 06 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-40<br>- kdumpctl: force rebuild in case of file system is modified<br>- mkdumprd: move to_dev_name() &amp; get_persistent_dev() to kdump-lib.sh<br>- kdumpctl: Move file modification check logic in check_system_modified()<br>- kdumpctl: force rebuild in case of dynamic system modification<br>- mkdumprd: do not lookup in by-uuid dirs for raw device's persistent name<br><br>* Thu May 19 2016 Baoquan He &lt;bhe@redhat.com&gt; - 2.0.7-39<br>- Remove duplicate prefix path ${initdir}<br>- Document declaration to support iSCSI HBA (ALL OFFLOAD)<br>- kdump.init: fix a typo<br>- rpm spec: add two patches to fix ppc64 kexec boot issue<br>- kexec-tools ppc64: add arch option --dt-no-old-root<br>- kexec-tools fs2dt.c: move copy old root param as a new function<br>- kdumpctl: Remove slub_debug from cmdline<br><br>==============================================<br><br>감사합니다.<br><br><publishedDate>2018-07-06T07:31:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000N9ub3IAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-06T06:41:50Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-06T06:41:50Z</b><br><br>답변 감사합니다.<br><br>말씀주신대로 적용한 결과 vmcore가 정상적으로 수집된것을 확인하였습니다.<br>또한,  /etc/sysconfig/kdump 에 &quot;KDUMP_COMMANDLINE_APPEND&quot; 라인에 추가하여도 정상동작 확인되었습니다.<br><br>이와 관련해서 추가 문의가 있는데요,<br><br>해당 이슈가 kdump 를 raw로 설정했을 때 항상 후처리해야하는 작업인가요??<br>지금까지 7.2 버전과 7.4 버전 동일한 환경으로 구성해왔지만 발생하지 않았던 이슈입니다.<br><br><br>확인 부탁드립니다.<br>감사합니다.<br><br><publishedDate>2018-07-06T06:41:50Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000N9sY9IAJ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-06T01:44:20Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-06T01:44:20Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>kdump 실행시에 아래와 같은 메시지가 발생했을 것으로 예상됩니다.<br><br>dracut-initqueue[779]: Warning: dracut-initqueue timeout - starting timeout scripts<br><br>이 증상은 말씀하신 것 처럼 lvm 장치를 찾을 수 없어서 발생했을 것입니다.<br><br>================================================================================<br><br>1. /etc/default/grub 파일의 GRUB_CMDLINE_LINUX= 항목에 아래의 내용을 삽입합니다.<br><br> rd.lvm.lv=vg9/DUMP<br><br>&lt; 예시 &gt;<br>...<br>GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rd.lvm.lv=vg9/DUMP rhgb quiet&quot;<br>...<br><br>2. 부트 로더에 설정을 적용합니다.<br><br> On non-UEFI systems:<br>  # grub2-mkconfig -o /etc/grub2.cfg<br><br> On UEFI systems:<br>  # grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg<br><br>3. kdump initramfs 를 삭제하고 kdump 데몬을 재시작 합니다. 이 과정에서 데몬의 동작 여부 및 kdump initramdisk 를 정상적으로 재생성 하는지 확인할 수 있습니다.<br><br> # rm /boot/﻿initramfs-3.10.0-XXX.el7.x86_64kdump.img<br> # systemctl restart kdump<br><br>4. kdump 테스트를 진행합니다.<br> <br> # echo c &gt; /proc/sysrq-trigger<br><br>================================================================================<br><br>위의 방법으로 설정 변경 후 테스트 결과 공유 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-06T01:44:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000N9sKMIAZ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-06T01:14:49Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-06T01:14:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>말씀하신 상황에 대해서 내부 재현 및 확인 중입니다.<br>확인되는대로 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-06T01:14:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000N9IrFIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-04T06:59:47Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-04T06:59:46Z</b><br><br>안녕하십니까 타임게이트 오선우입니다<br><br>답변 감사합니다<br><br>고객사에 RHEL7.2 환경에서는 raw디바이스로 만들지 않고 그동안 사용을 했었습니다<br><br>동일한 셋업으로 사용을 하고 있습니다 문론 덤프또한 잘 생성됩니다<br><br>그동안 따로 raw디바이스 설정을 진행하지 않았었는데요<br><br>이번에 RHEL7.4 환경으로 변경되는 시점으로 RHEL7.4에서 바뀐건지 어떠한 다른 원인이 있는건가요?<br><br><publishedDate>2018-07-04T06:59:46Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000N9HzMIAV"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-04T05:41:10Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-04T05:41:10Z</b><br><br>안녕하세요,<br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>$ cat kdump.conf | grep raw<br>raw /dev/vg9/DUMP<br><br>위의 내용을 보면 raw 장치로 바인딩 하지 않고 lvm 을 그대로 사용한 것처럼 보입니다.<br>lvm 이 raw 장치로 바인딩 되어있는지 확인이 필요합니다. raw 장치를 바인딩 하셨다면 아래와 같은 결과가 출력될 것 입니다.<br><br># raw -qa<br>/dev/raw/raw1:  bound to major 8, minor 17<br># ls -l /dev/raw<br>total 0<br>crw-rw---- 1 root   disk 162,  1 Jan 29 02:47 raw1<br><br>만약 raw 장치를 생성하지 않으셨다면 아래의 KCS 를 참조하셔서 raw 장치를 생성하신 후 다시한번 테스트 해보시기 바랍니다.<br><br>&quot;How to create raw devices in Red Hat Enterprise Linux 7?&quot;<br>https://access.redhat.com/solutions/1315113<br><br>감사합니다.<br><br><publishedDate>2018-07-04T05:41:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000N9GW1IAN"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-04T02:26:05Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-04T02:26:05Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>해당 문의에 대하여 확인중에 있습니다.<br>확인되는대로 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-04T02:26:05Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>고객사에서 RHEL7.4 OS 구성중 kdump 이슈가 발생하여 문의드립니다.<br><br>&quot;echo c &gt; /proc/sysrq-trigger&quot; 명령으로 core 생성 테스트를 하면 device를 찾지 못하며 timeout이 발생합니다.<br><br>해당 서버는 kdump를 raw로 설정하였습니다.<br>/etc/kdump.conf<br>   raw /dev/vg9/DUMP<br><br><br>Dracut timeout 발생 후 리부팅<br><br>Kdump.conf에서 “default shell” 설정 후 로그파일 확인결과 /dev/vg9/DUMP 를 찾지 못함<br><br>Raw가 아닌 /CRASH 파일시스템 영역으로 path 설정 후 kdump 테스트 시 정상적으로 vmcore 생성확인<br><br>OS상에서 DUMP lv의 attr 값 확인 결과 정상적으로 active 되어있음을 확인<br><br>추가 작업한 내용<br>1. Boot 영역 내 Initramfs.img  삭제 후 Dracut -f 수행<br>  -&gt; 증상 동일<br>2. Boot 영역 내 Initramfs.kdumpimg  삭제 후 kdump daemon restart, 이미지 재 생성<br>-&gt; 증상 동일<br>3. crashkernel값 512M -&gt; 256M 변경<br> -&gt; 증상 동일<br><br>추가로 고객사에서 현재 sosreport 반출이 불가하여 테스트머신에서 동일한환경으로 구성하여 sosreport 파일을 전달드립니다.<br>해당 내용에 대해 확인 부탁드립니다.<br><br>감사합니다.</issue><cep>false</cep></case>