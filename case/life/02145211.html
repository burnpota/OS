======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-07-20T01:35:32Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2018-07-30T02:58:44Z</b><br><b>id : 500A000000bTujFIAS</b><br>======================<br><br><b><font size=15>
제목  : L4 스위치 테스트에 따른 bonding 동작에 관한 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하십니까 타임게이트 오선우입니다<br><br>이중화 되어 있는 L4 스위치를 내려서 절체 테스트를 진행하였습니다<br><br>몇가지 문의드릴 내용이 있어서 케이스 오픈합니다<br><br>1. 로그상에서는 p2p1에 포트가 링크가 DOWN/UP 된 내용이 보이는데요<br><br>실제로 bonding상에는 Link Failure Count값이 0으로 증가하지 않았습니다<br><br>bonding 또한 동작하지 않고 연결동작(ping) 이 이루어 지지 않았습니다<br><br>1. 원인이 무엇이며 특이사항이 있는지 확인 부탁드립니다?<br><br>2. 해당 장비만 MTU 값이 8000인데요 해당 증상과 연관성이 있는지요?<br><br>감사합니다<br>======================<br><br>Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)<br><br>Bonding Mode: fault-tolerance (active-backup)<br>Primary Slave: None<br>Currently Active Slave: p2p1<br>MII Status: up<br>MII Polling Interval (ms): 0<br>Up Delay (ms): 0<br>Down Delay (ms): 0<br><br>Slave Interface: p2p1<br>MII Status: up<br>Speed: 1000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: a0:36:9f:7c:11:70<br>Slave queue ID: 0<br><br>Slave Interface: p4p1<br>MII Status: up<br>Speed: 1000 Mbps<br>Duplex: full<br>Link Failure Count: 0<br>Permanent HW addr: a0:36:9f:81:e8:78<br>Slave queue ID: 0<br><br>-----------------------------------------<br><br>Jul 19 18:58:26 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down<br>Jul 19 18:59:01 SLDAFIDL01 systemd: Started Session 198585 of user root.<br>Jul 19 18:59:01 SLDAFIDL01 systemd: Starting Session 198585 of user root.<br>Jul 19 19:00:01 SLDAFIDL01 systemd: Started Session 198587 of user root.<br>Jul 19 19:00:01 SLDAFIDL01 systemd: Starting Session 198587 of user root.<br>Jul 19 19:00:01 SLDAFIDL01 systemd: Started Session 198586 of user root.<br>Jul 19 19:00:01 SLDAFIDL01 systemd: Starting Session 198586 of user root.<br>Jul 19 19:00:01 SLDAFIDL01 root[4253]: NTPCheck : reach shift register something wrong.(375) Need to check NTP Server.(+DNTPML01SL) [Hardware Error]<br>Jul 19 19:00:01 SLDAFIDL01 root[4260]: NTPCheck : NTP status OK.(server : *DNTPML02SL, reach : 377, offset : 0.016)<br>Jul 19 19:01:01 SLDAFIDL01 systemd: Started Session 198588 of user root.<br>Jul 19 19:01:01 SLDAFIDL01 systemd: Starting Session 198588 of user root.<br>Jul 19 19:01:01 SLDAFIDL01 systemd: Started Session 198589 of user root.<br>Jul 19 19:01:01 SLDAFIDL01 systemd: Starting Session 198589 of user root.<br>Jul 19 19:01:01 SLDAFIDL01 systemd: Started Session 198590 of user root.<br>Jul 19 19:01:01 SLDAFIDL01 systemd: Starting Session 198590 of user root.<br>Jul 19 19:01:22 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX<br>Jul 19 19:01:55 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down<br>Jul 19 19:02:01 SLDAFIDL01 systemd: Started Session 198591 of user root.<br>Jul 19 19:02:01 SLDAFIDL01 systemd: Starting Session 198591 of user root.<br>Jul 19 19:03:01 SLDAFIDL01 systemd: Started Session 198592 of user root.<br>Jul 19 19:03:01 SLDAFIDL01 systemd: Starting Session 198592 of user root.<br>Jul 19 19:03:19 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLDAFIDL01</hostname><br><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-30T02:58:41Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-30T02:58:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service입니다.<br><br>마지막 안내후 일정기간동안 답변이 없으셔서 본 케이스를 close 처리 하려고 합니다.<br>만약 본 케이스와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.  <br>  <br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발생됩니다. <br>고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. <br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.  <br>  <br>감사합니다.<br><br><publishedDate>2018-07-30T02:58:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NI3aVIAT"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-25T07:51:48Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-25T07:51:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 추가적으로 문의하실 사항이 있으신가요?<br><br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-25T07:51:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCvoiIAD"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-20T08:59:28Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-20T08:59:27Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>확인 감사드립니다.<br><br>Q. 추가적으로 miimon설정이 오타가 있어서 적용이 안될경우 miimon설정이 0이 되면서 동작하지 않는것으로 알고 있는데요<br>   bonding동작이 안된것과 관련이 있을까요?<br><br>A. 네,miimon이 오타가 있을경우 0으로 설정되면서 링크 모니터링 툴이 링크 fail를 감지하지 못했던 것으로<br>   판단됩니다. miimon 설정을 정확히 수정후 해당 이슈가 재현되는지 테스트하신후 확인 부탁드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-20T08:59:27Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCvalIAD"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-20T08:43:54Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-20T08:43:54Z</b><br><br>1. 이중화 된 L4 스위치중 특정 한대를 절체시키면 ping이 통하지 않는가요? 아니면 두대의 스위치에 모두 해당되는지요?<br><br>   - 2대 중 1대만 down 하였었습니다.<br><br> <br><br>2. 올려주신 sosreport를 보면 MTU를 9000 으로 설정하신 것으로 보입니다. SLDAFIDL01 장비만 ping 이 안통했는지 아니면 MTU가 다른 장비도 안통했는지요? <br><br>   - MTU가 9000인 장비가 SLDAFIDL01 서버만 있었습니다.<br><br> <br><br>3. SLDAFIDL01 장비의 MTU 를 다른 장비와 동일하게 적용후에도 같은 이슈가 발생하는지 테스트 해보셨는지요?  <br><br>   - SLDAFIDL01 장비의 MTU를 다른 장비와 동일한 1500으로 변경은 해보지못했습니다.<br><br> <br><br>4. 아래와 같이 NIC link down이 18:39:08 ~ 19:03:19 사이에 발생한 것으로 보입니다. 반시간 동안 ping이 안통하다 어떤 작업을 하신후 네트워크가 회복되었는지요?<br><br>   - 두 번의 스위치 down 테스트가 있었고 테스트 간 사이에는 ping이 다시 가기는 하였습니다.<br>--스위치가 다운되어 있는 시간동안은 ping이 가지 않았고 다시 원복하면 ping이 동작하였습니다<br>======================<br> <br><br>Jul 19 18:39:01 SLDAFIDL01 systemd: Starting Session 198559 of user root.<br>Jul 19 18:39:08 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down ◀ 가정 처음 스위치 다운 ping 안감<br>Jul 19 18:40:01 SLDAFIDL01 systemd: Started Session 198560 of user root.<br><br>=== 생략 ===<br><br>Jul 19 18:44:01 SLDAFIDL01 systemd: Starting Session 198564 of user root.<br>Jul 19 18:44:48 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX ◀ 스위치 up ping 다시 감<br>Jul 19 18:45:01 SLDAFIDL01 systemd: Started Session 198565 of user root.<br><br>=== 생략 ===<br><br>Jul 19 18:45:01 SLDAFIDL01 systemd: Starting Session 198565 of user root.<br>Jul 19 18:45:21 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down ◀ 스위치 다운 ping 안감<br>Jul 19 18:46:01 SLDAFIDL01 systemd: Started Session 198566 of user root.<br><br>Jul 19 18:46:01 SLDAFIDL01 systemd: Starting Session 198566 of user root.<br>Jul 19 18:46:44 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX ◀ 스위치 up ping 다시 감<br>Jul 19 18:47:01 SLDAFIDL01 systemd: Started Session 198567 of user root.<br><br> <br>추가적으로 miimon설정이 오타가 있어서 적용이 안될경우 miimon설정이 0이 되면서 동작하지 않는것으로 알고 있는데요<br>bonding동작이 안된것과 관련이 있을까요?<br><br><publishedDate>2018-07-20T08:43:54Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NCuJOIA1"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-20T06:55:03Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-20T06:55:03Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>추가적으로 올려주신 sosreport 를 확인해보면 bond0 인터페이스 옵션에 <br>관련해 문제가 될만한 부분이 있어보입니다.<br><br>$ cat etc/sysconfig/network-scripts/ifcfg-bond0 <br>DEVICE=bond0<br>BOOTPROTO=none<br>NAME=bond0<br>ONBOOT=yes<br>IPADDR=100.253.45.211<br>GATEWAY=100.253.45.1<br>NETMASK=255.255.255.0<br>BONDING_OPTS=&quot;mode=1 miion=100&quot;   &lt;-----<br>MTU=9000<br><br>만약 상기의 파일중 bonding option에서 miion으로 설정하신 것이 확인되신다면<br>miimon 으로 정확한 옵션으로 수정할 필요가 있습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-20T06:55:03Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCtJ5IAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-20T05:00:18Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-20T05:00:18Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>이슈에 대해 좀더 구체적으로 파악하기 위해 아래와 같은 사항에 대해 확인을 하려고 합니다.<br><br>1. 이중화 된 L4 스위치중 특정 한대를 절체시키면 ping이 통하지 않는가요? 아니면 두대의 스위치에 모두 해당되는지요?<br>2. 올려주신 sosreport를 보면 MTU를 9000 으로 설정하신 것으로 보입니다. SLDAFIDL01 장비만 ping 이 안통했는지 아니면 MTU가 다른 장비도 안통했는지요?<br>3. SLDAFIDL01 장비의 MTU 를 다른 장비와 동일하게 적용후에도 같은 이슈가 발생하는지 테스트 해보셨는지요?<br>4. 아래와 같이 NIC link down이 18:39:08 ~ 19:03:19 사이에 발생한 것으로 보입니다. 반시간 동안 ping이 안통하다 어떤 작업을 하신후 네트워크가 회복되었는지요?<br> <br>Jul 19 18:39:08 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down<br>Jul 19 18:44:48 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX<br>Jul 19 18:45:21 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down<br>Jul 19 18:46:44 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX<br>Jul 19 18:58:26 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down<br>Jul 19 19:01:22 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX<br>Jul 19 19:01:55 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Down<br>Jul 19 19:03:19 SLDAFIDL01 kernel: igb 0000:84:00.0 p2p1: igb: p2p1 NIC Link is Up 1000 Mbps Full Duplex, Flow Control: RX<br><br>확인 부탁드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-20T05:00:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>