======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-05-31T05:28:20Z</b><br><b>마지막 답변자 : 타임게이트 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-05T08:23:58Z</b><br><b>id : 500A000000XM9uDIAT</b><br>======================<br><br><b><font size=15>
제목  : STONITH 망 절체시 증상에 대한 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요?<br>이번건은 케이스번호 01833554와 연계해서 확인 부탁드립니다.<br><br><br>일전에 했던 것(케이스번호 01833554)은 가상화에서 VCENTER와의 통신이 되지 않았던것이고<br>이번것은 물리장비에서 스토니스망(BOND3)을 다운시킨 상태를 체크하였으나<br>서비스에 전혀 문제도 되지 않았고 팬싱도 일어나지 않았습니다.<br>이번건에 대해서 액션 플로우 설명 부탁드리고<br>이전 건(케이스번호 01833554)과 비교해서 어떤 차이점이 있었는지 상태 확인 부탁드립니다.<br>감사합니다.<br><br>파일은 드롭박스에 첨부하였으며 <br>파일명은 <br>PECCCL01SL_170531_sos.tar.gz<br>PECCCL02SL_170531_sos.tar.gz<br>입니다.<br><br>위 2화일을 이곳에 링크 부탁드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PECCCL01SL, PECCCL02SL</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000JeLEmIAN"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-05T08:21:20Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-05T08:21:20Z</b><br><br>감사합니다. close 하겠습니다.<br><br><publishedDate>2017-06-05T08:21:20Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Je2WfIAJ"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-06-02T08:27:32Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-06-02T08:27:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br>말씀 하신 파일을 케이스로 첨부 해 드렸으며 확인 부탁드립니다. <br><br><br>감사합니다. 좋은 주말 되십시오. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-06-02T08:27:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Je1h6IAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-02T07:02:37Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-02T07:02:36Z</b><br><br>케이스 오픈할때 말씀 드렸던 파일입니다.<br>파일명은 아래와 같습니다.<br>PECCCL01SL_170531_sos.tar.gz<br>PECCCL02SL_170531_sos.tar.gz<br><br><publishedDate>2017-06-02T07:02:36Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JdzmCIAR"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-06-02T02:10:05Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-06-02T02:10:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>1. <br>아닙니다. cleanup 실행 하지 않아도 stonith 가 제대로 복구 될수 있습니다. <br>장애 노드에서 복구 시도가 계속 실패가 되면 다른 노드로 페일오버 됩니다. <br><br>2. <br>migration-threshold 를 3으로 설정 하였을 경우 복구 시도는 3번 합니다. <br>하지만 복구 과정에서 stop 실패가 발생 되면 fencing 이슈가 발생 하게 됩니다. <br>복구 과정에서 start 실패가 발생 되면 바로 다른 노드로 failover 됩니다. <br><br>즉 start/stop 실패가 없을 경우에 복구 시도를 3번 합니다. <br><br><br>3. <br>Red Hat dropbox로 올려 주신 파일은 외부에서 접근 불가 하십니다. 필요 하신다면 <br>파일명을 알려 주시면 제가 케이스에 첨부 시도를 해 보도록 하겠습니다. <br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-06-02T02:10:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JdqXaIAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-01T14:21:07Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-01T14:21:06Z</b><br><br>1.  stonith 망 복구 된 후에 fail-count를 없애려면 cleanup 을 하셔야 합니다. <br>    # pcs stonith cleanup<br><br>cleanup을 하지 않으면 모니터링을 안하는것인지요? <br><br>2. 저희쪽 클러스터의 migration-threshold값은 디폴트 3입니다.<br>stonith monitor 로그상에서 recover하는 과정을 설명 부탁드리겠습니다. recover를 몇번 진행했는지 궁금합니다.<br><br>3. 아울러 제가 드롭박스에 올린화일 링크 부탁드립니다. 저도 보면서 말씀 드렸으면 좋겠습니다.<br><br><publishedDate>2017-06-01T14:21:06Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JdlsaIAB"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-06-01T08:06:02Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-06-01T08:06:02Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>1. <br>stonith 망 복구 된 후에 fail-count를 없애려면 cleanup 을 하셔야 합니다. <br># pcs stonith cleanup<br><br>2. <br>stonith stop 작업을 하는 원인은 stonith monitor 실패가 발생 하였기 때문입니다. <br>pacemaker 클러스터에서 resource/stonith monitor failed 발생 하게 되면 <br>바로 failover 되지 않고 기존 운영 하였던 노드에서 복구 시도를 합니다. <br>복구 할시 먼저 resource/stonith를 stop 시키고 다시 start 시킵니다. <br><br>복구 하는 횟수는 migration-threshold 를 통해 설정 하실수 있습니다. 해당 옵션의 <br>디폴트 값은 100000으로 되었습니다. <br><br>migration-threshold 설정 방법은 아래와 같은 링크에서 확인 하실수 있습니다. <br><br>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/High_Availability_Add-On_Reference/s1-failure_migration-HAAR.html<br><br>관련 하여 추가적인 문의 사항이 있으시면 다시 연락 주시기 바랍니다. <br><br><br>감사합니다. 좋은 하루 되십시오.<br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-06-01T08:06:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JdkpbIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-01T06:16:01Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-01T06:16:01Z</b><br><br>1. 스토니스망이 다시 정상으로 돌아오면 모니터링을 자동으로 시작하는건지요? <br>  <br>  언클린 상태에서는 모니터링을 하지 않는것으로 보아야 하는건지요?<br>  <br>  pcs stonith cleanup을 꼭 해줘야 하는건지요? 안해줘도 모니터링은 하고 있는것인지 궁금합니다.<br><br>2.  제가 말씀 드리는 것은 stonith stop 실패 원인이 아니라 stonith stop 이 발생한 원인을 알고 싶습니다.<br>    stonith stop 타임아웃으로 인한 팬싱프로세스가 진행된것에 대해서는 이해했습니다.<br><br><publishedDate>2017-06-01T06:16:01Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JdkkqIAB"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-06-01T06:04:28Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-06-01T06:04:28Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>추가적으로 보내 주신 문의 사항에 대해 아래와 같이 답변 드립니다. <br><br>1. <br>일시적인 stonith 모니터링 실패가 발생 하여도 서비스에 영향을 주지 않습니다.<br>다만, fencing을 시켜야 될 때 지속적으로 stonith 모니터링 실패가 되면 <br>fencing 실패로 서비스에 영향을 줄수 있습니다. <br><br>2. <br>저번 건에서 stonith stop 실패 원인에 대해 로그 내용을 보시면 time-out <br>이슈가 발생 하였기 때문입니다. <br><br>Apr 16 17:13:01 [23124] PIASCL02SL       crmd:  warning: cib_action_update:     rsc_op 5: vmware_stonith1_stop_0 on PIASCL02SL-HB timed out <br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-06-01T06:04:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JdkJpIAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-01T05:06:08Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-01T05:06:07Z</b><br><br>답변 감사합니다.<br><br>1. 이번 건에는 stonith 모니터링이 타임아웃걸린 상황이어서 서비스에는 영향 없었다는 말씀이신건가요?<br><br>2. 저번 건은  stonith stop 이 실행되었는데 stop이 되지 않아서 문제가 되었다고 말씀하셨는데 어떠한 이유로 stonith 가 stop을 실행했는지 확인 부탁드립니다.<br><br><publishedDate>2017-06-01T05:06:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jdj37IAB"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-06-01T01:44:10Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-06-01T01:44:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br>보내 주신 sosreport 에서 확인 된 내용을 아래와 같이 정리하여 첨부 해 드립니다.<br><br>- stonith 망 다운 된 시점:<br><br>May 31 11:06:18 PECCCL01SL root: [TG] BOND3 DOWN<br>May 31 11:06:18 PECCCL01SL kernel: bond3: Removing slave ens3f2<br>May 31 11:06:18 PECCCL01SL kernel: bond3: Releasing active interface ens3f2<br>May 31 11:06:18 PECCCL01SL kernel: bond3: the permanent HWaddr of ens3f2 - 28:80:23:b2:aa:f2 - is still in use by bond3 - set the HWaddr of ens3f2 to a different address to avoid conflicts<br>May 31 11:06:18 PECCCL01SL kernel: bond3: making interface ens6f3 the new active one<br>May 31 11:06:18 PECCCL01SL kernel: bond3: Removing slave ens6f3<br>May 31 11:06:18 PECCCL01SL kernel: bond3: Releasing active interface ens6f3<br><br><br>- stonith 망 다운 된 후 stonith 모니터링 실패 현상이 있었음<br><br>May 31 11:07:04 PECCCL01SL stonith-ng[5790]:  notice: Child process 28920 performing action 'monitor' timed out with signal 15<br>May 31 11:07:04 PECCCL01SL stonith-ng[5790]:  notice: Operation 'monitor' [28920] for device 'ipmi_stonith2' returned: -62 (Timer expired)<br>May 31 11:07:04 PECCCL01SL crmd[5794]:   error: Operation ipmi_stonith2_monitor_60000: Timed Out (node=PECCCL01SL-HB, call=30, timeout=20000ms)<br>May 31 11:07:16 PECCCL01SL crmd[5794]:  notice: Operation ipmi_stonith2_stop_0: ok (node=PECCCL01SL-HB, call=35, rc=0, cib-update=26, confirmed=true)<br>May 31 11:07:36 PECCCL01SL stonith-ng[5790]:  notice: Child process 30196 performing action 'monitor' timed out with signal 15<br>May 31 11:07:36 PECCCL01SL stonith-ng[5790]:  notice: Operation 'monitor' [30196] for device 'ipmi_stonith2' returned: -62 (Timer expired)<br>May 31 11:07:37 PECCCL01SL crmd[5794]:   error: Operation ipmi_stonith2_start_0: Timed Out (node=PECCCL01SL-HB, call=36, timeout=20000ms)<br>May 31 11:07:37 PECCCL01SL crmd[5794]:  notice: Operation ipmi_stonith2_stop_0: ok (node=PECCCL01SL-HB, call=37, rc=0, cib-update=28, confirmed=true)<br><br>그리고 stonith 망과 핫빗망 동일 인터페이스에 설정 되어 있지 않음으로 stonith 망 절체시 <br>핫빗망에 영향을 주지 않았습니다. <br><br>Heartbeat: bond2<br>Stonith: bond3<br><br><br>stonith 장비에 모니터링 실패가 발생 하여도 클러스터가 정상적으로 운영 할수 있습니다. <br><br><br>이번 건이 케이스 01833554와의 차이점은 이번에 stonith 장비를 stop 시킬시 실패가 발생 하지 않았습니다. <br>아래는 케이스 01833554에서 추출한 메시지임니다. 그 메시지 내용을 보시면 vmware_stonith1 stop 작업이 <br>timeout 이슈로 실패 되었습니다. 따라서 resource failure (stonith stop 실패) 로 fencing 된 것입니다. <br><br>Apr 16 17:13:01 [23124] PIASCL02SL       crmd:  warning: cib_action_update:     rsc_op 5: vmware_stonith1_stop_0 on PIASCL02SL-HB timed out <br>^^^^^^^^^^^ 스톱 작업이 time out 됨<br>Apr 16 17:13:02 [23124] PIASCL02SL       crmd:     info: process_graph_event:   Detected action (149.5) vmware_stonith1_stop_0.-1=unknown error: failed<br>Apr 16 17:13:02 [21776] PIASCL02SL    pengine:  warning: pe_fence_node: Node PIASCL02SL-HB will be fenced because of resource failure(s)<br><br>pacemaker 클러스터에서는 resource/stonith stop 실패가 발생 하게 되면은 노드가 fencing 됩니다.<br>======================<br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-06-01T01:44:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JdisTIAR"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-06-01T01:20:08Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-06-01T01:20:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br>저는 정미연이라고 하며 앞으로 본 케이스를 담당하게 되었습니다. <br>지금 업로드 주신 파일을 확인 중에 있으며 업데이트 사항이 있으면 <br>바로 공유 드리도록 하겠습니다. <br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-06-01T01:20:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>