======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-08-18T08:38:46Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2017-09-08T10:08:21Z</b><br><b>id : 500A000000Y2cTrIAJ</b><br>======================<br><br><b><font size=15>
제목  : 시스템 운영중  문의사항
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하십니까 타임게이트 오선우입니다<br>고객사 시스템 운영중 몇가지 문의 사항이 있어서 답변 문의 드립니다<br> <br>1. net.ipv4.ip_local_port_range 값에 대한 문의<br>해당 옵션의 값이 sysctl에 등록이 되어 있지 않는데 시스템 별로 차이가 있는 것으로 보여집니다<br>사이트 검색시 메모리 용량에 따라 차이가 있다는 의견도 있고 값에 대한 의미는 나와있지만 <br>해당 값이 구성되어지는  공식이 없는것 같습니다 <br>확인 부탁드립니다<br> <br>net.ipv4.ip_local_port_range<br>Port numbers usable by transport protocols (TCP, UDP etc) to choose local ports when not specified by the application. The first number is the lower bound, the second is the upper bound of the range. Reducing the lower bound below 1024 is not recommended. See also ip_local_reserved_ports (below).<br>INTEGER PAIR- 0 - 65535<br>Default (RHEL7) &quot;32768 61000&quot; <br>참고 : https://access.redhat.com/solutions/108513<br> <br> <br>2. XFS 파일시스템에서 생성할수있는 하나의 디렉토리 내에 생성 가능한 디렉토리/ 파일 개수 확인<br>XFS Maximum subdirectories<br>--<br>--<br>unlimited<br>unlimited<br>unlimited <br>https://access.redhat.com/articles/rhel-limits<br><br>디렉토리 내에 서브 디렉토리 생성부분은 unlimited로 확인 됩니다  <br>그렇다면 한 디렉토리내에 생성할수 있는 file에 개수가 몇개인가요? inode값과 연관이 있는 것인가요? <br>확인 부탁드립니다<br><br>3.  pvcreate, lvcreate 명령어를 사용하여 LVM 구성시 아래와 같은 메시지가 콘솔에 발생합니다<br>실제로 구성은 잘 된거 같은데요 해당 메시지가 원인이 무엇인지  확인 부탁드립니다<br> ​File descriptor 3 (pipe:[229680]) leaked on pvcreate invocation. Parent PID 5813: bash<br>​<br>감사합니다<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000KS74BIAT"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-08-24T08:41:51Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-08-24T08:41:51Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>File descriptor 3 (pipe:[229680]) leaked on pvcreate invocation. Parent PID 5813: bash<br><br>해당 bash프로세스가 File descriptor값을 2이상을 가지게 되는 원인에는:<br>새로운 IO pipe를 생성하거나 부모프로세스가 File Descriptor를 2이상의 값을 가지고 있는 경우 등이 있습니다.<br>기존 사례 및 올려주신 sosreport를 다시한번 확인한 결과, 해당 bash 프로세스가 부모프로세스(pbrun)로부터 <br>&quot;2&quot; 이상의 File descriptor값을 물려받았고, 따라서 lvm이 상기 메세지를 출력된 것으로 보입니다.<br>~~~~~~~~~~~~~~~~~~~~~~~<br>sosreport-PNLSDL02SL-20170822105203 에서:<br><br># cat pstree | grep bash <br>  |-sshd---sshd---sshd---RestrictedShell---pbksh---runAs---pbrun---bash---bash---sosreport---timeout---pstree<br>                                                               `------- bash의 부모프로세스  <br># cat lsof | egrep &quot;/dev/pts/1|COMMAND&quot; <br>COMMAND      PID   TID     USER   FD      TYPE             DEVICE  SIZE/OFF       NODE NAME<br>Restricte  99603          31297    0u      CHR              136,1       0t0          4 /dev/pts/1<br>Restricte  99603          31297    1u      CHR              136,1       0t0          4 /dev/pts/1<br>Restricte  99603          31297    2u      CHR              136,1       0t0          4 /dev/pts/1<br><br>pbksh      99611          31297    0u      CHR              136,1       0t0          4 /dev/pts/1<br>pbksh      99611          31297    1u      CHR              136,1       0t0          4 /dev/pts/1<br>pbksh      99611          31297    2u      CHR              136,1       0t0          4 /dev/pts/1<br>pbksh      99611          31297    5u      CHR              136,1       0t0          4 /dev/pts/1 <br>pbksh      99611          31297    6u      CHR              136,1       0t0          4 /dev/pts/1 <br>pbksh      99611          31297    7u      CHR              136,1       0t0          4 /dev/pts/1 <br>pbksh      99611          31297    8u      CHR              136,1       0t0          4 /dev/pts/1 <br><br>runAs      99744          31297    0u      CHR              136,1       0t0          4 /dev/pts/1     <br>runAs      99744          31297    1u      CHR              136,1       0t0          4 /dev/pts/1    <br>runAs      99744          31297    2u      CHR              136,1       0t0          4 /dev/pts/1    <br>runAs      99744          31297    5u      CHR              136,1       0t0          4 /dev/pts/1<br><br>pbrun      99780          31297    0u      CHR              136,1       0t0          4 /dev/pts/1     <br>pbrun      99780          31297    1u      CHR              136,1       0t0          4 /dev/pts/1     <br>pbrun      99780          31297    2u      CHR              136,1       0t0          4 /dev/pts/1     <br>pbrun      99780          31297    5u      CHR              136,1       0t0          4 /dev/pts/1 &lt;---+<br>pbrun      99780          31297    6u      CHR              136,1       0t0          4 /dev/pts/1 &lt;---|<br>pbrun      99780          31297    7u      CHR              136,1       0t0          4 /dev/pts/1 &lt;---|------pbrun이 5,6,7,8 값을 가지고 있습니다.<br>pbrun      99780          31297    8u      CHR              136,1       0t0          4 /dev/pts/1 &lt;---|<br>pbrun      99780          31297    9u      CHR              136,1       0t0          4 /dev/pts/1 &lt;---+<br>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>pbrun프로세스의 해당동작이 정상동작인지 확인하시는 것을 권장드리며, <br>정상동작으로 확인된다면 앞서 안내해드린 워크어라운드로 해당 메세지의 출력을 막을수 있습니다.<br><br>감사합니다.<br><br><publishedDate>2017-08-24T08:41:51Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KS3Y8IAL"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-08-24T02:50:38Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-08-24T02:50:38Z</b><br><br>답변 감사합니다<br><br>마지막으로 한가지 더 문의드리겠습니다<br><br>고객에게서 문의가 왔는데요<br><br>문의 3번에서 <br>stdin/stdout/stderr 를 제외하면 그 당시에 어떠한 내용이 있었는지 자세한 어떤 이유로 메시지를 뿌린것인지 <br>확인이 가능한지 확인 부탁드립니다<br><br>메시지 로그 파일 보내드립니다<br>01번 sosreport는 파일 첨부가 안된거 같아 다시 보내드립니다<br><br><publishedDate>2017-08-24T02:50:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KRPcFIAX"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-08-22T08:04:13Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-08-22T08:04:13Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>sosreport 업로드해주셔서 감사합니다. 문의주신 내용에 아래와 같이 안내해드리겠습니다.<br><br>문의1:<br>PCRMAL01SL 서버의 로그에서 ip_local_port_range의 값이 saphostexec 프로세스에 의하여 변한 것을 확인하였습니다.<br><br># vim sos_commands/logs/journalctl_--all_--this-boot_--no-pager<br>Jul 23 17:50:10 PCRMAL01SL saphostexec[3295]: modified /proc/sys/net/ipv4/ip_local_port_range from 32768-60999 to 9000-65300 (SAP note 401162)<br><br>해당 프로세스가 새로운 커널파라메터값을 적용하는 자세한 원인에 관해서는 SAP에 문의하시기 바랍니다.<br><br>문의3:<br>man page 및 기술문서들을 참조해본 결과 에러가 아닌 file descriptor에 대한 warning 메세지인것으로 보입니다.<br>시스템의 동작에 영향이 없다면 해당 메세지는 무시하셔도 되는 메세지입니다.<br>lvm은 file descriptors가 0(stdin),1(stout),2(stderr) 가 아닐때 해당 warning 메세지를 출력합니다.<br>~~~~<br>$ man lvm<br><br>On invocation, lvm requires that only the standard file descriptors stdin,<br>stdout and stderr are available.  If others are found, they get closed and<br>messages are issued warning about the leak.<br>~~~~<br>warning 메세지가 출력되지 않게 하려면 아래와 같은 명령을 실행하시면 됩니다.<br># export LVM_SUPPRESS_FD_WARNINGS=1<br>해당 이슈에 관한 워크어라운드및 자세한 내용은 아래의 문서에서 확인하실수 있습니다.<br><br>[참고문서]<br>What is the meaning of the message: File descriptor 5 (/dev/pts/0) leaked on pvdisplay invocation. Parent PID 8593: bash <br>-https://access.redhat.com/solutions/49144<br><br>감사합니다.<br><br><publishedDate>2017-08-22T08:04:13Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KRO4WIAX"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-08-22T05:50:25Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-08-22T05:50:25Z</b><br><br>3번 내용에 sosreport 추가로 업로드 드립니다<br><br><publishedDate>2017-08-22T05:50:25Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KRMNZIA5"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-08-22T01:20:53Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-08-22T01:20:53Z</b><br><br>추가적으로 net.ipv4.ip_local_port_range 설정 값이 서로 다른 서버들이 있습니다<br>설정은 동일하지만 값에 차이가 있는데요 SAP이 설정된 서버와 설정되지 않은 non-SAP이 차이가 있는데요<br>검토 부탁드립니다 <br>쉽게 설명드려 같은 7.2 버전인데도 해당 값이 다릅니다 <br><br>설정 관련 아래 서버 sosreport를 dropbox에 업로드 하였습니다.<br> <br> SAP 설정된 서버       - sosreport-PCRMAL01SL-20170821183354.tar.xz<br> non-SAP default 서버 - sosreport-PDBEAL01SL-20170821183354.tar.xz<br><br>감사합니다<br><br><publishedDate>2017-08-22T01:20:53Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IscOoIAJ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-08-21T05:22:53Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-08-21T05:22:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>피드백 감사드립니다!<br><br>&gt;1번에서 sysctl.conf에 내용이 없는대도 장비별로 해당 값이 다른것은 &quot;랜덤&quot;하게 포트를 지정하기 때문인건가요?<br> <br>A.앞서 안내해드리는 과정에서 제가 문의주신 내용에 대해 정확하게 이해하지 못했던 것 같습니다.<br> 해당 커널파라메터의 default 값에 관하여 여러버전의 RHEL에서 확인해본 결과, <br> RHEL 5.11, RHEL 6.5, RHEL 6.7, RHEL 7.1, RHEL 7.2에서 모두 32768 61000으로 확인,<br> RHEL 6.9 에서는 32768 60999로 확인하였습니다.<br> 해당 default값이 RHEL 버전별로 어떻게 다른지 확인 부탁드리겠습니다.<br> <br>&gt;2번에서 &quot;한 디렉토리 내&quot;에서 생성할수 있는 file의 개수는 디렉토리 상관없이 파일시스템inode개수에 따라서 달라진다는 말씀이신가요? <br><br>A.네 말씀하신 것이 맞습니다.<br><br>&gt;3번에서 해당 메시지는 어떠한 경우에 발생하나요?<br><br>A. 조사에 의하면 설치된 upstart 패키지가 upstart-0.6.5-8.el6 보다 낮으면 버그로 인하여 이런 메세지가 출력될수 있는 버그를 확인하였습니다.<br> 만약 해당 패키지의 버전이 낮을 경우,upstart-0.6.5-8.el6 혹은 그이상의 버전으로 패키지를 업그레이드 하신후 이슈 재현여부를 확인해보시기 바랍니다. 버그가 픽스된 버전보다 같거나 높은데도 불구하고 여전히 이슈가 발생하신다면 sosreport를 수집하여 올려주시면 더 자세히 분석해보도록 하겠습니다.  <br><br>감사합니다.<br><br><publishedDate>2017-08-21T05:22:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IsbuYIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-08-21T04:13:37Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-08-21T04:13:37Z</b><br><br>답변 감사합니다<br><br>1번에서 sysctl.conf에 내용이 없는대도 장비별로 해당 값이 다른것은 &quot;랜덤&quot;하게 포트를 지정하기 때문인건가요?<br><br>2번에서 &quot;한 디렉토리 내&quot;에서 생성할수 있는 file의 개수는 디렉토리 상관없이 파일시스템inode개수에 따라서 달라진다는 말씀이신가요? <br><br>3번에서 해당 메시지는 어떠한 경우에 발생하나요? sosreport는 고객에게 문의하여 추가로 업로드하도록 하겠습니다<br> File descriptor 3 (pipe:[229680]) leaked on pvcreate invocation. Parent PID 5813: bash<br><br><publishedDate>2017-08-21T04:13:37Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IsbkhIAB"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-08-21T03:43:53Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-08-21T03:43:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>문의 주신 내용에 관해 아래와 같이 안내해드리겠습니다.<br><br>Q1) 1. net.ipv4.ip_local_port_range 값에 대한 문의<br>A1) 이 커널파라메터의 값이 구성되어지는 공식은 없고, 사용자에 의해 지정이 가능합니다. <br>    application이 특정 포트를 사용하지 않을 경우, 커널은 해당 커널파라메터 값을 참조하여 범위내에서 랜덤으로 포트를 지정하는 역할을 하게 됩니다.<br>    해당 파라메터는 default 값으로 32768   61000 로 설정되어 있으며, 최대 값을 65535까지 지정하실수 있으나, default값을 권장드립니다.<br>    시스템에서 커널파라메터의 설정된 값은 아래의 명령으로 확인하실수 있습니다.<br>    ~~~<br>    # sysctl -a | grep net.ipv4.ip_local_port_range<br>    net.ipv4.ip_local_port_range = 32768<br>61000<br>    ~~~<br><br>Q2) XFS 파일시스템에서 생성할수있는 하나의 디렉토리 내에 생성 가능한 디렉토리/ 파일 개수 확인<br>    디렉토리 내에 서브 디렉토리 생성부분은 unlimited로 확인 됩니다 <br>    그렇다면 한 디렉토리내에 생성할수 있는 file에 개수가 몇개인가요? inode값과 연관이 있는 것인가요?<br>A2) 아래의 참고문서[1]에 따르면 파일시스템에서는 생성가능한 inode 개수만큼 파일이 생성될수 있습니다. <br>    inode의 최대개수는 파일시스템내에서 inode가 차지할수 있는 크기에 따라 다릅니다. 파일시스템에서 <br>    차지할수 있는 inode의 크기의 조절방법은 아래 참고문서[2]에서 자세히 확인할수 있습니다. <br>    사이즈가 0인 파일의 생성가능한 최대 개수는 거의 unlimit라고 보실수 있습니다.<br><br>*참고문서*<br>[1] https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/ch07s03s02s02.html<br>[2] https://access.redhat.com/solutions/41492<br><br>Q3)해당 메시지가 원인이 무엇인지  확인 부탁드립니다<br>   File descriptor 3 (pipe:[229680]) leaked on pvcreate invocation. Parent PID 5813: bash<br><br>A3) 해당 메세지가 발생하는 시스템에서 sosreport를 수집하여 올려주시면 기존 사례및 기술문서 등을 통해 더 자세한 원인 조사가 가능할 것 같습니다. <br><br>감사합니다.<br><br><publishedDate>2017-08-21T03:43:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>