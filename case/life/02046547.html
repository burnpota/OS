======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-03-02T08:47:32Z</b><br><b>마지막 답변자 : Jay Shin</b><br><b>마지막 수정 일자 : 2018-03-12T00:02:09Z</b><br><b>id : 500A000000ZrvNmIAJ</b><br>======================<br><br><b><font size=15>
제목  : 스왑사용률관련
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>RHCS로 구성되어있는 시스템의 스왑이 63% 사용중입니다.<br>00:00:01    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad<br>00:10:01     24275264  42833592     63.83     85324      0.20<br>00:20:01     24275180  42833676     63.83     85276      0.20<br>00:30:01     24270564  42838292     63.83     85644      0.20<br>00:40:01     24261552  42847304     63.85     85700      0.20<br>....<br><br>sar의 내용을 보면<br>00:00:01     pswpin/s pswpout/s<br>00:10:01         3.28      0.10<br>00:20:01         0.01      0.04<br>00:30:01         0.03      1.97<br>00:40:01         0.00      3.82<br>00:50:01         0.02      2.25<br><br>00:00:01     pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff<br>00:10:01     10063.09    350.76  11441.97      0.56  16760.00   2397.88      2.71   2399.66     99.96<br>00:20:01     10210.57     97.48  10463.29      0.06  16259.20   2566.08      0.00   2566.00    100.00<br>00:30:01     10275.40    103.77  10647.61      0.06  16410.45   2658.46      2.39   2658.87     99.93<br>00:40:01     11058.27    112.57  10759.27      0.06  16780.61   2117.08      2.28   2115.41     99.81<br>00:50:01     11357.83    105.05  10299.47      0.04  17243.73   1183.78      0.00   1177.03     99.43<br><br> pswpin/s pswpout/s,pgpgin/s pgpgout/s   fault/s  majflt/s 발생을 보아 메모리가 부족한것으로 판단됩니다. <br><br>현재 물리 메모리의 증설없이 해당 부분을 해소하기 위해서<br>vm.swappiness = 60 부분을<br>vm.swappiness = 10으로 변경을 하고자 합니다.<br><br>위의 방법외에 다른 권고가 있으면 답변부탁드립니다.<br><br>추가적으로 궁금한 것이 있는데요.<br>1. <br>00:00:01     pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff<br>00:10:01     10063.09    350.76  11441.97      0.56  16760.00   2397.88      2.71   2399.66     99.96<br>00:20:01     10210.57     97.48  10463.29      0.06  16259.20   2566.08      0.00   2566.00    100.00<br><br>위와 같은 상황에서 majflt/s 심각도에 대해서 기준이 있나요? 예를들면 &quot;5가 넘으면 심각하다&quot; 와 같은것을요<br><br>2.  그리고<br>스왑은 한번 사용을 하게 되면 반환을 하지 않는 것으로 알고 있는데요.<br>00:00:01    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad<br>00:10:01     24275264  42833592     63.83     85324      0.20<br>00:20:01     24275180  42833676     63.83     85276      0.20<br>00:30:01     24270564  42838292     63.83     85644      0.20<br>00:40:01     24261552  42847304     63.85     85700      0.20<br>..생략<br>21:10:01     24147364  42961492     64.02   1166120      2.71<br>21:20:01     24145808  42963048     64.02   1166668      2.72<br>21:30:01     24144392  42964464     64.02   1168100      2.72<br>21:40:01     24140420  42968436     64.03   1169196      2.72<br>21:50:01     24140292  42968564     64.03   1170212      2.72<br>보시면 사용률이 줄어드는것을 확인 할수 있습니다.<br><br><br>답변부탁드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.4</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>FLPIDMM01 / FLPIDMM02</hostname><br><br><br><comment id="a0aA000000LuF3WIAV"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-03-12T00:02:06Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-03-12T00:02:05Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>본 기술 문의의 상태를 처리완료 상태로 변경하고자 합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 본 기술 문의를 *재개*하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-03-12T00:02:05Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LtTj3IAF"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-03-08T00:26:31Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-03-08T00:26:30Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 더 궁금한 사항이 있거나 추가적인 지원이 필요하신가요?<br><br>본 안내 후 일주일 이내에 별다른 답변이 없다면 자동으로 종료 상태가 된다는 것을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-03-08T00:26:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LsXHtIAN"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-03-04T23:30:53Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-03-04T23:30:53Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>말씀하신대로, 보여주신 로그에서 스왑 사용율이 63%에 달하고 있습니다.<br><br>00:00:01    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad<br>00:10:01     24275264  42833592     63.83     85324      0.20<br><br>majflt 가 관측되고 있고, pgscank/pgscand 가 상당량 보이며, 스캔 대비 회수율이 100%가 되고 있지 않습니다.<br>스캔이 발생하였다는 것은 시스템에 회수할 페이지를 즉시 찾기 힘들었다는 의미이며, 메모리 부족을 의미할 수 있습니다.<br><br>00:00:01     pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff<br>00:10:01     10063.09    350.76  11441.97      0.56  16760.00   2397.88      2.71   2399.66     99.96<br>00:20:01     10210.57     97.48  10463.29      0.06  16259.20   2566.08      0.00   2566.00    100.00<br>00:30:01     10275.40    103.77  10647.61      0.06  16410.45   2658.46      2.39   2658.87     99.93<br>00:40:01     11058.27    112.57  10759.27      0.06  16780.61   2117.08      2.28   2115.41     99.81<br>00:50:01     11357.83    105.05  10299.47      0.04  17243.73   1183.78      0.00   1177.03     99.43<br><br>&gt; pswpin/s pswpout/s,pgpgin/s pgpgout/s   fault/s  majflt/s 발생을 보아 메모리가 부족한것으로 판단됩니다. <br><br>&gt; 현재 물리 메모리의 증설없이 해당 부분을 해소하기 위해서<br>&gt; vm.swappiness = 60 부분을<br>&gt; vm.swappiness = 10으로 변경을 하고자 합니다.<br><br>&gt; 위의 방법외에 다른 권고가 있으면 답변부탁드립니다.<br><br>vm.min_free_kbytes 설정을 통해서 커널에 최소 여유 페이지를 늘릴 수 있습니다.<br><br>FLPIDMM01-2018022714341519709676]$ cat proc/sys/vm/min_free_kbytes <br>90112<br><br>  vm.<br>    dirty_ratio =  &quot;20&quot;  (% of total system memory)<br>    dirty_background_ratio =  &quot;10&quot;  (% of total system memory)<br>    dirty_expire_centisecs =  &quot;3000&quot;<br>    dirty_writeback_centisecs =  &quot;500&quot;<br>    swappiness [0-100] =  &quot;60&quot;<br><br>또한, dirty 값을 줄여서 dirty 캐시가 빨리 플러시되는 것을 기대해볼 수 있습니다.<br><br>[sysctl.conf]<br>vm.min_free_kbytes = 270336<br>vm.swappiness = 10<br>vm.dirty_ratio = 10<br>vm.dirty_background_ratio = 5<br>vm.dirty_expire_centisecs = 1000<br>vm.dirty_writeback_centisecs = 100<br><br># sysctl -p<br><br>또한, THP 기능을 비활성화하여, 페이지 단편화를 줄여 볼 수 있습니다.<br>transparent_hugepage=never<br>이 설정은 리부팅이 요구됩니다.<br><br>또한, IO 성능 향상을 위해 io scheduler 를 deadline 으로 설정해보시기 바랍니다.<br><br>[/boot/grub/grub.conf]<br><br>kernel /vmlinuz-2.6.32-358.23.2.el6.x86_64 ro root=UUID=ba907e16-910e-41c7-a074-4ed5a2d5ed37 rd_NO_LUKS rd_NO_LVM LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto  KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet nmi_watchdog=0 transparent_hugepage=never elevator=deadline<br><br><br>&gt; 추가적으로 궁금한 것이 있는데요.<br>&gt; 1. <br>&gt; 00:00:01     pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff<br>&gt; 00:10:01     10063.09    350.76  11441.97      0.56  16760.00   2397.88      2.71   2399.66     99.96<br>&gt; 00:20:01     10210.57     97.48  10463.29      0.06  16259.20   2566.08      0.00   2566.00    100.00<br><br>&gt; 위와 같은 상황에서 majflt/s 심각도에 대해서 기준이 있나요? 예를들면 &quot;5가 넘으면 심각하다&quot; 와 같은것을요<br><br>majflt 만 가지고 판단하기는 어려우며, 일반적으로 0 보다 큰 값이라면 디스크에서 메모리페이지가 로드되고 있다는 것을 의미합니다.<br><br>&gt; 2.  그리고<br>&gt; 스왑은 한번 사용을 하게 되면 반환을 하지 않는 것으로 알고 있는데요.<br>00:00:01    kbswpfree kbswpused  %swpused  kbswpcad   %swpcad<br>00:10:01     24275264  42833592     63.83     85324      0.20<br>00:20:01     24275180  42833676     63.83     85276      0.20<br>00:30:01     24270564  42838292     63.83     85644      0.20<br>00:40:01     24261552  42847304     63.85     85700      0.20<br>..생략<br>21:10:01     24147364  42961492     64.02   1166120      2.71<br>21:20:01     24145808  42963048     64.02   1166668      2.72<br>21:30:01     24144392  42964464     64.02   1168100      2.72<br>21:40:01     24140420  42968436     64.03   1169196      2.72<br>21:50:01     24140292  42968564     64.03   1170212      2.72<br>&gt;  보시면 사용률이 줄어드는것을 확인 할수 있습니다.<br><br>스왑사용이 늘었으며, 필요시에 swapoff -a/swapon -a 를 통해 스왑 메모리를 플러시하실 수도 있습니다만<br>운용중인 시스템에 영향을 줄 수 있으니, 점검 기간을 통해서 설정할 수 있습니다.<br><br>일전에 hung_task_timeout_secs 가 발생한적이 있어, 아래 파라메터가 0으로 변경되어있습니다.<br>10 으로 변경하여 추후 행이 발생하게 되면, 로그에 출력하게 해주시기 바랍니다.<br><br># echo 10 &gt; /proc/sys/kernel/hung_task_warnings<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-03-04T23:30:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>