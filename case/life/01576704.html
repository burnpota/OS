======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2016-02-02T05:35:30Z</b><br><b>마지막 답변자 : Meiyan Zheng</b><br><b>마지막 수정 일자 : 2016-03-09T06:44:03Z</b><br><b>id : 500A000000TSaoaIAD</b><br>======================<br><br><b><font size=15>
제목  : pacemaker 양쪽 노드 동시에 heartbit restart 시 정상적으로 fencing이 되지 않는 현상
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>두개노드중 한개노드는 정상 fencing을 통해서 정상 rebooting<br>다른 노드는 서버 hangup 상태로 정상적으로 fencing되지<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>pacemaker &amp; gfs2<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br> 성함(직급) : 김태현 선임<br> 회사명(부서명) : 삼성SDS<br> 전화번호 : 010-3734-0720<br> 메일주소 : th0720.kim@samsung.com<br> <br> * 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br> 성함(직급) : 송기호 선임<br> 회사명(부서명) : 타임게이트<br> 전화번호 : 010-3620-9917<br> 메일주소 : kh.song@time-gate.com / poporo01@naver.com ==============================================================================<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.1</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000GdoogIAB"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-03-09T06:44:02Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-03-09T06:44:01Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다.<br><br>본 케이스와 관련하여 지난 오랫동안 추가 업데이트가 없어 케이스를 처리 완료 하도록 하겠습니다. 만약 본 케이스와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.<br><br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발송됩니다. 고객님께서 남기 신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. 향후 기술  지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-03-09T06:44:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gb1vaIAB"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-02-29T08:22:09Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-02-29T08:22:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용 해 주셔서 감사합니다.<br><br><br>본 케이스와 관련 하여 오랫 동안 업데이트가 없어 보입니다.<br><br>혹시 어떻게 진행 되고 있으신가요? <br><br>만약 본 이슈와 관련 하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br><br>감사합니다.<br><br>Red Hat GSS<br>정미연<br><br><publishedDate>2016-02-29T08:22:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GAAcWIAX"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-02-04T05:12:57Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-02-04T05:12:57Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>heartbeat망 절체후 펜싱이 되었을때 reboot 되지 않는 것은 fence_scsi는 I/O fencing device이며 <br>reboot action를 support 되지 않기 때문입니다. <br><br>Feb  2 10:56:18 SLPAFIAL01 stonith-ng[147077]: warning: Agent 'fence_scsi' does not advertise support for 'reboot', performing 'off' action instead<br>Feb  2 10:56:20 slpafial02 stonith-ng[4791]: warning: Agent 'fence_scsi' does not advertise support for 'reboot', performing 'off' action instead\par<br><br><br>I/O fencing 작동시 등록된 디바이스와의 I/O만 차단 시키고 서버를 재부팅 시키지 않습니다. 그리고 <br>scsi 펜싱을 사용 하시면 ip resource가 정상적으로 failover 되지 않는 이슈등 발생 할수 있으며 <br>저희는 scsi fencing 보다 power fencing을 사용 하시는 것을 권장 해 드리고 있습니다. <br><br>heartbeat를 절체후 fencing 발생시 서버가 재부팅 되게끔 설정 하시려면 power fencing으로 바꾸시기 <br>바랍니다. <br><br><br>그리고 로그 내용을 확인 해 보니 노드 slpafial01이 정상적으로 slpafial02를 fencing 시킬수 있는 것으로 <br>보입니다. <br><br>Feb  2 10:56:18 SLPAFIAL01 stonith-ng[147077]:  notice: Operation 'reboot' [69177] (call 2 from stonith-api.69176) for host 'slpafial02-hb' with device 'scsi' returned: 0 (OK)<br>Feb  2 10:56:18 SLPAFIAL01 stonith-ng[147077]:  notice: Operation reboot of slpafial02-hb by slpafial01-hb for stonith-api.69176@slpafial01-hb.da940e46: OK<br>Feb  2 10:56:18 SLPAFIAL01 stonith-api[69176]: stonith_api_kick: Node 2/(null) kicked: reboot<br>Feb  2 10:56:18 SLPAFIAL01 stonith-api[69176]: stonith_api_time: Found 1 entries for 2/(null): 0 in progress, 1 completed<br>Feb  2 10:56:18 SLPAFIAL01 stonith-api[69176]: stonith_api_time: Node 2/(null) last kicked at: 1454378178<br><br><br>다만, 노드 slpafial02에서는 에러가 발생 하였으며 fencing이 실패 된 것으로 보입니다. fence_scsi 로 fencing 시도를 할시 <br>&quot;fence_scsi: Failed to verify 3 device(s)&quot; 와 같은 에러가 발생 하여 실패 되었습니다. 이것은 해당 노드가 이미 fencing <br>되어 다른 노드를 fencing 시킬수 없어 발생 된 에러입니다. <br><br>Feb  2 10:56:18 slpafial02 fence_scsi: Failed to verify 3 device(s)\par   &lt;====<br>Feb  2 10:56:19 slpafial02 fence_scsi: Failed to verify 3 device(s)\par   &lt;====<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]:   error: Operation 'reboot' [91577] (call 2 from stonith-api.91528) for host 'slpafial01-hb' with device 'scsi' returned: -201 (Generic Pacemaker error)\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [ WARNING:root:Parse error: Ignoring unknown option 'port=slpafial01-hb' ]\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [  ]\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [ ERROR:root:Failed to verify 3 device(s) ]\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [ Failed to verify 3 device(s) ]\par<br>======================<br>[Action Plan]<br><br>scsi fencing 보다 power fencing을 사용 하시는 것을 권장 해 드립니다. <br><br>혹은 power fencing을 추가 하여 level 1 fencing device로 사용 하시고 scsi fencing을 level 2 fencing device로 사용 하셔도 됩니다. <br>이와 같이 설정 하시면 cluster node를 fencing 시킬시 먼저 power fencing으로 fencing 시도 하고 만약 power fencing이 실패가 되면 <br>scsi fencing으로 장애 노드를 fencing 시키게 됩니다. <br><br>참고 자료:<br>How to configure/manage STONITH 'levels' in RHEL cluster with pacemaker ?<br>- https://access.redhat.com/solutions/891323<br>======================<br>감사합니다. <br><br>Red Hat GSS<br>정미연<br><br><publishedDate>2016-02-04T05:12:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GAAcRIAX"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-02-04T05:12:45Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-02-04T05:12:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>heartbeat망 절체후 펜싱이 되었을때 reboot 되지 않는 것은 fence_scsi는 I/O fencing device이며 <br>reboot action를 support 되지 않기 때문입니다. <br><br>Feb  2 10:56:18 SLPAFIAL01 stonith-ng[147077]: warning: Agent 'fence_scsi' does not advertise support for 'reboot', performing 'off' action instead<br>Feb  2 10:56:20 slpafial02 stonith-ng[4791]: warning: Agent 'fence_scsi' does not advertise support for 'reboot', performing 'off' action instead\par<br><br><br>I/O fencing 작동시 등록된 디바이스와의 I/O만 차단 시키고 서버를 재부팅 시키지 않습니다. 그리고 <br>scsi 펜싱을 사용 하시면 ip resource가 정상적으로 failover 되지 않는 이슈등 발생 할수 있으며 <br>저희는 scsi fencing 보다 power fencing을 사용 하시는 것을 권장 해 드리고 있습니다. <br><br>heartbeat를 절체후 fencing 발생시 서버가 재부팅 되게끔 설정 하시려면 power fencing으로 바꾸시기 <br>바랍니다. <br><br><br>그리고 로그 내용을 확인 해 보니 노드 slpafial01이 정상적으로 slpafial02를 fencing 시킬수 있는 것으로 <br>보입니다. <br><br>Feb  2 10:56:18 SLPAFIAL01 stonith-ng[147077]:  notice: Operation 'reboot' [69177] (call 2 from stonith-api.69176) for host 'slpafial02-hb' with device 'scsi' returned: 0 (OK)<br>Feb  2 10:56:18 SLPAFIAL01 stonith-ng[147077]:  notice: Operation reboot of slpafial02-hb by slpafial01-hb for stonith-api.69176@slpafial01-hb.da940e46: OK<br>Feb  2 10:56:18 SLPAFIAL01 stonith-api[69176]: stonith_api_kick: Node 2/(null) kicked: reboot<br>Feb  2 10:56:18 SLPAFIAL01 stonith-api[69176]: stonith_api_time: Found 1 entries for 2/(null): 0 in progress, 1 completed<br>Feb  2 10:56:18 SLPAFIAL01 stonith-api[69176]: stonith_api_time: Node 2/(null) last kicked at: 1454378178<br><br><br>다만, 노드 slpafial02에서는 에러가 발생 하였으며 fencing이 실패 된 것으로 보입니다. fence_scsi 로 fencing 시도를 할시 <br>&quot;fence_scsi: Failed to verify 3 device(s)&quot; 와 같은 에러가 발생 하여 실패 되었습니다. 이것은 해당 노드가 이미 fencing <br>되어 다른 노드를 fencing 시킬수 없어 발생 된 에러입니다. <br><br>Feb  2 10:56:18 slpafial02 fence_scsi: Failed to verify 3 device(s)\par   &lt;====<br>Feb  2 10:56:19 slpafial02 fence_scsi: Failed to verify 3 device(s)\par   &lt;====<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]:   error: Operation 'reboot' [91577] (call 2 from stonith-api.91528) for host 'slpafial01-hb' with device 'scsi' returned: -201 (Generic Pacemaker error)\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [ WARNING:root:Parse error: Ignoring unknown option 'port=slpafial01-hb' ]\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [  ]\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [ ERROR:root:Failed to verify 3 device(s) ]\par<br>Feb  2 10:56:19 slpafial02 stonith-ng[4791]: warning: scsi:91577 [ Failed to verify 3 device(s) ]\par<br>======================<br>[Action Plan]<br><br>scsi fencing 보다 power fencing을 사용 하시는 것을 권장 해 드립니다. <br><br>혹은 power fencing을 추가 하여 level 1 fencing device로 사용 하시고 scsi fencing을 level 2 fencing device로 사용 하셔도 됩니다. <br>이와 같이 설정 하시면 cluster node를 fencing 시킬시 먼저 power fencing으로 fencing 시도 하고 만약 power fencing이 실패가 되면 <br>scsi fencing으로 장애 노드를 fencing 시키게 됩니다. <br><br>참고 자료:<br>How to configure/manage STONITH 'levels' in RHEL cluster with pacemaker ?<br>- https://access.redhat.com/solutions/891323<br>======================<br>감사합니다. <br><br>Red Hat GSS<br>정미연<br><br><publishedDate>2016-02-04T05:12:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G9xEXIAZ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-02-03T06:40:55Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-02-03T06:40:54Z</b><br><br>안녕하세요.<br>질문에대한 답변드리겠습니다.<br>======================<br>핫빗망 재기동시 펜싱이 되지 않는 이슈에 대해 좀더 확인 할 부분이 있어 아래와 같이 추가적인 확인 요청을 드립니다.  <br><br>1. 수동으로 fence_scsi로 클러스터 노드를 펜싱 시킬수 있으신가요? 불가능합니다.<br>   # pcs stotnith fence &lt;node&gt;<br>2. 노드 slpafial01에서도 동일하게 펜싱이 되지 않는지요?  slpafial01 에서는 펜싱을 즉, reboot을 하지 않았습니다. slpafial02 쪽만 hangup<br>3. 11:12:21에 노드 slpafial02를 수동으로 재부팅 시킨 것인가요? 네<br>4. slpafial01의 messages 로그를 보내 주실수 있으신가요? 파일 첨부 해드립니다.<br><br>추가적으로 자세히 설명드리면 <br><br>slpafial01 slpafial02 는 cluster 입니다.<br><br>heartbit가 절체 되었을때<br>slpafial01는 fencing되지 않았고<br>slpafial02는 fencing되었습니다.<br><br>각각의 fencing action이 rebooting으로 되어있는데<br>rebooting이 되지 않고<br>slpafial02 가 hangup이 되어서<br>강제 종료를 진행하였습니다.<br><br>이상입니다.<br><br>감사합니다.<br><br>(Zheng, Meiyan에 회신)<br>&gt; 안녕하세요,<br>&gt; <br>&gt; Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br>&gt; <br>&gt; <br>&gt; 보내 주신 메시지 로그 파일로 확인 해 드린 내용을 아래와 같이 정리 해 드립니다. <br>&gt; <br>&gt; <br>&gt; - 2월 2일 10시 56분 경 노드 slpafial01의 핫빗이 끊어 진 것으로 인식 되었음 <br>&gt; Feb  2 10:56:00 slpafial02 corosync[3918]: [TOTEM ] A processor failed, forming new configuration.\par<br>&gt; <br>&gt; <br>&gt; - slpafial02에서 slpafial01이 클러스터 멤버가 아님으로 펜싱 시도를 시작 하였음  <br>&gt;   slpafial01을 펜싱 시킬수 있는 펜싱 디바이스는 scsi인 것으로 확인 되었음 <br>&gt; Feb  2 10:56:18 slpafial02 pengine[4794]: warning: Node slpafial01-hb will be fenced because the node is no longer part of the cluster\par<br>&gt; ...<br>&gt; Feb  2 10:56:18 slpafial02 stonith-ng[4791]:  notice: scsi can fence (reboot) slpafial01-hb: static-list\par<br>&gt; <br>&gt; <br>&gt; - slpafial01을 몇 번 펜싱 시도를 하였지만 펜싱이 계속 fail 되었음 <br>&gt; Feb  2 10:56:25 slpafial02 fence_scsi: Failed to verify 3 device(s)\par<br>&gt; <br>&gt; <br>&gt; - 그리고 10:56:25에 slpafial01이 다시 클러스터에 조인 된 것으로 보임 <br>&gt; Feb  2 10:56:25 slpafial02 corosync[3918]: [TOTEM ] A new membership (192.168.1.113:3108) was formed. Members joined: 1\par<br>&gt; <br>&gt; <br>&gt; - slpafial02에서 corosync가 kill 되어 corosync를 다시 기동 시키는 도중에 재부팅 되었음 <br>&gt; Feb  2<br><br><publishedDate>2016-02-03T06:40:54Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000G9vVWIAZ"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2016-02-03T01:55:57Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2016-02-03T01:55:57Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>보내 주신 메시지 로그 파일로 확인 해 드린 내용을 아래와 같이 정리 해 드립니다. <br><br><br>- 2월 2일 10시 56분 경 노드 slpafial01의 핫빗이 끊어 진 것으로 인식 되었음 <br>Feb  2 10:56:00 slpafial02 corosync[3918]: [TOTEM ] A processor failed, forming new configuration.\par<br><br><br>- slpafial02에서 slpafial01이 클러스터 멤버가 아님으로 펜싱 시도를 시작 하였음  <br>  slpafial01을 펜싱 시킬수 있는 펜싱 디바이스는 scsi인 것으로 확인 되었음 <br>Feb  2 10:56:18 slpafial02 pengine[4794]: warning: Node slpafial01-hb will be fenced because the node is no longer part of the cluster\par<br>...<br>Feb  2 10:56:18 slpafial02 stonith-ng[4791]:  notice: scsi can fence (reboot) slpafial01-hb: static-list\par<br><br><br>- slpafial01을 몇 번 펜싱 시도를 하였지만 펜싱이 계속 fail 되었음 <br>Feb  2 10:56:25 slpafial02 fence_scsi: Failed to verify 3 device(s)\par<br><br><br>- 그리고 10:56:25에 slpafial01이 다시 클러스터에 조인 된 것으로 보임 <br>Feb  2 10:56:25 slpafial02 corosync[3918]: [TOTEM ] A new membership (192.168.1.113:3108) was formed. Members joined: 1\par<br><br><br>- slpafial02에서 corosync가 kill 되어 corosync를 다시 기동 시키는 도중에 재부팅 되었음 <br>Feb  2 10:56:25 slpafial02 corosync[3918]: [CFG   ] Killed by node 1: dlm_controld\par<br>Feb  2 10:56:25 slpafial02 corosync[3918]: [MAIN  ] Corosync Cluster Engine exiting with status -1 at cfg.c:530.\par<br>...<br>Feb  2 10:56:25 slpafial02 systemd: Unit corosync.service entered failed state.\par<br>Feb  2 10:56:25 slpafial02 systemd: corosync.service failed.\par<br>Feb  2 10:56:25 slpafial02 systemd: pacemaker.service holdoff time over, scheduling restart.\par<br><br><br>핫빗망 재기동시 펜싱이 되지 않는 이슈에 대해 좀더 확인 할 부분이 있어 아래와 같이 추가적인 확인 요청을 드립니다.  <br><br>1. 수동으로 fence_scsi로 클러스터 노드를 펜싱 시킬수 있으신가요?<br>   # pcs stotnith fence &lt;node&gt;<br>2. 노드 slpafial01에서도 동일하게 펜싱이 되지 않는지요? <br>3. 11:12:21에 노드 slpafial02를 수동으로 재부팅 시킨 것인가요? <br>4. slpafial01의 messages 로그를 보내 주실수 있으신가요?<br><br><br>추가적으로 케이스 오픈 하실시에 지정 하신 심각도는 2입니다만 Red Hat 기술문의 심각도 정의에 의하면 보내 <br>주신 문의 사항은 심각도 3에 해당 합니다.<br> <br>Red Hat 기술 문의 심각도 정의와 관련하여 하기의 URL를 참고 하시기 바랍니다.<br>https://access.redhat.com/support/policy/severity/<br><br>다음 코멘트에 심각도와 관련한 내용에 대해  별도 언급이 없으신경우 본 케이스의 심각도를 3으로 조절 하도록 <br>해드리겠으니 이점에 대해 미리 양해 부탁드립니다.<br>======================<br>감사합니다. <br><br>Red Hat GSS<br>정미연<br><br><publishedDate>2016-02-03T01:55:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>