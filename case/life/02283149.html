======================<br><b>생성계정 : JIMIN KIM</b><br><b>생성날짜 : 2018-12-31T05:41:24Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2019-01-22T11:05:41Z</b><br><b>id : 5002K00000d6BeJQAU</b><br>======================<br><br><b><font size=15>
제목  : 복제한 datastore에서 인식 시킨 볼륨에 대해서 xfs_repair 시 오류 발생 관련 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다. <br><br>복제한 datastore에서 인식시킨 볼륨에 대해서 xfs_repair 수행 시 <br>아래와 같이 오류가 발생하여 문의드립니다.<br><br>그냥 mount를 하면 정상적으로 mount가 되고 <br>umount 후 다시 xfs_repair를 수행하면 정상적으로 수행이되는데<br>복제 볼륨에 대해서 처음 mount 전에 xfs_repair를 수행하면 아래와 같은 오류가 발생합니다.<br><br>root@SLDTSSAL03 /sysadmin/DR/MOUNT # ./mount.sh<br>  Volume group &quot;LRPTSSAPPVG&quot; is not exported<br>  1 logical volume(s) in volume group &quot;LRPTSSAPPVG&quot; now active<br>Phase 1 - find and verify superblock...<br>Phase 2 - using internal log<br>        - zero log...<br>ERROR: The filesystem has valuable metadata changes in a log which needs to<br>be replayed.  Mount the filesystem to replay the log, and unmount it before<br>re-running xfs_repair.  If you are unable to mount the filesystem, then use<br>the -L option to destroy the log and attempt a repair.<br>Note that destroying the log may cause corruption -- please attempt a mount<br>of the filesystem before doing this.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLDTSSAL03</hostname><br><br><br><comment id="a0a2K00000OlLoIQAV"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2019-01-02T05:12:39Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2019-01-02T05:12:38Z</b><br><br>안녕하세요? 레드해 허경입니다.<br><br>xfs_repair 맨페이지를 보시면 아래와 같은 옵션이 있습니다. <br>메시지에 언급되어 있듯이 ERROR 메시지가 나오지 않게 하려면 -L 옵션을 추가하시면 됩니다. 하지만, 이렇게 할 경우 파일시스템 손상의 우려가 있습니다.<br><br>       -L     Force Log Zeroing.  Forces xfs_repair to zero the log even if it<br>              is  dirty  (contains  metadata changes).  When using this option<br>              the filesystem will likely appear to be corrupt, and  can  cause<br>              the loss of user files and/or data.<br><br>따라서, 먼저 mount를 시도하고 mount가 안될 경우에 xfs_repair 파일시스템을 복구한 후 mount 하도록 스크립트를 조정하는 것이 바람직해보입니다.<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2019-01-02T05:12:38Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OlD79QAF"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2018-12-31T08:23:15Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2018-12-31T08:23:15Z</b><br><br>안녕하세요 <br><br>SDS 김지민 선임입니다.<br><br>umount 와 mount 과정에서 lvchange -an으로 deactive 과정을 추가하였는데<br>동일한 증상이 발생해서 결과 첨부합니다.<br><br>root@SLDTSSAL01 /sysadmin/DR/MOUNT # ./mount.sh<br>  Volume group &quot;LRPTSSAPPVG&quot; is not exported<br>  1 logical volume(s) in volume group &quot;LRPTSSAPPVG&quot; now active<br>Phase 1 - find and verify superblock...<br>Phase 2 - using internal log<br>        - zero log...<br>ERROR: The filesystem has valuable metadata changes in a log which needs to<br>be replayed.  Mount the filesystem to replay the log, and unmount it before<br>re-running xfs_repair.  If you are unable to mount the filesystem, then use<br>the -L option to destroy the log and attempt a repair.<br>Note that destroying the log may cause corruption -- please attempt a mount<br>of the filesystem before doing this.<br>root@SLDTSSAL01 /sysadmin/DR/MOUNT # cat mount.sh<br>#!/bin/bash<br>cp /sysadmin/DR/MOUNT/fstab_DR /etc/fstab<br><br>vgimport LRPTSSAPPVG<br><br>vgchange -ay LRPTSSAPPVG<br><br>lvchange -ay /dev/LRPTSSAPPVG/APP<br><br>xfs_repair /dev/LRPTSSAPPVG/APP<br><br>mount -a<br><br><br>감사합니다.<br><br><publishedDate>2018-12-31T08:23:15Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000OlCZyQAN"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-12-31T06:24:53Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-12-31T06:24:53Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>유선상으로 말씀드린것처럼 vgexport 전에 vgchange -an 명령으로 비활성화시킨후에 vgexport를 해야하는 것으로 보입니다.<br><br>root@SLDTSSAL03 /sysadmin/DR/MOUNT # ./mount.sh<br>  Volume group &quot;LRPTSSAPPVG&quot; is not exported   &lt;===== 이 부분을 보면 export되지 않은 것처럼 보입니다.<br><br>VG를 옮길 때 절차를 참고하시기 바랍니다.<br><br>1. Make sure that no users are accessing files on the active volumes in the volume group, then unmount the logical volumes.<br>2. Use the -a n argument of the vgchange command to mark the volume group as inactive, which prevents any further activity on the volume group.<br>3. Use the vgexport command to export the volume group. This prevents it from being accessed by the system from which you are removing it.<br><br>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/logical_volume_manager_administration/vg_admin#VG_move<br><br>xfs_repair 관련하여 아래 문서도 참고하시기 바랍니다.<br><br>https://access.redhat.com/discussions/3263661<br>https://access.redhat.com/solutions/140543<br><br>고맙습니다.<br>허 경 드림<br><br><publishedDate>2018-12-31T06:24:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>