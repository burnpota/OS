======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2016-03-22T06:13:07Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2016-08-26T10:00:32Z</b><br><b>id : 500A000000TtA65IAF</b><br>======================<br><br><b><font size=15>
제목  : Need to diagnosis and analysis why httpd processes become defunct status at kernel side ? [ apache defunct ]
</font></b><br><br>======================<br><actionPlan>// Collaboration Note<br><br><br>[ Environments ]<br><br>Red Hat Enterprise Linux 7.1 &amp; 7.2<br><br><br>[ Issue ]<br><br>httpd process become defunct status and there are a lot of &quot;apr_proc_mutex_lock failed...&quot; messages in apache's error_log.<br><br><br>[ Actions performed so far ]<br><br>From my perspective, it is very similar to content of the following mailing lists [1].<br>[1] http://mail-archives.apache.org/mod_mbox/httpd-users/201512.mbox/%3Cloom.20151230T024619-888@post.gmane.org%3E<br><br>They applied &quot;Mutex sem&quot; directives in httpd.conf by my ( Jack ) suggestions and then provided Korean explanation of <br>this situation after understanding the above apache manual [1]<br>[2] https://httpd.apache.org/docs/2.4/mod/core.html#mutex<br>    <br>From oracle, there are not proper solutions at weblogic side for this issue. they just reminded again that it's related<br>to apache as described at doc[1]<br><br>Customer still monitoring if it is effective for this issue. but, issue has not been happened so far.<br>But, they are still complaining about applying &quot;Mutex sem&quot; is really right resolutions for this issue.<br>So, they want to know root cause.<br><br><br>[ Findings of SME Okuda san in SBR webserver ]<br><br>FYI, Reproducing this issue with weblogic is possible by customer.<br><br>Below is Okuda's diagnosis step &amp; explanation to know the root cause of this issue. he analysed the status<br>of semaphore after reproducing issue with following scripts attached on the case.<br><br>$ ./seminfo.sh &gt; seminfo.out<br><br><br>The error message &quot;apr_proc_mutex_lock failed. Attempting to shutdown process gracefully.&quot; is written in accept_mutex_error in httpd-2.4.6/server/mpm/worker/worker.c.<br><br>    658 static void accept_mutex_error(const char *func, apr_status_t rv, int process_slot)<br>    659 {<br>    ...<br>    675     ap_log_error(APLOG_MARK, level, rv, ap_server_conf, APLOGNO(00273)<br>    676                  &quot;apr_proc_mutex_%s failed. Attempting to &quot;<br>    677                  &quot;shutdown process gracefully.&quot;, func);<br><br><br>The accept_mutex_error() is invoked in listener_thread() when apr_proc_mutex_lock() fails:<br><br>    681 static void * APR_THREAD_FUNC listener_thread(apr_thread_t *thd, void * dummy)<br>    682 {<br>    ...<br>    762         if ((rv = SAFE_ACCEPT(apr_proc_mutex_lock(accept_mutex)))<br>    763             != APR_SUCCESS) {<br>    764 <br>    765             if (!listener_may_exit) {<br>    766                 accept_mutex_error(&quot;lock&quot;, rv, process_slot);<br>    767             }<br>    768             break;                    /* skip the lock release */<br>    769         }<br><br><br>When the &quot;Mutex&quot; directive is not specified, the &quot;sysvsem&quot;(System V semaphore) is used in httpd. Threrefore, semop() is invoked finally.<br><br>As I reviewed the log file, max seg size and max total share memory are obviously too large.<br><br>=========================================================<br>ipcs -lm<br><br>------ Shared Memory Limits --------<br>max number of segments = 4096<br>max seg size (kbytes) = 18014398509465599<br>max total shared memory (kbytes) = 18014398442373116<br>min seg size (bytes) = 1<br><br><br>And there is no semaphore.<br><br>=========================================================<br>ipcs -s<br><br>------ Semaphore Arrays --------<br>key        semid      owner      perms      nsems     <br><br><br>Since there is no semaphore, the process can not acquire semaphore, because semop() fails. It is the direct cause.<br><br>I'm not sure why. Need to take sosreport and assistance from platform team.<br><br><br>[ Suggestions of SME, DKwon in SBR kernel and Current Situation ]<br><br>It looks like it was failed to access semaphore as the related semaphore ID doesn't exist. My understanding is you were taking this strace on a running process. To check what is happening when it calls 'semget()', would you mind to run the process with the below format instead? <br><br>$ strace -s 4096 -fvttTo strace.txt &lt;application to run&gt;<br><br>But, Above command does not work with the following error messages.<br><br>(98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:80<br>no listening sockets available, shutting down<br>AH00015: Unable to open logs<br>======================<br>[ Questions &amp; Expectations ]<br><br>Q1) How can we diagnosis this problem at kernel side and how to fix it unless applying &quot;Mutex sem&quot; in httpd.conf ?<br>Q2) How can we explain this issue technically in more detail ?<br>Q3) If this issue is due to kernel bug, can we open bugzilla and request hotfix request ?<br><br><br>Thanks,<br>Jack, Jmoon</actionPlan><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>아래와 같이 apache 프로세스 &lt;defunct&gt; 되는 현상이 자주 발생하고 있습니다.<br> <br>weblogic@SLPAFIEL01 /home/weblogic # ps -ef |grep http <br> <br>weblogic 3728 13364 0 16:24 ? 00:00:00 [httpd] weblogic 3757 3387 0 16:24 pts/3 00:00:00 grep --color=auto http root 13364 1 0 Mar17 ? 00:00:05 /APP/apache/bin/httpd -f /APP/apache/conf/httpd.conf -k start <br> <br>혹시 해당 문제점을 해결하기 위해 필요한 로그나 절차가  있으시면 가이드 부탁 드립니다.<br><br>문제 해결 기간 및  긴급도와 관련된 정보를 제공해 주시겠습니까?<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 박우진 (선임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  +82-10-2062-0157<br>- 메일주소 : 박우진 &lt;ewoojinn.park@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(선임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 2 (High)</b><br>======================<br><comment id="a0aA000000G6aznIAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-08-18T08:57:53Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-08-18T08:58:43Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q) 아래 작업진행에 대해서<br><br>1) /etc/systemd/logind.conf 를 편집기로 열어서 아래의 라인을 추가합니다.<br># vi /etc/systemd/logind.conf<br>~~ 생략<br>RemoveIPC=no<br><br>3) /etc/systemd/logind.conf 를 편집기로 열어서 기존의 설정내용을 아래와 같이 주석처리하거나 삭제합니다.<br>$ vi /etc/systemd/logind.conf<br>~~ 생략<br># RemoveIPC=no<br><br>서로 작업 진행이 다른데요.<br>어떠한 것으로 해야 하나요?<br><br><br>A) 1) 은 버그가 수정된 패키지를 업데이트하지 않고 Workaround 를 적용하는 방법에서 쓰이는 옵션이고,<br>   2) 는 Workaround 를 적용하지 않고, 수정된 패키지를 업데이트해서 문제해결을 위해서 적용하는 옵션<br>      이라고 이해하시면 될거 같습니다.<br><br>   RemoveIPC 에 대한 설명은 아래 참고문서[1]에서 확인하실 수 있으시며, 간략하게 설명을 하자면 사용자가 완전히<br>   로그아웃할때 사용자에게 소속된 System V 와 POSIX IPC 오브젝트를 삭제할지 그렇지 않을지를 결정하는 옵션입<br>   니다.<br><br><br>[ 참고문서 ]<br><br>[1] Applications using IPC (semaphores, shared memory, message queues) have problems after update to RHEL 7.2<br>- https://access.redhat.com/solutions/2062273<br><br><br>감사합니다.<br><br><publishedDate>2016-08-18T08:57:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G6alRIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-08-18T08:43:07Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-08-18T08:43:07Z</b><br><br>안녕하세요.<br>아래 작업진행에 대해서<br>1) /etc/systemd/logind.conf 를 편집기로 열어서 아래의 라인을 추가합니다.<br># vi /etc/systemd/logind.conf<br>~~ 생략<br>RemoveIPC=no<br><br>3) /etc/systemd/logind.conf 를 편집기로 열어서 기존의 설정내용을 아래와 같이 주석처리하거나 삭제합니다.<br>$ vi /etc/systemd/logind.conf<br>~~ 생략<br># RemoveIPC=no<br><br>서로 작업 진행이 다른데요.<br>어떠한 것으로 해야 하나요?<br><br>추가적으로 RemoveIPC는 yes와 no의 차이점도 간단히 설명 부탁드립니다.<br><br>감사합니다.<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 김태현 (선임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  82-10-3734-0720<br>- 메일주소 : 김태현 &lt;th0720.kim@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(책임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================<br><br><publishedDate>2016-08-18T08:43:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000G6LlkIAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-08-17T07:59:20Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-08-17T07:59:20Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저희 폐사 오희영 차장을 통해서 전달을 받은것은 지난 8월 11일 고객께서 자체적으로 저희가 제공을 해드린 패키지를<br>업데이트를 할것이라고 하였습니다. 그래서, 현재 고객께서 해당작업을 진행하셨는지 확인을 해볼필요가 있을거 같습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-08-17T07:59:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000G6KaMIAV"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2016-08-17T05:33:56Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2016-08-17T05:33:56Z</b><br><br>안녕하세요! <br>RHEL7 bundle HTTPD server(apache 2.4.x) 의 defunct 관련하여 아직 미적용되었습니다. <br><br>지난 8월 3일 오희영 차장께서 별도의 일정으로 연락주신다하였는데 고객(삼성생명 정보전략그룹)으로 별다른 연락이 없습니다. <br><br>해당 건 조속히 진행을 요청드립니다. <br><br>확인요청드립니다.<br><br><publishedDate>2016-08-17T05:33:56Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HYuHNIA1"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-08-04T01:56:04Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-08-04T01:56:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>어제 폐사 CSM 인 오희영 차장을 통해서 systemd 업데이트 작업을 진행하신다고 들었는데, 혹시 작업진행 사항이 어떻게 되셨는지 피드백 주시겠습니까?<br><br>감사합니다.<br><br><publishedDate>2016-08-04T01:56:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HKbXhIAL"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-06-22T06:55:24Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-06-22T07:33:05Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>금일 폐사 Account Manager 이신 목명균 이사님과 고객분이 미팅을 가졌었고, 저희가 현재 제공이 가능한<br>패치를 적용하는 방법을 요청을 하셔서 그 내용을 아래와 같이 안내를 드립니다.<br><br><br>- 아 래<br><br>1) 먼저 케이스에 업로드 해놓은 아래의 패키지들을 다운로드 합니다.<br><br>libgudev1-219-19.el7_2.4.x86_64.rpm<br>systemd-sysv-219-19.el7_2.4.x86_64.rpm<br>systemd-libs-219-19.el7_2.4.x86_64.rpm<br>systemd-219-19.el7_2.4.x86_64.rpm<br><br><br>2) 아래의 rpm 명령어로 이 패키지들을 모두 업데이트 합니다.<br><br>[root@localhost ~]$ rpm -Uvh systemd-* libgudev1-219-19.el7_2.4.x86_64.rpm <br>warning: systemd-219-19.el7_2.4.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID fd431d51: NOKEY<br>Preparing...                          ################################# [100%]<br>Updating / installing...<br>   1:systemd-libs-219-19.el7_2.4      ################################# [ 13%]<br>   2:systemd-219-19.el7_2.4           ################################# [ 25%]<br>   3:systemd-sysv-219-19.el7_2.4      ################################# [ 38%]<br>   4:libgudev1-219-19.el7_2.4         ################################# [ 50%]<br>Cleaning up / removing...<br>   5:systemd-sysv-219-19.el7          ################################# [ 63%]<br>   6:systemd-219-19.el7               ################################# [ 75%]<br>   7:libgudev1-219-19.el7             ################################# [ 88%]<br>   8:systemd-libs-219-19.el7          ################################# [100%]<br><br><br>3) /etc/systemd/logind.conf 를 편집기로 열어서 기존의 설정내용을 아래와 같이 주석처리하거나 삭제합니다.<br>$ vi /etc/systemd/logind.conf<br>~~ 생략<br># RemoveIPC=no<br><br>4) 위의 변경사항이 반영이 되도록 systemd-logind 서비스를 재시작합니다.<br>$ systemctl restart systemd-logind.service<br><br>5) Apache 웹서버를 재시작 합니다.<br>$ systemctl restart httpd.service<br><br><br>[ Note ]<br><br>위의 작업절차는 실제 서비스 환경에서도 즉시 적용이 가능하나, mission critical 한 경우에는<br>systemd-logind 나 httpd 서비스가 재시작을 하면서 애플리케이션을 보고 있는 사용자들에게는<br>일시적인 지연현상이 발생을 할 수 있으니 가능한 정기 유지보수 기간에 적용하시고, 모두 적용한 이<br>후 에는 가급적 reboot 을 하셔서 모든 설정이나 리소스들이 초기화가 될 수 있도록 하는것을 권장<br>드립니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-06-22T06:55:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HKaqOIAT"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-06-22T05:13:59Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-06-22T05:13:59Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>요청하신 workaround 를 적용하는 절차는 아래와 같습니다.<br><br>1) /etc/systemd/logind.conf 를 편집기로 열어서 아래의 라인을 추가합니다.<br># vi /etc/systemd/logind.conf<br>~~ 생략<br>RemoveIPC=no<br><br>2) 위의 변경사항이 반영이 되도록 systemd-logind 서비스를 재시작합니다.<br># systemctl restart systemd-logind.service<br><br>3) Apache 웹서버를 재시작 합니다.<br># systemctl restart httpd.service<br><br><br>[ Note ]<br><br>어제 유선상으로 통화를 마친 이후에 폐사의 삼성생명 Account 담당자이신 목명균 이사님과 본 이슈의 향후 방향에<br>대해서 의논을 하였는데 이전에 miss-communication 으로 인해서 본 이슈를 근본적으로 해결할 수 있는 patch<br>가 나온 상태인데도 불구하고 적용이 되지 않은거 같아서 가능하면 향후에 이 patch 가 적용이 되도록 고객께 안내<br>를 드리는것으로 의견을 모은 상태입니다. 이에 대해서는 저희 Account 담당자나 혹은 CSM 을 통해서 별도로 전달<br>이 예정이오니 참고하시길 바랍니다.<br><br><br>[ 참고문서 ]<br><br>[1] Applications using IPC (semaphores, shared memory, message queues) have problems after update to RHEL 7.2<br>- https://access.redhat.com/solutions/2062273<br><br><br>감사합니다.<br><br><publishedDate>2016-06-22T05:13:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HKalnIAD"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-06-22T04:59:52Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-06-22T04:59:52Z</b><br><br>안녕하세요.<br><br>어제 유선으로 얘기 주신 workarround 적용 절차를 다시 알려주시기 바랍니다.<br>실제로 고객사에서 절차대로 적용하였는 지 확인을 위함 입니다.<br><br>감사합니다.<br><br><publishedDate>2016-06-22T04:59:52Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HKXHqIAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-06-22T00:23:49Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-06-22T00:23:49Z</b><br><br>안녕하세요<br><br>어제 유선으로 목명균 이사님이 절차 관련해서 가이드를 다시 주시면 이와 관련 하여 확인 할 것이라고 했는데<br>workarround 적용 절차 다시 보내 주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2016-06-22T00:23:49Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HKMQ0IAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-06-21T08:54:32Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-06-21T08:54:32Z</b><br><br>안녕하세요.<br><br>연락처 전달 합니다.<br>이의준 수석 010-8856-1085<br><br>이상입니다.<br><br><publishedDate>2016-06-21T08:54:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HKLv2IAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-06-21T08:01:15Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-06-21T08:01:15Z</b><br><br>안녕하세요<br><br>이 이슈에 대해서 두가지 가이드가 있었는데 이슈가 발생한 검증 서버에는<br>systemd-219-19.el7_2.4 패키지는 설치 되어 있지 않고 workarround(&quot;RemoveIPC=no&quot; 적용)만 적용되어 테스트 중이었습니다.<br>그리고 일단 sosreport는 이전에도 수집 문제가 있어 고생한 적이 있어 고객측에는 Redhat에서 직접 수집 하여 가기를 원합니다.<br><br>감사합니다.<br><br><publishedDate>2016-06-21T08:01:15Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HKK8YIAX"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-06-21T06:50:10Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-06-21T06:50:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>올려주신 로그에는 문제의 원인을 파악할만한 내용이 존재하지 않아서 시스템의 로그나 apache 의 로그를 다시 보려고 하는데,<br>이 이슈가 수정된 systemd-219-19.el7_2.4 패키지가 설치되어서 이슈가 재발되어졌던 시스템의 sosreport 를 올려봐주<br>시겠습니까?<br><br>향후에 새로운 디버깅 단계의 진입이 있을수도 있으니 불편하시더라도 양해 부탁드립니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-06-21T06:50:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000HKJNcIAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-06-21T05:36:40Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-06-21T05:36:40Z</b><br><br>안녕하세요 <br><br>추가적으로 이전에 문의 드렸던 내용 다시 문의 드립니다.<br><br>&quot;Mutex sem&quot;의 의미는 &quot;sysvsem&quot;이라고 하셨는데 고객사에서 사용중인 mpm worker의 기본 Mutex 지시자는 &quot;sysvsem&quot;인데,<br>지금 까지 &quot;Mutex sem&quot;을 설정 한 운영서버는 아직 까지 정상 동작 중입니다.<br>이 둘의 차이점이 있는지 확인이 필요합니다.<br><br><publishedDate>2016-06-21T05:36:40Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HKJLGIA5"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-06-21T05:27:45Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-06-21T05:27:45Z</b><br><br>안녕하세요.<br><br>검증계에 가이드 주신 workarround 적용 후 apache process가 죽는 현상이 재발 하였습니다.<br><br>현재 운영계는 &quot;Mutex sem&quot; 적용을 빼지 않은 상태이고 아직까지 문제 없이 동작 중입니다.<br><br>검증계에서 발생한 로그를 첨부 하오니 다시 한 번 분석 바랍니다.<br><br><publishedDate>2016-06-21T05:27:45Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000HGGcGIAX"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-06-03T09:31:40Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-06-03T09:31:39Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>본 이슈는 RHEL 7.2 의 systemd 에서 소개된 새 기능으로서 사용자가 마지막 session ( Shell 또는 관리목적인<br>cronjob ) 을 마칠때 할당된 모든 IPC 자원을 정리하므로서 발생이 되는 이슈로 알려져 있습니다. 이 동작은 직면하신<br>이슈와 같이 같은 사용자 아래 구동중인 데몬 및 프로세스에 영향을 주어서 예상치 못하게 종료 되어버리는 결과를 가지게<br>됩니다.<br><br>이 이슈는 systemd-219-19.el7_2.4 버전으로 업데이트를 하시거나 이전에 안내드린것과 같이 RemoveIPC=no 를<br>/etc/systemd/logind.conf 에 적용하시면 해결이 가능합니다.<br><br><br>자세한 내용은 아래의 참고문서[1]을 확인해보시길 바랍니다.<br><br>[ 참고문서 ]<br><br>[1] Applications using IPC (semaphores, shared memory, message queues) have problems after update to RHEL 7.2<br>- https://access.redhat.com/solutions/2062273<br><br><br>감사합니다.<br><br><publishedDate>2016-06-03T09:31:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000H9XEiIAN"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-05-25T01:31:30Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-05-25T01:31:30Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>지난번 폐사 TAM 과 CSM 과의 미팅을 통해서 전달을 받은 두가지 문의사항에 대해서 아래와 같이 안내드립니다.<br><br>Q) Red Hat 에서 권고한 아래의 workaround 를 현재 운영중인 시스템에 적용하려고 하는데,<br><br>* workaround<br><br># vi /etc/systemd/logind.conf<br># RemoveIPC=no<br>RemoveIPC=no<br><br># systemctl restart systemd-logind.service<br><br><br>Q1) 위의 workaround 를 적용시 현재 운영중인 서비스에 어떠한 영향이 있나요?<br><br>A1) systemd-logind 는 사용자와 세션, 그리고 이들의 프로세스 및 idle 상태를 추적 유지관리하는<br>    역할을 하기 때문에 restrat 시에 이 상태 정보들이 사라질수가 있어 예측지 못한 애플리키에션 오<br>    류를 직면할 수도 있을것입니다. 그래서, 가능한 정기 유지보수 시점에 적용을 하실것을 권장드립니다.<br><br><br>Q2) 이전에 적용을 했던 아래의 workaround 는 원래대로 돌려놓아야 하나요?<br><br>$ vi /etc/httpd/httpd.conf<br>~~ 생략<br>Mutex sem<br>ServerRoot &quot;/xxxx/xxxx/&quot;<br>~~ 생략<br><br><br>A2) 네, 그렇습니다. 현재의 시스템은 이는 Production 환경으로 들어서기 이전에 저희 Red Hat 에서<br>    공식적으로 확인이 된것이 아니라, upstream 에서 확인된 workaround 로서 공식적인 검증을 통하<br>    지 않고 안내를 했기 때문입니다. 뿐만 아니라, Production 환경에서는 Dev 나 Stg 환경과 다르게<br>    User Session 이 끊어지는 주기가 빈번하지 않을수 있기 때문에 위의 Workaround 로 인해서 잠재<br>    적인 이슈가 해소가 되지 않았을수도 있기 때문입니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-05-25T01:31:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000H9IMGIA3"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-05-24T02:03:45Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-05-24T02:03:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>이전의 영문내용을 번역해서 다시 한번 더 정리해서 아래와 같이 안내를 드립니다.<br><br>- 아래<br><br>아래의 strace 로그를 보면 IPC '13139974' 가 14시 21분 18초에 생성이 되고, 애플리케이션은 이를<br>14시 25분 22초 에 이를 제거하려고 시도했던것을 볼 수 있습니다.<br><br>하지만, 이 함수는 -EINVAL 에러와 함께 실패가 되었습니다.<br><br>-------------------------------------------------------------------------------<br>$ grep 13139974 160-strace_str.log<br>56301 14:21:18.492751 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 13139974 &lt;0.000007&gt;<br>56301 14:21:18.492777 semctl(13139974, 0, SETVAL, 0x1) = 0 &lt;0.000006&gt;<br>56301 14:21:18.492825 semctl(13139974, 0, IPC_SET, 0x7ffc538ddd50) = 0 &lt;0.000425&gt;<br>...<br>56351 14:24:58.573528 semop(13139974, {{0, 1, SEM_UNDO}}, 1) = 0 &lt;0.000015&gt;<br>56325 14:25:11.749835 semop(13139974, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>56351 14:25:15.654251 semop(13139974, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>56301 14:25:22.814565 semctl(13139974, 0, IPC_RMID, 0) = -1 EINVAL (Invalid argument) &lt;0.000382&gt;<br>56349 14:25:37.916009 semop(13139974, {{0, 1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000008&gt;<br>56320 14:25:56.884480 semop(13139974, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000007&gt;<br>56348 14:26:18.995342 semop(13139974, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000007&gt;<br>-------------------------------------------------------------------------------<br><br>systemtap 수집결과에서도  14시 25분 22초에 systemd 에 의해서 semaphore 13139974 가 삭제된것을 볼수 있는데, 삭제는 거의 같은<br>시점에 일어났지만, systemd-logind 는 좀 더 빨라서 삭제가 가능했습니다.<br><br>-------------------------------------------------------------------------------<br>$ grep 13139974 180-semctl_mon.log <br>$ grep 13139974 180-semctl_mon.log -A 1<br>semctl_down(semid=13139974, cmd=1) = 0 called at Wed May 18 14:21:18 2016 KST<br>caller details: swapper/0(0m0.000000000s)=&gt;systemd(0m0.033000000s)=&gt;strace.sh(116871m12.010731377s)=&gt;strace(116871m12.013117473s)=&gt;httpd(116871m12.014885077s)<br>--<br>semctl_down(semid=13139974, cmd=0) = 0 called at Wed May 18 14:25:22 2016 KST<br>caller details: swapper/0(0m0.000000000s)=&gt;systemd(0m0.033000000s)=&gt;systemd-logind(0m15.684603220s)<br>--<br>semctl_down(semid=13139974, cmd=0) = -22 called at Wed May 18 14:25:22 2016 KST<br>caller details: swapper/0(0m0.000000000s)=&gt;systemd(0m0.033000000s)=&gt;strace.sh(116871m12.010731377s)=&gt;strace(116871m12.013117473s)=&gt;httpd(116871m12.014885077s)<br>-------------------------------------------------------------------------------<br><br>이 예측된 semaphore 삭제는 최신 systemd-logind 내의 버그에 의해서 원인이 된것이고, 현재는 내부에서 버그 트래킹 시스템에서 현재 QA 단계<br>의 상태로 있는 상태입니다. 이 버그가 수정이 되는 동안 저희는 아래의 workaround 를 제공하고 있으니 이를 /etc/systemd/logind.conf 에<br>적용해서 다시 한번 더 이슈가 재발되는지 확인해주시길 부탁드립니다.<br><br>From:<br>#RemoveIPC=no<br><br>To:<br>RemoveIPC=no<br><br><br>위와 같이 변경후 아래의 명령을 실행하십시오.<br>$ systemctl restart systemd-logind.service<br><br><br>감사합니다.<br><br><publishedDate>2016-05-24T02:03:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000H8TvbIAF"><br>======================<br><b>생성계정 : Kwon, Daniel</b><br><b>생성날짜 : 2016-05-18T23:32:59Z</b><br><b>마지막 답변자 : Kwon, Daniel</b><br><b>마지막 수정 일자 : 2016-05-18T23:37:36Z</b><br><br>Hi,<br><br>Thanks for the files. This files are very useful to find out the cause.<br><br>From the strace log, we see that the IPC '13139974' was created at 14:21:18 and the application was tried to remove it at '14:25:22', but this call was failed with error -EINVAL<br><br>-------------------------------------------------------------------------------<br>$ grep 13139974 160-strace_str.log <br>56301 14:21:18.492751 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 13139974 &lt;0.000007&gt;<br>56301 14:21:18.492777 semctl(13139974, 0, SETVAL, 0x1) = 0 &lt;0.000006&gt;<br>56301 14:21:18.492825 semctl(13139974, 0, IPC_SET, 0x7ffc538ddd50) = 0 &lt;0.000425&gt;<br>...<br>56351 14:24:58.573528 semop(13139974, {{0, 1, SEM_UNDO}}, 1) = 0 &lt;0.000015&gt;<br>56325 14:25:11.749835 semop(13139974, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>56351 14:25:15.654251 semop(13139974, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>56301 14:25:22.814565 semctl(13139974, 0, IPC_RMID, 0) = -1 EINVAL (Invalid argument) &lt;0.000382&gt;<br>56349 14:25:37.916009 semop(13139974, {{0, 1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000008&gt;<br>56320 14:25:56.884480 semop(13139974, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000007&gt;<br>56348 14:26:18.995342 semop(13139974, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000007&gt;<br>-------------------------------------------------------------------------------<br><br>From the systemtap output, we see that the semaphore 13139974 was removed by 'systemd' at '14:25:22'. The deletion had happened almost at the same time, but systemd-logind was a bit faster and was able to remove it.<br><br>-------------------------------------------------------------------------------<br>$ grep 13139974 180-semctl_mon.log <br>$ grep 13139974 180-semctl_mon.log -A 1<br>semctl_down(semid=13139974, cmd=1) = 0 called at Wed May 18 14:21:18 2016 KST<br>caller details: swapper/0(0m0.000000000s)=&gt;systemd(0m0.033000000s)=&gt;strace.sh(116871m12.010731377s)=&gt;strace(116871m12.013117473s)=&gt;httpd(116871m12.014885077s)<br>--<br>semctl_down(semid=13139974, cmd=0) = 0 called at Wed May 18 14:25:22 2016 KST<br>caller details: swapper/0(0m0.000000000s)=&gt;systemd(0m0.033000000s)=&gt;systemd-logind(0m15.684603220s)<br>--<br>semctl_down(semid=13139974, cmd=0) = -22 called at Wed May 18 14:25:22 2016 KST<br>caller details: swapper/0(0m0.000000000s)=&gt;systemd(0m0.033000000s)=&gt;strace.sh(116871m12.010731377s)=&gt;strace(116871m12.013117473s)=&gt;httpd(116871m12.014885077s)<br>-------------------------------------------------------------------------------<br><br>This unexpected semaphore removal was caused by the bug in systemd-logind in the latest version. We have a internal BZ ticket that is on QA stage at the moment. In the meantime, as a workaround, please try the test once again after making change in /etc/systemd/logind.conf ?<br><br>From:<br>#RemoveIPC=no<br><br>To:<br>RemoveIPC=no<br><br>Run the below to apply the above change.<br><br>$ systemctl restart systemd-logind.service<br><br>Please let us know how it goes. Thanks.<br><br>Best regards,<br>Daniel Kwon<br>Software Maintenance Engineer, GSS, Red Hat Asia Pacific<br><br><publishedDate>2016-05-18T23:32:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000H8F3nIAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-05-18T01:00:44Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-05-18T01:00:43Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>먼저, 지난번 코멘트에서 요청드린 semaphore 동작을 추출한 내용을 저희 커널 전문그룹의 엔지니어의 분석내용과<br>향후 진행할 내용에 대해서 안내드립니다.<br><br>- 분석내용<br><br>strace 는 semaphore 생성이 아래와 같이 모두 성공된것을 볼 수 있습니다.<br><br>$ grep semget strace-dev.log <br>5294  15:04:31.382949 semget(IPC_PRIVATE, 1, IPC_CREAT|0600 &lt;unfinished ...&gt;<br>5294  15:04:31.383058 &lt;... semget resumed&gt; ) = 1212416 &lt;0.000099&gt;<br>5294  15:04:31.385420 semget(IPC_PRIVATE, 1, IPC_CREAT|0600 &lt;unfinished ...&gt;<br>5294  15:04:31.385466 &lt;... semget resumed&gt; ) = 1245185 &lt;0.000040&gt;<br>5294  15:04:31.509303 semget(IPC_PRIVATE, 1, IPC_CREAT|0600 &lt;unfinished ...&gt;<br>5294  15:04:31.509392 &lt;... semget resumed&gt; ) = 1277952 &lt;0.000082&gt;<br>5294  15:04:31.510181 semget(IPC_PRIVATE, 1, IPC_CREAT|0600 &lt;unfinished ...&gt;<br>5294  15:04:31.510250 &lt;... semget resumed&gt; ) = 1310721 &lt;0.000063&gt;<br>5294  15:04:31.518784 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 1343490 &lt;0.000020&gt;<br><br>$ grep semget strace-stage.log <br>61171 15:04:51.317274 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 11862020 &lt;0.000010&gt;<br>61171 15:04:51.317756 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 11894789 &lt;0.000007&gt;<br>61171 15:04:51.420633 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 11927556 &lt;0.000009&gt;<br>61171 15:04:51.420751 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 11960325 &lt;0.000007&gt;<br>61171 15:04:51.424835 semget(IPC_PRIVATE, 1, IPC_CREAT|0600) = 11993094 &lt;0.000006&gt;<br><br><br>이는 꽤 한참동안 사용이 되었고, 오로지 이슈의 원인이었던 시점은 다른 시점에서 삭제를 시도했을때 이었습니다.<br><br>그래서, 이 단계에서 저희가 의심하는것은 누군가가 혹은 어떤 스크립트가 'ipcrm' command 또는 'semctl'<br>함수를 실행해서 이들 semaphore 를 삭제를 하는것입니다.<br><br>이 원인을 조사하기 위해서 먼저 'ipcrm' 으로 처리되는 어떤 cronjob 이 있는지 확인하는것과 이 삭제동작을<br>모니터링 하기 위해서 systemtap 스크립트를 수행하는것을 제안드립니다. 이 이슈가 일어나는것을 모니터링하는<br>동안 아래의 스크립트를 실행하실 수 있습니다.<br><br>--------------------&lt; copy the below as a file 'semctl.stp' &gt;-------------------------------<br>#!/usr/bin/env stap<br><br>probe begin {<br><br>printf(&quot;probe started\n&quot;);<br>}<br><br>probe kernel.function(&quot;semctl_down&quot;).return {<br><br>printf(&quot;semctl_down(semid=%d, cmd=%d) = %d called at %s\n&quot;, $semid, $cmd, $return, tz_ctime(gettimeofday_s()));<br><br>pt = pid2task(pid())<br><br>printf(&quot;caller details: %s\n&quot;, task_ancestry(pt, 1))<br><br>printf(&quot;         USER : %s\n&quot;, env_var(&quot;USER&quot;))<br><br>printf(&quot;         HOME : %s\n&quot;, env_var(&quot;HOME&quot;))<br><br>printf(&quot;         PWD  : %s\n&quot;, env_var(&quot;PWD&quot;))<br>}<br>----------------------&lt; copy end before this line &gt;-----------------------------------------<br><br>아래는 실행예제 입니다.<br><br>$ stap semctl.stp &gt; /root/semctl_mon.txt<br><br>디버깅을 위해서 이 스크립트를 실행하려면 kernel-debuginfo 와 다른 패키지들을 설치해야 할것입니다.<br>그리고, 이전단계에서 실행하셨던 strace 또한 위의 systemtap 의 결과내용을 비교분석해야 하므로 같이<br>실행을 해주십시오. strace 가 실행이 되고 나면 이전과 같이 아래의 명령의 결과도 같이 케이스에 업로드<br>해주십시오.<br><br>$ egrep -e 'semget' -e 'semop' -e 'semctl' &lt;strace files&gt;<br><br>또한, /root/semctl_mon.txt 파일도 마찬가지로 업로드 해주십시오. 이들 파일들을 비교하므로서<br>'ipcrm' 이 호출될때와 현재 이슈와 관련이 있는지를 추가분석을 할 것입니다.<br><br><br>- 향후단계<br><br>금일 폐사 미들웨어 컨설턴트인 이형승 부장님이 방문하여 위의 작업을 진행하게 될것이고 결과물이 케이스에<br>업로드가 되는대로 계속해서 지원하도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-05-18T01:00:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000H80r5IAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-05-17T00:41:24Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-05-17T00:41:23Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>올려주신 strace 내용을 저희 커널 전문그룹의 엔지니어가 확인하였는데, 전체내용이 아닌 일부내용만이 있어서<br>full context 를 이해하는데 어려움이 있다고 합니다.<br><br>다만, 이 부분적인 strace 내용중에 semaphore 가 최초에 올바르게 사용이 되었고 나중에 semaphore 를<br>삭제를 시도했습니다. 하지만 이미 삭제가 되어서 이는 실패가 되었습니다.<br><br>$ grep 1343490 *<br>strace-dev-1-1.txt:5318  10:32:05.805911 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5312  10:32:05.835320 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5313  10:32:08.499172 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5314  10:32:16.580581 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5316  10:32:16.581099 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:8609  10:32:16.583797 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:8857  10:32:16.584377 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:47293 10:32:16.585128 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:47284 10:32:16.585895 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5314  10:32:34.550363 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5316  10:32:34.550450 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:47293 10:32:34.550482 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:8857  10:32:34.550613 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:8609  10:32:34.550698 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:47284 10:32:34.550773 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5315  10:32:35.143567 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:8852  10:32:35.144247 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5317  10:32:35.144986 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5311  10:32:35.145877 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5318  10:32:35.146688 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5312  10:32:35.147398 semop(1343490, {{0, 1, SEM_UNDO}}, 1) = 0 &lt;0.000030&gt;<br>strace-dev-1-1.txt:8852  10:32:53.376235 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5315  10:32:54.501169 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5317  10:32:54.550560 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5311  10:32:54.551154 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5318  10:32:54.551358 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5312  10:32:54.551797 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace-dev-1-1.txt:5294  10:46:05.902922 semctl(1343490, 0, IPC_RMID, 0) = -1 EINVAL (Invalid argument) &lt;0.000096&gt;<br>strace-dev-1-1.txt:5313  11:02:33.087414 semop(1343490, {{0, 1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000075&gt;<br>strace_output.txt:5318  10:32:05.805911 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace_output.txt:5312  10:32:05.835320 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace_output.txt:5313  10:32:08.499172 semop(1343490, {{0, -1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br>strace_output.txt:5314  10:32:16.580581 semop(1343490, {{0, 1, SEM_UNDO}}, 1 &lt;unfinished ...&gt;<br><br><br>하지만, 이는 'shutdown()' function 함수 이후에 일어나서, strace 이전에 semaphore 가 제거된것으로 의심이 됩니다.<br><br>5318  10:32:03.803067 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;15.014252&gt;<br>5318  10:32:03.803226 shutdown(13, SHUT_WR) = 0 &lt;0.000094&gt;<br>5318  10:32:03.803375 poll([{fd=13, events=POLLIN}], 1, 2000 &lt;unfinished ...&gt;<br>5312  10:32:03.834400 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;15.014400&gt;<br>5312  10:32:03.834514 shutdown(13, SHUT_WR) = 0 &lt;0.000059&gt;<br>5312  10:32:03.834622 poll([{fd=13, events=POLLIN}], 1, 2000 &lt;unfinished ...&gt;<br><br><br>strace 는 오직 아래의 time frame 이후의 데이터를 보여주는데,<br><br>5313  10:31:51.053729 read(17, &quot;HTTP/1.1 200 OK\r\nCache-Control: no-cache\r\nDate: Fri, 13 May 2016 01:31:50 G<br><br><br>만약, 전체 데이터를 제공하는것이 아니라면 전체분석을 제공하는것이 어렵습니다. 그래서, 전체 strace 의 내용을 가지기 전까지<br>적어도 아래의 명령을 실행한 결과값을 제공해주시길 부탁드립니다.<br><br>$ egrep -e 'semget' -e 'semop' -e 'semctl' &lt;strace files&gt;<br><br><br>* Note - 위의 내용은 폐사 미들웨어 컨설턴트이신 이형승 부장님이 별도 연락과 메일을 고객분께 별도로 전달드렸을것입니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-05-17T00:41:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GyITSIA3"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-27T07:34:10Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-05-02T05:26:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>금일 현재 삼성생명 Account Manager - 목명균 이사님, TAM - 한진구 차장님, CSM - 오희영 차장님과<br>인 본 이슈에 대해서 미팅을 하였고, 향후 저희 Red Hat 에서의 지원계획을 아래와 같이 안내해드립니다.<br><br>- 아 래<br><br>1) 현재상황 <br>   <br>   ㄱ. httpd 프로세스가 상당수의 &quot;apr_proc_mutex_lock failed...&quot; 에러 메시지와 함께 zombie 프로세스가 됨.<br>   ㄴ. Red Hat 에서 제공된 Workaround 로서 httpd.conf 에 'Mutex sem' 설정으로 이슈 잠재적으로 해소됨<br>   ㄷ. 문제의 근본원인을 확인을 위해 webserver 및 kernel 전문그룹의 엔지니어 개입으로 디버깅 단계 진입됨<br>   ㄹ. 디버깅 단계를 제안했으나 예상치 못한 프로세스 미종료 와 Third Party Application 에 의한 인터럽트로 예상<br>      된 디버깅 단계가 미진행됨<br>   ㅁ. 이 디버깅 단계의 진척이 되도록 고객사의 Red Hat 지원요청<br><br><br>2) 향후 Red Hat 의 지원계획 ( 이슈재현이 가능한 시스템 보유시 )<br>   - Red Hat Account Manager, TAM, CSM 이 고객사 방문을 통해 Red Hat 의 향후계획 설명<br><br>   ㄱ. 파트너사와 협업을 통한 Red Hat Consultant 의 지원투입하여 디버깅 단계극복<br>   ㄴ. 디버깅 단계가 완료될 시 kernel 및 webserver 전문 엔지니어의 문제원인 분석시작 및 2차 디버깅 단계시도 가능성 존재<br>   ㄷ. 문제의 원인이 kernel 또는 apache 의 버그가 아닐시에는 직접 문제수정 ( 커널 파라미터 적용 및 설정변경 등 )<br>   라. 문제의 원인이 kernel 또는 apache 의 버그시 Red Hat Engineering 팀 개입<br><br><br>3) 현재의 이슈가 Kernel 또는 RHEL 7.2 의 apache 버그로 확정시 Red Hat 의 대응계획<br><br>   ㄱ. 버그수정을 위해서 Red Hat 전문 엔지니어들이 적극적으로 참여할 수 있도록 이슈전파 및 고객 피드백 전달<br>   ㄴ. 내부 버그추적 시스템을 통한 Red Hat Engineering 팀 개입<br>   ㄷ. 가능한 빠른시간에 문제가 수정되도록 hotfix 패키지 릴리즈를 위한 고객상황 전달 ( Business Justification )<br>   ㄹ. hotfix 패키지 ( 혹은 버그 수정을 확인하는 test 패키지로 이슈 검증 ) 릴리즈 후 테스트 시스템 적용 후 문제수정 확인<br>   ㅁ. 테스트 환경에서 검증된 hotfix 패키지를 Production 환경에 적용 및 고객검증<br><br><br>감사합니다.<br><br><publishedDate>2016-04-27T07:34:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GxyyBIAR"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-26T02:51:54Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-26T02:51:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저희 Red Hat 엔지니어의 방문지원 요청하신 내용에 대해서 저희 Red Hat Global Support Servcie 에서는<br>제공이 되지 않는 서비스여서 현재 담당 Account Manager 이신 목명균 이사님과 상의를 진행하였고, 본 건에 <br>대해서는 고객께 직접 연락을 하거나 타임게이트의 담당자분과 연락하셔서 현재 이슈에 대한 향후 단계에 대해서 논의<br>를 하신다고 합니다. 관련하여 업데이트되는 내용이 있다면 다시 말씀드리며, 혹시 추가적인 문의내용이 있으시다면<br>케이스에 업데이트를 남겨주시길 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2016-04-26T02:51:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gxn5qIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-25T08:57:22Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-25T08:57:21Z</b><br><br>안녕하세요.<br><br>고객측에서 아래의 순서데로 수행시에 문제가 있다고 다시 연락이 왔습니다.<br>또한 이렇게 계속 문제가 되는 것에 대해서 redhat에서 엔지니어가 직접와서 수행해 주기를 바라고 있으니, 의견 바랍니다.<br><br>1. $ su - root<br>2. $ systemctl stop httpd.service<br>3. $ ps -axf | grep httpd<br>4. $ kill -9 &lt;httpd_pid&gt;          # 여러개일 경우에 반복수행<br>5. $ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br>수행 결과 : 아래와 같은 오류 발생. 이 부분은 무시해도 된다고 하셨구요.<br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 100.252.145.92. Set the 'ServerName' directive globally to suppress this message <br>6. strace 실행 후 아파치 기동시에 아래와 같이 이전과 똑같은 오류가 나면서 아파치 기동이 않된답니다.<br>(98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:80<br>no listening sockets available, shutting down<br>AH00015: Unable to open logs<br><br>이상입니다.<br><br><publishedDate>2016-04-25T08:57:21Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Gxl3rIAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-25T04:35:44Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-25T04:35:44Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저희 커널 전문엔니니어가 언급한 내용을 저의 테스트 VM 에서도 아래와 같이 확인을 하였습니다만, 실행하는데에 전혀 문제가<br>될만한 것들을 찾지 못한 상태입니다.<br><br>$ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using localhost.localdomain. Set the 'ServerName' directive globally to suppress this message<br><br>$ ps axf | grep httpd<br> 5361 pts/1    S+     0:00  |       \_ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br> 5366 pts/1    S+     0:00  |           \_ /usr/sbin/httpd -DFOREGROUND<br> 5367 pts/1    S+     0:00  |               \_ /usr/sbin/httpd -DFOREGROUND<br> 5368 pts/1    S+     0:00  |               \_ /usr/sbin/httpd -DFOREGROUND<br> 5369 pts/1    S+     0:00  |               \_ /usr/sbin/httpd -DFOREGROUND<br> 5370 pts/1    S+     0:00  |               \_ /usr/sbin/httpd -DFOREGROUND<br> 5371 pts/1    S+     0:00  |               \_ /usr/sbin/httpd -DFOREGROUND<br><br><br>그리고, 아래의 메시지의 메시지는 httpd.conf 에 ServerName 이 FQDN 으로 설정이 되어 있지 않아서 나타나는것이고,<br>httpd 를 실행하는데 있어서 문제가 되지 않으므로 무시하셔도 됩니다.<br><br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 100.252.145.92.<br><br><br>다만, 아래의 메시지가 문제가 될만한것인데 non-root 사용자로 'systemctl stop httpd.service' 로 실행이 되어서<br>정상종료가 되지 않았거나, 'systemctl stop httpd.service' 실행시에 이전에 실행중이던 httpd 프로세스가 정상적으로<br>종료되지 않아서 발생이 되는것으로 보입니다.<br><br>그래서, 아래와 같이 root 로 systemctl stop httpd.service 를 실행하시고, 다시 한번 더 ps 로 확인한 다음에<br>여전히 httpd 가 실행중이라면 kill 로 강제종료 처리이후에 다시 한번 더 실행해보시길 바랍니다.<br><br>$ su - root<br>$ systemctl stop httpd.service<br>$ ps -axf | grep httpd<br>$ kill -9 &lt;httpd_pid&gt;          # 여러개일 경우에 반복수행<br>$ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br><br><br>감사합니다.<br><br><publishedDate>2016-04-25T04:35:44Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gxj9eIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-25T00:48:13Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-25T00:48:13Z</b><br><br>안녕하세요 <br>요청 주신데로  명령을 실행 했으나 아래와 같은 오류가 발생합니다. <br>그리고 고객측에서 처음 부터 제대로 된 명령어를 전달 해 주지 않아 여러번 시도 하게 되어 실망하고 있습니다.<br><br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 100.252.145.92. Set the 'ServerName' directive globally to suppress this message (98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:80 no listening sockets available, shutting down AH00015: Unable to open logs <br><br>$ systemctl stop httpd.service<br>$ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br><br>이상입니다.<br><br><publishedDate>2016-04-25T00:48:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Gx4piIAB"><br>======================<br><b>생성계정 : Kwon, Daniel</b><br><b>생성날짜 : 2016-04-22T06:36:36Z</b><br><b>마지막 답변자 : Kwon, Daniel</b><br><b>마지막 수정 일자 : 2016-04-22T06:36:36Z</b><br><br>Hi,<br><br>Could you confirm if you had stopped httpd service before this? So, the steps will be like below.<br><br><br>$ systemctl stop httpd.service<br>$ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br><br><br>Best regards,<br>Daniel Kwon<br>Software Maintenance Engineer, GSS, Red Hat Asia Pacific<br><br><publishedDate>2016-04-22T06:36:36Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gx4ceIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-22T06:10:01Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-22T06:10:00Z</b><br><br>안녕하세요<br>가이드 주신데로 실행을 했으나 아래와 같은 오류가 발생합니다.<br>확인 바랍니다.<br><br>root@SLTAFIAL01 /APP/apache/bin # strace -s 4096 -fvttTo strace.txt /APP/apache/bin/httpd -DFOREGROUND AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 100.252.145.92. Set the 'ServerName' directive globally to suppress this message (98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:80 no listening sockets available, shutting down AH00015: Unable to open logs <br><br>감사합니다.<br><br><publishedDate>2016-04-22T06:10:00Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Gx0vKIAR"><br>======================<br><b>생성계정 : Kwon, Daniel</b><br><b>생성날짜 : 2016-04-21T23:14:08Z</b><br><b>마지막 답변자 : Kwon, Daniel</b><br><b>마지막 수정 일자 : 2016-04-21T23:14:08Z</b><br><br>Hi,<br><br>The exact command that you can use in the case of apache server is in the below.<br><br>$ strace -s 4096 -fvttTo strace.txt /usr/sbin/httpd -DFOREGROUND<br><br>As it's a daemon, you have to use '/usr/sbin/httpd' instead of 'systemctl start httpd.service'. Once you get the issued situation, please just stop the above process by typing 'Ctrl-C'. Thanks.<br><br>Best regards,<br>Daniel Kwon<br>Software Maintenance Engineer, GSS, Red Hat Asia Pacific<br><br><publishedDate>2016-04-21T23:14:08Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gwqp3IAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-21T06:10:31Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-21T10:16:27Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>말씀하신 내용은 맞는것 같습니다, 아파치 프로세스가 실행되는 방식이 일반 애플리케이션과는 다소 차이가 있어서 이를 정확히 어떻게<br>실행해야 할지를 저희 Kernel 전문 엔지니어분과 상의를 하고 있는중입니다. 확인이 되는대로 업데이트를 남겨드리도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-04-21T06:10:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GwpcpIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-21T02:08:05Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-21T02:08:05Z</b><br><br>안녕하세요<br>분석결과를 읽어보니 <br>semaphore ID가 존재하지 않는 문제를 확인 하기 위해서 semget에 대한 정보가 필요한데 이전의 strace 정보에는 아래의 명령어로 해당 프로세스에 대한 정보를 수집 했기 때문에 정보가 부족 하다는 말씀이 맞는지요?<br><br>$ strace -s 4096 -fvttTo strace.txt -p &lt;pid of the application ( 아파치의 부모 프로세스 )&gt; <br><br>그러므로 아래의 명령어로 특정 process의 strace 정보가 아닌 현상재현시의 전체 strace 정보를 다시 수집해서 전달 드리면 되겠습니까?<br><br>$ strace -s 4096 -fvttTo strace.txt &lt;application to run&gt;<br><br><publishedDate>2016-04-21T02:08:05Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GwnfpIAB"><br>======================<br><b>생성계정 : Kwon, Daniel</b><br><b>생성날짜 : 2016-04-21T01:15:39Z</b><br><b>마지막 답변자 : Kwon, Daniel</b><br><b>마지막 수정 일자 : 2016-04-21T01:15:39Z</b><br><br>Hi,<br><br>I have checked the uploaded strace output and could see that it's all failed with the return code of 'EINVAL'.<br><br>------------------------------------------------------------------------<br>$ grep semop worker_strace.log | awk '{ print $3, $4, $5, $6, $7, $8, $9, $10, $11, $12 }' | sort | uniq -c<br>  89 semop(10682369, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument)<br>  89 semop(10682369, {{0, 1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument)<br>  89 semop(10715138, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument)<br>------------------------------------------------------------------------<br><br>It happens mainly when the semaphore ID is not exist.<br><br>------------------------------------------------------------------------<br>     [EINVAL]           No semaphore set corresponds to semid, or the process would exceed the system-<br>                        defined limit for the number of per-process SEM_UNDO structures.<br>------------------------------------------------------------------------<br><br>The last call to semop in work_strace.log is in the below.<br><br>------------------------------------------------------------------------<br>2008  19:51:48.740261 semop(10682369, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000007&gt;<br>2008  19:51:48.740311 semop(10682369, {{0, 1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000006&gt;<br>2042  19:51:48.749101 semop(10715138, {{0, -1, SEM_UNDO}}, 1) = -1 EINVAL (Invalid argument) &lt;0.000007&gt;<br>------------------------------------------------------------------------<br><br>From the work_strace, I see that after above tries, it's tried to remove the semaphore by calling 'semctl', but it's also failed as the ID is not exist.<br><br>------------------------------------------------------------------------<br>$ grep semctl worker_strace.log <br>35108 19:51:49.623791 semctl(10715138, 0, IPC_RMID, 0) = -1 EINVAL (Invalid argument) &lt;0.000006&gt;<br>35108 19:51:49.623945 semctl(10682369, 0, IPC_RMID, 0) = -1 EINVAL (Invalid argument) &lt;0.000005&gt;<br>35108 19:51:49.623969 semctl(10649600, 0, IPC_RMID, 0) = -1 EINVAL (Invalid argument) &lt;0.000005&gt;<br>------------------------------------------------------------------------<br><br>I have checked if there's any call to 'semget()' which is used to take semaphore ID, but I couldn't find any.<br><br>------------------------------------------------------------------------<br>$ grep semget prefork_strace.log <br>$ grep semget worker_strace.log <br>$<br>------------------------------------------------------------------------<br><br>It looks like it was failed to access semaphore as the related semaphore ID doesn't exist. My understanding is you were taking this strace on a running process. To check what is happening when it calls 'semget()', would you mind to run the process with the below format instead? <br><br>$ strace -s 4096 -fvttTo strace.txt &lt;application to run&gt;<br><br>With above, we would be able to capture all the messages, so, may give us whole interactions. Thanks.<br><br>Best regards,<br>Daniel Kwon<br>Software Maintenance Engineer, GSS, Red Hat Asia Pacific<br><br><publishedDate>2016-04-21T01:15:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GwbvAIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-20T05:27:39Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-20T05:27:39Z</b><br><br>안녕하세요! <br><br>요청하신 strace 로그결과를 첨부드립니다. <br><br>대상 장비는 운영시스템이 아닌 검증 및 개발 장비에서 해당 정보 수집했으며 하기는 삼성생명 담당자의 멘트입니다. <br><br>###<br>요청하신 strace 를 두가지 case 로 설정하여 회신 드립니다.<br> <br>1.  개발계 prefork 방식으로 설정후 strace 취합<br>2. 품질계 worker 방식으로 설정후 strace 취합<br> <br>두가지 case 모두 apache 접근 오류가 발생하여 첨부합니다.<br> <br>현재는 모두 sem 설정으로 복원한 상태입니다.<br>###<br><br>확인 요청드립니다. <br><br>감사합니다.<br><br><publishedDate>2016-04-20T05:27:39Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000DjYfcIAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-12T05:23:01Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-12T05:23:01Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>답변 감사합니다. 요청드린 strace 결과를 케이스에 올려주신대로 계속해서 지원하도록 하겠으니, 본 케이스는 대기상태로 남겨두도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-04-12T05:23:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gq51lIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-12T01:12:48Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-12T01:12:48Z</b><br><br>안녕하세요! 답변 감사합니다. <br><br>현재 고객측에 해당 내역 전달하여 strace 결과값을 gathering 중에 있습니다. <br><br>답변이 오는데로 진행하도록 하겠습니다. <br><br>감사합니다.<br><br><publishedDate>2016-04-12T01:12:48Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Gpg3yIAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-11T01:39:03Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-11T01:39:03Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>이전의 안내에서 말씀을 드린것과 같이 저희 커널 전문그룹으로 본 이슈를 전달을 한 뒤에 담당 엔지니어<br>으로부터 문제분석을 위해서 아래의 진단단계를 요청받았습니다.<br><br>그래서, 다소 불편하시더라도 아래의 strace 를 이슈가 재현될때까지 실행시키다가 Ctrl+C 로 종료하<br>셔서 strace.txt 를 케이스에 업로드를 부탁드립니다.<br><br>$ strace -s 4096 -fvttTo strace.txt -p &lt;pid of the application ( 아파치의 부모 프로세스 )&gt;<br><br><br>감사합니다.<br><br><publishedDate>2016-04-11T01:39:03Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GpSc5IAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-08T08:54:07Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-08T08:54:07Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>현재 올려주신 semaphore 데이터를 분석하고 난 뒤에 커널측면의 분석이 필요하다는 엔지니어의 피드백을<br>통해서 현재 이슈를 커널 전문그룹으로 다시 전달한 상태입니다. 응답이 다시 돌아오는대로 연락을 드리거나<br>업데이트를 남겨드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2016-04-08T08:54:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GoYs7IAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-06T06:57:58Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-06T06:57:57Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>네, 맞습니다. 곧 업데이트를 드리려고 했는데 먼저 질문을 남겨주셨네요. 현재 엔지니어가 이슈발생시의<br>semaphore 상태를 확인하기 위해서 업로드된 스크립트입니다. 이슈재현 하셔서 아래의 스크립트를 root<br>로 실행한 뒤 생성이 되는 seminfo.out 을 케이스에 업로드 부탁드립니다.<br><br>$ ./seminfo.sh &gt; seminfo.out<br><br><br>감사합니다.<br><br><publishedDate>2016-04-06T06:57:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GoYqGIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-06T06:54:44Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-06T06:54:44Z</b><br><br>안녕하세요<br>금일 올려주신 seminfo.sh를 열어보니 ipcs로 세마포어와 쉐어드 메모리 정보를 추출하는 스크립트로 보이는데,<br>이슈 발생시에 수집을 요청 하시는 것인지요?<br><br><publishedDate>2016-04-06T06:54:44Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GoX5OIAV"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-06T02:00:15Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-06T02:00:15Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>먼저 피드백과 저희 답변에 대한 지적에 감사드립니다. 저도 전문그룹 엔지니어의 답변을 보고 다소 의아하긴 하였습니다만<br>제가 잘 아는 분야가 아니라서 전달해드리는 과정에서 실수가 있었던거 같습니다. 그래서, 다시 한번 더 토론을 시도해니<br>자신이 현재의 상황에 대해서 잘못 인지했다라고 인정하고 다시 이슈정리 및 고객의 요청사항을 재점검을 해보고 있는 상태<br>입니다.<br><br>불편을 드려서 다시 한번 더 죄송하다는 말씀을 드리고, 업데이트가 있는대로 연락드리도록 하겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-04-06T02:00:15Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GoD4iIAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-05T02:14:43Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-05T02:14:43Z</b><br><br>안녕하세요 <br>답변 주신 내용으로는  아래 로그가  원인이라고 얘기 하시는데<br>레드헷 7.1에 번들된 apache에도 해당 로그가 똑같이 발생하지만 process defunct가 전혀 발생하지 않고 있습니다.<br>그러므로 해당 로그만 가지고 weblogic plug-in이 문제라고 얘기 하는 것은 성급한 판단으로 보입니다.  이부분에 대해서 추가 의견 주시기 바랍니다.<br><br>첫번째 emerg 이전에, &quot;weblogic:debug&quot; 로그만을 볼 수 있는데, weblogic plugin 은 이슈를 트리거한것을 보실 수 있습니다.<br>[Thu Mar 31 13:56:27.127645 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(776): BEFORE acquire_lock<br>[Thu Mar 31 13:56:27.127691 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(786): AFTER acquire_lock<br>[Thu Mar 31 13:56:27.127693 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(789): List size is 2<br>[Thu Mar 31 13:56:27.127696 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(796): Cleaning up the list node '100.252.201.210:12310'list Length '1''<br>[Thu Mar 31 13:56:27.127699 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(816): stale connections: KA = 20, delta = 17'<br>[Thu Mar 31 13:56:27.127701 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(796): Cleaning up the list node '100.252.201.210:12310'list Length '1''<br><br>그리고 이전에 문의 했던 내용에 대해서도 답변 바랍니다.<br><br>추가적으로 &quot;sem&quot;의 의미는 &quot;sysvsem&quot;이라고 하셨는데 고객사에서 사용중인 mpm worker의 기본 Mutex 지시자는 &quot;sysvsem&quot;입니다.<br>그렇다면  &quot;Mutex sem&quot;으로 설정 한다는 것은 기본 값으로 설정 한 것이나 차이가 없다는 것인데,<br>왜 &quot;Mutex sem&quot; 설정 후에는 몇주간 한 번도 문제가 발생 하지 않는지요? 이미 사이트 오픈하여 운영중인데도  전혀 문제가 없습니다.<br>단순히 추정만 하시지 마시고 논리적으로 명확한 답변 바랍니다.<br><br>또한 mpm타입을 prefork로 변경하여 테스트 했지만 바로 이슈가 재현 되었으며, 예상하셨던 race condition이 아닌 것 같습니다.<br><br><publishedDate>2016-04-05T02:14:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GnhIlIAJ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-04-03T23:56:38Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-04-04T01:19:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>올려주신 로그파일을 저희 전문그룹의 엔지니어가 확인한 내용을 아래와 같이 안내드립니다.<br><br>- 아래<br><br>아래와 같이 common_error_log 를 보면, sysvsem 이 사용된것을 보실 수 있습니다. 그래서 &quot;Mutex sem&quot;<br>또는 &quot;Mutex default&quot; 를 설정하는것은 현재 이슈가 해결이 된것처럼 보일수도 있겠으나, 잠재적으로 다시 나<br>타날 수도 있습니다.<br><br>[Thu Mar 31 09:44:31.151510 2016] [mpm_worker:debug] [pid 25960:tid 139931004381248] worker.c(1826): AH00294: Accept mutex: sysvsem (default: sysvsem)<br><br><br>첫번째 &quot;emerg&quot; 로그는 3월 31일 목요일 13시 57분에 pid 26325 에서 &quot;AH00243&quot; 에서 나타났는데, 그 다<br>음의 &quot;emerg&quot; 로그는 AH00272 에서 였습니다.<br><br><br>[Thu Mar 31 13:57:00.092749 2016] [mpm_worker:emerg] [pid 26325:tid 139930403485440] (22)Invalid argument: AH00273: apr_proc_mutex_unlock failed. Attempting to shutdown process gracefully.<br>[Thu Mar 31 13:57:00.126106 2016] [mpm_worker:emerg] [pid 40494:tid 139930403485440] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 31 13:57:02.128629 2016] [mpm_worker:emerg] [pid 40537:tid 139930403485440] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 31 13:57:04.130533 2016] [mpm_worker:emerg] [pid 40574:tid 139930403485440] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br><br>첫번째 emerg 는 &quot;AH00273&quot; 은 semaphore 를 unlocking 하는것을 실패한거을 나타내고, 이는 그 다음의 emerg &quot;AH00272&quot;<br>의 원인이었던 것으로 보입니다.<br><br>첫번째 emerg 이전에, &quot;weblogic:debug&quot; 로그만을 볼 수 있는데, weblogic plugin 은 이슈를 트리거한것을 보실 수 있습니다.<br><br><br>[Thu Mar 31 13:56:27.127645 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(776): BEFORE acquire_lock<br>[Thu Mar 31 13:56:27.127691 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(786): AFTER acquire_lock<br>[Thu Mar 31 13:56:27.127693 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(789): List size is 2<br>[Thu Mar 31 13:56:27.127696 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(796): Cleaning up the list node '100.252.201.210:12310'list Length '1''<br>[Thu Mar 31 13:56:27.127699 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(816): stale connections: KA = 20, delta = 17'<br>[Thu Mar 31 13:56:27.127701 2016] [weblogic:debug] [pid 26325:tid 139930428663552] ap_proxy.cpp(796): Cleaning up the list node '100.252.201.210:12310'list Length '1''<br><br><br>또한, 위의 로그는 common_error_log 에서 상당히 많이 나타난것을 보실 수 있고, emerg 로그는 는 start 한 이래로<br>나타나지 않았습니다.<br><br>그래서, 이 이슈는 아마도 race condition 에 의해서 원인이 되었을 가능성이 매우 높습니다.<br><br>저희는 weblogic plugin 이 thread-unsafe 코드를 가지고 있다고 생각합니다. 그래서 이 이슈과 관련된 어떤 버그가<br>있는지 Oracle  사에 기술문의를 해볼 필요가 있을것입니다.<br><br>만약, race condition 이 원인이라면 아파치의 mpm worker 모드에서 prefork 모드로 변경하는것은 이슈를 경감하는데<br>에 도움이 될것입니다.<br><br><br>오라클로 기술문의하고 난 뒤에도 저희 Red Hat 의 지원이 필요하시다면 다시 연락주십시오.<br><br><br>감사합니다.<br><br><publishedDate>2016-04-03T23:56:38Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GmmqAIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-04-01T01:45:59Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-04-01T01:45:59Z</b><br><br>요청 하신 access, error log 전달 합니다.<br><br>이상입니다.<br><br><publishedDate>2016-04-01T01:45:59Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GmcQoIAJ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-31T09:18:31Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-31T09:18:31Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>+-------------------------------------------------------------------------------------+<br>메시지 그대로 sosreport 에서 지원이 되지 않는 apache plugin 때문에 발생이 된것이니,<br>/tmp 디렉토리나 /var/tmp 디렉토리에 sosreport 가 생성이 되었다면 케이스에 업로드 해주시고,<br>그렇지 않다면, 그냥 아래의 sosreport 명령을 실행해서 올려주십시오.<br><br>- 그냥 실행하더라도 /var/log/httpd 디렉토리내에 access_log 또는 error_log 가 포함이 되어 있을것입니다.<br>  만약에 포함이 되어 있지 않다면, /var/log/httpd/access_log 와 error_log 를 직접 올려주셔도 됩니다.<br>+-------------------------------------------------------------------------------------+<br><br>죄송합니다. 지금의 아파치의 루트 디렉토리가 변경된것에 대해서 착오가 있었던거 같습니다. <br>위의 코멘트는 그냥 무시하시고, /APP/apache/logs 디렉토리내에 있는 로그파일들을 압축해서 올려주시면 될 거 같습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-31T09:18:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gmc1wIAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-31T08:37:53Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-31T08:37:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>메시지 그대로 sosreport 에서 지원이 되지 않는 apache plugin 때문에 발생이 된것이니,<br>/tmp 디렉토리나 /var/tmp 디렉토리에 sosreport 가 생성이 되었다면 케이스에 업로드 해주시고,<br>그렇지 않다면, 그냥 아래의 sosreport 명령을 실행해서 올려주십시오.<br><br>- 그냥 실행하더라도 /var/log/httpd 디렉토리내에 access_log 또는 error_log 가 포함이 되어 있을것입니다.<br>  만약에 포함이 되어 있지 않다면, /var/log/httpd/access_log 와 error_log 를 직접 올려주셔도 됩니다.<br><br>$ sosreport<br><br><br>감사합니다.<br><br><publishedDate>2016-03-31T08:37:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GmbnkIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-31T08:13:03Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-31T08:13:02Z</b><br><br>안녕하세요<br>알려주신 링크에 있는 가이드데로 sosreport를 수집시도 했으나 아래와 같은 오류가 발생합니다.<br>확인 바랍니다.<br><br>[weblogic@SLQAFIEL01:/APP/apache/bin] sosreport -k apache.log=on<br>sosreport (version 3.2)<br>unable to set option for disabled or non-existing plugin (apache)<br>no valid plugins were enabled<br>[weblogic@SLQAFIEL01:/APP/apache/bin]<br><br>[weblogic@SLQAFIEL01:/APP/apache] sosreport<br>sosreport (version 3.2)<br>no valid plugins were enabled<br><br><publishedDate>2016-03-31T08:13:02Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GmLTQIA3"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-30T07:01:32Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-30T07:01:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>새롭게 문의주신 내용을 저희 webserver 전문그룹의 엔지니어로부터 답변을 받았는데, 초기에 defunct 이슈가 왜 일어났는지를 확실하지 않아서 이슈를<br>재현해서 Debug 수준의 로그를 확인해보고 싶다고 합니다. 예상으로는 Mutex 가 기술되지 않았을때 weblogic plugin 이 원인이었을 수 있다고 합니다.<br><br>그래서, 이전의 &quot;Mutex sem&quot; 지시어를 주석처리하고, 참고문서[1]에 설명한대로 httpd.conf 에서 Debug LogLevel 을 debug 로 변경해서 이슈<br>재현 후에 sosreport 를 다시 생성후 업로드 해주시겠습니까?<br><br><br>[ 참고문서 ]<br><br>[1] How to modify Apache httpd Logging<br>- https://access.redhat.com/solutions/417713<br><br><br>감사합니다.<br><br><publishedDate>2016-03-30T07:01:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GmKFmIAN"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-30T04:07:01Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-30T04:07:01Z</b><br><br>추가적으로 &quot;sem&quot;의 의미는 &quot;sysvsem&quot;이라고 하셨는데 고객사에서 사용중인 mpm worker의 기본 Mutex 지시자는 &quot;sysvsem&quot;입니다.<br>그렇다면  &quot;Mutex sem&quot;으로 설정 한다는 것은 기본 값으로 설정 한 것이나 차이가 없다는 것인데,<br>왜 &quot;Mutex sem&quot; 설정 후에는 문제가 발생 하지 않는지요?<br><br><publishedDate>2016-03-30T04:07:01Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Gm0IYIAZ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-29T04:57:09Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-29T04:57:09Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>영문으로 추가로 문의주신 내용에 대해서 저희 전문그룹의 Senior 엔지니어가 아래의 답변을 주셨습니다. 혹시 추가로 문의사항이 있으시면 코멘트 남겨주십시오.<br><br>Q1) The side-effect, which is expected in the case of &quot;Mutex sem&quot; Directive use?(The Apache documentation, there is no such content.)<br>A1) &quot;sem&quot; means &quot;sysvsem&quot; in the Red Hat httpd. In &quot;sysvsem&quot;, a semaphore file is stored in tmpfs (a temporary file system on RAM) in /run.<br>    When httpd crashes, a semaphore file stay in the tmpfs. When httpd frequently crashes, a lot of semaphore files eats i-node, and <br>    finally &quot;device full&quot; occurs due to i-node shortage (even if the tmpfs has enough free area).<br><br>Q2) What is the recommended value in the Mutex Directive?<br>A2) Every options works fine. However, the &quot;default&quot; should work fine on every platforms (&quot;default&quot;=&quot;sysvsem&quot; on RHEL httpd).<br><br>Q3) Until now, the exact cause has not been confirmed. how to debugging when the same problem.<br>A3) defunct process has been exited already, so the log files are the only clue for us. Set LogLevel to &quot;debug&quot;.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-29T04:57:09Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlzbPIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-29T02:27:26Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-29T02:27:26Z</b><br><br>안녕하세요<br><br>앞에 문의한 내용 빠른 업데이트 바랍니다.<br><br>이상입니다.<br><br><publishedDate>2016-03-29T02:27:26Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlnxfIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-28T05:52:35Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-28T05:52:35Z</b><br><br>안녕하세요<br><br>금요일에 오전에   이미 &quot;Mutex sem&quot; 에 대한 케이스가 있어  적용하여 금일 오픈 후 까지 문제가 발생 하고 있지 않으나, 추가 문의 사항이 있습니다.<br><br>토요일에 글로벌 엔지니어분께 &quot;Mutex sem&quot;  적용시 발생 할 수 있는 문제점에 문의를 드렸으나, 답변이 없어 다시 문의 드립니다.<br>이유는 defunct 문제가 발생되지 않는 서버에도 &quot;Mutex sem&quot;을 적용 할지 여부를 고객사에서 결정 해야하기 때문입니다.<br><br>#케이스<br>1. &quot;apr_proc_mutex_lock failed before this child process served any requests.&quot; 오류만 발생하고 프로세스 defunct는 발생하지 않는 서버<br>2. 1번의 오류 및 defunct가 발생하지 않는 정상서버<br><br><publishedDate>2016-03-28T05:52:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlhSpIAJ"><br>======================<br><b>생성계정 : Masirkar, Dasharath</b><br><b>생성날짜 : 2016-03-26T06:50:17Z</b><br><b>마지막 답변자 : Masirkar, Dasharath</b><br><b>마지막 수정 일자 : 2016-03-26T06:50:16Z</b><br><br>Hi ,<br><br>Thanks for the update.<br><br>&gt;&gt; Q2) What is the recommended value in the Mutex Directive?<br><br>After going through the sosreport-SLQAFIEL01-20160324102741.tar.xz it shows that you are using prefork mpm. And you have single CPU core in the system. With single CPU core 200 is the optimal value for MaxClients.You can use the example configuration as follows:<br><br>&lt;IfModule mpm_prefork_module&gt;<br><br>ServerLimit          200<br><br>StartServers        5<br><br>MinSpareServers     5<br><br>MaxSpareServers     20<br><br>MaxClients          200<br><br>MaxRequestsPerChild 0<br>&lt;/IfModule&gt;<br><br>[root@]# httpd -V<br>Server version: Apache/2.4.6 (Red Hat Enterprise Linux)<br>Server built:   Aug 10 2015 07:39:34<br>Server's Module Magic Number: 20120211:24<br>Server loaded:  APR 1.4.8, APR-UTIL 1.5.2<br>Compiled using: APR 1.4.8, APR-UTIL 1.5.2<br>Architecture:   64-bit<br>Server MPM:     prefork<br>  threaded:     no<br>    forked:     yes (variable process count)<br>Server compiled with....<br> -D APR_HAS_SENDFILE<br> -D APR_HAS_MMAP<br> -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)<br> -D APR_USE_SYSVSEM_SERIALIZE<br> -D APR_USE_PTHREAD_SERIALIZE<br><br>In RHEL7 provided httpd, it supports sysvsem and pthread mutex variant. For prefork or worker mpm by default it will use sysvsem mutex variant. For example:<br><br>For prefork mpm :<br>===============<br>[Sat Mar 26 11:40:43.798719 2016] [mpm_prefork:debug] [pid 19947] prefork.c(1005): AH00165: Accept mutex: sysvsem (default: sysvsem)<br><br>For worker mpm :<br>===============<br>[Sat Mar 26 11:36:20.907074 2016] [mpm_worker:debug] [pid 18163:tid 139641215068224] worker.c(1826): AH00294: Accept mutex: sysvsem (default: sysvsem)<br><br>&gt;&gt; Q3) Until now, the exact cause has not been confirmed. how to debugging when the same problem.<br><br>You may test it by changing this to pthread, by adding the configuration as follows in httpd.conf file. <br><br>Mutex pthread<br><br>For prefork mpm :<br>===============<br>[Sat Mar 26 11:55:03.880427 2016] [mpm_prefork:debug] [pid 20501] prefork.c(1005): AH00165: Accept mutex: pthread (default: sysvsem)<br><br>Then add debug logging for prefork module by adding the configuration as follows in httpd.conf file and reproduce the issue and share the latest Apache httpd (access,error) logs for the review.<br><br>LogLevel info prefork.c:debug<br><br>Regards,<br>Dasharath<br>-------------------------<br>Red Hat Technical Support<br>-------------------------<br>https://access.redhat.com/site/support/contact/technicalSupport/<br><br><publishedDate>2016-03-26T06:50:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlhHrIAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-26T02:29:52Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-26T02:29:52Z</b><br><br>I am writing to inquire about the correlation apache error log(AH00272: apr_proc_mutex_lock failed before this child process served any requests) with process defunct<br><br>Q1) The side-effect, which is expected in the case of &quot;Mutex sem&quot; Directive use?(The Apache documentation, there is no such content.)<br>Q2) What is the recommended value in the Mutex Directive?<br>Q3) Until now, the exact cause has not been confirmed. how to debugging when the same problem.<br><br><publishedDate>2016-03-26T02:29:52Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Glb46IAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-25T09:19:48Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-25T09:19:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>한가지 놓친게 있어서 다시 한번 더 업데이트를 남겨드립니다. 지금 이후부터는 영문지원 서비스가 제공이 되오니,<br>요청사항이 있을시에는 반드시 영어로 남겨주시길 당부드립니다. 이 시간 이후 와 주말간에 문제가 잘 해결이 되<br>셨으면 좋겠습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-25T09:19:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlayIIAR"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-25T08:56:42Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-25T08:56:42Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>먼저, 오라클에서 온 피드백 공유해주셔서 감사합니다. 현재 본 케이스는 주말이나 야간에도 계속해서 영문지원이 될 수 있도록<br>설정이 된 상태이니, 이전에 안내 드렸던 옵션을 적용한 뒤에도 여전히 문제가 나타난다면 업데이트를 남겨주시길 부탁드립니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-25T08:56:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlasFIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-25T08:40:21Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-25T08:40:21Z</b><br><br>오라클 지원 팀에서 온 답변입니다.<br>유선상 말씀드릴때처럼 Apache Process와의 Defunct와 연관지울 수 없고, 가이드 할 내용이 없다는 내용입니다.<br>---------------------------------------------------------------------------------------------------------------------------- <br>&quot;Mutex Directive&quot; 관련하여 아래의 Apache 문서는 이미 참조하셨을 것으로 보입니다. <br><br>참조: http://httpd.apache.org/docs/current/mod/core.html#mutex <br><br>------------------------ <br>Mutex Directive <br><br>The Mutex directive sets the mechanism, and optionally the lock file location, that httpd and modules use to serialize access to resources. Specify default as the second argument to change the settings for all mutexes; specify a mutex name (see table below) as the second argument to override defaults only for that mutex. <br><br>The Mutex directive is typically used in the following exceptional situations: <br><br>   change the mutex mechanism when the default mechanism selected by APR has a functional or performance problem <br>   change the directory used by file-based mutexes when the default directory does not support locking <br><br>Supported modules <br><br>This directive only configures mutexes which have been registered with the core server using the ap_mutex_register() API. All modules bundled with httpd support the Mutex directive, but third-party modules may not. Consult the documentation of the third-party module, which must indicate the mutex name(s) which can be configured if this directive is supported. <br>------------------------ <br><br>아파치 프로세스 Defunct 이슈에 대하여 조사해 보았지만, 웹로직단에서 가이드 드릴만한 부분은 없습니다. <br><br>감사합니다.<br><br><publishedDate>2016-03-25T08:40:21Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlZruIAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-25T05:34:18Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-25T05:34:18Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>제 생각에는 오라클사에서 설정이 가능한 적절한 방법을 가이드를 해줄거 같습니다.<br>혹시 weblogic 이 어떠한 mutex mechanism 을 사용하는지 모르겠습니다만, 혹시 테스트가 가능하다면 httpd.conf 에서 &quot;Mutex sem&quot; 으로 설정해서<br>웹서버, 미들웨어를 재기동해서 문제가 해소되는지 확인해보시겠습니까?<br><br>$ vi /etc/httpd/httpd.conf<br>~~ 생략<br>Mutex sem<br>ServerRoot &quot;/xxxx/xxxx/&quot;<br>~~ 생략<br><br><br>감사합니다.<br><br><publishedDate>2016-03-25T05:34:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlZlcIAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-25T05:09:40Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-25T05:09:40Z</b><br><br>현재까지의 진행 현황공유합니다.<br><br>일단 아파치 워커프로세스의 설정 정보를 아래와 같이 변경하였습니다.<br><br>ServerLimit<br><br>16<br>StartServers<br><br>16<br>MaxClients<br><br>2048<br>MinSpareThreads<br><br>16<br>MaxSpareThreads<br><br>32<br>ThreadsPerChild<br><br>128<br>MaxRequestsPerChild<br><br>0<br>#ThreadLimit<br><br>128<br><br>현재의 현상이 프로세스에 대한 동적인 제어과정에서 발생하는 것으로 추정되어서<br>프로세스 및 Thread를 초기에 기동하여 변동없이 유지하는 설정입니다.<br><br>그리고 답변에 예상원인 중 &quot;APR 에 의해서 선택된 초기 mechanism 이 기능적 혹은 성능문제” <br>부분에서 구체적으로 해볼수 있는 구체적인 방법이 가이드되지 않아 시도해볼 수 있는 방법이 없는 것인지 문의 드립니다.<br><br>그리고 Third Party 관련하여서 확인 요청하셨는데 그 부분은 현재 오라클 Escalation 진행 하였고 그 답변을 기다리고 있는 상태입니다.<br><br><publishedDate>2016-03-25T05:09:40Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlZY2IAN"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-25T04:20:07Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-25T04:20:07Z</b><br><br>안녕하세요,<br><br>Red Hat CEE 기술지원팀 문 종 영 입니다.<br><br>이미 케이스를 통해 현재 삼성생명에서 RHEL 7.2 기반의 apache process 가 defunct 가 나타나는 문제에 대해서 답변을 나간 상태이<br>긴 하지만, 현재의 대응방안과 향후계획과 함께 다시 한번 더 안내를 드립니다.<br><br><br>[ 문제분석 및 대응방안 ]<br><br>httpd.conf 내에 Mutex Directive 는 httpd 와 module 이 리소스들로 serialize 접근을 하는 메커니즘과 lock file 위치를 설정<br>하는데, 초기값으로 default 로 설정이 되어 있는 상태로 보여집니다. default 는 APR 에 의해서 결정되므로서 locking 을 구현한것을<br>설정하게 됩니다.<br><br>지금과 같이 httpd 프로세스가 defunct 가 나는 예상원인은 아래의 예외상황에 해당이 되는것으로 보입니다.<br><br>1. APR 에 의해서 선택된 초기 mechanism 이 기능적 혹은 성능문제<br>2. file-based mutex 들에 의해서 사용된 초기 디렉토리가 locking 을 지원하지 않는 문제<br><br><br>* 지원되는 모듈<br>- Mutex Directive 는 ap_mutex_register() API 를 사용중인 core server 와 함께 등록되어진 mutex 들을 오직 설정하는데,<br>  아파치에서 제공되는 모든 모듈들은 Mutex directive 를 지원합니다. 하지만, third-party 모듈들은 그렇지 않을수도 있습니다.<br><br>아래는 httpd 에서 사용이 가능한 mutex 메커니즘입니다.<br><br>default | yes<br>none | no<br>posixsem<br>sysvsem<br>Security<br>pthread<br>fcntl:/path/to/mutex<br>flock:/path/to/mutex<br><br><br>이 Directive 가 지원이 되어서 설정이 될 수 있는 mutex 이름을 나타나는지 third-party 소프트웨어 벤더로 문의하신 뒤<br>apache 와 weblogic 양쪽에서 새롭게 Mutex 를 설정하셔서 문제가 해소되는지 확인해보시길 바랍니다.<br>======================<br>[ 향후계획 ]<br><br>본 케이스는 Premium: Red Hat JBoss Enterprise Web Server 서브스크립션을 보유하고 계시기 때문에 주말에도 지원이 가능<br>한 상황입니다. 그래서, 만약 금일까지 본 이슈가 해소가 되지 않는다면 FTS ( Follow the Sun ) 절차를 통해서 해외의 Red Hat<br>미들웨어 엔지니어가 계속적으로 지원이 될 수 있도록 할것이니 요청사항이 있으시다면 케이스에 상황을 계속 업데이트 해주실것을 당부<br>드립니다.<br><br><br>[ 참고문서 ]<br><br>[1] https://httpd.apache.org/docs/2.4/mod/core.html#mutex<br><br><br>감사합니다.<br><br><publishedDate>2016-03-25T04:20:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlXQ5IAN"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-25T01:23:41Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-25T01:25:40Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>httpd.conf 내에 Mutex Directive 는 httpd 와 module 이 리소스들로 serialize 접근을 하는 메커니즘과 lock file 위치를 설정<br>하는데, 초기값으로 default 로 설정이 되어 있는 상태로 보여집니다. default 는 APR 에 의해서 결정되므로서 locking 을 구현한것을<br>설정하게 됩니다.<br><br>지금의 상황은 아래의 예외상황에 해당이 되는것으로 보입니다.<br><br>1. APR 에 의해서 선택된 초기 mechanism 이 이 기능적 혹은 성능문제<br>2. file-based mutex 들에 의해서 사용된 초기 디렉토리가 locking 을 지원하지 않는 문제<br><br>* 지원되는 모듈<br>- Mutex Directive 는 ap_mutex_register() API 를 사용중인 core server 와 함께 등록되어진 mutex 들을 오직 설정하는데,<br>  아파치에서 제공되는 모든 모듈들은 Mutex directive 를 지원합니다. 하지만, third-party 모듈들은 그렇지 않을수도 있습니다.<br>  이 Directive 가 지원이 되면 설정이 될 수 있는 mutex 이름을 나타나는지 third-party 소프트웨어 벤더로 문의해보시길 바랍니다.<br><br>아래는 httpd 에서 사용이 가능한 mutex 메커니즘입니다.<br><br>default | yes<br>none | no<br>posixsem<br>sysvsem<br>Security<br>pthread<br>fcntl:/path/to/mutex<br>flock:/path/to/mutex<br><br><br>[ 참고문서 ]<br><br>[1] https://httpd.apache.org/docs/2.4/mod/core.html#mutex<br><br>감사합니다.<br><br><publishedDate>2016-03-25T01:23:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlQQhIAN"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-24T13:18:52Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-24T13:18:52Z</b><br><br>안녕하세요 <br><br>답변 주신내용은 weblogic 에서 제공하는 plug-in을 이용하여 weblogic과 통신시에 acceptbacklog 부족등의 이유로, 웹로직에서 connection을 거부하는 내용이며 본 이슈인 apr(apache portable runtime 모듈에서 mutex lock을 못 잡는 것과 상관이 없습니다.<br><br>##common_error_log 파일에 보시면 apr에서 mutet lock 잡는 것이 실패한다고 나오는데 이 부분을 확인 바랍니다.<br><br>[Thu Mar 03 15:40:44.688558 2016] [weblogic:notice] [pid 17296:tid 140063341606976] WebLogic Server Plugin version 12.1.3 &lt;WLSPLUGINS_12.1.3.0.0_LINUX.X64_140429.1732&gt;<br>[Thu Mar 03 15:40:44.689205 2016] [ssl:warn] [pid 17296:tid 140063341606976] AH01873: Init: Session Cache is not configured [hint: SSLSessionCache]<br>[Thu Mar 03 15:40:44.689835 2016] [core:warn] [pid 17296:tid 140063341606976] AH00098: pid file /APP/apache/pid/sample_domain.pid overwritten -- Unclean shutdown of previous Apache run?<br>[Thu Mar 03 15:40:44.691731 2016] [mpm_worker:notice] [pid 17296:tid 140063341606976] AH00292: Apache/2.4.6 (Red Hat Enterprise Linux) OpenSSL/1.0.1e-fips configured -- resuming normal operations<br>[Thu Mar 03 15:40:44.691750 2016] [core:notice] [pid 17296:tid 140063341606976] AH00094: Command line: '/APP/apache/bin/httpd -f /APP/apache/conf/httpd.conf'<br>Could not open log file '/LOG/apache/V-AFI11/V-AFI11-102/access/ssl_access_V-AFI11-102_log_2016_03_03' (No such file or directory)<br>AH00106: piped log program '/APP/apache/bin/rotatelogs /LOG/apache/V-AFI11/V-AFI11-102/access/ssl_access_V-AFI11-102_log_%Y_%m_%d 86400' failed unexpectedly<br>[Thu Mar 03 15:42:00.510433 2016] [mpm_worker:emerg] [pid 17308:tid 140062809306880] (43)Identifier removed: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:00.511409 2016] [mpm_worker:emerg] [pid 17306:tid 140062809306880] (43)Identifier removed: AH00273: apr_proc_mutex_lock failed. Attempting to shutdown process gracefully.<br>[Thu Mar 03 15:42:00.511510 2016] [mpm_worker:emerg] [pid 17672:tid 140062809306880] (43)Identifier removed: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:01.775435 2016] [mpm_worker:emerg] [pid 17988:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:02.778081 2016] [mpm_worker:emerg] [pid 18019:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:02.779813 2016] [mpm_worker:emerg] [pid 18020:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:04.779852 2016] [mpm_worker:emerg] [pid 18096:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:05.782511 2016] [mpm_worker:emerg] [pid 18141:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br><br><publishedDate>2016-03-24T13:18:52Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlNRUIA3"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-24T11:45:00Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-24T11:45:00Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>[Wed Mar 23 12:31:33.354238 2016] [weblogic:error] [pid 4377:tid 140132736190208] [client 100.119.87.64:50932] &lt;43771458703881527&gt; *******Exception type [CONNECTION_REFUSED] (apr_socket_connect call failed with error=111, host=100.252.201.210, port=12310 ) raised at line 1682 of URL.cpp<br>[Wed Mar 23 12:31:33.354295 2016] [weblogic:error] [pid 4377:tid 140132736190208] [client 100.119.87.64:50932] Trying GET /admin/login.do at backend host '100.252.201.210/12310; got exception 'CONNECTION_REFUSED [os error=115, line 1682 of URL.cpp]: apr_socket_connect call failed with error=111, host=100.252.201.210, port=12310 '<br>[Wed Mar 23 13:12:28.141105 2016] [weblogic:error] [pid 4377:tid 140132493485824] [client 100.119.88.37:55062] &lt;43771458706048862&gt; *******Exception type [READ_TIMEOUT] (no read after 300 seconds) raised at line 275 of Reader.cpp, referer: https://ap1.q.extadmin.samsunglife.kr/admin/opr/syscontrol/page.do?type=manual<br>[Wed Mar 23 13:12:28.141202 2016] [weblogic:error] [pid 4377:tid 140132493485824] [client 100.119.88.37:55062] &lt;43771458706048862&gt; sendRequest: exception caught while parsingHeaders w/ recycled connection to 100.252.201.210:12310, numfailures=1, referer: https://ap1.q.extadmin.samsunglife.kr/admin/opr/syscontrol/page.do?type=manual<br>[Wed Mar 23 13:12:28.141233 2016] [weblogic:error] [pid 4377:tid 140132493485824] [client 100.119.88.37:55062] ap_proxy: trying POST /admin/opr/syscontrol/syscontrol.applyManual.json at backend host 100.252.201.210/12310; got exception 'Backend Server not responding'; state: reading status line or response headers from WLS (wrote? Y read? N); not failing over, referer: https://ap1.q.extadmin.samsunglife.kr/admin/opr/syscontrol/page.do?type=manual<br>[Wed Mar 23 13:12:28.141293 2016] [weblogic:error] [pid 4377:tid 140132493485824] [client 100.119.88.37:55062] &lt;43771458706048862&gt; request [/admin/opr/syscontrol/syscontrol.applyManual.json] did NOT process successfully.................., referer: https://ap1.q.extadmin.samsunglife.kr/admin/opr/syscontrol/page.do?type=manual<br>[root@dhcp-160-183 Downloads]# <br><br><br>올려주신 로그에서 보면 대부분의 오류의 원인이 weblogic 에서 나타나는 오류입니다. 그래서, 이 문제를 오라클사로 문의하셔서 기술지원 요청을 해보시고,<br>그 이후에도 저희 Red Hat 의 도움이 필요하시다면, 다시 연락주십시오.<br><br><br>[ 참고문서 ]<br><br>[1] Tips for reducing Connection_Refused Errors<br>- http://docs.oracle.com/middleware/1212/webtier/PLGWL/common_tasks.htm#PLGWL423<br><br><br>감사합니다.<br><br><publishedDate>2016-03-24T11:45:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GlIngIAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-24T08:47:15Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-24T08:47:15Z</b><br><br>안녕하세요. 저희쪽 팀장님 연락처 남겨드립니다.<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 박우진 (선임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  +82-10-2062-0157<br>- 메일주소 : 박우진 &lt;ewoojinn.park@samsung.com'&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 김동식(이사)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01087288836<br>- 메일주소 : dongskim@time-gate.com'<br>==============================================================================<br><br>필요하신 파일 있으시면 연락 후 지원 받으시면 될것으로 보입니다.<br>감사합니다.<br><br><publishedDate>2016-03-24T08:47:15Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlIbpIAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-24T08:28:34Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-24T08:28:34Z</b><br><br>안녕하세요. 저희쪽 팀장님 연락처 남겨드립니다.<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 박우진 (선임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  +82-10-2062-0157<br>- 메일주소 : 박우진 &lt;ewoojinn.park@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 김동식(이사)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01087288836<br>- 메일주소 : dongskim@time-gate.com<br>==============================================================================<br><br><publishedDate>2016-03-24T08:28:34Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlHlUIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-24T06:24:12Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-24T06:24:11Z</b><br><br>안녕하세요 <br>고객사 오픈이 다음주 월요일이라 내일까지 이슈가 해결되야 합니다.<br>가능한 빨리 답변바랍니다.<br><br><publishedDate>2016-03-24T06:24:11Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GlEm6IAF"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-24T01:00:15Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-24T01:00:15Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>시스템내에 전체 로그들과 설정파일을 해보아야 할거 같습니다. sosreport 를 케이스에 업로드 해주시길 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-03-24T01:00:15Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GktoOIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-23T08:38:29Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-23T08:38:29Z</b><br><br>담당자가 현상 및 작업내용에 대해 혼란이 있어서 저희도 혼란스럽게 케이스 업데이트가 이루어 졌습니다.<br><br>이점 죄송하고 다시 정리 하겠습니다.<br><br>1. 현상: 서비스 운영중 지속적으로 아파치 프로세스 Defunct 발생<br>2. 구성정보: <br>     -. 정상적으로 RPM이용하여 설치를 하였고, 삼성화재 표준 구성에 따라 httpd를 별도의 Directory(app-config)로 이동하여 구성함.<br>3. 테스트<br>     -. 초기 설치 상태로 변경하여 테스트 하여도 동일하게 Defunct 현상 발생함.<br>4. 1차 분석<br>    -. 구성상의 특이점은 보이지 않으나 정상적으로 운영 중인 시스템과 비교 결과 RHEL7.1에서 운영중인 서버는 정상적으로 운영되고 있고<br>        문제가 발생한 서버는 RHEL7.2인 것으로 확인 되고 있음.<br>    -. apache common error log를 보면 아래와 같은 에러가 지속적으로 발생하고 있음.<br><br>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br>[Thu Mar 03 15:42:00.510433 2016] [mpm_worker:emerg] [pid 17308:tid 140062809306880] (43)Identifier removed: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:00.511409 2016] [mpm_worker:emerg] [pid 17306:tid 140062809306880] (43)Identifier removed: AH00273: apr_proc_mutex_lock failed. Attempting to shutdown process gracefully.<br>[Thu Mar 03 15:42:00.511510 2016] [mpm_worker:emerg] [pid 17672:tid 140062809306880] (43)Identifier removed: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:01.775435 2016] [mpm_worker:emerg] [pid 17988:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:02.778081 2016] [mpm_worker:emerg] [pid 18019:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>[Thu Mar 03 15:42:02.779813 2016] [mpm_worker:emerg] [pid 18020:tid 140062809306880] (22)Invalid argument: AH00272: apr_proc_mutex_lock failed before this child process served any requests.<br>-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><br>5. 문의사항<br>    -. 위와 같은 에러로그가 발생하는 이유와 Defunct 현상과의 연관성에 대해 답변 요청 드립니다.<br>    -. RHEL 7.2와 현재 설치된 아파치 버젼(2.4.6)에서의 버그 케이스가 있는지 확인 요청 드립니다.<br>  <br><br>관련 로그는 첨부하여 올려드리오니 참조하시기 바랍니다.<br><br><publishedDate>2016-03-23T08:38:29Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GktRAIAZ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-23T07:56:08Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-23T07:56:07Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>최초<br>/APP/apache/bin/httpd file이 있었으나<br>httpd를 가동시 정상 가동이 되지 않아<br>/sbin 아래로 임의적으로 옮겨 <br>httpd를 가동하니 정상적인 실행이 되었지만 defunct 가 발생하여서 원할한 서버 접속이 안되었다고 합니다.<br><br>현재는<br>/APP/apache/bin/ 로 다시 옮긴 상황이고<br>httpd가 정상적으로 가동이 되지 않고 있다고 합니다.<br><br><br>말씀하신 위의 설명은 Third-party Software 를 RHEL 에 설치하다가 발생되어진 이슈로 보입니다.<br>시스템 내에서 저희 Red Hat 에서 제공된 httpd 패키지가 설치 되어져서 운영이 되지 않는한 기술지원이 되지<br>않습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-23T07:56:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gkt2FIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-23T07:11:27Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-23T07:11:27Z</b><br><br>안녕하세요<br>현재 고객에서 <br><br>최초<br>/APP/apache/bin/httpd file이 있었으나<br>httpd를 가동시 정상 가동이 되지 않아<br>/sbin 아래로 임의적으로 옮겨 <br>httpd를 가동하니 정상적인 실행이 되었지만 defunct 가 발생하여서 원할한 서버 접속이 안되었다고 합니다.<br><br>현재는<br>/APP/apache/bin/ 로 다시 옮긴 상황이고<br>httpd가 정상적으로 가동이 되지 않고 있다고 합니다.<br><br>위와 같은 상화에서도 지원을 받을수 없는지요?<br><br>만약 지원이 된다면 어떠한 행동 절차가 필요한지 답변 부탁드립니다.<br><br><publishedDate>2016-03-23T07:11:27Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GksDHIAZ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-23T05:03:11Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-23T05:03:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>weblogic@SLTAFIAL01 /APP/apache/bin # rpm -qf /APP/apache/bin/httpd file<br> /APP/apache/bin/httpd is not owned by any package<br>weblogic@SLTAFIAL01 /APP/apache/bin # rpm -qf /APP/apache/conf/httpd.conf file <br>/APP/apache/conf/httpd.conf is not owned by any package<br><br><br>올려주신 메시지는 설치된 RHEL 의 rpm 패키지 목록내에서 위의 파일을 소유하고 있는 rpm 패키지가<br>존재하지 않는다는 의미이며 Red Hat 에서 제공이 되지 않고, 지원이 되는 항목이 아니라고 이해하시면<br>됩니다.<br><br>그리고, 저희가 현재 케이스가 지원이 더 이상 어렵다라고 말씀드린것은 설치된 소프트웨어가 Red Hat<br>에서 제공이 된 소프트웨어가 아니기 때문이며, 새로운 이슈때문에 새롭게 기술문의를 하시는것은 가능<br>합니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-23T05:03:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Gks9tIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-23T04:53:56Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-23T04:53:56Z</b><br><br>안녕하세요.<br><br>아래와 같은 결과물을 받았습니다.<br><br>weblogic@SLTAFIAL01 /APP/apache/bin # rpm -qf /APP/apache/bin/httpd file<br> /APP/apache/bin/httpd is not owned by any package<br>weblogic@SLTAFIAL01 /APP/apache/bin # rpm -qf /APP/apache/conf/httpd.conf file <br>/APP/apache/conf/httpd.conf is not owned by any package<br><br>위의 결과물은 <br>번들패키지가 아닌 부분으로 보면 되는 것인지요??<br><br>더이상 case open이 불가능한 것인지 확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2016-03-23T04:53:56Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GkrJ9IAJ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-23T02:05:16Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-23T02:05:16Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>유선상으로 말씀 드린 내용을 다시 설명을 드리자면 현재의 apache 웹서버의 설치 위치를 아래와 같이<br>rpm 데이터베이스를 검색해서 httpd-xxx 로 시작하는 패키지명이 나와야 저희 Red Hat 에서 지원이<br>되는 항목입니다.<br><br>$ rpm -qf /APP/apache/bin/httpd 또는 rpm -qf /APP/apache/conf/httpd.conf <br><br><br>감사합니다.<br><br><publishedDate>2016-03-23T02:05:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000GkqRdIAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2016-03-23T01:51:00Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2016-03-23T01:51:00Z</b><br><br>안녕하세요. 답변 감사합니다.<br>두가지 질문을 드립니다.<br><br>1. 해당 버전이 어떤 면에서 레드햇에서 제공되는 버전이 아니라고 보시는지 알수 있을까요??<br><br>2. 현재 다수의 defunct 발생으로 인해 접속이 원활하지 않는 상태입니다.  해당 문제의 원인을 알아 볼수 있는 접근방법 을 알려주시기 바랍니다.<br>필요하시면 config와 명령어를 첨부 해드릴 있습니다.<br><br><br>감사합니다.<br><br><publishedDate>2016-03-23T01:51:00Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000GkpplIAB"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2016-03-23T01:16:23Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2016-03-23T01:16:23Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>defunct 프로세스는 좀비 프로세스로서 사실상 더 이상 존재하지 않는 프로세스 입니다. 이는 시스템 리소스를 더 이상 사용하지<br>않긴 하지만, 커널에서는 process table 에서 entry 가 존재하는 상태이긴 합니다. 그래서, 무시해도 상관이 없기는 하나 이를<br>완전히 사라지게 하려면 시스템을 리부팅하거나 부모 프로세스의 실행을 완전히 종료시켜야 가능합니다.<br><br>자세한 내용은 아래의 참고문서[1],[2] 를 활용하시길 바랍니다.<br><br><br>* Note<br>- 올려주신 설명중에 아파치 웹서버의 설치 위치로 보아서는 저희 Red Hat 에서 제공이 되는 rpm 형식의 소프트웨어가 아닌것으로<br>  보입니다. 이는 저희 기술지원 범위에 해당이 되지 않으므로 본 케이스와 관련된 추가 문의는 더 이상 어렵다는 말씀을 드립니다.<br>  기술지원 범위에 대한 자세한 내용은 아래의 참고문서[3]을 읽어보시길 바랍니다.<br><br><br>[ 참고문서 ]<br><br>[1] What is defunct process ?<br>- https://access.redhat.com/solutions/41173<br><br>[2] How to kill Zombie/Defunct process ?<br>- https://access.redhat.com/solutions/417253<br><br>[3] Production Support Scope of Coverage<br>- https://access.redhat.com/support/offerings/production/soc<br><br><br>감사합니다.<br><br><publishedDate>2016-03-23T01:16:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br> <br>weblogic@SLPAFIEL01 /home/weblogic # ps -ef |grep http <br> <br>weblogic 3728 13364 0 16:24 ? 00:00:00 [httpd] weblogic 3757 3387 0 16:24 pts/3 00:00:00 grep --color=auto http root 13364 1 0 Mar17 ? 00:00:05 /APP/apache/bin/httpd -f /APP/apache/conf/httpd.conf -k start <br> <br>혹시 해당 문제점을 해결하기 위해 필요한 로그나 절차가  있으시면 가이드 부탁 드립니다.</issue><timeFramesAndUrgency>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 박우진 (선임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  +82-10-2062-0157<br>- 메일주소 : 박우진 &lt;ewoojinn.park@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(선임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================</timeFramesAndUrgency><cep>false</cep></case>