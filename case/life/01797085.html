======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-02-22T07:00:29Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-03-18T10:03:54Z</b><br><b>id : 500A000000WUPgEIAX</b><br>======================<br><br><b><font size=15>
제목  : [기술문의]RHCS 스크립트 모니터링문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>RHCS구성이 완료된 서버에서 페일오버 관련해 기술문의 드립니다.<br>현재 구성에서 만약 <br>오라클이 죽었때를 페일오버가 되는 구성인지 확인 부탁드리며,<br>만약된다면 RHCS에서 일정한 간격으로 어떠한 프로세스를 모니터링 해서 페일오버가 되는지 확인 부탁드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.4</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000IwdREIAZ"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-03-03T01:49:49Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-03-03T01:49:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>아래와 같이 설정 하시면 안됩니다. 1번 노드에는 1번 노드를 fencing 시킬때 <br>사용 하는 디바이스를 지정 하셔야 하며 2번 노도에는 2번 노드를 fencing <br>시킬때 사용 하는 디바이스를 지정 하셔야 합니다. <br><br>                &lt;clusternode name=&quot;flptrsd01.cs&quot; nodeid=&quot;1&quot;&gt;<br>                        &lt;fence&gt;<br>                                &lt;method name=&quot;Method1&quot;&gt;<br>                                        &lt;device name=&quot;ipmifence2&quot;/&gt;   &lt;---------------2번노드<br>                                &lt;/method&gt;<br>                        &lt;/fence&gt;<br>                &lt;/clusternode&gt;<br>                &lt;clusternode name=&quot;flptrsd02.cs&quot; nodeid=&quot;2&quot;&gt;<br>                        &lt;fence&gt;<br>                                &lt;method name=&quot;Method1&quot;&gt;<br>                                        &lt;device name=&quot;ipmifence1&quot;/&gt; &lt;-----------------1번노드<br>                                &lt;/method&gt;<br>                        &lt;/fence&gt;<br>                &lt;/clusternode&gt;<br><br>즉 아래와 같이 설정 하시면 됩니다. <br><br>                &lt;clusternode name=&quot;flptrsd01.cs&quot; nodeid=&quot;1&quot;&gt;<br>                        &lt;fence&gt;<br>                                &lt;method name=&quot;Method1&quot;&gt;<br>                                       &lt;device name=&quot;ipmifence1&quot;/&gt; &lt;-----------------1번노드 <br>                                &lt;/method&gt;<br>                        &lt;/fence&gt;<br>                &lt;/clusternode&gt;<br>                &lt;clusternode name=&quot;flptrsd02.cs&quot; nodeid=&quot;2&quot;&gt;<br>                        &lt;fence&gt;<br>                                &lt;method name=&quot;Method1&quot;&gt;                                        <br>                                        &lt;device name=&quot;ipmifence2&quot;/&gt;   &lt;---------------2번노드<br>                                &lt;/method&gt;<br>                        &lt;/fence&gt;<br>                &lt;/clusternode&gt;<br><br><br>2-node 클러스터일 경우에 핫빗망 절체 되었을 때 양 노드 모두 quorate 상태로 <br>되어 있어 모두 fencing을 날리는 능력을 가지고 있습니다. 이럴 경우에 따로 <br>조치를 하지 않으면 서로 fencing이 될수 있습니다. <br><br>따라서, fencing device에 delay 값을 주거나 tie-breaker를 설정 하셔야 <br>합니다. <br><br>관련 하여 아래와 같은 링크에서 자세히 설명 되어 있으니 참고 부탁드립니다. <br><br>Delaying Fencing in a Two Node Cluster to Prevent Fence Races or <br>&quot;Fence Death&quot; Scenarios <br>- https://access.redhat.com/solutions/54829<br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-03-03T01:49:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000IwLMqIAN"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-03-02T04:28:02Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-03-02T04:28:02Z</b><br><br>답변감사합니다.<br>현재 클러스터에 파워펜싱을 추가 하기로 하였습니다.<br>아래의 구성방법으로 추가를 진행하고 하는데요.<br>제가 궁금한 부분은<br>======================<br>node1 에 node2 ipmilan을 설정한는 것이 맞는지 확인 부탁드립니다.<br><br>&lt;?xml version=&quot;1.0&quot;?&gt;<br>&lt;cluster config_version=&quot;85&quot; name=&quot;cl_TRSD&quot;&gt;<br>        &lt;fence_daemon post_fail_delay=&quot;0&quot; post_join_delay=&quot;3&quot;/&gt;<br>        &lt;clusternodes&gt;<br>                &lt;clusternode name=&quot;flptrsd01.cs&quot; nodeid=&quot;1&quot;&gt;<br>                        &lt;fence&gt;<br>                                &lt;method name=&quot;Method1&quot;&gt;<br>                                        &lt;device name=&quot;ipmifence2&quot;/&gt;   &lt;---------------2번노드<br>                                &lt;/method&gt;<br>                        &lt;/fence&gt;<br>                &lt;/clusternode&gt;<br>                &lt;clusternode name=&quot;flptrsd02.cs&quot; nodeid=&quot;2&quot;&gt;<br>                        &lt;fence&gt;<br>                                &lt;method name=&quot;Method1&quot;&gt;<br>                                        &lt;device name=&quot;ipmifence1&quot;/&gt; &lt;-----------------1번노드<br>                                &lt;/method&gt;<br>                        &lt;/fence&gt;<br>                &lt;/clusternode&gt;<br>        &lt;/clusternodes&gt;<br>        &lt;cman expected_votes=&quot;1&quot; two_node=&quot;1&quot;&gt;<br>                &lt;multicast addr=&quot;239.192.111.234&quot;/&gt;<br>                &lt;altmulticast addr=&quot;239.192.111.235&quot;/&gt;<br>        &lt;/cman&gt;<br>        &lt;fencedevices&gt;<br>                &lt;fencedevice agent=&quot;fence_scsi&quot; devices=&quot;/dev/mapper/ext0, /dev/mapper/ext1, /dev/mapper/ext2, /dev/mapper/ext3&quot; name=&quot;scsi_fence&quot;/&gt;<br>                &lt;fencedevice agent=&quot;fence_ipmilan&quot; ipaddr=&quot;10.1.0.202&quot; login=&quot;admin&quot; name=&quot;ipmifence1&quot; passwd=&quot;123qwe..&quot;/&gt;<br>                &lt;fencedevice agent=&quot;fence_ipmilan&quot; ipaddr=&quot;10.1.0.205&quot; login=&quot;admin&quot; name=&quot;ipmifence2&quot; passwd=&quot;123qwe..&quot;/&gt;<br>        &lt;/fencedevices&gt;<br><br>위의 구성이 맞다면<br>만약 하트비트 망이 죽었을때 <br>어느쪽 노드가 먼저 죽는지 확인은 어떻게 하는것인지 궁금합니다.<br>그리고 1번 노드만 우선적으로 펜싱되게 하는 파라메타 확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-02T04:28:02Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Iv08CIAR"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-02-23T08:14:21Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-02-23T08:14:21Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>script 리소스 작성 예시는 제공 되고 있지 않지만 아래의 링크 내용이 다소 도움 <br>될수 있을 것 같아서 아래와 같이 첨부 해 드립니다. <br><br>참고 자료:<br>Where can I find resources to help me create a custom resource agent <br>scripts for Red Hat High Availability clusters? <br>- https://access.redhat.com/solutions/189823<br><br>status 확인시 exit 값이 0이라면 상태 체크가 성공 되고 만약 0이 아닌 양수로 exit<br>되면은 상태체크가 실패되고 페일오버 발생 할수 있습니다. <br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-02-23T08:14:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Iuz49IAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-02-23T06:17:20Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-02-23T06:17:20Z</b><br><br>답변감사합니다.<br>혹시 프로세스를 모니터링해서 페일오버를 하는 <br>스크립트 예시를 받아 볼수 있을까요??<br><br>현재<br>#! /bin/sh<br># Oracle            Start/Stop the Oracle ServerManager<br>#<br># description: Oracle 11G is an Enterprise Database System<br># processname: oracle<br># pidfile: /var/run/oracle.pid<br><br>....생략....<br>status)<br>if [ $(ps -ef | grep -i ora_ | grep -v grep | wc -l) -lt 3 ];  -&gt; 3은 오라클에서 필수적으로 충족되어야 할 프로세스 갯수가 3보다 작으면 NOT RUNNING  크면 RUNNING<br>then    <br>echo &quot;NOT running&quot;    logger &quot;EXCUTE :/etc/cluster/init.oracle [ NOT RUNNING ]&quot;    <br>exit 1 <br>else    <br>echo &quot;running&quot;    logger &quot;EXCUTE :/etc/cluster/init.oracle [ RUNNING ]&quot;    <br>exit 0 <br>fi<br>;;<br>restart)<br><br>와같은 스크립트로 진행하고자 하는데<br>추가적인 예시가 있으면 회신부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-02-23T06:17:20Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000IuxJHIAZ"><br>======================<br><b>생성계정 : Zheng, Meiyan</b><br><b>생성날짜 : 2017-02-23T02:07:55Z</b><br><b>마지막 답변자 : Zheng, Meiyan</b><br><b>마지막 수정 일자 : 2017-02-23T02:07:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용 해 주셔서 감사합니다. <br><br><br>클러스터 설정 파일을 보면 서비스 부분에서 아래와 같은 리소스들 등록 되어 있습니다. <br><br>&lt;service domain=&quot;cluster-FD&quot; name=&quot;svc_TRSD&quot; recovery=&quot;relocate&quot;&gt;<br>           &lt;ip ref=&quot;100.254.40.167&quot;/&gt;<br>           &lt;fs ref=&quot;oracle&quot;/&gt;<br>           &lt;fs ref=&quot;oracle_arch&quot;/<br>           &lt;fs ref=&quot;dbadmin&quot;/&gt;<br>           &lt;script ref=&quot;oracle_TRSD&quot;/&gt;<br>&lt;/service&gt;<br><br>여기서 오라클 상태는 script 파일 /etc/cluster/init.oracle 통해 확인 하는 것으로 <br>보입니다. <br><br>만약에 rgmanager에서 /etc/cluster/init.oracle status 실행시 exit 값이 0이 아이면 <br>서비스 페일오버가 발생 할수 있습니다. <br><br>오라클이 죽었을 경우에 /etc/cluster/init.oracle status 실행시 exit 값이 0이 아니라고 <br>생각 하여 서비스 페일오버 발생 할수 있다고 생각 됩니다. <br><br>클러스터에서 script 리소스는 30s 한번씩 상태를 확인 합니다. <br><br>만약에 리소스 실패 경우 한번 recover 시도를 하게 설정 하시려면 리소스에 <br>__independent_subtree=&quot;1&quot; 로 설정 하시면 됩니다. <br><br>&lt;script name=&quot;script_one&quot; __independent_subtree=&quot;1&quot; ...&gt;<br><br>참고 자료:<br>How do I make a RHEL HA resource non-critical? <br>- https://access.redhat.com/solutions/30187<br><br><br>감사합니다. <br><br>Red Hat GSS<br>정미연 드림<br><br><publishedDate>2017-02-23T02:07:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>