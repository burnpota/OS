======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-03-27T04:27:30Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-04-16T10:03:55Z</b><br><b>id : 500A000000WkYXiIAN</b><br>======================<br><br><b><font size=15>
제목  : [로그문의]kernel : scsi target0:0:1: FAST-40
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>고객의 요청에 의해서 아래의 로그 분석 부탁드립니다.<br><br>--&lt;아래&gt;<br>Warning (IPADMCI1) (Syslog) Mar 27 09:36:18 IPADMCI1 kernel: scsi target0:0:1: FAST-40 WIDE SCSI 80.0 MB/s ST (25 ns, offset 127) (TIME 03/27 09:36)<br><br>RHEL6버전이며<br>가상화 서버입니다.<br><br>해당 로그가 타서버에서는 발생하지 않으나 위의 서버가 지속적으로 발생하고 있습니다.<br><br>추가 필요하신 자료가 있으시면 요청 부탁드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.3</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 4 (Low)</b><br>======================<br><comment id="a0aA000000JBKfFIAX"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-03-31T02:24:28Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-03-31T02:24:28Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>RHEL 측면에서 더 분석을 할만 지금 현재는 없는 상태입니다. 더 상세한 분석을 위해서는 mptbase 드라이버를 Debug mode 로 전환해서<br>이슈를 재현해야만 가능한 일입니다. 이슈가 재현이 된다고 하더라도 결국 mptbase 드라이버 측면에서 나타나는 trace 를 분석해서 안내를 <br>드려야 하는데, 이것이 VMWare Tools 와 관련된것이라면 또 다시 VMWare Tools 드라이버에서 원인분석을 하셔야 하는 어려움이 있으니<br>이를 참고하셔서 VMWare 로 기술문의 해보십시오.<br><br>감사합니다.<br><br><publishedDate>2017-03-31T02:24:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JBKZCIA5"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-03-31T02:13:51Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-03-31T02:13:51Z</b><br><br>답변감사합니다.<br><br>해당 부분에 대해서 vmware업체에서 특별한 이슈를 발견할수 없었다고 해서 <br>더욱 자세한 분석을 요청하였습니다.<br><br>더불어 타업체에서 <br>리눅스 OS에 추가로 확인 할 수있는 부분이 없는지를 다시한번 확인요청이 왔습니다.<br><br>혹시 추가적으로 가능성이 있는 부분이 있을까요??<br><br>일단 현재 vmtools는 최신버전이 아닌 상태라고 해서 vmtools를 최신으로 업데이트후에 상황을 관찰해 보겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-31T02:13:51Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JAY4VIAX"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-03-28T07:09:46Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-03-28T07:09:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q) mptbase 드라이버가 vmware에서 제공되는 드라이버 인가요?<br>A) RHEL 커널내에 포함이 되어 있는 드라이버입니다. 하지만, VM 상에서 이 드라이버를 통해서 보내는 SCSI 명령어들은 VM 에 설치된<br>   VMWare Tools 의 드라이버를 거쳐서 Host 에 연결이 되어 있는 스토리지로 보내어지기 때문에 VMWare 와 연관이 있는 이슈로 <br>   이해하시면 됩니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-28T07:09:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JAXzfIAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-03-28T07:01:45Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-03-28T07:01:45Z</b><br><br>답변감사합니다.<br>mptbase 드라이버가 vmware에서 제공되는 드라이버 인가요??<br><br><publishedDate>2017-03-28T07:01:45Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JAXEpIAP"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-03-28T05:39:23Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-03-28T05:40:09Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q1) 위의 메시지는 mptbase 드라이버가 디스크로 시도중인 task 를 취소하여 위와 같이 이 오퍼레이션들이 hung task 가 되었습니다.<br>이 후 mptbase 드라이버가 다시 Reset 을 발행했는데 태스크들이 모두 취소되고 해당 SCSI 타겟들이 유효하다는거을 확인하여서<br>SCSI 드라이버 자체가 해당 LUN 으로 테스트를 완료했다는 메시지입니다.<br><br>&lt;--위의 내용이 전혀 이해가 되지 않는데요.<br>정상적으로 처리가 되었다는 말씀이신가요?<br><br>A1) mptbase 드라이버에서 일어나던 task 가 중지되어서, 드라이버가 자체적으로 Reset 을 해서 SCSI 타겟들이 유효검증 단계를 진행<br>   했다라고 이해하시면 됩니다. 위의 hung task 메시지가 일어난 원인이 mptbase 의 task 가 중지된것이기 때문에 이는 정상적으로<br>   처리가 되지 않은것입니다.<br><br><br>Q2) 그래서, 이슈는 말씀하신 &quot;FAST-40 WIDE SCSI 80.0 MB/s ST&quot; 메시지가 발생된 원인분석 보다는 &quot;mptscsih: ioc0: attempting<br>     task   abort&quot; 왜 mptbase 드라이버가 task 를 취소했는지를 확인해야할것입니다.<br><br>&lt;--위의 내용중에 FAST-40 WIDE SCSI 80.0 MB/s ST 발생하는 원인은 알수 없나요??<br>아니면 mptscsih: ioc0: attempting task abort 때문에 위의 로그가 발생하는 것인가요??<br><br>A2) &quot;FAST-40 WIDE SCSI 80.0 MB/s ST&quot; 의 발생원인은 mptbase 드라이버가 Reset 하여 타겟 LUN 에 테스트 과정을 검증한 메시지<br>    입니다. 그래서, 이는 Reset 이 되었기 때문에 나타난것이고, 이 Reset 이 왜 일어났는지가 중요한데 mptbase 드라이버가 task 를<br>    중지했기 때문입니다. task 가 중지된 원인으로는 호스트와 연결된 스토리지의 연결문제일 수도 있고, 이전에 말씀드렸던 VMWare 에서 제<br>    공되는 para-virtualized 드라이버의 버그로 인해서 나타날 수 도 있으니, 하드웨어/스토리지 벤더와 VMWare 에 연락하셔서 지원받으<br>    실것을 권장드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-28T05:39:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JAXBBIA5"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-03-28T05:27:53Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-03-28T05:27:53Z</b><br><br>답변 감사합니다.<br>해당 내용에 대해서 정확한 이해가 안되서 재차 질문드립니다.<br><br>위의 메시지는 mptbase 드라이버가 디스크로 시도중인 task 를 취소하여 위와 같이 이 오퍼레이션들이 hung task 가 되었습니다.<br>이 후 mptbase 드라이버가 다시 Reset 을 발행했는데 태스크들이 모두 취소되고 해당 SCSI 타겟들이 유효하다는거을 확인하여서<br>SCSI 뜨라이버 자체가 해당 LUN 으로 테스트를 완료했다는 메시지입니다.<br><br>&lt;--위의 내용이 전혀 이해가 되지 않는데요.<br>정상적으로 처리가 되었다는 말씀이신가요?<br><br>그래서, 이슈는 말씀하신 &quot;FAST-40 WIDE SCSI 80.0 MB/s ST&quot; 메시지가 발생된 원인분석 보다는 &quot;mptscsih: ioc0: attempting task abort&quot; 왜 mptbase 드라이버가 task 를 취소했는지를 확인해야할것입니다.<br><br>&lt;--위의 내용중에 FAST-40 WIDE SCSI 80.0 MB/s ST 발생하는 원인은 알수 없나요??<br>아니면 mptscsih: ioc0: attempting task abort 때문에 위의 로그가 발생하는 것인가요??<br><br><publishedDate>2017-03-28T05:27:53Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JAVfeIAH"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-03-28T02:10:01Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-03-28T04:41:16Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>1472 Mar 27 07:27:13 IPADMCI1 kernel: mptscsih: ioc0: attempting task abort! (sc=ffff88013862e380)<br>1473 Mar 27 07:27:13 IPADMCI1 kernel: sd 0:0:0:0: [sda] CDB: Write(10): 2a 00 03 25 a0 88 00 00 18 00<br>1474 Mar 27 07:27:18 IPADMCI1 kernel: INFO: task jbd2/sda2-8:384 blocked for more than 120 seconds.<br>1475 Mar 27 07:27:18 IPADMCI1 kernel: &quot;echo 0 &gt; /proc/sys/kernel/hung_task_timeout_secs&quot; disables this message.<br>1476 Mar 27 07:27:18 IPADMCI1 kernel: jbd2/sda2-8   D 0000000000000001     0   384      2 0x00000000<br>1477 Mar 27 07:27:18 IPADMCI1 kernel: ffff880138fc9c20 0000000000000046 0000000000000000 0000000000000001<br>1478 Mar 27 07:27:18 IPADMCI1 kernel: ffff880138fc9b90 ffffffff81012c59 ffff880138fc9bd0 ffffffff810a2431<br>1479 Mar 27 07:27:18 IPADMCI1 kernel: ffff880138db5058 ffff880138fc9fd8 000000000000fb88 ffff880138db5058<br>1480 Mar 27 07:27:18 IPADMCI1 kernel: Call Trace:<br>1481 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff81012c59&gt;] ? read_tsc+0x9/0x20<br>1482 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff810a2431&gt;] ? ktime_get_ts+0xb1/0xf0<br>1483 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff810a2431&gt;] ? ktime_get_ts+0xb1/0xf0<br>1484 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff811b62b0&gt;] ? sync_buffer+0x0/0x50<br>1485 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff8150e953&gt;] io_schedule+0x73/0xc0<br>1486 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff811b62f0&gt;] sync_buffer+0x40/0x50<br>1487 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff8150f30f&gt;] __wait_on_bit+0x5f/0x90<br>1488 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff811b62b0&gt;] ? sync_buffer+0x0/0x50<br>1489 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff8150f3b8&gt;] out_of_line_wait_on_bit+0x78/0x90<br>1490 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff81096de0&gt;] ? wake_bit_function+0x0/0x50<br>1491 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff81096c67&gt;] ? bit_waitqueue+0x17/0xd0<br>1492 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff811b62a6&gt;] __wait_on_buffer+0x26/0x30<br>1493 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffffa00b1116&gt;] jbd2_journal_commit_transaction+0xaa6/0x1500 [jbd2]<br>1494 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff810096f0&gt;] ? __switch_to+0xd0/0x320<br>1495 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff81081b5b&gt;] ? try_to_del_timer_sync+0x7b/0xe0<br>1496 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffffa00b7148&gt;] kjournald2+0xb8/0x220 [jbd2]<br>1497 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff81096da0&gt;] ? autoremove_wake_function+0x0/0x40<br>1498 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffffa00b7090&gt;] ? kjournald2+0x0/0x220 [jbd2]<br>1499 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff81096a36&gt;] kthread+0x96/0xa0<br>1500 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff8100c0ca&gt;] child_rip+0xa/0x20<br>1501 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff810969a0&gt;] ? kthread+0x0/0xa0<br>1502 Mar 27 07:27:18 IPADMCI1 kernel: [&lt;ffffffff8100c0c0&gt;] ? child_rip+0x0/0x20<br><br>위의 메시지는 mptbase 드라이버가 디스크로 시도중인 task 를 취소하여 위와 같이 이 오퍼레이션들이 hung task 가 되었습니다.<br>이 후 mptbase 드라이버가 다시 Reset 을 발행했는데 태스크들이 모두 취소되고 해당 SCSI 타겟들이 유효하다는거을 확인하여서<br>SCSI 뜨라이버 자체가 해당 LUN 으로 테스트를 완료했다는 메시지입니다.<br><br>1503 Mar 27 07:27:23 IPADMCI1 kernel: mptscsih: ioc0: WARNING - Issuing Reset from mptscsih_IssueTaskMgmt!! doorbell=0x24000000<br>1504 Mar 27 07:27:23 IPADMCI1 kernel: mptscsih: ioc0: task abort: SUCCESS (rv=2002) (sc=ffff88013862e380)<br>1505 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:0: Beginning Domain Validation<br>1506 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:0: Domain Validation skipping write tests<br>1507 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:0: Ending Domain Validation<br>1508 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:0: FAST-40 WIDE SCSI 80.0 MB/s ST (25 ns, offset 127)<br>1509 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:1: Beginning Domain Validation<br>1510 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:1: Domain Validation skipping write tests<br>1511 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:1: Ending Domain Validation<br>1512 Mar 27 07:27:23 IPADMCI1 kernel: scsi target0:0:1: FAST-40 WIDE SCSI 80.0 MB/s ST (25 ns, offset 127)<br><br>그래서, 이슈는 말씀하신 &quot;FAST-40 WIDE SCSI 80.0 MB/s ST&quot; 메시지가 발생된 원인분석 보다는 &quot;mptscsih: ioc0: attempting task abort&quot; 왜 mptbase 드라이버가 task 를 취소했는지를 확인해야할것입니다.<br><br>이는 아래의 참고문서[1]에서 알려진것과 같이 이는 VMWare 호스트상에서 스토리지 문제가 있다라는것을 의미합니다.<br>VMWare 사로 연락하셔서 스토리지 설정이 올바른지 확인하실것을 권장드립니다. 더불어 말씀을 드리자면, 대부분의 경우에<br>위와같은 timeout 에러는 VMWare 에서 제공되는 para-virtualized 드라이버를 제공하는 최신버전의 VMWare Tools<br>패키지를 설치하므로서 해소가 되는것으로 알려져 있습니다.<br><br>그리고, VMWare 에서 권장할것으로 예상이 되는 SCSI 드라이버의 timeout 값을 180 로 올리시면 이 이슈를 해소하는데 도움이<br>될것입니다.<br><br>[1] Example<br><br>To get current timeout value for /dev/sda device:<br># cat /sys/block/sda/device/timeout<br><br>To set timeout value for /dev/sda device:<br># echo 180 &gt; /sys/block/sda/device/timeout<br><br>*** NOTE: Settings made in this manner are not persistent.  To make them persist across reboots the commands can be added to the '/etc/rc.local' file.  This file is read at each reboot and the new values will be applied.<br><br><br>[ 참고문서 ]<br><br>[1] The message &quot;mptscsih: ioc0: attempting task abort!&quot; repeats in the system log of VMware guest<br>- https://access.redhat.com/solutions/108273<br><br><br>감사합니다.<br><br><publishedDate>2017-03-28T02:10:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JAVLbIAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-03-28T01:34:38Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-03-28T01:34:38Z</b><br><br>sosreport 첨부해드립니다.<br><br><publishedDate>2017-03-28T01:34:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JAEq7IAH"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-03-27T04:52:46Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-03-27T04:52:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>현재 올려주신 문의내용을 자세히 살펴보기 위해서 sosreport 케이스에 올려주시길 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-03-27T04:52:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>