======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2019-03-08T07:49:20Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2019-03-25T08:43:09Z</b><br><b>id : 5002K00000dNqm2QAC</b><br>======================<br><br><b><font size=15>
제목  : 서버 네트워크 라우팅관련 문의
</font></b><br><br>======================<br><actionPlan>* RPF를 disable 하시거나 non-strict mode로 설정하실수 있습니다.<br> <br>net.ipv4.conf.all.rp_filter = 0 혹은 2</actionPlan><b>사전문의<br></b><br>안녕하십니까 타임게이트 오선우입니다<br>타임게이트 / 오선우 / 수석보 / 010-4630-3171 / sw.oh@time-gate.com<br><br>고객사에 아래와 같은 이슈가 있습니다<br>전달상에 문제가 있을수 있어 그대로 남겨드립니다<br><br>한쪽으로는 통신이 가능한데 반대쪽으로 통신이 되지 않는 증상이 있습니다<br>각대역의 게이트웨이까지 ping 통신은 된다는 내용을 유선상으로 확인하였습니다<br><br>리눅스서버 즉 A서버의 sosreport 파일 dropbox에 첨부하였습니다<br><br>1. sosreport상이나 라우팅 설정등 네트워크 설정상에 문제가 되는 부분이 있는지 확인 부탁드립니다<br><br>2. 추가로 필요한 정보가 있으면 말씀해주시면 전달해드리도록 하겠습니다<br><br>3. 드롭박스에 첨부된  sosreport 파일 링크하나만 부탁드립니다<br>저도 한번 확인해보도록 하겠습니다<br><br>감사합니다<br><br><br>--------------------------------------<br><br>서버 네트워크 라우팅관련 문의 드립니다.<br><br> A -&gt; B 서버로 통신이 되는데 반대로는 통신이 안되는 현상이 있어 문의드립니다.<br><br> 아래 내용 참고 부탁드리며, 서버 쪽 라우팅 이슈나 다른 문제가 있는지 확인 부탁드립니다.<br><br><br> sosreport는 dropbox로 업로드 하였습니다.<br><br> (파일명 : sosreport-PBISAL01SL-20190308153901.tar.xz)<br><br> <br><br>[문의 내용]<br><br>■ A 서버<br><br>  - RHEL 7.2<br><br>  - 100.254.143.0 대역, 100.254.147.0 대역 IP 소유 (Default gw : 100.254.143 대역)<br><br>■ B 서버<br><br>  - Windows<br><br>  - 100.254.147.0 대역 IP 소유<br><br>■ 현상<br><br>  - B 서버 (100.254.147.0 대역) -&gt; A 서버 (100.254.143.0 대역) 통신 불가. 반대는 가능<br><br>  - B 서버 (100.254.147.0 대역) -&gt; A 서버 (100.254.147.0 대역) 통신 가능. 반대도 가능<br><br> <br><br>(B 서버) C:\Users\erp_admin&gt; ping 100.254.143.yyy -t<br><br>Pinging 100.254.143.yyy with 32 bytes of data:<br>Request timed out.<br>Request timed out.<br><br> <br><br>(A 서버) # /sbin/tcpdump -nn -i eno16780032 host 100.254.147.xxx<br>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode<br>listening on eno16780032, link-type EN10MB (Ethernet), capture size 65535 bytes<br>15:26:59.824243 IP 100.254.147.xxx &gt; 100.254.143.yyy: ICMP echo request, id 1, seq 297, length 40<br>15:27:04.777108 IP 100.254.147.xxx &gt; 100.254.143.yyy: ICMP echo request, id 1, seq 298, length 40<br><br> <br><br>(A 서버) # ping 100.254.147.xxx<br>PING 100.254.147.145 (100.254.147.xxx) 56(84) bytes of data.<br>64 bytes from 100.254.147.xxx: icmp_seq=1 ttl=128 time=0.361 ms<br>64 bytes from 100.254.147.xxx: icmp_seq=2 ttl=128 time=0.159 ms<br><br><br>(A 서버) # route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         100.254.143.1   0.0.0.0         UG    0      0        0 eno16780032<br>100.254.69.224  100.254.147.1   255.255.255.255 UGH   0      0        0 eno67109888<br>100.254.143.0   0.0.0.0         255.255.255.0   U     0      0        0 eno16780032<br>100.254.145.0   100.254.143.11  255.255.255.0   UG    0      0        0 eno16780032<br>100.254.147.0   0.0.0.0         255.255.255.0   U     0      0        0 eno67109888<br>169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eno67109888<br>169.254.0.0     0.0.0.0         255.255.0.0     U     1003   0        0 eno16780032<br>169.254.0.0     0.0.0.0         255.255.0.0     U     1004   0        0 eno33559296<br>169.254.0.0     0.0.0.0         255.255.0.0     U     1005   0        0 eno50338560<br>172.18.12.0     172.18.13.1     255.255.255.0   UG    0      0        0 eno33559296<br>172.18.13.0     0.0.0.0         255.255.255.0   U     0      0        0 eno33559296<br>172.18.14.0     172.18.13.1     255.255.255.0   UG    0      0        0 eno33559296<br>172.18.15.0     172.18.13.1     255.255.255.0   UG    0      0        0 eno33559296<br>172.18.21.0     0.0.0.0         255.255.255.0   U     0      0        0 eno50338560<br><br>--------------------------------------------<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PBISAL01SL</hostname><br><br><br><comment id="a0a2K00000PmyUpQAJ"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-25T08:42:46Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-25T08:42:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service입니다.<br><br>본 케이스를 종료처리 하고자 합니다.<br>만약 본 케이스와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.  <br>  <br>케이스가 처리 완료되면 가능하게 고객 설문조사 메일이 발생됩니다. <br>고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. <br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.  <br>  <br>감사합니다.<br><br><publishedDate>2019-03-25T08:42:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PYuZnQAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-19T09:55:52Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-19T09:55:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 입니다.<br><br>본 케이스와 연관되어 추가적으로 문의하실 사항이 있으신가요?<br><br>본 안내 후 일정기간 답변이 없다면 본 케이스는 자동으로 종료 상태가 됨을 알려 드립니다.<br><br>만약 추가적인 지원이 필요하시다면, 연락 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-19T09:55:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PWwZjQAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-11T06:22:46Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-11T06:22:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>&gt;해당 커널파라미터가 기본값이 1인가요?<br><br>네 맞습니다, 기본 값이 1입니다.<br><br>&gt;RPF에 대한 내용은 저도 찾아보고 있는데요 관련 기능을 disable 하여도 특이사항이 없나요?<br><br>네 특이사항은 없을 것으로 보입니다. 실제 환경의 요구에 맞게 설정하셔도 문제 없습니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-11T06:22:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PWw5bQAD"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2019-03-11T05:37:54Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2019-03-11T05:37:53Z</b><br><br>안녕하십니까 <br><br><br>따로 sysctl.conf에는 해당내용이 적용 안되어 있는것 같은데요  <br><br>따로 변경되었을 가능성이 있는건가요?<br><br>해당 커널파라미터가 기본값이 1인가요?<br><br>해당 값은 모든 서버에 적용이 필요한 상황인가요?<br><br>말씀해주신대로 sysctl -a 에는 1로 변경되어 있는것 같은데요<br><br>RPF에 대한 내용은 저도 찾아보고 있는데요 관련 기능을 disable 하여도 특이사항이 없나요?<br><br>다시한번 확인 부탁드립니다<br><br>감사합니다<br><br><publishedDate>2019-03-11T05:37:53Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PWv0sQAD"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-11T03:33:21Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-11T03:33:21Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>해당 현상이 발생하는 원인은 아래의 커널 파라메터 때문입니다.<br><br>$ cat sos_commands/kernel/sysctl_-a | grep all.rp_filter<br>net.ipv4.conf.all.rp_filter = 1<br><br>Why can't a server be pinged if net.ipv4.conf.all.rp_filter is set on the server?<br> https://access.redhat.com/solutions/32261<br><br><br>서버 B에서 A 서버 (100.254.143.0 대역) 로 ping을 진행하면, ICMP 패킷은 A서버에서 해당 대역의 IP로 할당된 eno16780032 에서 수신합니다. <br>하지만 reply 패킷은 B 서버 (100.254.147.0 대역) 로 가야하기 때문에 147.0 대역 IP로 할당된 eno67109888에서 송신하게 됩니다.<br>이때 패킷을 받은 인터페이스와(eno16780032), 패킷을 보내야 하는 인터페이스(eno67109888)가 매칭이 안되면,<br>rp_filter를 1로 설정한 노드에서는 해당 패킷을 보내지 않습니다.<br><br>해당 이슈를 해결하려면 아래와 같이 조치하실 수 있습니다.<br>-----<br>* RPF를 disable 하시거나 non-strict mode로 설정하실수 있습니다.<br> <br>net.ipv4.conf.all.rp_filter = 0 혹은 2<br>-----<br><br>감사합니다.<br><br><publishedDate>2019-03-11T03:33:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PWuAjQAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2019-03-11T01:12:02Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2019-03-11T01:12:02Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>저는 Platform Support 를 담당하고 있는 Technical Support Engineer 이성빈입니다.<br>올려주신 문의내용은 현재 자세히 살펴보고 있는중이며, 관련된 내용이 확인이 되는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-11T01:12:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>