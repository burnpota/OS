======================<br><b>생성계정 : 타임게이트 (주)</b><br><b>생성날짜 : 2017-11-06T05:22:34Z</b><br><b>마지막 답변자 : Ted Won</b><br><b>마지막 수정 일자 : 2017-11-13T01:27:08Z</b><br><b>id : 500A000000Z1mUrIAJ</b><br>======================<br><br><b><font size=15>
제목  : [삼성생명] 번들 http server - SAP netweaver 연동 간 header size 관련 이슈
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br>삼생생명 차세대 ERP 관련 이슈에 대하여 하기와 같이 문의가 요청되어 SR 생성드립니다. <br><br>## 고객정보 ##<br>고객사 : 삼성생명<br>고객명 : 박현우 선임<br>연락처 : 010-9104-2853<br>##<br><br>## 환경 ##<br>-OS : RHEL7<br>-WEB : 번들 HTTP<br>rpm -qf /usr/sbin/httpd<br>httpd-2.4.6-40.el7.x86_64<br>-WAS : SAP netweaver 7.x<br><br>##  협력사정보 ##<br>회사명 : 타임게이트<br>담당자 : 안상훈 책임<br>연락처 : 010-3957-1209<br>##<br><br>## 종전 SR##<br>기술 문의 01952603<br>[삼성생명] RHEL 번들 http server 설정문의(LimitRequestLine)<br>##<br><br>## 현상 ##<br>특정 사용자가 해당 서비스 접속 시 정상적으로 처리되지 않는 이슈가 발생(400 Bad Request)하여 분석중에 있습니다. <br>L7의 로그 확인결과 client - L7 - WEB 간의 연동((packet전송 등) 이력은 확인하였으나 번들 http server의 로그(access, error log) 가 전혀 남지 않아 문의드립니다.<br><br><br>다른 시스템의 로그레벨을 warn -&gt; debug로 변경설정하여 로그확인결과 유사 증상 시 하기의 로그가 확인되어<br>## error 로그 일부 ##<br>[Fri Nov 03 16:36:35.090583 2017] [reqtimeout:info] [pid 7061:tid 140663235118848] [client 100.1.92.229:49320] AH01382: Request header read timeout<br>##<br><br>구글링을 통해 하기의 설정으로 header 의 크기를 명시적으로 변경한 후 정상적으로 서비스 됨을 확인하였습니다. <br>## httpd.conf 일부 ##<br>LimitRequestLine 40960<br>LimitRequestFieldSize 40960<br>##<br><br>## 문의 ##<br>문의1. 고객의 높은 권한상태로 인해 다수의 cookie값 등으로 header size가 비정상으로 클 경우 해당 에러가 발생하는 것으로 보이는데 (AH01382: Request header read timeout) 해당 로그는 warn으로 적재가 안되는지요?<br><br>문의2. LimitRequestLine 등을 증가설정할 시 역효과(DoS와 같은 공격 등)를 확인요청드립니다. <br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags><tag><name>rpm</name></tag></tags><br><comment id="a0aA000000KxmjKIAR"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-13T01:18:25Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-13T01:18:25Z</b><br><br>확인감사드립니다.<br>SR 종료합니다 .<br><br><publishedDate>2017-11-13T01:18:25Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KxBJfIAN"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2017-11-09T02:39:33Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2017-11-09T02:39:33Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>&gt;&gt; LimitRequestBody, LimitRequestLine, LimitRequestFieldSize 상호간 고려사항을 확인요청드립니다.  <br><br>확인 결과 각각은 독립적인 요청 처리 설정 값들입니다. 각각 limit the size of the body, limit the request-line (HTTP method, URI, and protocol version), limit the header request field 등에 대해서 맏고 있습니다.<br><br>상세한 내용은 아래의 Apache 문서에서 확인하실 수 있습니다.<br><br>LimitRequestBody [1]<br><br>    The LimitRequestBody directive allows the user to set a limit on the allowed size of an HTTP request message body within the context in which the directive is given (server, per-directory, per-file or per-location). If the client request exceeds that limit, the server will return an error response instead of servicing the request. The size of a normal request message body will vary greatly depending on the nature of the resource and the methods allowed on that resource. CGI scripts typically use the message body for retrieving form information. Implementations of the PUT method will require a value at least as large as any representation that the server wishes to accept for that resource.<br><br>LimitRequestLine [2] <br><br>    The LimitRequestLine directive allows the server administrator to set the limit on the allowed size of a client's HTTP request-line. Since the request-line consists of the HTTP method, URI, and protocol version, the LimitRequestLine directive places a restriction on the length of a request-URI allowed for a request on the server. A server needs this value to be large enough to hold any of its resource names, including any information that might be passed in the query part of a GET request.<br><br>LimitRequestFieldSize [3]<br><br>    The LimitRequestFieldSize directive allows the server administrator to set the limit on the allowed size of an HTTP request header field. A server needs this value to be large enough to hold any one header field from a normal client request. The size of a normal request header field will vary greatly among different client implementations, often depending upon the extent to which a user has configured their browser to support detailed content negotiation. SPNEGO authentication headers can be up to 12392 bytes.<br><br><br>[1] https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestbody<br>[2] https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestline<br>[3] https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestfieldsize<br> <br>감사합니다.<br><br><publishedDate>2017-11-09T02:39:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KwvTaIAJ"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2017-11-08T07:46:49Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2017-11-08T07:46:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>죄송스럽게도 답변 준비에 시간이 조금 더 필요하여 먼저 코멘트드립니다.<br><br>마땅한 정보를 찾을 수 없어서 현재 글로벌 Red Hat Apache Web Server 엔지니어의 도움을 요청한 상태입니다.<br><br>확인되는 데로 답변드리도록 하겠습니다.<br><br>답변이 늦어져서 죄송합니다.<br><br><br>감사합니다.<br><br><publishedDate>2017-11-08T07:46:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Kwd4tIAB"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2017-11-07T08:50:31Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2017-11-07T08:50:31Z</b><br><br>[Red Hat Internal Collaboration Note: #sbr-webservers]<br><br>* Environment:<br> + RHEL 7<br> + httpd-2.4.6-40.el7.x86_64<br> + SAP netweaver 7.x<br><br>* Question:<br>Our current configuration as below:<br>##<br>LimitRequestBody 20000000<br>LimitRequestLine 49152<br>LimitRequestFieldSize 40960<br>##<br><br>We want to know there is any consideration point or relationship between LimitRequestBody and LimitRequestLine and LimitRequestFieldSize when we change their value ?<br><br>Can someone provide any ideas on this question ?<br>Thanks in advanced<br><br><publishedDate>2017-11-07T08:50:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KwbzfIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-07T07:15:10Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-07T07:15:10Z</b><br><br>확인감사드립니다. <br>추가 문의드립니다. <br><br>현재 관련 설정이 하기와 같이 되어있습니다. <br>##<br>LimitRequestBody 20000000<br>LimitRequestLine 49152<br>LimitRequestFieldSize 40960<br>##<br><br>각 값들을 변경할 경우 고려할 점이 있는지요?<br>예를 들어 mpm 값의 maxclient 변경 시 StartServer, ThreadsPerChild등 반드시 고려해야 하는 값이 있는 것처럼<br>LimitRequestBody, LimitRequestLine, LimitRequestFieldSize 상호간 고려사항을 확인요청드립니다. <br><br>감사합니다.<br><br><publishedDate>2017-11-07T07:15:10Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KwbQgIAJ"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2017-11-07T06:23:40Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2017-11-07T06:23:40Z</b><br><br>안녕하세요,<br><br><br>&gt;&gt; 문의1. 고객의 높은 권한상태로 인해 다수의 cookie값 등으로 header size가 비정상으로 클 경우 해당 에러가 발생하는 것으로 보이는데 (AH01382: Request header read timeout) 해당 로그는 warn으로 적재가 안되는지요?<br><br>해당 로깅에 대해서는 설정으로 로그 레벨 조정이 어렵습니다. 소스코드 확인 결과 해당 메세지 출력이 info 레벨로 하드 코딩되어 있습니다.<br>~~~<br>vi modules/filters/mod_reqtimeout.c<br>...<br>out:<br>    if (APR_STATUS_IS_TIMEUP(rv)) {<br>        ap_log_cerror(APLOG_MARK, APLOG_INFO, 0, f-&gt;c, APLOGNO(01382)<br>                      &quot;Request %s read timeout&quot;, ccfg-&gt;type);<br>...<br>    }<br>    return rv;<br>}<br>~~~<br>[1] https://ci.apache.org/projects/httpd/trunk/doxygen/group__APACHE__CORE__LOG.html<br>#define <br>APLOG_INFO   LOG_INFO /* informational */<br>======================<br><br>&gt;&gt; 문의2. LimitRequestLine 등을 증가설정할 시 역효과(DoS와 같은 공격 등)를 확인요청드립니다.<br><br>해당 문의에 관련해서 매우 잘 정리된 레퍼런스를 찾기가 어렵습니다만 아파치 보안 팁 문서(Security Tips - Denial of Service (DoS) attacks)의 내용을 참고해보시면 LimitRequestLine에 관한 언급도 나오고 있습니다. 참고하시면 도움이 되실 듯합니다.<br>[2] https://httpd.apache.org/docs/2.4/misc/security_tips.html<br>Denial of Service (DoS) attacks:<br>~~~<br>All network servers can be subject to denial of service attacks that attempt to prevent responses to clients by tying up the resources of the server. It is not possible to prevent such attacks entirely, but you can do certain things to mitigate the problems that they create.<br><br>Often the most effective anti-DoS tool will be a firewall or other operating-system configurations. For example, most firewalls can be configured to restrict the number of simultaneous connections from any individual IP address or network, thus preventing a range of simple attacks. Of course this is no help against Distributed Denial of Service attacks (DDoS).<br><br>There are also certain Apache HTTP Server configuration settings that can help mitigate problems:<br>...<br>The directives LimitRequestBody, LimitRequestFields, LimitRequestFieldSize, LimitRequestLine, and LimitXMLRequestBody should be carefully configured to limit resource consumption triggered by client input.<br>~~~<br><br><br>감사합니다.<br><br><publishedDate>2017-11-07T06:23:40Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KwJqhIAF"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2017-11-06T08:36:50Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2017-11-06T08:36:50Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>저는 원종석이라고 하고 앞으로 이 케이스를 담당하게 되었습니다. <br><br>상세한 이슈 확인 및 분석을 위해 아래의 정보 제공을 요청드립니다:<br>1. 현재 httpd configuration 파일<br>2. httpd error log 전체 파일<br><br>감사합니다.<br><br>Best Regards,<br>Ted Won<br>Senior Software Maintenance Engineer<br>Red Hat Global Support Services<br><br><publishedDate>2017-11-06T08:36:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>