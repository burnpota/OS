======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-07-26T04:51:37Z</b><br><b>마지막 답변자 : Xingbin Li</b><br><b>마지막 수정 일자 : 2017-08-13T10:04:11Z</b><br><b>id : 500A000000XWguhIAD</b><br>======================<br><br><b><font size=15>
제목  : [기술]ReaR 기술 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>로컬 영역 부분( mpathbX )이  ReaR 백업시 INCLUDE 되지 않아 문의 드립니다.<br>multipath 를 수정할수 는 없는 상황입니다.<br><br># df -h<br>Filesystem            Size  Used Avail Use% Mounted on<br>/dev/mapper/mpathbp2   30G  9.7G   19G  35% /<br>tmpfs                  63G     0   63G   0% /dev/shm<br>/dev/mapper/mpathbp1 1008M  117M  841M  13% /boot<br>/dev/mapper/mpathbp5  9.9G  203M  9.2G   3% /home<br>/dev/mapper/mpathbp6  9.9G  841M  8.6G   9% /var<br>/dev/mapper/vg0-lv_nwadmin<br>                      9.9G  1.1G  8.3G  12% /nwadmin<br>/dev/mapper/vg0-lv_Tools<br>                       30G  455M   28G   2% /Tools<br>/dev/mapper/vg0-lv_CRASH<br>                      148G   11G  130G   8% /CRASH<br>/dev/mapper/vg2-lv_oradata_PRQS<br>                      133G   11G  116G   9% /oradata_PRQS<br>/dev/mapper/vg2-lv_ora_resource_PRQS<br>                       20G  831M   18G   5% /ora_resource_PRQS<br>/dev/mapper/vg2-lv_orasys_PRQS<br>                       20G  9.2G  9.6G  50% /orasys_PRQS<br>/dev/mapper/vg2-lv_LOG<br>                      4.0G  3.0G  803M  80% /LOG<br>/dev/mapper/vg2-lv_oracle_PRQS<br>                       20G  5.2G   14G  28% /oracle_PRQS<br>#pvs<br>  PV                   VG   Fmt  Attr PSize   PFree   <br>  /dev/mapper/ext1p1   vg2  lvm2 a--  100.00g 1016.00m<br>  /dev/mapper/ext2p1   vg2  lvm2 a--  100.00g       0 <br>  /dev/mapper/mpathap1 vg1  lvm2 a--  278.87g  128.87g<br>  /dev/mapper/mpathbp7 vg0  lvm2 a--  211.87g   21.87g<br><br>#vgs<br>  VG   #PV #LV #SN Attr   VSize   VFree   <br>  vg0    1   3   0 wz--n- 211.87g   21.87g<br>  vg1    1   1   0 wz--n- 278.87g  128.87g<br>  vg2    2   5   0 wz--n- 199.99g 1016.00m<br><br>#lvs<br>  LV                   VG   Attr     LSize   Pool Origin Data%  Move Log Copy%  Convert<br>  lv_CRASH             vg0  -wi-ao-- 150.00g                                           <br>  lv_Tools             vg0  -wi-ao--  30.00g                                           <br>  lv_nwadmin           vg0  -wi-ao--  10.00g                                           <br>  lv_DUMP              vg1  -wi-a--- 150.00g                                           <br>  lv_LOG               vg2  -wi-ao--   4.00g                                           <br>  lv_ora_resource_PRQS vg2  -wi-ao--  20.00g                                           <br>  lv_oracle_PRQS       vg2  -wi-ao--  20.00g                                           <br>  lv_oradata_PRQS      vg2  -wi-ao-- 135.00g                                           <br>  lv_orasys_PRQS       vg2  -wi-ao--  20.00g<br><br>root@FLPRSD01 /etc/rear/irregular # cat local.conf<br>OUTPUT=ISO<br>BACKUP=NETFS<br>BACKUP_URL=nfs://100.254.69.121/REAR/irregular/FLPRSD01<br>OUTPUT_URL=nfs://100.254.69.121/REAR/irregular/FLPRSD01<br>BACKUP_PROG_EXCLUDE=('/tmp/*' '/dev/shm/*' '/var/tmp/*' '/var/crash/*' '/CRASH/*' '/LOG/*' '/APP/*' '/sysadmin/*' '/nwadmin/*' '/home/*')<br>ONLY_INCLUDE_VG=(&quot;vg&quot;)<br>NETFS_KEEP_OLD_BACKUP_COPY=y<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.8</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>FLPRSD01</hostname><br><br><br><comment id="a0aA000000JxSsaIAF"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-07-27T06:04:51Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-07-28T00:58:37Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt;AUTOEXCLUDE_MULTIPATH=n<br>&gt;로 변경후 백업을 진행해 보는건 해소방안이 될수 있을까요??<br><br>A. 네 됩니다. 추가적으로 정상적으로 백업여부를 확인하는 방법을 안내해드리겠습니다.<br>NFS 서버에서 생성된 ISO파일의 initrd파일내에 로컬디스크 모듈,multipath모듈,그리고 multipath설정이 들어있는지 확인하셔야 합니다.<br>그리고 이 모든 파일을 확인 하신후 테스트서버에서 recover테스트를 해보실 필요가 있습니다.<br><br>&gt;만약 해소가 된다면<br>&gt;복구시 복구 대상이 백업서버와 동일하게<br>&gt;블럭장치들이 mpathx로 복원되는지도 질문드립니다.<br><br>A. 복구대상 서버의 로컬디스크가 다른 이름으로 변하지 않았다면 revocer과정을 거친후 로컬디스크는 여전히 mpathx로 인식됩니다. <br><br>추가로 말씀드리자면,<br>multipath.conf파일에서 blacklist를 잘못 설정하면 로컬디스크가 multipath device로 바뀌는 이슈가 발생할수 있습니다, <br>로컬 디스크를 /dev/sd* 형태로 원복하면 상기의 옵션을 추가하지 않아도 rear 백업작업이 정상화 될것으로 보입니다.<br>로컬디스크를 mpathx에서 /dev/sdX로 복원되는 방법은 아래의 문서를 참고하여 설정하시면 됩니다.<br><br>Ignoring Local Disks when Generating Multipath Devices<br>-https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html-single/DM_Multipath/index.html#ignore_localdisk_procedure<br><br>감사합니다.<br><br><publishedDate>2017-07-27T06:04:51Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JxR40IAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-07-27T01:27:37Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-07-27T01:27:37Z</b><br><br>답변감사합니다.<br>ONLY_INCLUDE_VG=(&quot;vg&quot;)   부분은 주석 처리가 불가능 합니다.<br>왜냐하면 모든 볼륨그룹의 영역은 백업을 받지 않기 때문입니다.<br><br>그래서 ONLY_INCLUDE_VG=(&quot;vg&quot;)  에  존재하지 않는 vg를 줌으로서 모든 볼륨그룹을 받지 않게 설정한것입니다.<br><br>위의 사항은<br>로컬디스크가 mpath로 변경되어서 백업이 되지 않는 현상으로 보이는데<br><br>rear 의 default.conf를 보면 <br># Automatically exclude multipath disks and their dependent components<br>AUTOEXCLUDE_MULTIPATH=y<br><br>옵션부분이 있는데<br>해당 부분을 <br># Automatically exclude multipath disks and their dependent components<br>AUTOEXCLUDE_MULTIPATH=n<br>로 변경후 백업을 진행해 보는건 해소방안이 될수 있을까요??<br><br>만약 해소가 된다면<br>복구시 복구 대상이 백업서버와 동일하게<br>블럭장치들이 mpathx로 복원되는지도 질문드립니다.<br><br>감사합니다.<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 정의찬 (사원)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  82-10-2952-3184<br>- 메일주소 : 정의찬 &lt;echan.jeong@samsung.com&gt;<br><br><publishedDate>2017-07-27T01:27:37Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JxEDOIA3"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2017-07-26T08:27:54Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2017-07-26T08:59:47Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>root@FLPRSD01 /etc/rear/irregular # cat local.conf<br>OUTPUT=ISO<br>BACKUP=NETFS<br>BACKUP_URL=nfs://100.254.69.121/REAR/irregular/FLPRSD01<br>OUTPUT_URL=nfs://100.254.69.121/REAR/irregular/FLPRSD01<br>BACKUP_PROG_EXCLUDE=('/tmp/*' '/dev/shm/*' '/var/tmp/*' '/var/crash/*' '/CRASH/*' '/LOG/*' '/APP/*' '/sysadmin/*' '/nwadmin/*' '/home/*')<br>ONLY_INCLUDE_VG=(&quot;vg&quot;)   &lt;-----<br>NETFS_KEEP_OLD_BACKUP_COPY=y<br><br>상기의 ONLY_INCLUDE_VG 옵션을 주석처리하고 테스트 해보시고 확인 부탁드리겠습니다.<br>여전히 이슈가 발생한다면 sosreport와 nfs서버에서 rear.log 를 수집하여 올려주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-07-26T08:27:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>