======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-07-12T05:52:49Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-08-09T10:04:01Z</b><br><b>id : 500A000000bSnFuIAK</b><br>======================<br><br><b><font size=15>
제목  : Owner of /proc/[pid of httpd child process]/* file is non-root user.([삼성생명] apache 실행시 Permission denied 메세지 관련 문의)
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요, 타임게이트 입니다.<br><br>운영계서버에서 Apache 실행시 readlink:Permission denied 혹은 opendir:Permission denied<br>메세지가 생성되는 문제가 발생합니다. 해당 내용에 대한 확인 부탁드립니다.<br><br>정확한 메세지는 아래와 같습니다.<br>============== 아 래 ===============<br>root@IDHPSWB1 /root # ps -ef | grep http | grep cyber<br>root      65704      1  0 05:01 ?        00:00:02 /sbin/httpd -f /supp1/apache/cyber_domain/conf/cyber_domain.httpd.conf -k start<br>w3sli     65720  65704  0 05:01 ?        00:01:41 /sbin/httpd -f /supp1/apache/cyber_domain/conf/cyber_domain.httpd.conf -k start<br>w3sli     65721  65704  0 05:01 ?        00:01:41 /sbin/httpd -f /supp1/apache/cyber_domain/conf/cyber_domain.httpd.conf -k start<br>w3sli     65722  65704  0 05:01 ?        00:01:40 /sbin/httpd -f /supp1/apache/cyber_domain/conf/cyber_domain.httpd.conf -k start<br><br>root@IDHPSWB1 /root # su - w3sli<br>Last login: Thu Jun 21 11:12:35 KST 2018 on pts/0<br><br>w3sli@IDHPSWB1 /home/w3sli # lsof -p 65704<br>COMMAND   PID USER   FD      TYPE DEVICE SIZE/OFF NODE NAME<br>httpd   65704 root  cwd   unknown                      /proc/65704/cwd (readlink: Permission denied)<br>httpd   65704 root  rtd   unknown                      /proc/65704/root (readlink: Permission denied)<br>httpd   65704 root  txt   unknown                      /proc/65704/exe (readlink: Permission denied)<br>httpd   65704 root NOFD                                /proc/65704/fd (opendir: Permission denied)<br><br>w3sli@IDHPSWB1 /home/w3sli # lsof -p 65720<br>COMMAND   PID  USER   FD      TYPE DEVICE SIZE/OFF NODE NAME<br>httpd   65720 w3sli  cwd   unknown                      /proc/65720/cwd (readlink: Permission denied)<br>httpd   65720 w3sli  rtd   unknown                      /proc/65720/root (readlink: Permission denied)<br>httpd   65720 w3sli  txt   unknown                      /proc/65720/exe (readlink: Permission denied)<br>httpd   65720 w3sli NOFD                                /proc/65720/fd (opendir: Permission denied)<br><br>w3sli@IDHPSWB1 /home/w3sli # lsof -p 65721<br>COMMAND   PID  USER   FD      TYPE DEVICE SIZE/OFF NODE NAME<br>httpd   65721 w3sli  cwd   unknown                      /proc/65721/cwd (readlink: Permission denied)<br>httpd   65721 w3sli  rtd   unknown                      /proc/65721/root (readlink: Permission denied)<br>httpd   65721 w3sli  txt   unknown                      /proc/65721/exe (readlink: Permission denied)<br>httpd   65721 w3sli NOFD                                /proc/65721/fd (opendir: Permission denied)<br>===================================<br><br>정상 실행되는 호스트에서 확인해 보았을때 아래와 같이 lsof에서 Permission 관련 메세지는 보이지 않습니다.<br>============== 아 래 =============== <br>w3sli@SLVHPSWL0A /home/w3sli # ps -ef | grep httpd<br>root      14680      1  0  6??4 ?      00:05:02 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>w3sli     14719  14680  0  6??4 ?      00:09:50 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>w3sli     14722  14680  0  6??4 ?      00:09:52 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>w3sli     14734  14680  0  6??4 ?      00:09:47 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>w3sli     14910  14680  0  6??4 ?      00:09:47 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>root     116395      1  0  6??4 ?      00:01:53 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>chatadm  116401 116395  0  6??4 ?      00:05:07 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>chatadm  116413 116395  0  6??4 ?      00:05:09 /usr/sbin/httpd -f /APP/chat/apache/conf/httpd.conf -k start<br>w3sli    119241 119178  0 13:37 pts/0    00:00:00 grep --color=auto httpd<br><br>w3sli@SLVHPSWL0A /home/w3sli # lsof -p 14719<br>COMMAND   PID  USER   FD      TYPE    DEVICE  SIZE/OFF      NODE NAME<br>httpd   14719 w3sli  cwd       DIR       8,2      4096        64 /<br>httpd   14719 w3sli  rtd       DIR       8,2      4096        64 /<br>httpd   14719 w3sli  txt       REG       8,2    519432  51756508 /usr/sbin/httpd<br>httpd   14719 w3sli  mem       REG       8,2     37096  50928257 /usr/lib64/libnss_sss.so.2<br>httpd   14719 w3sli  DEL       REG       0,4            60384583 /dev/zero<br>httpd   14719 w3sli  mem       REG       8,2     62184  50334703 /usr/lib64/libnss_files-2.17.so<br>httpd   14719 w3sli  mem       REG       8,2    111080  50334713 /usr/lib64/libresolv-2.17.so<br>httpd   14719 w3sli  mem       REG       8,2     15688  50335056 /usr/lib64/libkeyutils.so.1.5<br>httpd   14719 w3sli  mem       REG       8,2     58728  50395417 /usr/lib64/libkrb5support.so.0.1<br>========================================<br><br>문제가 되는 IDHPSWB1 호스트에 대하여 운영체제 측면에서 문제를 발생시킬만한 요소가 있는지 확인 부탁드립니다.<br><br><br>이번 문의는 이전에 저희 측에서 문의드렸던 CASE 02106991(https://access.redhat.com/support/cases/#/case/02106991) 기술문의에서도 언급되었던 내용입니다.<br><br>IDHPSWB1 에 관련된 자료(sosreport, conf, sar, messages) 내용 첨부드리니 참고하셔서 확인 부탁드리겠습니다.<br><br>감사합니다.<br><br><br>* 고객 정보 - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>    - 성함(직급) : 곽고운 선임<br>    - 회사명(부서명) : 삼성SDS (보험시스템그룹)<br>    - 전화번호 : 010-5060-5094  <br>    - 메일주소 : kowoon.kwak@samsung.com<br><br>* 파트너 정보 - 실제 고객의 시스템을 유지보수하는 업체 또는 현 Case를 핸들링하는 유저<br>    - 성함(직급) : 송기호 책임<br>    - 회사명(부서명) : 타임게이트(오픈소스 솔루션)<br>    - 전화번호 : 010-3620-9917 <br>    - 메일주소 : os.support@time-gate.com<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>IDHPSWB1</hostname><br><br><br><comment id="a0aA000000NHlWoIAL"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-24T07:50:24Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-24T08:08:55Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>추가적으로 문의주신 내용 중간에 답변을 적어서 보내드립니다.<br><br>역으로 SLVHPSWL0A 장비가 문제가 있는 말씀이신가요? 그렇게 이해하면 될까요?<br><br>&gt;&gt; 네 permission denied 가 발생하지 않는 SLVHPSWL0A 장비에 문제가 있어보입니다.<br><br>만약 SLVHPSWL0A 장비가 문제가 있다면 fork 하는 방식이 두 장비가 다르다는 말씀이신가요?<br><br>&gt;&gt; 네 정상적이라면 아래와 같이 owner 가 root인 프로세스는 하나만 존재하고 하위 프로세스는 일반 유저가 owner로 됩니다.<br><br>[testuser@rhel7test conf]$ ps -ef | grep httpd<br>    root     13184     1  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start  &lt;----<br>    testuser 13185 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13186 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13187 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13188 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13189 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start <br><br>하지만 SLVHPSWL0A 에서는 아래와 같이 비정상적으로 fork 되어 있는 것으로 보입니다.<br><br>    w3sli@SLVHPSWL0A /home/w3sli # ps -ef | grep httpd<br>    w3sli     79166  79116  0 11:19 pts/5    00:00:00 grep --color=auto httpd<br>    root      87495      1  0  7??3 ?      00:00:27 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start  &lt;---<br>    root      87533  87495  0  7??3 ?      00:02:26 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start  &lt;---<br>    w3sli     87534  87495  0  7??3 ?      00:01:34 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>    w3sli     87542  87495  0  7??3 ?      00:01:33 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br><br>제공해드린 conf 파일등으로 판별이 어렵나요?<br><br>&gt;&gt;<br><br>Red Hat에서 제공되는 httpd에 대해 directory 구조, start script, configuration 등을 모두 customizing 해서 사용하시는 것으로 보입니다.<br>이럴 경우에는 저희가 support 해드릴 수 있는 부분이 많이 제한됩니다.<br><br>저희가 정상이라고 파악되는 IDHPSWB1 장비의 경우에는 각 domain 별로 각각의 configuration, start script를 사용하시는 것으로 추정됩니다.<br><br>~~~~~<br>/sbin/httpd -f /supp1/apache/cyber_domain/conf/cyber_domain.httpd.conf -k start<br>~~~~~<br><br>문제가 된다고 보는 SLVHPSWL0A 장비의 경우에는 모든 domain에 대한 configuration, start script를 사용하고, 세부 도메인별로 추가로 configuration을 가지는 것이 아닐까 생각됩니다.<br><br>~~~~~~~<br>/usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>(all_domain.httpd.conf)<br>Include /supp1/jbossews/all_domain/conf/cyber_domain.httpd.conf<br>...<br>~~~~~~~<br><br>몇몇 configuration 파일이나 script 등은 제공되지 않았습니다.<br>설사 모든 파일이 제공된다 하더라도, customizing 되어 사용되어지는 부분을 저희가 모두 확인해드릴 수는 없습니다.<br>위에 설명드린 대로, IDHPSWB1 장비와 SLVHPSWL0A 장비에서 사용되어지는 configuration 및 start script이 다른듯 하니, 두 장비를 비교/확인해보시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-24T07:50:23Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NHl9KIAT"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-24T07:19:04Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-24T07:19:04Z</b><br><br>답변 감사합니다<br><br>말씀해주신대로라면 Permission denied 형태로 보이는 것은 정상적인 현상이며<br><br>역으로 SLVHPSWL0A 장비가 문제가 있는 말씀이신가요? 그렇게 이해하면 될까요?<br><br>만약 SLVHPSWL0A 장비가 문제가 있다면 fork 하는 방식이 두 장비가 다르다는 말씀이신가요?<br><br>제공해드린 conf 파일등으로 판별이 어렵나요?<br><br>확인 부탁드립니다<br><br>감사합니다<br><br><publishedDate>2018-07-24T07:19:04Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NHioGIAT"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-24T02:46:28Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-24T02:46:28Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>글로벌 웹서버 전문그룹에서 온 답변을 연계해드리겠습니다.<br><br>SLVHPSWL0A 에서 httpd 가 비정상적으로 기동되어 있는 것으로 보입니다.<br><br>    w3sli@SLVHPSWL0A /home/w3sli # ps -ef | grep httpd<br>    w3sli     79166  79116  0 11:19 pts/5    00:00:00 grep --color=auto httpd<br>    root      87495      1  0  7??3 ?      00:00:27 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start  &lt;---<br>    root      87533  87495  0  7??3 ?      00:02:26 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start  &lt;---<br>    w3sli     87534  87495  0  7??3 ?      00:01:34 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br>    w3sli     87542  87495  0  7??3 ?      00:01:33 /usr/sbin/httpd -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf -k start<br><br>httpd 구동시 root 소유 부모 프로세스는 한개가 존재하며 하위의 일반 유저 권한 fork를 진행하는 것이 정상입니다, <br>또한 해당 자식 프로세스가 대응되는 /proc/PID/{cwd,root,exe,fd} 파일들이 root 소유가 되어 lsof -p 로 볼때 permission denied가 나와야 합니다. <br><br>httpd는 일반적으로 아래와 같이 root 소유의 부모 프로세스와 fork 된 자식프로세스들로 구동됩니다.<br><br>   [testuser@rhel7test conf]$ /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>   ~~~~~~~~~~~~~~~~~~~~<br>    ~~~~~~~~~~~~~~~~~~~~<br>    [testuser@rhel7test conf]$ ps -ef | grep httpd<br>    root     13184     1  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13185 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13186 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13187 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13188 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br>    testuser 13189 13184  0 21:51 ?        00:00:00 /usr/sbin/httpd -f /etc/httpd/conf/httpd2.conf -k start<br><br>SLVHPSWL0A 에서 httpd 프로세스가 이상하게 fork 하고 있기 때문에 어떤 방식으로 기동되는지 확인이 필요합니다.<br>httpd 프로세스가 비정상적으로 fork 되게 설정파일을 customizing 해서 사용하면 지원이 힘들 가능성이 있는 점 미리 알려드립니다.<br><br>가능하시다면 SLVHPSWL0A 에서도 IDHPSWB1 과 같은 방식으로 root 소유의 부모 프로세스가 하나만 존재하도록<br>기동하신 후에 /proc/PID/* 파일들의 소유자가 일반유저로 비정상적으로 권한을 가지는지 확인하시기 바랍니다.<br>만약 SLVHPSWL0A 에서도 정상적으로 httpd 기동후 /proc 파일소유가 root 유저라면 정상현상으로 보실 수 있습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-24T02:46:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NHR0yIAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-23T03:23:58Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-23T03:23:57Z</b><br><br>안녕하십니까 오선우입니다<br><br><br>1.두 호스트 모두 어떤 계정으로 httpd를 실행하셨는지요? (root 혹은 w3sli) =&gt; w3sli 계정으로 수행합니다.<br>2.두 호스트에서 /usr/sbin/httpd 파일에 w3sli 유저에 관련해 setuid거나 setcap 혹은 다른 작업을 진행하신적이 있으신지요? =&gt; 아래와같이 setuid 적용 되어있습니다.<br>3.두 호스트에서 w3sli 계정에 대해 root 권한 부여와 같은 별도의 작업을 진행하신 적이 있으신지요? =&gt; 없습니다.<br> <br>root@IDHPSWB1 /root # ll /usr/sbin/httpd<br>-rwsr-x---. 1 root w3slibg 519432 May 10  2017 /usr/sbin/httpd<br> <br>root@SLVHPSWL0A /root # ll /usr/sbin/httpd<br>-rwsr-x---. 1 root w3slibg 519432 May 10  2017 /usr/sbin/httpd<br> <br> <br>감사합니다.<br><br><publishedDate>2018-07-23T03:23:57Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NCsUQIA1"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-20T02:38:40Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-20T02:38:39Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>먼저 케이스 진행이 지연되어 죄송합니다.<br>자체적으로 테스트 환경에서 default 설정으로 httpd를 구동해본 결과 <br>/proc/[PID]/* 파일들이 root 가 소유로 되는 것으로 확인이 됩니다.<br><br>아래의 몇가지 사항에 대해 확인을 하려고 합니다.<br><br>1.두 호스트 모두 어떤 계정으로 httpd를 실행하셨는지요? (root 혹은 w3sli) <br>2.두 호스트에서 /usr/sbin/httpd 파일에 w3sli 유저에 관련해 setuid거나 setcap 혹은 다른 작업을 진행하신적이 있으신지요?<br>3.두 호스트에서 w3sli 계정에 대해 root 권한 부여와 같은 별도의 작업을 진행하신 적이 있으신지요? <br><br>확인 부탁드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-20T02:38:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCZmjIAH"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-19T01:14:54Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-19T01:14:54Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>어제 부재중인 관계로 파일 업로드를 오늘 확인하였습니다.<br>해당 데이터들로 글로벌 전문그룹에 의뢰를 하도록 하겠으니 시간이 지체될 수 있는점 양해 부탁드리겠습니다.<br>불편을 끼쳐드려 죄송합니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-19T01:14:54Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCHkuIAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-18T02:27:08Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-18T02:27:07Z</b><br><br>안녕하십니까 타임게이트 오선우입니다<br>sosreport 파일 첨부드립니다<br>감사합니다<br><br><publishedDate>2018-07-18T02:27:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NBjpFIAT"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-16T06:09:18Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-16T06:09:18Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>파일 첨부 감사드립니다.<br>마지막으로 SLVHPSWL0A 호스트의 sosreport는 첨부 가능하신지요?<br><br>감사합니다.<br><br><publishedDate>2018-07-16T06:09:18Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NBjL5IAL"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-16T05:01:58Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-16T05:01:58Z</b><br><br>안녕하십니까 타임게이트 오선우입니다<br><br>수집된 내용과 httpd.conf 파일 첨부드립니다<br><br>감사합니다<br><br><publishedDate>2018-07-16T05:01:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NBSNeIAP"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-13T09:07:29Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-13T09:07:29Z</b><br><br>안녕하세요, 오선우님<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br>~~~<br>같은 httpd 의 프로세스에서 fork 로 생성된 자식 프로세스의 /proc/&lt;pid&gt;/* 파일들이 어떤 호스트에서는 root의 권한을 가지고<br>어떤 호스트에서는 일반유저의 권한을 가지게되는 원인은 무엇인가?<br>~~~<br><br>상기의 물음에 답변을 드리기 위해 글로벌 전문그룹에 의뢰를 하려고 합니다.<br>해당 문제에 대한 분석을 위해 아래와 같이 데이터 요청을 드립니다.<br><br>w3sli 유저로 lsof -p 실행시:<br> 1. permission denied가 발생하는 호스트에서(IDHPSWB1): <br><br>   # ls -al /proc/65720<br>   # ls -al /proc/65721<br><br> 2. permission denied가 발생하지 않는 호스트에서(SLVHPSWL0A):<br><br>   # ls -al /proc/14719<br>   # ls -al /proc/14722<br><br> 3. SLVHPSWL0A 호스트의 sosreport와 httpd의 conf 파일도 가능하다면 올려주시기 바랍니다.<br><br>좋은 주말 되십시오<br><br>감사합니다.<br><br><publishedDate>2018-07-13T09:07:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NBS3eIAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-13T08:44:38Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-13T08:44:38Z</b><br><br>안녕하십니까 타임게이트 오선우입니다<br><br>타임게이트 / 오선우 / 책임 / 010-4630-3171 / sw.oh@time-gate.com<br><br>해당 내용 진행하고 있는 저희쪽 담당 책임님이 일정이 있어서 제가 대신 진행하게 되었습니다<br><br>답변 감사합니다<br><br>몇가지 문의 드릴려고 합니다<br><br>우선 해당 두 서버에 65704 PID가 포크하여 프로세스를 생성하고 비슷하게 14680 PID가 포크하여 프로세스를 생성하여 돌고 있는 상태인데요<br><br>각각의 서버에 보이는 증상이 Permission denied가 되는 이유가 궁금합니다<br><br>해당 httpd 데몬을 실행한 것도 일반계정으로 둘다 비슷한 형태인데요 어떤차이로 인해 이런 증상을 보이는것인가요?<br><br>proc의 파일생성이나 PID를 생성하고 말씀해주신 디렉토리들의 퍼미션을 결정하는 것이 동일한 환경일꺼 같은데요<br><br>만약 실행한 환경이 다르다면 어떤부분들을 확인해보면 좋은지 의견 부탁드립니다<br><br>고객의 의견도 어떤 차이로 많이 동일한 패턴으로 돌아가는 프로세스들의 설정이 어는것은 Permission denied 내용이 안보이고 어느 내용들은 보이고 해서<br><br>문의 드립니다<br><br><publishedDate>2018-07-13T08:44:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NBRCTIA5"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-13T07:36:58Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-13T07:36:58Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>Q. 경로에 대한 소유권을 확인 해야하는 부분인가요?<br>A. 네 맞습니다. 소유권이 root로 되어 있으면 일반유저로 losf 조회시 permission denied로 출력될 것으로 보입니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-13T07:36:58Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NBRAIIA5"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-13T07:34:38Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-13T07:34:38Z</b><br><br>답변감사합니다.<br>말씀하신 부분을 확인하기 위해서 확인 해봐야 하는경로가 <br>/proc/65704/cwd<br>/proc/65704/root<br>/proc/65704/exe<br>/proc/65704/fd<br>경로에 대한 소유권을 확인 해야하는 부분인가요?<br><br><publishedDate>2018-07-13T07:34:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NBOCkIAP"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-13T01:39:07Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-13T01:39:06Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>직접 테스트 해본 바에 의하면 일반 유저로 lsof -p 실행시 Permission denied 가 발생하는 것은 정상현상으로 보입니다.<br><br>아래는 테스트환경에서의 결과입니다.<br><br># ps -ef | grep http<br>root       983     1  0 06:25 ?        00:00:03 /usr/sbin/httpd -DFOREGROUND<br>apache     985   983  0 06:25 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND<br><br><br># ll /proc/985<br><br>lrwxrwxrwx. 1 root   root   0 Jul 12 06:26 cwd -&gt; /<br>lrwxrwxrwx. 1 root   root   0 Jul 12 06:26 exe -&gt; /usr/sbin/httpd<br>dr-x------. 2 root   root   0 Jul 12 06:26 fd<br>dr-x------. 2 root   root   0 Jul 12 06:26 fdinfo<br><br>상기와 같이 lsof가 불러오는 /proc/985 디렉토리의 네개 항목의 owner 및 group 이 <br>root로 되어 있으면 permission denied 가 출력되게 됩니다.<br><br><br>SLVHPSWL0A 호스트에서 일반유저가 lsof로 오픈파일을 볼수 있는 원인은 <br>해당 프로세스의 /proc/&lt;pid&gt;/ 경로의 항목들의 owner 와 group 권한이 <br>일반유저로 되어 있기 때문일 것으로 추측됩니다. 따라서 해당 경로에서 <br>owner 와 group 을 확인해보기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-13T01:39:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NB8cwIAD"><br>======================<br><b>생성계정 : Li, Xingbin</b><br><b>생성날짜 : 2018-07-12T07:29:46Z</b><br><b>마지막 답변자 : Li, Xingbin</b><br><b>마지막 수정 일자 : 2018-07-12T07:29:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>저는 이성빈이라고 하며 본 케이스를 담당하게 되었습니다.<br>현재 문의 주신 내용에 대해 확인 중에 있으며 답변이 정리되는대로 코멘트를 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-12T07:29:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>