======================<br><b>생성계정 : 타임게이트 (주)</b><br><b>생성날짜 : 2017-11-03T01:02:50Z</b><br><b>마지막 답변자 : Ying Huang</b><br><b>마지막 수정 일자 : 2018-05-18T06:28:49Z</b><br><b>id : 500A000000Z1Z6IIAV</b><br>======================<br><br><b><font size=15>
제목  : [삼성생명] 번들 http server Segmentation fault (11) 이후 좀비프로세스 현상 - 운영계
</font></b><br><br>======================<br><b>사전문의<br></b><br>## 고객정보 ##<br>고객사 : 삼성생명<br>고객명 : 박현우 선임<br>연락처 : 010-9104-2853<br>##<br><br>## 환경 ##<br>-OS : RHEL7<br><br>-WEB : 번들 HTTP<br>rpm -qf /usr/sbin/httpd<br>httpd-2.4.6-40.el7.x86_64<br><br>-지난 SR : 01846566, 01783481<br>##<br><br>## 이슈 ##<br>하기의 시점인 11월 1일 15시48분 경 Segmentation fault 이슈로 특정 child process가 종료된 이후 정상 동작을 하지 않는 이슈(좀비 프로세스)가 재발되었습니다. <br><br>## common_error_log 일부 ##<br>[Wed Nov 01 15:48:47.693063 2017] [core:notice] [pid 97309:tid 140356340254784] AH00052: child pid 78621 exit signal Segmentation fault (11) <br>##<br><br>## httpd.conf mpm 설정값 ##<br>#&lt;IfModule worker.c&gt;<br>ServerLimit             64<br>StartServers            3<br>MaxClients              8192<br>ThreadLimit             256<br>MinSpareThreads         75<br>MaxSpareThreads         250<br>ThreadsPerChild         256<br>MaxRequestsPerChild     0<br>Mutex sem<br>#&lt;/IfModule&gt;<br>##<br><br>기존 하나의 child prcoess 당 처리할 수 있는 최대 request 개수도 무제한으로 변경하여 (MaxRequestsPerChild 1000 --&gt; 0) <br>강제 종료되지 않음에도 유사 증상이 발생하였습니다. <br>빠른 확인 요청드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 2 (High)</b><br><br><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-14T06:18:39Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-14T06:18:39Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>공유 감사드립니다.<br>해당 이슈에 대하여 행 이슈를 해소하시려면 먼저 segfault 이슈를 해결해야 합니다.<br>다만 재차 시도를 했으나 일부 library가 없는 상황에서 구체적인 원인 분석이 어려웠습니다.<br>추가적인 원인 분석에는 library를 제공한 벤더사쪽으로 분석 요청 바랍니다.<br>아래는 저희 엔지니어분이 분석한 부분이며 벤더사쪽으로 문의요청을 할시 함께 전달하시면<br>도움이 될것으로 보입니다.<br>=================================================<br>in the crashing thread of the core mentioned in 118:<br><br>#0  __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br>#1  0x00007f686e218219 in apr_thread_mutex_lock (mutex=&lt;optimized out&gt;) at locks/unix/thread_mutex.c:92<br>#2  0x00007f686ec68014 in apr_reslist_maintain (reslist=reslist@entry=0x7f6794082840) at misc/apr_reslist.c:184<br>#3  0x00007f686ec682f5 in apr_reslist_create (reslist=0x7f6871118710, min=&lt;optimized out&gt;, smax=&lt;optimized out&gt;, hmax=256, ttl=&lt;optimized out&gt;, con=con@entry=0x7f68636f2440 &lt;connection_constructor&gt;, <br>    de=de@entry=0x7f68636f2410 &lt;connection_destructor&gt;, params=params@entry=0x7f687118f400, pool=0x7f6794082668) at misc/apr_reslist.c:305<br>#4  0x00007f68636f56db in ap_proxy_initialize_worker (worker=0x7f687118f400, s=0x7f6871180d20, p=0x7f6871117d78) at proxy_util.c:1907<br>#5  0x00007f68636f19ec in proxy_handler (r=0x7f6788056d40) at mod_proxy.c:1045<br>#6  0x00007f686f560240 in ap_run_handler (r=0x7f6788056d40) at config.c:169<br>#7  0x00007f686f560789 in ap_invoke_handler (r=r@entry=0x7f6788056d40) at config.c:439<br>#8  0x00007f686f574b0a in ap_process_async_request (r=r@entry=0x7f6788056d40) at http_request.c:317<br>#9  0x00007f686f574de4 in ap_process_request (r=r@entry=0x7f6788056d40) at http_request.c:363<br>#10 0x00007f686f571772 in ap_process_http_sync_connection (c=0x7f685426e808) at http_core.c:190<br>#11 ap_process_http_connection (c=0x7f685426e808) at http_core.c:231<br>#12 0x00007f686f569810 in ap_run_process_connection (c=0x7f685426e808) at connection.c:41<br>#13 0x00007f686f569bf8 in ap_process_connection (c=c@entry=0x7f685426e808, csd=csd@entry=0x7f685426e5f0) at connection.c:202<br>#14 0x00007f686390878b in process_socket (bucket_alloc=0x7f6788051ca8, my_thread_num=29, my_child_num=2, sock=0x7f685426e5f0, p=0x7f685426e578, thd=0x7f6854002768) at worker.c:620<br>#15 worker_thread (thd=0x7f6854002768, dummy=&lt;optimized out&gt;) at worker.c:979<br>#16 0x00007f686dfebdc5 in start_thread (arg=0x7f68487e8700) at pthread_create.c:308<br>#17 0x00007f686db1528d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:113<br><br>this was trying to take the mutex lock for a mutex with the address of 0<br><br>frame 1<br>88<br>APR_DECLARE(apr_status_t) apr_thread_mutex_lock(apr_thread_mutex_t *mutex)<br>89<br>{<br>90<br>    apr_status_t rv;<br>91<br><br>92<br>    rv = pthread_mutex_lock(&amp;mutex-&gt;mutex);   &lt;&lt;&lt;&lt;<br><br>called from frame 2:<br>#2  0x00007f686ec68014 in apr_reslist_maintain (reslist=reslist@entry=0x7f6794082840) at misc/apr_reslist.c:184<br>184<br>    apr_thread_mutex_lock(reslist-&gt;listlock);<br><br>176<br>APU_DECLARE(apr_status_t) apr_reslist_maintain(apr_reslist_t *reslist)<br>177<br>{<br>178<br>    apr_time_t now;<br>179<br>    apr_status_t rv;<br>180<br>    apr_res_t *res;<br>181<br>    int created_one = 0;<br>182<br><br>183<br>#if APR_HAS_THREADS<br>184<br>    apr_thread_mutex_lock(reslist-&gt;listlock);  &lt;&lt;&lt;&lt;<br><br>here, reslist-&gt;listlock has the address 0<br>(gdb) p reslist-&gt;listlock<br>$16 = (apr_thread_mutex_t *) 0x0<br><br>(gdb) frame 3<br>#3  0x00007f686ec682f5 in apr_reslist_create (reslist=0x7f6871118710, min=&lt;optimized out&gt;, smax=&lt;optimized out&gt;, hmax=256, ttl=&lt;optimized out&gt;, con=con@entry=0x7f68636f2440 &lt;connection_constructor&gt;, <br>    de=de@entry=0x7f68636f2410 &lt;connection_destructor&gt;, params=params@entry=0x7f687118f400, pool=0x7f6794082668) at misc/apr_reslist.c:305<br>305<br>    rv = apr_reslist_maintain(rl);<br><br>so rl-&gt;listlock is 0<br><br>(gdb) list apr_reslist_create<br>253<br>                                             apr_interval_time_t ttl,<br>254<br>                                             apr_reslist_constructor con,<br>255<br>                                             apr_reslist_destructor de,<br>256<br>                                             void *params,<br>257<br>                                             apr_pool_t *pool)<br>258<br>{<br>259<br>    apr_status_t rv;<br>260<br>    apr_reslist_t *rl;<br><br>** rl was created in this function<br>...<br>280<br>    rl = apr_pcalloc(pool, sizeof(*rl));<br>...<br>294<br>    rv = apr_thread_mutex_create(&amp;rl-&gt;listlock, APR_THREAD_MUTEX_DEFAULT,<br>295<br>                                 pool);<br>296<br>    if (rv != APR_SUCCESS) {<br>297<br>        return rv;<br>298<br>    }<br><br>the mutex was created here in line 294, so apr_thread_mutex_create may have failed in some way.  However, the 'rv' must have also been equal to APR_SUCCESS, otherwise it would have returned before getting to the point where it failed:<br><br>305<br>    rv = apr_reslist_maintain(rl); &lt;&lt;&lt;&lt;<br><br>Two possibilities:<br><br>something in apr_thread_mutex_create, or one of the functions it calls, returned success, while the mutex creation set the mutex address to 0<br><br>apr_thread_mutex_create succeeded and returned a valid mutex, but the mutex address got set to 0 after returning, possibly in apr_reslist_maintain<br><br>there are no obvious BZs which match<br>=================================================<br><br>감사합니다.<br><br><publishedDate>2017-12-14T06:18:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LCtF3IAL"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-14T02:30:25Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-14T02:30:25Z</b><br><br>안녕하세요 <br>요청하신 삼성생명 ep 업무의 구조도를 첨부드립니다. <br>감사합니다.<br><br><publishedDate>2017-12-14T02:30:25Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LBz3nIAD"><br>======================<br><b>생성계정 : Ferreira, Arthur</b><br><b>생성날짜 : 2017-12-09T22:33:47Z</b><br><b>마지막 답변자 : Ferreira, Arthur</b><br><b>마지막 수정 일자 : 2017-12-09T22:33:47Z</b><br><br>Hello,<br><br>Thanks for the files and for your patience.<br><br>We have reviewed your files and we're seeing difference in the time between those files. The strace outputs are from November 30 and the sosreport is from a day before. Even the strace outputs does not cover the same time frame. The parent trace runs from 14:52:03 to 14:57:35, and the child trace covers 14:50:31 to 14:51:42.<br><br>Also, as Flos has shared in comment 111, we could debug the core dump only to an extent then it needs information that's not on our libraries:<br><br>    (gdb) bt<br>    #0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>    #1  0x00007f685f3f72af in ?? ()<br>    #2  0x0000000000000000 in ?? ()<br>    <br>    UNKNOWN:<br>    # eu-addr2line -e /usr/lib/debug/usr/sbin/httpd.debug --core core._httpd_54501_PIWBWL04SL_1340_1511934151 0x00007f685f3f72af<br>    ??:0<br><br>The FUTEX_WAIT system call is probably related to that thread (pthread_cond_timedwait) and, if this is from a third party library, we can't do much. And, to debug further, we need the missing sources of the 4 libraries:<br><br>    warning: Could not load shared library symbols for 4 libraries, e.g. /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/webgatessl_apache24.so.<br>    Use the &quot;info sharedlibrary&quot; command to see the complete listing.<br><br>As the case is really long and it's mostly in Korean, probably there are important pieces of information we're missing. <br><br>Is it possible to explain again what is the issue and what you need at the moment for us to try help you better?<br><br>Kind regards,<br>---<br>Arthur Ferreira<br>Red Hat Customer Experience &amp; Engagement (CEE)<br>https://access.redhat.com<br><br><publishedDate>2017-12-09T22:33:47Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LByLpIAL"><br>======================<br><b>생성계정 : Ferreira, Arthur</b><br><b>생성날짜 : 2017-12-09T15:36:49Z</b><br><b>마지막 답변자 : Ferreira, Arthur</b><br><b>마지막 수정 일자 : 2017-12-09T15:36:49Z</b><br><br>Hello,<br><br>I'm Arthur Ferreira and I'll help on the case today.<br><br>Allow me some time to review it and talk to the team about it.<br><br>Let us know if you have any questions in the meantime.<br><br>Kind regards,<br>---<br>Arthur Ferreira<br>Red Hat Customer Experience &amp; Engagement (CEE)<br>https://access.redhat.com<br><br><publishedDate>2017-12-09T15:36:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LBmKTIA1"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-08T09:37:49Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-08T09:37:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재로선 백업 엔지니어분이 고객님 아키택쳐에 대한 상세한 설명 요청이 있습니다.<br>If you want to solve the problem from the ground up, let customer describe their entire architecture clearly, or draw a business process diagram, what to do in each part. The premise is that we have got the result of a complete analysis of coredump.<br><br>해당 이슈에 대하여 collaboration을 진행하였으며 다른 지역 엔지니어분이 해당 이슈에 대한<br>업데이트가 있을 경우 영문으로 진행될 겁니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-08T09:37:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LBk9RIAT"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-08T05:43:34Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-08T05:43:34Z</b><br><br>안녕하세요!<br>빠른 확인에 감사드립니다<br>추가 문의가 있어 SR 업데이트 드립니다. <br><br>종전 SR 시 답변주신  &quot;해당 이슈는 어플리케이션이 어떻게 구성/실현되었는지를 알아보면 원인 분석에 도움이 됩니다&quot; 에서 말씀하시는<br>어플리케이션이 어떤 것을 의미하시는지요?<br>3rd party library인 webgate 솔루션을 의미하는지 아니면 WAS인 SAP netweaver, 혹은 그 위에 배포되어지는 실제 apps를 말씀하시는지 확인요청드립니다<br>감사합니다.<br><br><publishedDate>2017-12-08T05:43:34Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LBjRAIA1"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-08T03:48:44Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-08T03:48:44Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; common_error_log 상 pid 54501 child process는 11월 29일 14:42분 발생하여 해당 process는 종료된 것이고<br>&gt; 나머지 살아있는 다른 child process에 대한 strace를 수집한 결과입니다. <br>&gt; 그럼 왜 다른 child 프로세스가 새로 생성되어 WAKE 작업을 수행하지 못한 것인지요?<br><br>FUTEX_WAIT_PRIVATE는 유저 스페이스 락 매커니즘이며 이는 어플리케이션에서 실현되어야 할 부분 입니다.<br>앞서 말씀드렸듯이 해당 이슈는 어플리케이션이 어떻게 구성/실현되었는지를 알아보면 원인 분석에 도움이 됩니다.<br>인터넷에서 FUTEX_WAIT/FUTEX_WAKE 관련 설명을 참고하시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-08T03:48:44Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LBiCJIA1"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-08T00:47:17Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-08T00:47:17Z</b><br><br>빠른 답변에 감사드립니다. <br><br>확인요청하신 내역에 대하여 하기와 같이 답변드립니다. <br><br>2.1 지난 12월 5일 strace 결과 분석 시 하기와 같이 parent process가 정상적으로 살아있고(alive) 정지시그널을 받았다(2017년  14시 57분 34초)고 하였는데 해당 시점은 segmentation fault(11) 발생시점(2017년 14시 42분 32초) 이전입니다. 어떤 로그스택을 확인하시고 정상적으로 판단하신지 확인요청드립니다. <br><br>그렇다면 segfault는 상기 httpd 프로세스를 종료후 다시 기동된 프로세스에서 발생된 이슈이신가요?<br>올려주신 strace 정보는 segfault 이슈 발생후 수집된것이 아닌지요? 확인 부탁 드립니다.<br><br>--&gt; <br>제가 common_error_log 일부를 잘못 발췌하였습니다. <br>##<br>[Wed Nov 29 14:42:32.946673 2017] [core:notice] [pid 106630:tid 140086520838208] AH00051: child pid 54501 exit signal Segmentation fault (11), possible coredump in /LOG/ep/apache<br>##<br>segfault(11) 발생인지 후인 약 8분 후 재기동 없이 strace를 약 5분 내외로 수집한 결과입니다. <br><br>2.2 또한 child process 역시 request가 polling 되어 있으나 이슈 발생 시점보다 약 6분 이전에 적재된 것으로 판단되는데 mod_proxy는 단순 gateway성 역할로 들어온 request를 polling하지 않고 was로 바로 넘겨줘야 하는 것이 아닌지요? apache worker mpm의 업무처리 메카니즘관련하여 정리된 공식문서가 있는지 확인을 요청드립니다. <br><br>백업 엔지니어분이 일부 로그를 발췌하여 전달되어 아래 부분이 빠졌습니다.<br>행에 빠진 child 프로세스는 아래와 같이 FUTEX_WAIT_PRIVATE에 빠져 있으며 해당 경우 다른 프로세스가<br>WAKE 작업을 해줘야만 해당 상태에서 빠져 나올수 있습니다. 다만 현재 이슈에서 WAKE 작업을 해줘야 할 프로세스가 segfault로 종료되어 child 프로세스가 지속적으로 기다리는 작업을 하고 있는것입니다.<br><br>53352 14:50:31.675411 restart_syscall(&lt;... resuming interrupted call ...&gt; &lt;unfinished ...&gt;<br>53349 14:50:31.675428 futex(0x7f68711cd45c, FUTEX_WAIT_PRIVATE, 4408, NULL &lt;unfinished ...&gt;<br><br>--&gt; <br>추가 문의드립니다. <br>common_error_log 상 pid 54501 child process는 11월 29일 14:42분 발생하여 해당 process는 종료된 것이고<br>나머지 살아있는 다른 child process에 대한 strace를 수집한 결과입니다. <br>그럼 왜 다른 child 프로세스가 새로 생성되어 WAKE 작업을 수행하지 못한 것인지요?<br><br>확인요청드립니다.<br><br><publishedDate>2017-12-08T00:47:17Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LBVf9IAH"><br>======================<br><b>생성계정 : Guo, Qi</b><br><b>생성날짜 : 2017-12-07T10:08:03Z</b><br><b>마지막 답변자 : Guo, Qi</b><br><b>마지막 수정 일자 : 2017-12-07T10:08:02Z</b><br><br>Hello,<br><br>Okay, just some additional info. For RH's library/binary, we could see the source code after loading our debugging symbols, for example:<br><br>~~~<br>warning: Could not load shared library symbols for 4 libraries, e.g. /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/webgatessl_apache24.so.<br>Use the &quot;info sharedlibrary&quot; command to see the complete listing.<br>Do you need &quot;set solib-search-path&quot; or &quot;set sysroot&quot;?<br>[Thread debugging using libthread_db enabled]<br>Using host libthread_db library &quot;/lib64/libthread_db.so.1&quot;.<br>Core was generated by `/usr/sbin/httpd -f /APP/ep/apache/conf/httpd.conf -k start'.<br>Program terminated with signal 11, Segmentation fault.<br>#0  __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br>50<br>  unsigned int type = PTHREAD_MUTEX_TYPE (mutex);<br><br>(gdb) thread 1<br>[Switching to thread 1 (Thread 0x7f68487e8700 (LWP 54532))]<br>#0  __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br>50<br>  unsigned int type = PTHREAD_MUTEX_TYPE (mutex);<br><br>(gdb) f 2<br>#2  0x00007f686ec68014 in apr_reslist_maintain (reslist=reslist@entry=0x7f6794082840) at misc/apr_reslist.c:184<br>184<br>    apr_thread_mutex_lock(reslist-&gt;listlock);<br><br>(gdb) thread 2<br>[Switching to thread 2 (Thread 0x7f686f4c5700 (LWP 54760))]<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>238<br>62:<br>movq<br>%rax, %r14<br><br>(gdb) bt<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>#1  0x00007f685f3f72af in ?? ()<br>#2  0x0000000000000000 in ?? ()<br><br>(gdb) q<br>~~~<br><br>RH:<br># eu-addr2line -e /usr/lib/debug/usr/sbin/httpd.debug --core core._httpd_54501_PIWBWL04SL_1340_1511934151 0x00007f686ec68014<br>misc/apr_reslist.c:188<br><br>UNKNOWN:<br># eu-addr2line -e /usr/lib/debug/usr/sbin/httpd.debug --core core._httpd_54501_PIWBWL04SL_1340_1511934151 0x00007f685f3f72af<br>??:0<br><br>Please let us know what's in that address?<br><br>Thanks.<br>Flos<br><br><publishedDate>2017-12-07T10:08:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LBUtNIAX"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-07T09:10:57Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-07T09:10:56Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; 1. share library에 webgate 관련 lib가 확인되기는 하지만 thread76, thread2는 ?? 만 나올뿐 영향을 끼친다고는 생각이 안들어서 추가 문의를 드립니다. <br><br>물음표로 출력되는것은 저희가 관련 소스 파일이 없어 이와 같이 표시되는것입니다.<br>관련 소스 파일이 있다면 물음표로 출력되지 않을 것이며 대신 관련 function등을 확인할수 있고 해당 thread가 어떤 작업을 하는지를 확인해 볼수 있습니다.<br>현재 소스 코드가 없는 상황이기에 추가 분석이 되지 않고 있습니다.<br><br>&gt; 2.1 지난 12월 5일 strace 결과 분석 시 하기와 같이 parent process가 정상적으로 살아있고(alive) 정지시그널을 받았다(2017년  14시 57분 34초)고 하였는데 해당 시점은 segmentation fault(11) 발생시점(2017년 14시 57분 38분) 이전입니다. 어떤 로그스택을 확인하시고 정상적으로 판단하신지 확인요청드립니다. <br><br>Turn to check the strace output. For str2.out which was tracing against the parent process, the httpd was still alive as it's executing and could receive signal to quit normally. See below:<br><br>106630 14:57:34.980524 write(2, &quot;[Wed Nov 29 14:57:34.980504 2017] [mpm_worker:notice] [pid 106630:tid 140086520838208] AH00295: caught SIGTERM, shutting down\n&quot;, 126) = 126 &lt;0.000011&gt;<br><br>고객님께서 보내주신 정보에 의하면 parent httpd 프로세스는 상기 시점에 SIGTERM 신호를 받고 정상 종료 되었습니다.<br>children 프로세스 정보는 아래와 같은 시간까지 기록 되었습니다.<br>53359 14:51:42.490529 poll([{fd=22, events=POLLIN}], 1, 1000 &lt;detached ...&gt;<br><br>그렇다면 segfault는 상기 httpd 프로세스를 종료후 다시 기동된 프로세스에서 발생된 이슈이신가요?<br>올려주신 strace 정보는 segfault 이슈 발생후 수집된것이 아닌지요? 확인 부탁 드립니다.<br><br>&gt; 2.2 또한 child process 역시 request가 polling 되어 있으나 이슈 발생 시점보다 약 6분 이전에 적재된 것으로 판단되는데 mod_proxy는 단순 gateway성 역할로 들어온 request를 polling하지 않고 was로 바로 넘겨줘야 하는 것이 아닌지요? apache worker mpm의 업무처리 메카니즘관련하여 정리된 공식문서가 있는지 확인을 요청드립니다. <br><br>백업 엔지니어분이 일부 로그를 발췌하여 전달되어 아래 부분이 빠졌습니다.<br>행에 빠진 child 프로세스는 아래와 같이 FUTEX_WAIT_PRIVATE에 빠져 있으며 해당 경우 다른 프로세스가<br>WAKE 작업을 해줘야만 해당 상태에서 빠져 나올수 있습니다. 다만 현재 이슈에서 WAKE 작업을 해줘야 할 프로세스가<br>segfault로 종료되어 child 프로세스가 지속적으로 기다리는 작업을 하고 있는것입니다.<br><br>53352 14:50:31.675411 restart_syscall(&lt;... resuming interrupted call ...&gt; &lt;unfinished ...&gt;<br>53349 14:50:31.675428 futex(0x7f68711cd45c, FUTEX_WAIT_PRIVATE, 4408, NULL &lt;unfinished ...&gt;<br><br><br>&gt; 3. 해당 모니터링 페이지의 활용가이드가 있는지요? 확인요청드립니다. <br>관련 정보는 아래의 문서를 참고하실수 있으십니다.<br><br>How to monitor Apache httpd process/thread status<br>https://access.redhat.com/solutions/39808<br><br>How can I view Apache server performance status?<br>https://access.redhat.com/solutions/6207<br><br><br>&gt; 4. 하기의 각각 core에 대한 분석결과도 상세하게 SR 업데이트를 요청드립니다. <br><br>일부 소스 코드가 없는 상황에서 추가적인 코어 분석은 무의미 합니다.<br>모든 소스 코드를 확보 가능한 3rd party 벤더사쪽에서 먼저 분석하신후 만일 OS와 관련되는 문제가 있을 경우 분석 결과를 공유해<br>주시면 저희쪽에서 추가적인 분석을 진행하도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-07T09:10:56Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LBSNRIA5"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-07T05:02:10Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-07T05:02:10Z</b><br><br>안녕하세요<br>추가 문의 드립니다. <br><br>1. 지난 11월 30일 core 분석 결과 중 약 272개의 thread 중 76번 thread가 ??로 분석되어 더 이상 상세분석이 불가하여 3rd party 솔루션업체의 분석을 요청한다고 하였습니다. <br>There are 272 threads and we can't get a clean stack backtrace from some of the threads because<br>httpd has some 3rd party shared libs loaded.<br>##<br>gdb) thr 76<br>[Switching to thread 76 (Thread 0x7f1006e32700 (LWP 30595))]<br>#0  0x00007f10055efc3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>81<br>T_PSEUDO (SYSCALL_SYMBOL, SYSCALL_NAME, SYSCALL_NARGS)<br>(gdb) bt<br>#0  0x00007f10055efc3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>#1  0x00007f0ff706c1c6 in ?? ()<br>#2  0x0000000000000000 in ?? ()<br>##<br><br>해당 thread에서는 webgate관련 library가 확인이 되지 않는데 어느 부분에서 3rd lib로 판단한 것인지 확인요청드립니다.<br>share library에 webgate 관련 lib가 확인되기는 하지만 thread76, thread2는 ?? 만 나올뿐 영향을 끼친다고는 생각이 안들어서 추가 문의를 드립니다. <br>##<br>(gdb) info sharedlibrary APP<br>From                To                  Syms Read   Shared Object Library<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/webgatessl_apache24.so<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libclntsh.so.11.1<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libnnz11.so<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libxmlengine.so<br>##<br><br>2. 지난 12월 5일 strace 결과 분석 시 하기와 같이 parent process가 정상적으로 살아있고(alive) 정지시그널을 받았다(2017년  14시 57분 34초)고 하였는데 해당 시점은 segmentation fault(11) 발생시점(2017년 14시 57분 38분) 이전입니다. 어떤 로그스택을 확인하시고 정상적으로 판단하신지 확인요청드립니다. <br>## 분석 내용##<br>For str2.out which was tracing against the parent process, the httpd was still alive as it's executing and could receive signal to quit normally<br>##<br>## parents strace 내용 ##<br>106630 14:57:34.980524 write(2, &quot;[Wed Nov 29 14:57:34.980504 2017] [mpm_worker:notice] [pid 106630:tid 140086520838208] AH00295: caught SIGTERM, shutting down\n&quot;, 126) = 126 &lt;0.000011&gt;<br>##<br>## common_error_log 일부##<br>[Wed Nov 29 14:57:38.733357 2017] [core:notice] [pid 56766:tid 139839891814464] AH00094: Command line: '/usr/sbin/httpd -f /APP/ep/apache/conf/httpd.conf' <br>##<br><br>또한 child process 역시 request가 polling 되어 있으나 이슈 발생 시점보다 약 6분 이전에 적재된 것으로 판단되는데 mod_proxy는 단순 gateway성 역할로 들어온 request를 polling하지 않고 was로 바로 넘겨줘야 하는 것이 아닌지요? apache worker mpm의 업무처리 메카니즘관련하여 정리된 공식문서가 있는지 확인을 요청드립니다. <br>## 분석내용 ##<br>For children's strace output, they're kept on polling on something, but what they really did and what business they're running were not known by us. You may need to engage the application vendor for further information:<br>##<br>## strace 내용 ##<br>53360 14:51:41.586004 poll([{fd=23, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53363 14:51:41.662510 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001074&gt;<br>53363 14:51:41.662563 poll([{fd=26, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53364 14:51:41.784396 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.000911&gt;<br>## 중략 ##<br><br>3.  현재 apache server-status 모니터링 옵션이 활성화 되어있습니다. <br>## ep.httpd.conf ##<br>        &lt;Location /server-status&gt;<br>        SetHandler server-status<br>        #Order deny,allow<br>        #Deny from all<br>        Allow from 100.1.91.117,100.118.90.42,100.118.91.116,100.118.181.76,100.118.91.208,100.1.92.229<br>        &lt;/Location&gt;<br>##<br>해당 모니터링 페이지의 활용가이드가 있는지요? 확인요청드립니다. <br><br>4. 하기의 각각 core에 대한 분석결과도 상세하게 SR 업데이트를 요청드립니다. <br>##<br>- 2017년 11월 23일 : 3호기 segment fault(11) 발생<br>core._httpd_58490_PIWBWL03SL_1340_1511394001.gz (19.0 MB) <br> <br>- 2017년 11월 24일 : 3호기 segment fault(11) 추가 발생<br>core._httpd_100117_PIWBWL03SL_1340_1510055509.gz (19.1 MB) <br><br>- 2017년 11월 27일 : 2호기 segment fault(11) 발생<br>core._httpd_28696_PIWBWL02SL_1340_1510054244.gz (18.5 MB) <br><br>- 2017년 11월 28일 : 4호기 segment fault(11) 발생<br>core._httpd_54501_PIWBWL04SL_1340_1511934151.gz 21MB<br>##<br><br><publishedDate>2017-12-07T05:02:10Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L6g29IAB"><br>======================<br><b>생성계정 : Guo, Qi</b><br><b>생성날짜 : 2017-12-05T08:23:21Z</b><br><b>마지막 답변자 : Guo, Qi</b><br><b>마지막 수정 일자 : 2017-12-05T09:11:44Z</b><br><br>Hello,<br><br>I'm Flos Kwok, one of the colleagues who are assisting Catherine on this case. I would like to share some more information about the 'hung' issue of the httpd. Let's take the event on Nov 30 for instance.<br><br>On extracting the core dump file, debugging symbols of third party modules are not available:<br><br>(gdb) info sharedlibrary APP<br>From                To                  Syms Read   Shared Object Library<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/webgatessl_apache24.so<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libclntsh.so.11.1<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libnnz11.so<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libxmlengine.so<br><br>We can see 272 threads info in the core dump, but not all can be read, for example:<br><br>(gdb) info threads <br>  Id   Target Id         Frame <br>  272  Thread 0x7f684a7ec700 (LWP 54528) 0x00007f686db0ac3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>...<br>* 1    Thread 0x7f68487e8700 (LWP 54532) __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br><br>(gdb) thread 2<br>[Switching to thread 2 (Thread 0x7f686f4c5700 (LWP 54760))]<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>238<br>62:<br>movq<br>%rax, %r14<br><br>(gdb) bt<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>#1  0x00007f685f3f72af in ?? ()<br>#2  0x0000000000000000 in ?? ()<br><br>It's hard to get a full picture what was going on without all debugging symbols and the related source code.<br><br>Turn to check the strace output. For str2.out which was tracing against the parent process, the httpd was still alive as it's executing and could receive signal to quit normally. See below:<br><br>** /tmp/171130/str2.out<br><br>106630 14:52:03.195709 select(0, NULL, NULL, NULL, {0, 387927}) = 0 (Timeout) &lt;0.388363&gt;<br>106630 14:52:03.584322 wait4(-1, 0x7fff3bd91c3c, WNOHANG|WSTOPPED, NULL) = 0 &lt;0.000006&gt;<br>106630 14:52:03.584380 select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout) &lt;1.001044&gt;<br>106630 14:52:04.585564 wait4(-1, 0x7fff3bd91c3c, WNOHANG|WSTOPPED, NULL) = 0 &lt;0.000006&gt;<br>106630 14:52:04.585608 select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout) &lt;1.001046&gt;<br>106630 14:52:05.586794 wait4(-1, 0x7fff3bd91c3c, WNOHANG|WSTOPPED, NULL) = 0 &lt;0.000006&gt;<br>106630 14:52:05.586838 select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout) &lt;1.001044&gt;<br>106630 14:52:06.588093 wait4(-1, 0x7fff3bd91c3c, WNOHANG|WSTOPPED, NULL) = 0 &lt;0.000006&gt;<br>106630 14:52:06.588135 select(0, NULL, NULL, NULL, {1, 0}) = 0 (Timeout) &lt;1.001051&gt;<br>...<br>106630 14:57:33.986522 wait4(-1, 0x7fff3bd91c3c, WNOHANG|WSTOPPED, NULL) = 0 &lt;0.000006&gt;<br>106630 14:57:33.986569 select(0, NULL, NULL, NULL, {1, 0}) = ? ERESTARTNOHAND (To be restarted if no handler) &lt;0.906535&gt;<br>106630 14:57:34.893148 --- SIGTERM {si_signo=SIGTERM, si_code=SI_USER, si_pid=56755, si_uid=1340} ---  &lt;&lt;&lt;---------- QUITTING<br>106630 14:57:34.893188 rt_sigreturn()   = -1 EINTR (Interrupted system call) &lt;0.000005&gt;<br>106630 14:57:34.893318 write(7, &quot;$&quot;, 1) = 1 &lt;0.000449&gt;<br>106630 14:57:34.893859 write(7, &quot;$&quot;, 1) = 1 &lt;0.000027&gt;<br>106630 14:57:34.893919 write(7, &quot;$&quot;, 1) = 1 &lt;0.000005&gt;<br>106630 14:57:34.893940 write(7, &quot;$&quot;, 1) = 1 &lt;0.000167&gt;<br>106630 14:57:34.894122 write(7, &quot;$&quot;, 1) = 1 &lt;0.000191&gt;<br>106630 14:57:34.894409 write(7, &quot;$&quot;, 1) = 1 &lt;0.000005&gt;<br>106630 14:57:34.894431 write(7, &quot;$&quot;, 1) = 1 &lt;0.000005&gt;<br>106630 14:57:34.894445 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894459 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894473 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894486 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894500 write(7, &quot;$&quot;, 1) = 1 &lt;0.000006&gt;<br>106630 14:57:34.894517 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894531 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894546 write(7, &quot;$&quot;, 1) = 1 &lt;0.000026&gt;<br>106630 14:57:34.894583 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894601 write(7, &quot;$&quot;, 1) = 1 &lt;0.000224&gt;<br>106630 14:57:34.894875 write(7, &quot;$&quot;, 1) = 1 &lt;0.000005&gt;<br>106630 14:57:34.894896 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894910 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894924 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.894942 write(7, &quot;$&quot;, 1) = 1 &lt;0.000341&gt;<br>106630 14:57:34.895304 write(7, &quot;$&quot;, 1) = 1 &lt;0.000277&gt;<br>106630 14:57:34.895611 write(7, &quot;$&quot;, 1) = 1 &lt;0.000005&gt;<br>106630 14:57:34.895634 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895650 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895664 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895677 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895691 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895707 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895722 write(7, &quot;$&quot;, 1) = 1 &lt;0.000004&gt;<br>106630 14:57:34.895737 write(7, &quot;$&quot;, 1) = 1 &lt;0.000345&gt;<br>106630 14:57:34.896105 select(0, NULL, NULL, NULL, {0, 16384}) = 0 (Timeout) &lt;0.017653&gt;<br>106630 14:57:34.913797 wait4(53093, 0x7fff3bd91b1c, WNOHANG|WSTOPPED, NULL) = 0 &lt;0.000006&gt;<br>106630 14:57:34.913845 wait4(106634, 0x7fff3bd91b84, WNOHANG, NULL) = 0 &lt;0.000004&gt;<br>106630 14:57:34.913863 kill(106634, SIGTERM) = 0 &lt;0.000017&gt;<br>106630 14:57:34.913894 wait4(106633, 0x7fff3bd91b84, WNOHANG, NULL) = 0 &lt;0.000004&gt;<br>106630 14:57:34.913910 kill(106633, SIGTERM) = 0 &lt;0.000170&gt;<br>106630 14:57:34.914094 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_KILLED, si_pid=106634, si_status=SIGTERM, si_utime=2059, si_stime=15631} ---<br>106630 14:57:34.914111 wait4(106632, 0x7fff3bd91b84, WNOHANG, NULL) = 0 &lt;0.000005&gt;<br>106630 14:57:34.914126 kill(106632, SIGTERM) = 0 &lt;0.000150&gt;<br>106630 14:57:34.914299 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_KILLED, si_pid=106632, si_status=SIGTERM, si_utime=34, si_stime=122} ---<br>106630 14:57:34.914318 select(0, NULL, NULL, NULL, {0, 65536}) = ? ERESTARTNOHAND (To be restarted if no handler) &lt;0.003412&gt;<br>106630 14:57:34.917756 --- SIGCHLD {si_signo=SIGCHLD, si_code=CLD_EXITED, si_pid=53093, si_status=0, si_utime=1336, si_stime=321} ---<br>106630 14:57:34.917771 select(0, NULL, NULL, NULL, {0, 62255}) = 0 (Timeout) &lt;0.062360&gt;<br>106630 14:57:34.980179 wait4(53093, [{WIFEXITED(s) &amp;&amp; WEXITSTATUS(s) == 0}], WNOHANG|WSTOPPED, NULL) = 53093 &lt;0.000044&gt;<br>106630 14:57:34.980269 wait4(106634, [{WIFSIGNALED(s) &amp;&amp; WTERMSIG(s) == SIGTERM}], WNOHANG, NULL) = 106634 &lt;0.000026&gt;<br>106630 14:57:34.980323 wait4(106633, [{WIFSIGNALED(s) &amp;&amp; WTERMSIG(s) == SIGTERM}], WNOHANG, NULL) = 106633 &lt;0.000013&gt;<br>106630 14:57:34.980353 wait4(106632, [{WIFSIGNALED(s) &amp;&amp; WTERMSIG(s) == SIGTERM}], WNOHANG, NULL) = 106632 &lt;0.000011&gt;<br>106630 14:57:34.980385 unlink(&quot;/APP/ep/apache/pid/ep_domain.pid&quot;) = 0 &lt;0.000087&gt;<br>106630 14:57:34.980524 write(2, &quot;[Wed Nov 29 14:57:34.980504 2017] [mpm_worker:notice] [pid 106630:tid 140086520838208] AH00295: caught SIGTERM, shutting down\n&quot;, 126) = 126 &lt;0.000011&gt;<br><br>For children's strace output, they're kept on polling on something, but what they really did and what business they're running were not known by us. You may need to engage the application vendor for further information:<br><br>** /tmp/171130/str.out<br><br>53360 14:51:41.586004 poll([{fd=23, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53363 14:51:41.662510 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001074&gt;<br>53363 14:51:41.662563 poll([{fd=26, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53364 14:51:41.784396 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.000911&gt;<br>53364 14:51:41.784478 poll([{fd=27, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53362 14:51:41.984951 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001110&gt;<br>53361 14:51:41.985004 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001161&gt;<br>53362 14:51:41.985028 poll([{fd=25, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53361 14:51:41.985047 poll([{fd=24, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53355 14:51:42.120856 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001097&gt;<br>53355 14:51:42.120937 poll([{fd=18, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53357 14:51:42.298480 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001120&gt;<br>53356 14:51:42.298537 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001176&gt;<br>53357 14:51:42.298583 poll([{fd=20, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53356 14:51:42.298608 poll([{fd=19, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53358 14:51:42.419883 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001079&gt;<br>53358 14:51:42.419955 poll([{fd=21, events=POLLIN}], 1, 1000 &lt;unfinished ...&gt;<br>53359 14:51:42.490445 &lt;... poll resumed&gt; ) = 0 (Timeout) &lt;1.001111&gt;<br>53359 14:51:42.490529 poll([{fd=22, events=POLLIN}], 1, 1000 &lt;detached ...&gt;<br><br>As a sum up at the moment, we recommend you asking application vendor to look into the core dump with their debuginfo files and checking with them if it's possible to add more debugging code/methods to their application for further troubleshoot this issue on their side.<br><br>Best regards,<br>Flos Kwok<br><br><publishedDate>2017-12-05T08:23:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6e4rIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-05T05:24:04Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-05T05:24:04Z</b><br><br>안녕하세요<br>3rd party 라이브러리인 webgate는 해당 솔루션업체에 core를 전달하여 분석을 요청한 점 참고하시기 바랍니다. <br><br>추가로 기  2017년 11월 30일 약 15:00 시 경 유선통화 시 요청드린 것과 같이 segmentation fault(11)이 발생한 원인분석이 어렵다면<br>해당 &quot;이슈 후 다른 http process가 hang 상태가 되어 이후 request를 처리하지 못하는 현상에 대한 원인 분석&quot;을 요청드립니다. <br><br>삼성생명 내 개발/검증계 등은 물론 local VM test 환경에서도 segmentation fault(11)와 유사한 명령어인 kill -11 PID를 수행해도<br>대상 process는 종료가 되지만 child process가 재기동되어 정상적으로 서비스가 되었습니다. <br><br>빠른 확인을 요청드립니다. <br>감사합니다.<br><br><publishedDate>2017-12-05T05:24:04Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L6K6mIAF"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-04T02:09:45Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-04T02:09:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>백업 엔지니어분이 모든 코어를 분석해 보았습니다. 다만 전부 앞서 안내해 드린 코어 정보와 같이 <br>필요한 라이브러리가 없어 trace 정보를 읽을수 없는 상황이여서 예를 들어 trace 정보를 보내주신것이며 <br>코어를 벤더사쪽으로 문의 드리시면 벤더사엔지니어분이 필요한 라이브러리로 디버깅 환경을 구축하셔서 <br>분석을 진행하실수 있으십니다.<br><br>만일 분석시 저희 레드햇 패치지들의 debuginfo 파일들이 필요하시면 등록하신 시스템에서 debuginfo-install<br>명령어로 설치 혹은 저희 레드햇 고객 포탈에서 다운로드 가능하십니다.<br><br>How to use gdb to generate a readable backtrace from an application core<br>https://access.redhat.com/solutions/274793<br><br>감사합니다.<br><br><publishedDate>2017-12-04T02:09:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L6JYeIAN"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-04T00:42:23Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-04T00:42:23Z</b><br><br>안녕하세요<br>확인 감사드립니다. <br>현재  webgate 업체에 문의 중에 있으니 참고하시기 바라며 추가적으로 기 분석요청드린 core에 대한 분석도 요청드립니다. <br><br>- 2017년 11월 23일 : 3호기 segment fault(11) 발생<br>core._httpd_58490_PIWBWL03SL_1340_1511394001.gz (19.0 MB) <br> <br>- 2017년 11월 24일 : 3호기 segment fault(11) 추가 발생<br>core._httpd_100117_PIWBWL03SL_1340_1510055509.gz (19.1 MB) <br><br>- 2017년 11월 27일 : 2호기 segment fault(11) 발생<br>core._httpd_28696_PIWBWL02SL_1340_1510054244.gz (18.5 MB) <br><br><br>- 2017년 11월 28일 : 4호기 segment fault(11) 발생<br>core._httpd_54501_PIWBWL04SL_1340_1511934151.gz 21MB<br><br>감사합니다<br><br><publishedDate>2017-12-04T00:42:23Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5zIWIAZ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-01T09:01:36Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-01T09:01:36Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>11월 30일 코멘트에서 예를 들어 첨부드린 부분을 보시면 thread 2를 확인하려고 시도시 아래와 같이<br>내용 확인이 불가능한 것을 볼수 있으십니다.<br><br>** /tmp/171130/core._httpd_54501_PIWBWL04SL_1340_1511934151<br><br>(gdb) thread 2<br>[Switching to thread 2 (Thread 0x7f686f4c5700 (LWP 54760))]<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>238<br>62:<br>movq<br>%rax, %r14<br><br>(gdb) bt<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>#1  0x00007f685f3f72af in ?? ()  &lt;========= 여기<br>#2  0x0000000000000000 in ?? ()  &lt;========= 여기<br><br>상기와 같이 모든 코어에서 추가적인 분석이 어려운 상황이 발생됩니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-01T09:01:36Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5ydOIAR"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-01T07:58:38Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-01T07:58:38Z</b><br><br>안녕하세요!<br><br>추가 문의가 있어 SR드립니다. <br><br>어제 업데이트 주신 SR 확인결과 gdb 상 webgate 관련 부분은 확인되지 않는데 확인요청드립니다. <br><br>##<br>(gdb) bt<br>#0  __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br>#1  0x00007f686e218219 in apr_thread_mutex_lock (mutex=&lt;optimized out&gt;) at locks/unix/thread_mutex.c:92<br>#2  0x00007f686ec68014 in apr_reslist_maintain (reslist=reslist@entry=0x7f6794082840) at misc/apr_reslist.c:184<br>#3  0x00007f686ec682f5 in apr_reslist_create (reslist=0x7f6871118710, min=&lt;optimized out&gt;, smax=&lt;optimized out&gt;, hmax=256, ttl=&lt;optimized out&gt;, <br>    con=con@entry=0x7f68636f2440 &lt;connection_constructor&gt;, de=de@entry=0x7f68636f2410 &lt;connection_destructor&gt;, params=params@entry=0x7f687118f400, pool=0x7f6794082668)<br>    at misc/apr_reslist.c:305<br>#4  0x00007f68636f56db in ap_proxy_initialize_worker (worker=0x7f687118f400, s=0x7f6871180d20, p=0x7f6871117d78) at proxy_util.c:1907<br>#5  0x00007f68636f19ec in proxy_handler (r=0x7f6788056d40) at mod_proxy.c:1045<br>#6  0x00007f686f560240 in ap_run_handler (r=0x7f6788056d40) at config.c:169<br>#7  0x00007f686f560789 in ap_invoke_handler (r=r@entry=0x7f6788056d40) at config.c:439<br>#8  0x00007f686f574b0a in ap_process_async_request (r=r@entry=0x7f6788056d40) at http_request.c:317<br>#9  0x00007f686f574de4 in ap_process_request (r=r@entry=0x7f6788056d40) at http_request.c:363<br>#10 0x00007f686f571772 in ap_process_http_sync_connection (c=0x7f685426e808) at http_core.c:190<br>#11 ap_process_http_connection (c=0x7f685426e808) at http_core.c:231<br>#12 0x00007f686f569810 in ap_run_process_connection (c=0x7f685426e808) at connection.c:41<br>#13 0x00007f686f569bf8 in ap_process_connection (c=c@entry=0x7f685426e808, csd=csd@entry=0x7f685426e5f0) at connection.c:202<br>#14 0x00007f686390878b in process_socket (bucket_alloc=0x7f6788051ca8, my_thread_num=29, my_child_num=2, sock=0x7f685426e5f0, p=0x7f685426e578, thd=0x7f6854002768)<br>    at worker.c:620<br>#15 worker_thread (thd=0x7f6854002768, dummy=&lt;optimized out&gt;) at worker.c:979<br>#16 0x00007f686dfebdc5 in start_thread (arg=0x7f68487e8700) at pthread_create.c:308<br>#17 0x00007f686db1528d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:113<br>##<br><br><publishedDate>2017-12-01T07:58:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5xC2IAJ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-12-01T05:34:35Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-12-01T05:34:35Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>상황 공유 감사드립니다.<br>이슈 발생시점 리소스 상황을 확인해 보았지만 CPU, 메모리, 네트워크 등 리소스 overload <br>현상이 없습니다.<br><br>OS측 추가 분석이 필요하시면 언제든지 연락 주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-12-01T05:34:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5vDcIAJ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-12-01T00:55:45Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-12-01T00:55:45Z</b><br><br>안녕하세요<br>확인감사드립니다. <br>요청하신 것과 같이 하기 내용과 더불어 11월 22일 1호기 webserver 이슈 시 생성된 core와 더불어 <br>webgate 쪽에 문의드릴 예정이니 참고하시기 바랍니다. <br><br>추가로 sosreport에 누락된 각 장비별 sar 로그를 첨부드립니다. <br>감사합니다.<br><br><publishedDate>2017-12-01T00:55:45Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5hU3IAJ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-30T08:15:29Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-30T08:15:28Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>올려주신 코어 덤프 파일을 전부 확인해본바에 의하면 모든 코어가 3rd party module 라이브러리가 있는 관계로<br>추가적인 원인 분석이 어려운 상황입니다. 행 이슈에 대하여 strace를 수집하여 분석 시도를 해보았지만 이는<br>이슈 발생후 정보라 행이 빠진것만 확인 될뿐 이와 같은 이슈가 발생된 원인을 확인할수 없는 상황입니다.<br>httpd는 어플리케이션의 container 작용만 하기때문에 segfault&amp;행 이슈 원인 분석에는 구체적으로 어플리케이션이 어떻게 실현되었는지<br>segfault가 발생시 다른 연관된 프로세스를 어떻게 처리하는지에 대해 알아보셔야 합니다.<br><br>segfault 이슈는 벤더사쪽으로 코어를 전달하여 추가적인 분석 요청을 해보셔야 하며<br>이에 따른 행 이슈는 어플리케이션 구성을 파악하여 서로 연관되어 있는 thread중 segfault 이슈가<br>발생시 다른 thread에는 어떤 영향을 주는지를 확인해 보셔야 합니다.<br><br>아래는 백업 엔지니어분이 일부 분석 과정을 공유해 주신 부분입니다. 참고하시기 바랍니다.<br><br>Just extracted the backtrace from the rest core dumps. But no idea if they're of the same issue. Maybe involving application vendors to look into these dumps as they have more information about the third party modules and know more about the workflow of their business.<br><br>** /tmp/171130/core._httpd_54501_PIWBWL04SL_1340_1511934151<br><br>Core was generated by `/usr/sbin/httpd -f /APP/ep/apache/conf/httpd.conf -k start'.<br>Program terminated with signal 11, Segmentation fault.<br>#0  __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br>50<br>  unsigned int type = PTHREAD_MUTEX_TYPE (mutex);<br><br>(gdb) info threads <br>  Id   Target Id         Frame <br>  272  Thread 0x7f684a7ec700 (LWP 54528) 0x00007f686db0ac3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>  ...<br>  9    Thread 0x7f67d603f700 (LWP 54773) pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>  8    Thread 0x7f67d6140700 (LWP 54762) pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>  7    Thread 0x7f67d6f05700 (LWP 54759) 0x00007f686db15863 in epoll_wait () at ../sysdeps/unix/syscall-template.S:81<br>  6    Thread 0x7f685a9eb700 (LWP 54504) 0x00007f686db0ac3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>  5    Thread 0x7f68581e6700 (LWP 54761) pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>  4    Thread 0x7f68527fc700 (LWP 54512) 0x00007f686db0ac3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>  3    Thread 0x7f686f4ff840 (LWP 54501) 0x00007f686dff222d in read () at ../sysdeps/unix/syscall-template.S:81<br>  2    Thread 0x7f686f4c5700 (LWP 54760) pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>* 1    Thread 0x7f68487e8700 (LWP 54532) __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br><br>(gdb) bt<br>#0  __GI___pthread_mutex_lock (mutex=0x8) at pthread_mutex_lock.c:50<br>#1  0x00007f686e218219 in apr_thread_mutex_lock (mutex=&lt;optimized out&gt;) at locks/unix/thread_mutex.c:92<br>#2  0x00007f686ec68014 in apr_reslist_maintain (reslist=reslist@entry=0x7f6794082840) at misc/apr_reslist.c:184<br>#3  0x00007f686ec682f5 in apr_reslist_create (reslist=0x7f6871118710, min=&lt;optimized out&gt;, smax=&lt;optimized out&gt;, hmax=256, ttl=&lt;optimized out&gt;, <br>    con=con@entry=0x7f68636f2440 &lt;connection_constructor&gt;, de=de@entry=0x7f68636f2410 &lt;connection_destructor&gt;, params=params@entry=0x7f687118f400, pool=0x7f6794082668)<br>    at misc/apr_reslist.c:305<br>#4  0x00007f68636f56db in ap_proxy_initialize_worker (worker=0x7f687118f400, s=0x7f6871180d20, p=0x7f6871117d78) at proxy_util.c:1907<br>#5  0x00007f68636f19ec in proxy_handler (r=0x7f6788056d40) at mod_proxy.c:1045<br>#6  0x00007f686f560240 in ap_run_handler (r=0x7f6788056d40) at config.c:169<br>#7  0x00007f686f560789 in ap_invoke_handler (r=r@entry=0x7f6788056d40) at config.c:439<br>#8  0x00007f686f574b0a in ap_process_async_request (r=r@entry=0x7f6788056d40) at http_request.c:317<br>#9  0x00007f686f574de4 in ap_process_request (r=r@entry=0x7f6788056d40) at http_request.c:363<br>#10 0x00007f686f571772 in ap_process_http_sync_connection (c=0x7f685426e808) at http_core.c:190<br>#11 ap_process_http_connection (c=0x7f685426e808) at http_core.c:231<br>#12 0x00007f686f569810 in ap_run_process_connection (c=0x7f685426e808) at connection.c:41<br>#13 0x00007f686f569bf8 in ap_process_connection (c=c@entry=0x7f685426e808, csd=csd@entry=0x7f685426e5f0) at connection.c:202<br>#14 0x00007f686390878b in process_socket (bucket_alloc=0x7f6788051ca8, my_thread_num=29, my_child_num=2, sock=0x7f685426e5f0, p=0x7f685426e578, thd=0x7f6854002768)<br>    at worker.c:620<br>#15 worker_thread (thd=0x7f6854002768, dummy=&lt;optimized out&gt;) at worker.c:979<br>#16 0x00007f686dfebdc5 in start_thread (arg=0x7f68487e8700) at pthread_create.c:308<br>#17 0x00007f686db1528d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:113<br><br>(gdb) thread 2<br>[Switching to thread 2 (Thread 0x7f686f4c5700 (LWP 54760))]<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>238<br>62:<br>movq<br>%rax, %r14<br><br>(gdb) bt<br>#0  pthread_cond_timedwait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_timedwait.S:238<br>#1  0x00007f685f3f72af in ?? ()<br>#2  0x0000000000000000 in ?? ()<br><br>감사합니다.<br><br><publishedDate>2017-11-30T08:15:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5gLTIAZ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-30T06:14:25Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-30T06:14:25Z</b><br><br>안녕하세요!<br><br>파트너사 담당자 연락처를 하기와 같이 전달드립니다. <br><br>## <br>회사명 : 타임게이트<br>담당자 : 안상훈 책임<br>연락처 ; 010-3957-1209<br>##<br><br>감사합니다.<br><br><publishedDate>2017-11-30T06:14:25Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5g7lIAB"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-30T05:48:49Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-30T05:48:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 모든 코어에 대한 분석을 의뢰한 상황이며 코어가 많다보니 다소 시간이<br>걸릴것으로 보입니다. 분석 결과가 있는대로 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-30T05:48:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5eflIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-30T02:08:04Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-30T02:08:04Z</b><br><br>안녕하세요! 빠른 확인에 감사드립니다. <br><br>추가 문의가 있어 SR 드립니다. <br>현재 segmentation fault(11)  발생 후 hang현상이 발생하는 케이스가 11월에만 총 5번이 발생하였습니다. <br><br>- 2017년 11월 22일 : 운영계 1호기 segment fault(11) 발생 후 hang현상 <br>## 4개의 첨부파일 ##<br>core._httpd_30330_PIWBWL01SL_1340_1511314916.gz (19.3 MB) <br>gdb_core._httpd_30330.txt (32.5 kB) <br>str_parents_49454.out (196.1 kB) <br>strace_child_14897.out (2.0 MB) <br>##<br><br>- 2017년 11월 23일 : 3호기 segment fault(11) 발생, 해당 파일 첨부<br>##<br>strace_parents.out (208.4 kB) <br>strace_child.out (2.7 MB) <br>core._httpd_58490_PIWBWL03SL_1340_1511394001.gz (19.0 MB) <br>gdb_core._httpd_58490_PIWBWL03SL_1340_1511394001.txt (11.9 kB) <br>##<br> <br>- 2017년 11월 24일 : 3호기 segment fault(11) 추가 발생, 해당 파일 첨부<br>##<br>core._httpd_100117_PIWBWL03SL_1340_1510055509.gz (19.1 MB) <br>str.out (112.6 kB) <br>str2.out (5.2 kB) <br>##<br> <br>- 2017년 11월 27일 : 2호기 segment fault(11) 발생, 해당 파일 첨부<br>##<br>core._httpd_28696_PIWBWL02SL_1340_1510054244.gz (18.5 MB) <br>gdb_core._httpd_71597_PIWBWL02SL_1340_1511737652.txt (10.8 kB) <br>str.out (13.0 kB) <br>##<br><br>- 2017년 11월 28일 : 4호기 segment fault(11) 발생, 해당 파일 첨부<br>##<br>core._httpd_54501_PIWBWL04SL_1340_1511934151.gz 21MB<br>str.out 179KB<br>str2.out 75KB<br>##<br><br>저희가 core 분석 관련하여 전달받은 답변은 하기와 같습니다. <br><br>## 2017년 11월 22일 오후 06:12분 SR 답변 ##<br>저희 엔지니어 분의 분석 결과에 의하면 컨낵션이 &quot;https://ep.ap5.p.samsunglife.kq:50002&quot;에 의하여<br>overwritten 이슈가 있는것으로 확인되며 추가적인 확인에는 mod_proxy 설정 파일이 필요하시다고 하십니다.<br>해당 환경에서 사용중인 설정 파일들을 압축하셔서 올려주시기 바랍니다.<br>##<br><br>## 2017년 11월 30일 SR 답변 ##<br>저희가 core 분석시 3rd party shared libs가 로딩이 되는 원인으로 추가적인 원인 분석이 어렵습니다.<br>3rd party 벤더사쪽으로 의뢰하셔서 추가적인 원인 분석 요청 드립니다.<br><br>There are 272 threads and we can't get a clean stack backtrace from some of the threads because<br>httpd has some 3rd party shared libs loaded.<br>##<br><br>문의1) 금일 업로드 한 것을 제외하고 4건의 core 분석을 의뢰드렸지만 2건의 답변이 왔습니다. 해당 분석은 어떤 core 파일을 분석하였는지 확인요청드립니다. <br>문의2) 22일 분석결과(mod_proxy 사용으로 인해 overwritten 이슈 추측)과 30일 분석결과(3rd party lib  사용에 따른 분석불가) 가 상이한 것으로 확인되는데 segmentation fault(11) 발생원인이 다수로 존재하는 것인지요?<br>문의3) 3rd party 벤더사쪽으로 의뢰하셔서 추가적인 원인 분석 요청을 하셨는데 어떤 것에 대하여 문의하면 되는지요? 함께 첨부주신 trace를 전달만 하면되는지요?<br><br>확인요청드립니다 <br><br>ps. 요청하신 sar 로그는 금일 오후 전달드리겠습니다.<br><br><publishedDate>2017-11-30T02:08:04Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5ePEIAZ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-30T01:31:48Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-30T01:31:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; 현재 사용중인 mod_proxy.so 파일자체의 이슈가 있는 건 아닌지요? 현재 사용중인 mod_proxy.so의 버젼을 확인하는 명령어가 있는지요?<br>mod_proxy.so 버전을 별도로 확인할수는 없으며 mod_proxy.so는 httpd 패키지에 포함됩니다.<br><br>&gt; RHEL7 번들 http server에 포함된 mod_proxy.so 파일의 최신 파일을 첨부받을 수 있는지요?<br>httpd 최신버전은 2.4.6-67.el7_4.6 인것으로 확인되며 해당 패키지는 아래의 링크에서 다운로드 받아 설치 가능하십니다.<br>https://access.redhat.com/downloads/content/package-browser<br><br>&gt; 만약 불가능하다면 최신 community apache에 포함된 so파일로 변경을 해도 되는지요?<br>고객님께서 community apache로 테스트를 하실수 있으며 만일 이슈가 해소되신다면 저희 레드햇에서 원인 분석 및 패치를<br>확인할 것입니다. 다만 community apache에 관련 이슈는 지원이 되지 않기 때문에 테스트 용으로만 사용하시기 바랍니다.<br><br>리소스 상태에 대하여서는 sar로그를 올려주시면 확인해 보도록 하겠습니다.<br><br>아래와 같이 저희가 core 분석시 3rd party shared libs가 로딩이 되는 원인으로 추가적인 원인 분석이 어렵습니다.<br>3rd party 벤더사쪽으로 의뢰하셔서 추가적인 원인 분석 요청 드립니다.<br><br>There are 272 threads and we can't get a clean stack backtrace from some of the threads because<br>httpd has some 3rd party shared libs loaded.<br><br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/webgatessl_apache24.so<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libclntsh.so.11.1<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libnnz11.so<br>0x00007f0ff41dc110  0x00007f0ff41e8d64  Yes         /lib64/libnsl.so.1<br>0x00007f0ff3ccd5a0  0x00007f0ff3ccd77d  Yes         /lib64/libaio.so.1<br>                                        No          /APP/ep/webgate/Webgate_apache24/webgate/apache/lib/libxmlengine.so<br><br>gdb) thr 76<br>[Switching to thread 76 (Thread 0x7f1006e32700 (LWP 30595))]<br>#0  0x00007f10055efc3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>81<br>T_PSEUDO (SYSCALL_SYMBOL, SYSCALL_NAME, SYSCALL_NARGS)<br>(gdb) bt<br>#0  0x00007f10055efc3d in poll () at ../sysdeps/unix/syscall-template.S:81<br>#1  0x00007f0ff706c1c6 in ?? ()<br>#2  0x0000000000000000 in ?? ()<br><br>감사합니다.<br><br><publishedDate>2017-11-30T01:31:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5e7oIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-30T01:01:21Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-30T01:01:20Z</b><br><br>확인요청드립니다. <br><br>2017년 11월 24일 기 문의드린 하기의 내역에 답변요청드립니다. <br><br>현재 사용중인 mod_proxy.so 파일자체의 이슈가 있는 건 아닌지요? 현재 사용중인 mod_proxy.so의 버젼을 확인하는 명령어가 있는지요?<br>##<br> rpm -qf /etc/httpd/modules/mod_proxy.so<br>httpd-2.4.6-40.el7.x86_64<br>##<br><br>RHEL7 번들 http server에 포함된 mod_proxy.so 파일의 최신 파일을 첨부받을 수 있는지요?<br>만약 불가능하다면 최신 community apache에 포함된 so파일로 변경을 해도 되는지요?<br><br><publishedDate>2017-11-30T01:01:20Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5dywIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-30T00:43:32Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-30T00:43:32Z</b><br><br>안녕하세요<br>운영계 web server 4호기에서 동일 증상이 발생하여 core파일 및 strace를 첨부드립니다.<br><br><publishedDate>2017-11-30T00:43:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L5PZsIAN"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-29T08:18:39Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-29T08:18:39Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>올려주신 sosreport에는 이슈 발생시 sar 로그가 확인이 되지 않고 있는데 <br>혹시 별도로 저장 하신것인지요?<br><br>$ vim var/log/sa/<br>201711/ sa01    sa02    sa03    sa04    sar03   sar05   sar06   sar08 <br><br>$ vim var/log/sa/201711/sa<br>sa01   sa02   sa03   sa04   sar03  sar05  sar06  sar08  <br><br>sar 로그 확인 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-29T08:18:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L5OHfIAN"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-29T06:06:13Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-29T06:06:13Z</b><br><br>안녕하세요<br>요청하신 sosreport를 첨부드립니다. <br>확인요청드립니다. <br>감사합니다.<br><br><publishedDate>2017-11-29T06:06:13Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L4kmTIAR"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-27T01:26:33Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-27T01:26:33Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 분석중 3rd party 모듈이 있어 추가적인 분석이 어렵다는 답변 받았습니다.<br>우선 이슈 발생시 리소스 이슈가 있는지를 확인해 보기 위하여 서버에서 sosreport를<br>수집하셔서 케이스에 업로드 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-27T01:26:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L4kjoIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-27T01:21:03Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-27T01:21:03Z</b><br><br>기 문의드린 사항에 대하여 확인요청드립니다. <br>##<br>추가로 문의드립니다. <br>현재 segment fault(11)의 발생원인이 mod_proxy로 WEB-WAS 간 연동 시 overwritten 이슈로 인해 발생하는 것으로 1차 분석 결과를 받았습니다. <br>만약 현재 사용중인 mod_proxy.so 파일자체의 이슈가 있는 건 아닌지요? 현재 사용중인 mod_proxy.so의 버젼을 확인하는 명령어가 있는지요?<br>##<br> rpm -qf /etc/httpd/modules/mod_proxy.so<br>httpd-2.4.6-40.el7.x86_64<br>##<br><br>RHEL7 번들 http server에 포함된 mod_proxy.so 파일의 최신 파일을 첨부받을 수 있는지요?<br>만약 불가능하다면 최신 community apache에 포함된 so파일로 변경을 해도 되는지요?<br>##<br><br><publishedDate>2017-11-27T01:21:03Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L4kiqIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-27T01:16:32Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-27T01:16:32Z</b><br><br>안녕하세요<br>번들 http server  2호기에서 동일 증상이 발생하여 SR 업데이트 드립니다. <br><br>## common_error_log 일부 중략 ##<br>p2.p.oam.samsunglife.kr:5575: Connection refused<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>[Mon Nov 27 08:07:32.942343 2017] [core:notice] [pid 41764:tid 139634273863744] AH00051: child pid 71597 exit signal Segmentation fault (11), possible coredump in /LOG/ep/apache<br>##<br><br>core 파일 및 strace 결과, gdb 수행결과를 첨부드립니다. <br><br>확인요청드립니다 <br>감사합니다.<br><br><publishedDate>2017-11-27T01:16:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L4YGxIAN"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-24T08:26:50Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-24T08:26:50Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 해당 이슈에 대하여 collaboration을 진행하여 분석 요청 중에 있습니다.<br>아시다시피 한국 영업시간이 끝나가니 만일 새로운 업데이트 사항이 있으시면 영문으로 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-24T08:26:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L4Y9hIAF"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-24T08:14:18Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-24T08:14:18Z</b><br><br>안녕하세요<br>금일 2017년 11월 24일 약 15:10분경 websever 3호기에서 동일 증상(segment fault(11))이 재 발생후 다른 프로세스가 hang걸리는 현상이 발생하여<br>SR업데이트 드립니다. <br>빠른 확인요청드립니다.  <br>감사합니다.<br><br><publishedDate>2017-11-24T08:14:18Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L4Wu9IAF"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-24T06:14:35Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-24T06:14:35Z</b><br><br>안녕하세요<br>요청하신 설정파일을 첨부드립니다. <br><br>추가로 문의드립니다. <br>현재 segment fault(11)의 발생원인이 mod_proxy로 WEB-WAS 간 연동 시 overwritten 이슈로 인해 발생하는 것으로 1차 분석 결과를 받았습니다. <br>만약 현재 사용중인 mod_proxy.so 파일자체의 이슈가 있는 건 아닌지요? 현재 사용중인 mod_proxy.so의 버젼을 확인하는 명령어가 있는지요?<br>##<br> rpm -qf /etc/httpd/modules/mod_proxy.so<br>httpd-2.4.6-40.el7.x86_64<br>##<br><br>RHEL7 번들 http server에 포함된 mod_proxy.so 파일의 최신 파일을 첨부받을 수 있는지요?<br>만약 불가능하다면 최신 community apache에 포함된 so파일로 변경을 해도 되는지요?<br><br>확인요청드립니다.<br><br><publishedDate>2017-11-24T06:14:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L4VS5IAN"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-24T01:46:34Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-24T01:46:34Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>백업 엔지니어분의 답변에 의하면 아래와 같은 설정 파일이 빠졌다고 하십니다.<br>추가 업로드 부탁 드립니다.<br>httpd.conf:Include /APP/ep/apache/conf/loadModule.conf              <br>httpd.conf:Include /APP/ep/apache/conf/ep.httpd.conf                <br>httpd.conf:Include /APP/ep/apache/conf/errorPages.conf              <br>httpd.conf:include  &quot;/APP/ep/apache/conf/webgate.conf&quot; <br><br>감사합니다.<br><br><publishedDate>2017-11-24T01:46:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L4VOhIAN"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-24T01:39:17Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-24T01:39:17Z</b><br><br>안녕하세요<br>추가로 3호기 webserver 장비에서도 동일하게 증상이 발생하여 첨부드립니다. <br>분석요청드립니다<br>감사합니다.<br><br><publishedDate>2017-11-24T01:39:17Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L4LNSIA3"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-23T03:34:10Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-23T03:34:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>올려주신 설정 파일 확인중에 있으니 분석 결과가 있는대로 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-23T03:34:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L4K0KIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-11-23T01:09:39Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-23T01:09:39Z</b><br><br>안녕하세요<br><br>타임게이트 허 민 입니다.<br>빠른 답변 감사드립니다.<br>보내주신 내용 고객측에 전달 하였으며 요청하신 config 파일 보내드립니다.<br>확인 바랍니다.<br><br><publishedDate>2017-11-23T01:09:39Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L48OSIAZ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-22T09:12:32Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-22T09:12:32Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>저희 엔지니어 분의 분석 결과에 의하면 컨낵션이 &quot;https://ep.ap5.p.samsunglife.kq:50002&quot;에 의하여<br>overwritten 이슈가 있는것으로 확인되며 추가적인 확인에는 mod_proxy 설정 파일이 필요하시다고 하십니다.<br>해당 환경에서 사용중인 설정 파일들을 압축하셔서 올려주시기 바랍니다.<br><br>또한 해당 환경에서 mod_proxy를 사용하고 계신것으로 확인되는데 httpd와 어떤 방식으로 interaction을 <br>진행하는지에 대한 설명 부탁 드립니다.<br><br><br>(gdb) thread <br>[Current thread is 1 (Thread 0x7f0fe37ee700 (LWP 30354))]<br>(gdb) bt                          <br>#0  0x00007f0ffb1d9d9d in ap_proxy_ssl_connection_cleanup (conn=0x7f10088de330, r=r@entry=0x7f0ef0006440) at proxy_util.c:1431<br>#1  0x00007f0ff9f8e592 in proxy_http_handler (r=0x7f0ef0006440, worker=0x7f10088de330, conf=0x7f10089311e8, <br>    url=0x7f0ef001d448 &quot;https://ep.ap5.p.samsunglife.kr:50002/css/themes/sap_serp_standard/dynamic.css&quot;, proxyname=0x0, proxyport=0)<br>    at mod_proxy_http.c:1934<br>#2  0x00007f0ffb1d5d54 in proxy_run_scheme_handler (r=r@entry=0x7f0ef0006440, worker=0x7f10088de330, conf=conf@entry=0x7f10089311e8, <br>    url=0x7f0ef001d448 &quot;https://ep.ap5.p.samsunglife.kr:50002/css/themes/sap_serp_standard/dynamic.css&quot;, <br>    proxyhost=proxyhost@entry=0x0, proxyport=proxyport@entry=0) at mod_proxy.c:2733<br>#3  0x00007f0ffb1d6c3d in proxy_handler (r=0x7f0ef0006440) at mod_proxy.c:1119<br>#4  0x00007f1007045240 in ap_run_handler (r=0x7f0ef0006440) at config.c:169<br>#5  0x00007f1007045789 in ap_invoke_handler (r=r@entry=0x7f0ef0006440) at config.c:439<br>#6  0x00007f1007059b0a in ap_process_async_request (r=r@entry=0x7f0ef0006440) at http_request.c:317<br>#7  0x00007f1007059de4 in ap_process_request (r=r@entry=0x7f0ef0006440) at http_request.c:363<br>#8  0x00007f1007056772 in ap_process_http_sync_connection (c=0x7f0fec2622c8) at http_core.c:190<br>#9  ap_process_http_connection (c=0x7f0fec2622c8) at http_core.c:231<br>#10 0x00007f100704e810 in ap_run_process_connection (c=0x7f0fec2622c8) at connection.c:41<br>#11 0x00007f100704ebf8 in ap_process_connection (c=c@entry=0x7f0fec2622c8, csd=csd@entry=0x7f0fec2620b0) at connection.c:202<br>#12 0x00007f0ffb3ed78b in process_socket (bucket_alloc=0x7f0ef00008e8, my_thread_num=22, my_child_num=2, sock=0x7f0fec2620b0, <br>    p=0x7f0fec262038, thd=0x7f0fec002618) at worker.c:620<br>#13 worker_thread (thd=0x7f0fec002618, dummy=&lt;optimized out&gt;) at worker.c:979<br>#14 0x00007f1005ad0dc5 in start_thread (arg=0x7f0fe37ee700) at pthread_create.c:308<br>#15 0x00007f10055fa28d in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:113<br>(gdb)<br>(gdb) disassemble                                                   <br>Dump of assembler code for function ap_proxy_ssl_connection_cleanup:                                                                    <br>   0x00007f0ffb1d9d40 &lt;+0&gt;:     push   %r12                         <br>   0x00007f0ffb1d9d42 &lt;+2&gt;:     push   %rbp<br>   0x00007f0ffb1d9d43 &lt;+3&gt;:     push   %rbx<br>   0x00007f0ffb1d9d44 &lt;+4&gt;:     mov    %rdi,%rbx<br>   0x00007f0ffb1d9d47 &lt;+7&gt;:     sub    $0x20,%rsp<br>   0x00007f0ffb1d9d4b &lt;+11&gt;:    mov    %fs:0x28,%rax<br>   0x00007f0ffb1d9d54 &lt;+20&gt;:    mov    %rax,0x18(%rsp)<br>   0x00007f0ffb1d9d59 &lt;+25&gt;:    xor    %eax,%eax<br>   0x00007f0ffb1d9d5b &lt;+27&gt;:    cmpq   $0x0,0x38(%rdi)<br>   0x00007f0ffb1d9d60 &lt;+32&gt;:    je     0x7f0ffb1d9e1f &lt;ap_proxy_ssl_connection_cleanup+223&gt;<br>   0x00007f0ffb1d9d66 &lt;+38&gt;:    cmpq   $0x0,(%rdi)<br>   0x00007f0ffb1d9d6a &lt;+42&gt;:    je     0x7f0ffb1d9e1f &lt;ap_proxy_ssl_connection_cleanup+223&gt;<br>   0x00007f0ffb1d9d70 &lt;+48&gt;:    mov    0x8(%rsi),%rax<br>   0x00007f0ffb1d9d74 &lt;+52&gt;:    mov    %rsi,%r12<br>   0x00007f0ffb1d9d77 &lt;+55&gt;:    mov    (%r12),%rdi<br>   0x00007f0ffb1d9d7b &lt;+59&gt;:    mov    0x80(%rax),%rsi<br>   0x00007f0ffb1d9d82 &lt;+66&gt;:    callq  0x7f0ffb1d04e0 &lt;apr_brigade_create@plt&gt;<br>   0x00007f0ffb1d9d87 &lt;+71&gt;:    mov    %rax,%rbp<br>   0x00007f0ffb1d9d8a &lt;+74&gt;:    mov    (%rbx),%rax<br>   0x00007f0ffb1d9d8d &lt;+77&gt;:    xor    %edx,%edx<br>   0x00007f0ffb1d9d8f &lt;+79&gt;:    mov    $0x2000,%r8d<br>   0x00007f0ffb1d9d95 &lt;+85&gt;:    mov    $0x1,%ecx<br>   0x00007f0ffb1d9d9a &lt;+90&gt;:    mov    %rbp,%rsi<br>=&gt; 0x00007f0ffb1d9d9d &lt;+93&gt;:    mov    0x68(%rax),%rdi<br>...<br>(gdb) info registers rax<br>rax            0x6cb9576a1d5332d6       7834389140057830102<br>(gdb) x/1gx 0x6cb9576a1d5332d6+0x68<br>0x6cb9576a1d53333e:     Cannot access memory at address 0x6cb9576a1d53333e<br>(gdb) <br><br>== The segfault occurred at thread #1. It looks something is broken.<br><br>(gdb) info registers rbx<br>rbx            0x7f10088de330   139706839720752<br>(gdb) print conn<br>$7 = (proxy_conn_rec *) 0x7f10088de330<br>(gdb) <br>(gdb) print *conn<br>$9 = {connection = 0x6cb9576a1d5332d6, r = 0x1, worker = 0x7f10088de330, pool = 0x7f1006fcf998, <br>  hostname = 0x7f10088d9818 &quot;\310ɍ\b\020\177&quot;, addr = 0x7f100886e020, scpool = 0x0, sock = 0x2f2f3a7370747468, <br>  data = 0x702e3570612e7065, forward = 0x676e75736d61732e, flags = 1701210476, port = 27438, is_ssl = 1, close = 0, need_flush = 0, <br>  inreslist = 0, uds_path = 0x3230303035 &lt;Address 0x3230303035 out of bounds&gt;}<br>(gdb) <br><br>== It seems conn is broken.<br>== I found something interesting :<br><br>(gdb) print &amp;conn.sock <br>$10 = (apr_socket_t **) 0x7f10088de368<br>(gdb) x/s 0x7f10088de368<br>0x7f10088de368: &quot;https://ep.ap5.p.samsunglife.kq:50002&quot;<br>(gdb) <br><br>In the midst of conn was overwritten by &quot;https://ep.ap5.p.samsunglife.kq:50002&quot;.<br>It should be in one of config files. Finding a place where it is defined may give us a clue.<br><br>감사합니다.<br><br><publishedDate>2017-11-22T09:12:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L46DgIAJ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-22T06:42:57Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-22T06:42:57Z</b><br><br>안녕하세요! 확인에 감사드립니다. <br><br>추가 문의하신 내역에 대하여 하기와 같이 전달드리니 참고하시기 바랍니다. <br><br> <br>아래 내용에 답변 드립니다.<br><br>이슈 발생시 해당 서버에서 어떤 작업이 있었는지요? <br>--&gt; 어떤 작업을 말씀하시는지요? 설정변경 등을 의미하시는지요? 만약 그렇다면 운영계 장비이기 때문에 일과시간에 별도의 작업은 진행할 수 없고<br>별도의 일정으로 PM시 작업이 진행되며 금일 이슈발생 시점인 약 10:50분경에는 특이사항은 없는 것으로 확인됩니다 <br><br>ep업무는 상세히 어떤 작업을 말씀하시는것인지 설명 부탁 드립니다.<br>--&gt;<br>EP는 Enterprize Portal의 약자로 사내 시스템을 사용하기 위한 접속 창구로서의 Portal 로써 처리 데이터는 FC, GA 가 사용하는 업무 데이터 이며 시스템 이용자는 임직원, FC , GA 입니다.<br><br>혹시 레드햇에서 제공하는 라이브러리가 아니신지죠?<br>--&gt; 별도의 3rd party library는 아닙니다. 번들 http 설치시 함께 rpm으로 설치한 것으로 확인됩니다. 요청하신 결과를 하기와 같이 첨부드립니다. <br>##<br>epadmin@PIWBWL01SL /home/epadmin # rpm -qf /etc/httpd/modules/mod_ssl.so<br>mod_ssl-2.4.6-40.el7.x86_64<br>##<br><br>감사합니다.<br><br><publishedDate>2017-11-22T06:42:57Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L461pIAB"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-22T06:27:11Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-22T06:27:11Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>core 파일을 잘 받아왔습니다.<br><br>이슈 발생시 해당 서버에서 어떤 작업이 있었는지요? ep업무는 상세히 어떤 작업을 말씀하시는것인지 설명 부탁 드립니다.<br>코어 파일에 의하면 이슈 발생시 아래의 사이트의 request를 처리 중인것으로 확인됩니다.<br><br>https://ep.ap5.p.samsunglife.kr:50002/css/themes/sap_serp_standard/dynamic.css<br><br>다만 추가 분석 시도시 아래와 같은 라이브러리가 missing으로 나오는데<br>혹시 레드햇에서 제공하는 라이브러리가 아니신지죠?<br>/etc/httpd/modules/mod_ssl.so<br><br>아니다면 상기의 파일을 케이스에 올려주시고 아래의 명령어 결과도 함께 첨부 부탁 드립니다.<br><br># rpm -qf /etc/httpd/modules/mod_ssl.so<br><br>감사합니다.<br><br><publishedDate>2017-11-22T06:27:11Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L44J5IAJ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-22T02:48:18Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-22T02:48:18Z</b><br><br>안녕하세요 <br>운영계 번들 http server에서 segment fault(11)이 발생하여 관련 process가 hang현상이 재현되어 요청하신 파일들을 업데이트 드립니다. <br><br>access 로그 및 error 로그에는 전혀 특이사항이 없어 별도 첨부하지 않았으나 common_error_log 일부를 첨부드리니 참고하시기 바랍니다. <br>##<br>[Sun Nov 19 07:01:01.321627 2017] [mpm_worker:notice] [pid 49454:tid 139706813532224] AH00292: Apache/2.4.6 (Red Hat Enterprise Linux) OpenSSL/1.0.1e-fips configured -- resuming normal operations<br>[Sun Nov 19 07:01:01.321649 2017] [core:notice] [pid 49454:tid 139706813532224] AH00094: Command line: '/usr/sbin/httpd -f /APP/ep/apache/conf/httpd.conf'<br>ap1.p.oam.samsunglife.kr:5575: Connection refused<br>ap1.p.oam.samsunglife.kr:5575: Connection refused<br>ap1.p.oam.samsunglife.kr:5575: Connection refused<br>## 중략 ##<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>ap2.p.oam.samsunglife.kr:5575: Connection refused<br>[Wed Nov 22 10:41:57.056120 2017] [core:notice] [pid 49454:tid 139706813532224] AH00051: child pid 30330 exit signal Segmentation fault (11), possible coredump in /LOG/ep/apache<br>##<br><br>현재 이슈가 발생한 업무는 ep업무이며 epamdin의 계정으로 수행된 process입니다. <br>##<br>epadmin@PIWBWL01SL /LOG/ep/apache # ps -ef | grep httpd<br>epadmin   14897  49454  4 09:39 ?        00:03:38 /usr/sbin/httpd -f /APP/ep/apache/conf/httpd.conf -k start<br>biadmin   32316  48939  0 10:52 ?        00:00:00 /usr/sbin/httpd -f /APP/bi/apache/conf/httpd.conf -k start<br>epadmin   32567  32444  0 10:53 pts/4    00:00:00 grep --color=auto httpd<br>biadmin   48939      1  0 Nov19 ?        00:00:11 /usr/sbin/httpd -f /APP/bi/apache/conf/httpd.conf -k start<br>crmadmin  48940      1  0 Nov19 ?        00:00:08 /usr/sbin/httpd -f /APP/crm/apache/conf/httpd.conf -k start<br>crmadmin  48962  48940  0 Nov19 ?        00:06:20 /usr/sbin/httpd -f /APP/crm/apache/conf/httpd.conf -k start<br>epadmin   49454      1  0 Nov19 ?        00:00:19 /usr/sbin/httpd -f /APP/ep/apache/conf/httpd.conf -k start<br>##<br>현재 이슈가 발생한 pid 30330 child process는 강제종료되어 ps 상 확인은 되지 않아 현재 hang으로 빠진 ep관련 process에 대한 parents 및 child 에 strace를 수행하여 첨부드립니다. <br>- str_parents_49454.out, strace_child_14897.out <br><br>또한 segment fault(11) 발생 시 생성된 core 파일 및 해당 core파일에 대한 gdb결과도 함께 첨부드립니다. <br>core._httpd_30330_PIWBWL01SL_1340_1511314916.gz<br>gdb_core._httpd_30330.txt<br><br>현재 실 운영중인 점 참고하시어 빠른 분석을 요청드립니다 <br>감사합니다.<br><br><publishedDate>2017-11-22T02:48:18Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000L3UFRIA3"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-20T01:22:10Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-20T01:22:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>피드백 감사드립니다.<br><br>추가적인 문의사항이 있으시면 언제든지 연락주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-20T01:22:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000L3U7SIAV"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-20T00:57:36Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-20T00:57:36Z</b><br><br>요청하신 케이스 확인하여 SR 업데이트 드리도록 하겠습니다.<br><br><publishedDate>2017-11-20T00:57:36Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KySLOIA3"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-15T09:01:29Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-15T09:01:29Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; 혹시 이 경우 어떠한 case가 있는지 확인 부탁드립니다.<br>백업 엔지니어 답변에 의하면 프로세스 사이에는 파이프 등 여러가지 방법으로 통신을 진행하기 때문에 이와 같은 이슈는 사용하는 프로그램 구성에 따라 발생될수 있다고 하십니다. <br>php 혹은 java 개발자라면 이와 같은 시물레이션 가능하시다고 하십니다.<br><br>&gt; 또한 Redhat 내부 재현이 되지 않았다고 하셨는데 그러면 현재 테스트 진행이 되지 않고 있는 것인지요?혹시 테스트는 아파치에 dump 시그널을 줬을시 현상 재현이 안된다는 말씀이신지요?아니면 segment fault가 재현이 안된다는 말씀이신지요?<br>테스트시 수동으로 kill -11 신호를 주어 segfault 이슈는 재현되며 코어가 생성 되지만 해당 경우에 행 이슈가 발생되지 않았습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-15T09:01:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KyRdbIAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-11-15T08:02:39Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-15T08:02:39Z</b><br><br>- 행 이슈는 kill -11 명령어로 코어가 발생된후 발생된 이슈이다보니 원인 분석에는 이슈 발생시 <br>프로세스의 gcore와 strace 결과가 필요합니다.<br>&gt;<br>현재 수집된 gcore와 strace 값은 없으며 동일 현상 발생 시 수집 예정입니다.<br>재현되면 수집 하도록 하겠습니다.<br><br>- 또한 앞서 말씀드렸듯이 kill -11 명령어 실행시 현재 실행되고 있는 작업이 중지되어 의존성이 있는 <br>다른 작업이 반환값을 받지 못하여 대기 상태에 빠질수 있습니다.<br>&gt;<br>혹시 이 경우 어떠한 case가 있는지 확인 부탁드립니다.<br><br>- 또한 지난 가이드 시 테스트환경을 구축하신다고 하셨는데 해당 장비에서 segment fault발생시 http process가 hang으로 빠지는 이슈가 재현되지는 않았는지요?<br>아쉽게도 저희 여러 엔지니어분이 테스트를 진행해 보았지만 행 이슈는 없었습니다.<br><br>&gt;<br>테스트 환경에서 segment fault 재현은 되지 않었습니다.<br>또한 Redhat 내부 재현이 되지 않았다고 하셨는데 그러면 현재 테스트 진행이 되지 않고 있는 것인지요?혹시 테스트는 아파치에 dump 시그널을 줬을시 현상 재현이 안된다는 말씀이신지요?아니면 segment fault가 재현이 안된다는 말씀이신지요?<br><br><publishedDate>2017-11-15T08:02:39Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KyQGPIA3"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-15T05:51:48Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-15T05:51:48Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>&gt; 현재 운영중인 장비에서 kill -11 이후 hang으로 빠지는 원인에 대한 분석이 필요합니다. <br>행 이슈는 kill -11 명령어로 코어가 발생된후 발생된 이슈이다보니 원인 분석에는 이슈 발생시 <br>프로세스의 gcore와 strace 결과가 필요합니다. 만일 이슈가 재현 되신다면 수집 부탁 드립니다.<br>또한 앞서 말씀드렸듯이 kill -11 명령어 실행시 현재 실행되고 있는 작업이 중지되어 의존성이 있는 <br>다른 작업이 반환값을 받지 못하여 대기 상태에 빠질수 있습니다. 따라서 행 이슈는 이와 같은 <br>원인으로 발생될 가능성이 높습니다.<br><br>&gt; 또한 지난 가이드 시 테스트환경을 구축하신다고 하셨는데 해당 장비에서 segment fault발생시 <br>http process가 hang으로 빠지는 이슈가 재현되지는 않았는지요?<br>아쉽게도 저희 여러 엔지니어분이 테스트를 진행해 보았지만 행 이슈는 없었습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-15T05:51:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KyOWqIAN"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-15T01:49:20Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-15T01:49:19Z</b><br><br>빠른 답변에 감사드립니다 .<br><br>우선 지난번 첨부드린 core 파일이 강제로 kill -11을 한 결과이기 때문에 이슈 분석에 도움이 안되는 것을 잘 알고 있습니다. <br><br>문의드리고자 하는 것은 Segment fault(11)이 발생하는 원인도 필요하지만 <br>Segment fault(11) = kill -11 이 발생한 후 관련 http process가 hang으로 빠지며 정상적인 request 처리가 안되는 것입니다. <br>개발/검증계 에서는 kill -11 이후 child process가 재기동되어 정상적으로 서비스가 되었지만<br>현재 운영중인 장비에서 kill -11 이후 hang으로 빠지는 원인에 대한 분석이 필요합니다. <br><br>또한 지난 가이드 시 테스트환경을 구축하신다고 하셨는데 해당 장비에서 segment fault발생시 http process가 hang으로 빠지는 이슈가 재현되지는 않았는지요?<br>##<br>동일한 디버깅 환경을 구축하여 core 파일을 분석하기 위하여<br>아래와 같은 명령어 출력 결과를 수집하셔서 케이스에 첨부<br>부탁 드립니다.<br><br># uname -a<br># rpm -qa <br>##<br><br>확인요청드립니다.<br><br><publishedDate>2017-11-15T01:49:19Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Ky93uIAB"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-14T08:18:33Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-14T08:18:33Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>1) 지난번 SR에서는 왜 gcore에 대한 가이드가 없었는지<br><br>앞서 케이스에서는 segfault 발생시 원인 분석에 필요한 코어가 발생되지 <br>않는 이슈에 중점을 두어 안내해 드린것으로 보입니다.<br>kill -11 명령어를 가이드해드린것은 segfault 시뮬레이션을 진행하여<br>정상적으로 코어 파일이 생성되는지 확인하기 위함입니다.<br>다만 테스트 작업시 행 이슈에 대하여 원인분석을 진행하시려면 행이 발생된 <br>프로세스의 gcore로 생성된 코어를 수집이 필요합니다.<br><br>따라서 만일 앞서 말씀하신 child process가 자체로 segfault 이슈가<br>발생될 경우에는 현재 환경에서 분석에 필요한 코어가 정상적으로 생성될 겁니다.<br>또한 좀비 프로세스가 있다고 하였기 때문에 해당 이슈에 대하여서는<br>부모 process의 gcore를 수집해 주시면 분석에 도움이 되어 안내해 드리게<br>되었습니다.<br><br>2) gcore를 사용한 로컬테스트 결과가 재현 되었는지<br>gcore 로는 코어가 정상적으로 생성되는것은 테스트 해보았습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-14T08:18:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ky8XIIAZ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-14T07:27:51Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-14T07:27:51Z</b><br><br>안녕하세요.<br><br>요청하신 core파일은 지난 SR(01783481)에서 가이드해주신 내용에 따라 kill -11을 사용하여 생성하였습니다.<br>=&gt; RHEL7 core파일 생성 가이드 답변일자: Park, Min Woo 날짜: Apr 13 2017 시간: 11:08 AM +09:00<br><br>지금 가이드해주신 내용은 gcore로 core파일을 생성할것을 전달해주셨는데 이전 SR 가이드에 차이가 있어 문의사항 드립니다.<br><br>1) 지난번 SR에서는 왜 gcore에 대한 가이드가 없었는지<br>2) gcore를 사용한 로컬테스트 결과가 재현 되었는지<br><br>위 두가지 문의사항 답변 부탁드립니다.<br><br><publishedDate>2017-11-14T07:27:51Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Ky7wfIAB"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-14T06:35:10Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-14T06:35:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>저희 백업 엔지니어분이 core 파일을 분석 결과 해당 파일은 kill -11 명령어로 생성되었기 때문에<br>행 이슈를 분석하기 어렵다고 하십니다.<br><br>The core generated by kill -11 does not help to resolve the customer's issue.<br>It is just a snapshot when you run the kill command.<br><br>또한 테스트시 kill -11 대신 gcore를 사용하시는것이 더 안전하다고 하십니다.<br>이는 kill -11 명령어 실행시 현재 실행되고 있는 작업이 중지되어 의존성이 있는 다른 작업이<br>반환값을 받지 못하여 대기 상태에 빠질수 있기 때문입니다.<br><br>gcore로 코어를 생성하는 방법은 아래의 문서를 참고하실수 있으십니다.<br><br>$ gcore (pid of the process)<br><br>참고문서:<br>How to obtain a core file without restarting an application?<br>https://access.redhat.com/solutions/9952<br><br>현재 정상적으로 코어가 발생되는 환경이 구축 되었으므로 segfault 발생시 좀비 프로세스가 발생하는 이슈가 <br>재현되시면 생성된 코어와 gcore로 부모 프로세스의 코어도 함께 수집하여 어떤 스레드가 비정상적으로<br>종료되었는지 분석해 볼수 있습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-14T06:35:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KxpxdIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-13T08:19:18Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-13T08:19:17Z</b><br><br>안됩니다.<br>운영계 장비이며 빠른 원인분석이 필요한 상황입니다. <br>긴급도 조정을 원할 시 하기의 고객담당자의 번호로 사전 협의 후 진행할 것을 요청드립니다. <br><br>##<br>고객사 : 삼성생명<br>고객명 : 박현우 선임<br>연락처 : 010-9104-2853<br>##<br><br>감사합니다.<br><br><publishedDate>2017-11-13T08:19:17Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KxpRGIAZ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-13T07:34:10Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-13T07:34:10Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 올려주신 코어 파일을 저희 백업 엔지니어분이 분석중에 있습니다.<br><br>앞서 kill -11 pid로 테스트 중 hang걸리는 현상이 발생할시 수집된<br>코어 파일이라고 하셨습니다. 그러면 이때 행이 걸려 있는 프로세스의<br>strace 수집은 가능하신지요?<br><br>해당 이슈는 원인 분석 이슈로 심각도 3에 해당 됩니다.<br>적합한 심각도로 조절해 드리겠으며 이의가 있으시면 알려주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-13T07:34:10Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KxntjIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-13T04:44:33Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-13T04:44:33Z</b><br><br>안녕하세요<br>강제로 kill -11 을 발생시킨 시점에는 특이한 로그는 없는 것으로 판단됩니다. <br><br>추가로 요청하신 uname -a 와 rpm -qa의 결과를 첨부드립니다. <br>epadmin@PIWBWL01SL /APP # uname -a<br>Linux PIWBWL01SL 3.10.0-327.53.1.el7.x86_64 #1 SMP Tue Mar 14 10:49:09 EDT 2017 x86_64 x86_64 x86_64 GNU/Linux<br><br><publishedDate>2017-11-13T04:44:33Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KxnJRIAZ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-13T03:05:13Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-13T03:05:12Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>감사합니다. core 파일을 잘 받아 왔습니다.<br>혹시 core가 발생전후 로그가 존재하는지요?<br>있으시다면 업로드 부탁 드립니다.<br>또한 동일한 디버깅 환경을 구축하여 core 파일을 분석하기 위하여<br>아래와 같은 명령어 출력 결과를 수집하셔서 케이스에 첨부<br>부탁 드립니다.<br><br># uname -a<br># rpm -qa <br><br>감사합니다.<br><br><publishedDate>2017-11-13T03:05:12Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KxmhiIAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-13T01:13:53Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-13T01:13:53Z</b><br><br>안녕하세요 <br>문의하신 내역에 대하여 하기와 같이 답변드립니다. <br><br>##<br>child process가 행이 걸렸다고 하셨는데 이슈 발생시 해당 프로세스의<br>strace 를 수집하실수 있으신가요? 확인 부탁 드립니다.<br># strace -Tttvf -s 8192 -o /tmp/str.out -p &lt;pid&gt;<br>--&gt; 개발,품질 시에는 발생하지 않았고 운영에서만 발생하는 경우였습니다.<br>평소에 이슈를 발생시킬 수 없는 환경이라 trace 수집은 어렵습니다.<br>##<br><br>##<br>앞서 아래의 설정이 적용되게 하기 위하여 systemctl daemon-reload 작업을<br>가이드해드렸는데 ulimit -a로 확인시 정상적으로 적용이 되었는지 확인 부탁 드립니다.<br>3) /etc/systemd/system.conf<br>DefaultLimitCORE=infinity<br>--&gt;<br><br>epadmin@PIWBWL01SL /proc # ulimit -a<br>core file size          (blocks, -c) unlimited<br>data seg size           (kbytes, -d) unlimited<br>scheduling priority             (-e) 0<br>file size               (blocks, -f) unlimited<br>pending signals                 (-i) 255569<br>max locked memory       (kbytes, -l) 64<br>max memory size         (kbytes, -m) unlimited<br>open files                      (-n) 10240<br>pipe size            (512 bytes, -p) 8<br>POSIX message queues     (bytes, -q) 819200<br>real-time priority              (-r) 0<br>stack size              (kbytes, -s) 8192<br>cpu time               (seconds, -t) unlimited<br>max user processes              (-u) 10240<br>virtual memory          (kbytes, -v) unlimited<br>file locks                      (-x) unlimited<br>##<br><br>##<br>또한 child process의 limit은 어떠 했는지 확인 부탁 드립니다.<br># cat /proc/&lt;pid&gt;/limits<br>--&gt; <br> epadmin@PIWBWL01SL /proc # cat 86429/limits<br>Limit                     Soft Limit           Hard Limit           Units<br>Max cpu time              unlimited            unlimited            seconds<br>Max file size             unlimited            unlimited            bytes<br>Max data size             unlimited            unlimited            bytes<br>Max stack size            8388608              unlimited            bytes<br>Max core file size        unlimited            unlimited            bytes<br>Max resident set          unlimited            unlimited            bytes<br>Max processes             10240                10240                processes<br>Max open files            10240                10240                files<br>Max locked memory         65536                65536                bytes<br>Max address space         unlimited            unlimited            bytes<br>Max file locks            unlimited            unlimited            locks<br>Max pending signals       255569               255569               signals<br>Max msgqueue size         819200               819200               bytes<br>Max nice priority         0                    0<br>Max realtime priority     0                    0<br>Max realtime timeout      unlimited            unlimited            us<br>##<br><br><publishedDate>2017-11-13T01:13:53Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KxDypIAF"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-09T08:19:41Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-09T08:19:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>제가 테스트를 진행해 본바에 의하면 child process가 킬이 될 경우 바로<br>새로운 child process가 생성 되었습니다.<br><br>올려주신 파일이 DRM이 걸려 오픈이 되지 않습니다.<br>혹시 생성된 coredump 파일을 직접 올려주실수 있으시다면 더 좋을꺼 같습니다.<br><br>또한 child process가 행이 걸렸다고 하셨는데 이슈 발생시 해당 프로세스의<br>strace 를 수집하실수 있으신가요? 확인 부탁 드립니다.<br><br># strace -Tttvf -s 8192 -o /tmp/str.out -p &lt;pid&gt;<br><br>앞서 아래의 설정이 적용되게 하기 위하여 systemctl daemon-reload 작업을<br>가이드해드렸는데 ulimit -a로 확인시 정상적으로 적용이 되었는지 확인 부탁 드립니다.<br><br>3) /etc/systemd/system.conf<br>DefaultLimitCORE=infinity<br><br>또한 child process의 limit은 어떠 했는지 확인 부탁 드립니다.<br><br># cat /proc/&lt;pid&gt;/limits<br><br>감사합니다.<br><br><publishedDate>2017-11-09T08:19:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KxCt6IAF"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-09T06:27:17Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-09T06:27:17Z</b><br><br>안녕하세요<br><br>kill -11 pid로 테스트 중 hang걸리는 현상이 발생하여 떨어진 coredump파일을 gdb파일로 변경하여 보내드립니다.<br>감사합니다.<br><br><publishedDate>2017-11-09T06:27:17Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KxCiXIAV"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-09T06:08:45Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-09T06:08:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>문의하신 질문에 대한 문서가 확인이 되지 않아 테스트 및 확인 중에 있습니다.<br>결과가 있는대로 업데이트 드리 겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-09T06:08:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KxBDDIA3"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-09T02:26:06Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-09T02:26:06Z</b><br><br>안녕하세요<br>RHEL7의 core파일 생성을 위해 관련 설정 적용 후 OS/ http server를 재기동하여<br>정상적으로 core파일이 생성되는지 확인하기 위하여 http server child process에 강제로 kill -11을 수행하였습니다. <br>core파일은 정상적으로 생성이 되었으나 이후 child process가 재생성되지 않고 아무런 응답이 없는 hang 현상이 발생하였는데<br>개발/검증계에서는 kill -11로 core파일이 생성된 이후 정상으로 child process가 재생성되어 테스트 하는 것에 영향이 없었습니다. <br><br>문의1. kill -11 이후 해당 child process가 자동으로 재생성되지 않는 것이 정상인지요?<br>문의2. 만약 비정상이라면 원인에 대한 분석을 요청드립니다. 분석을 위해 필요한 파일에 대하여 확인요청드립니다. <br><br>감사합니다.<br><br><publishedDate>2017-11-09T02:26:06Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KwsTmIAJ"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-08T01:24:54Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-08T01:24:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>알겠습니다. 이슈가 재현되면 core 파일을 올려주시면 저희 백업 엔지니어분이 직접 원인 분석을<br>해드릴수 있습니다. 또한 이슈 발생후 새로운 sosreport를 수집하셔서 케이스에 함께 첨부 <br>부탁 드립니다.<br><br>즐거운 하루 되세요!<br><br>감사합니다.<br><br><publishedDate>2017-11-08T01:24:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Kws85IAB"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-08T00:47:31Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-08T00:47:31Z</b><br><br>안녕하세요<br>빠른 확인 감사드립니다. <br>현재 OS 설정 적용하여 모니터링 중에 있습니다. <br>이슈 발생 시 생성된 core 파일의 gdb 결과를 첨부드리도록 하겠습니다 <br>감사합니다.<br><br><publishedDate>2017-11-08T00:47:31Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KwZwIIAV"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-07T02:55:14Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-07T02:55:14Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>리부팅 작업 대신 아래와 같은 작업을 진행하실수 있으십니다.<br><br>5.1) # systemctl daemon-reload<br>5.2) apache 재기동<br><br>감사합니다.<br><br><publishedDate>2017-11-07T02:55:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KwZljIAF"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-07T02:30:07Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-07T02:30:07Z</b><br><br>안녕하세요<br>종전 sr 시 RHEL7의 core파일 생성을 위해<br>8개의 절차를 가이드주셨습니다<br>그 중 5번째 절차의 os reboot이 반드시 필요한지 재확인요청드립니다<br>운영계 장비이다보니 os재기동 시 이슈발생할 가능성이 있을경우 장애가 커져서 가급적 재기동은 미수행하고 싶다고합니다<br>빠른확인 요청드립니다<br><br><publishedDate>2017-11-07T02:30:07Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Kvx80IAB"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-11-03T03:00:25Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-11-03T03:00:24Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>segfault 이슈는 core가 없이 원인 분석이 어렵습니다.<br>주말에 앞서 안내해 드린 설정을 적용하시고 이슈가 재현되어 core가 생성되면<br>케이스에 올려주시기 바랍니다.<br>core가 생성되면 저희 개발 엔지니어과 함께 원인 분석을 해보도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-11-03T03:00:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KvwY0IAJ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-03T01:06:11Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-03T01:06:11Z</b><br><br>참고로 SR 진행 담당자 연락처를 하기와 같이 전달드립니다. <br>##<br>회사명 : 타임게이트<br>담당자 : 안상훈 책임<br>연락처 : 010-3957-1209<br>##<br><br>감사합니다.<br><br><publishedDate>2017-11-03T01:06:11Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KvwXWIAZ"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2017-11-03T01:04:29Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2017-11-03T01:04:29Z</b><br><br>현재 core가 발생하지 않아 core파일 및 gdb 결과는 첨부하지 못하였습니다. <br><br>이번 주말을 이용하여 지난 SR시 가이드 하신 core 파일 생성절차를 적용할 예정이니 참고하시기 바랍니다. <br>##<br>1) /APP/apache/ep/conf/httpd.conf<br>CoreDumpDirectory /LOG/apache/ep/ <br><br>2) /etc/sysctl.conf<br>#kernel.core_pattern = /tmp/core_%e_%p_%h_%u_%t<br><br>3) /etc/systemd/system.conf<br>DefaultLimitCORE=infinity<br><br>4) /usr/lib/systemd/system/httpd.service<br>[Service]<br>LimitCORE = infinity <br><br>5) 위 설정 후 reboot<br><br>6) ulimit -a 확인<br><br>7) core_pattern 확인<br>$ cat /proc/sys/kernel/core_pattern<br>core<br><br>8) core_pattern 변경<br>$ echo &quot;core._%e_%p_%h_%u_%t&quot; &gt; /proc/sys/kernel/core_pattern<br><br>9) apache process kill<br>$ kill -11 $PID<br>==&gt; /LOG/apache/ep 에 core 생성됨<br>core._httpd_3004_localhost.localdomain_48_1492048027<br><br>##<br><br><publishedDate>2017-11-03T01:04:29Z</publishedDate><createdByType>Customer</createdByType><br>======================<br></comments><br>