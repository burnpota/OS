======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-06-17T02:50:15Z</b><br><b>마지막 답변자 : Workflow Integration</b><br><b>마지막 수정 일자 : 2018-06-20T01:47:04Z</b><br><b>id : 500A000000b8e8xIAA</b><br>======================<br><br><b><font size=15>
제목  : [생명]oom killer 관련
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요.<br>해당 서버에 2017년 12월 부터 현재 까지스플렁크 서비스가 KILL되는 현상이 자주 발생하고 있습니다.<br>messages와 sar05를 보면<br>[messages]<br>Jun  5 14:51:08 SLPSADEL01 kernel: Call Trace:<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff810cb641&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111ce40&gt;] ? dump_header+0x90/0x1b0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff810e930e&gt;] ? __delayacct_freepages_end+0x2e/0x30<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8121d4ec&gt;] ? security_real_capable_noaudit+0x3c/0x70<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111d2c2&gt;] ? oom_kill_process+0x82/0x2a0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111d201&gt;] ? select_bad_process+0xe1/0x120<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111d700&gt;] ? out_of_memory+0x220/0x3c0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8112c3dc&gt;] ? __alloc_pages_nodemask+0x8ac/0x8d0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81160c6a&gt;] ? alloc_pages_current+0xaa/0x110<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111a237&gt;] ? __page_cache_alloc+0x87/0x90<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81119c1e&gt;] ? find_get_page+0x1e/0xa0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111b1d7&gt;] ? filemap_fault+0x1a7/0x500<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff811432c4&gt;] ? __do_fault+0x54/0x530<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81143897&gt;] ? handle_pte_fault+0xf7/0xb50<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8105231d&gt;] ? check_preempt_curr+0x6d/0x90<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff811a2100&gt;] ? mntput_no_expire+0x30/0x110<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff811a2100&gt;] ? mntput_no_expire+0x30/0x110<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8114452a&gt;] ? handle_mm_fault+0x23a/0x310<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff810474e9&gt;] ? __do_page_fault+0x139/0x480<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81186b94&gt;] ? cp_new_stat+0xe4/0x100<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81513bfe&gt;] ? do_page_fault+0x3e/0xa0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81510fb5&gt;] ? page_fault+0x25/0x30<br><br>sar05  <br>00:00:01    kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit<br>14:45:01     23174620  42620444     64.78    346356  39616544   2435440      2.95<br>14:46:01     13254484  52540580     79.85    346500  40281324   2571304      3.11<br>14:47:01       197128  65597936     99.70    252984  33242900   2322740      2.81<br>14:48:01       188064  65607000     99.71    143552  12848284   2250528      2.73<br>14:49:09       169308  65625756     99.74      2656     36552   2215572      2.68<br>14:50:06       168012  65627052     99.74     14536     39780   2217528      2.69<br>14:51:08      3291632  62503432     95.00      1552     21108   2362248      2.86<br><br>메모리 부족으로 인해서 oom 발생하여 커널에서 메모리 확보를 위해 프로세스를 죽는것으로 보입니다.<br>그런데 해당 파라메터를 확인해보면<br>1. vm.panic_on_oom = 0 으로 설정이 되어있는데요. 이러한 상황에서도 oom이 발생하는 건가요??<br><br>2. oom이 발생당시 swap을 모두 사용하였습니다. 현재 물리메모리를 증설할수 없는 상황에서 swap 사이즈 변경, vm.swappiness = 60-&gt;10 으로 변경하는 것이 도움이 될까요? 혹시 추가 파라메터 수정으로 해당 문제를 완화할수 있는 방법이 있을까요?<br><br>3. oom이 발생하였다는것은 프로세스의 자원 점유가 높아서 발생한 것으로 판단되는데요. 시스템상의 이슈로 발생할 가능성이 있을까요?<br><br>감사합니다. <br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 김태현 (책임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  82-10-3734-0720<br>- 메일주소 : 김태현 &lt;th0720.kim@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(책임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================<br><br>어디서 문제가 발생했습니까? 어떤 환경에서 발생했습니까?<br><br>스플렁크 프로세스가 oom이 발생하여 kill됩니다.<br><br>언제 문제가 발생했습니까? 이러한 문제가 자주 발생합니까? 반복적으로 발생합니까? 특정 시간에 발생합니까?<br><br>2017년 12월 부터 14시~15시 그리고 야간시간에 자주 발생합니다.<br><br>해결 기간이나 업무에 미치는 영향에 대한 정보를 제공해 주시겠습니까?<br><br>늦어도 19일까지 답변부탁드리며,  업무영향도는 정확한 파악이 어렵습니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.4</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPSADEL01</hostname><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000MtRw7IAF"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-06-20T01:47:03Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-06-20T01:47:03Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>먼저, 본 기술 문의를 직접 종료해주셔서 감사합니다.<br><br>만약 본 기술 문의와 관련하여 추가 질문이 있으시다면 언제든지 재오픈하실 수 있습니다.<br><br>기술 문의가 처리 완료되면 *고객 설문조사* 메일이 발송됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-06-20T01:47:03Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MtRsUIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-06-20T01:38:28Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-20T01:38:28Z</b><br><br>답변감사합니다. 해당 내용을 고객에게 전달하였습니다. <br>물리메모리 확장의 조치가 취해질것으로 보입니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-20T01:38:28Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MspT9IAJ"><br>======================<br><b>생성계정 : Shin, Jay</b><br><b>생성날짜 : 2018-06-18T00:33:35Z</b><br><b>마지막 답변자 : Shin, Jay</b><br><b>마지막 수정 일자 : 2018-06-18T00:33:34Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>올려주신 sosreport 분석 결과, 해당 시점에 메모리 부족현상으로 oom 과 더불어 majflt/write/iowait/sys/pgscank/load average 수치가 급증되고 있습니다.<br><br>DMIDECODE<br>  BIOS:<br>    Vend: Dell Inc.<br>    Vers: 2.5.4<br>    Date: 01/22/2016<br>    BIOS Rev: 2.5<br>    FW Rev:<br>  System:<br>    Mfr:  Dell Inc.<br>    Prod: PowerEdge R720<br>    Vers: Not Specified<br>    Ser:  DTH0322<br>    UUID: 4C4C4544-0054-4810-8030-C4C04F333232<br>  CPU:<br>    2 of 2 CPU sockets populated, 6 cores/12 threads per CPU<br>    12 total cores, 24 total threads<br>    Mfr:  Intel<br>    Fam:  Xeon<br>    Freq: 2600 MHz<br>    Vers: Intel(R) Xeon(R) CPU E5-2630 v2 @ 2.60GHz<br>  Memory:<br>    Total: 65536 MiB (64 GiB)<br><br>OS<br>  Hostname: SLPSADEL01<br>  Distro:   [redhat-release] Red Hat Enterprise Linux Server release 6.4 (Santiago)<br>  RHN:      serverURL = https://xmlrpc.rhn.redhat.com/XMLRPC<br>            enableProxy = 0<br>  RHSM:     hostname = subscription.rhn.redhat.com<br>            proxy_hostname =<br>  YUM:      12 enabled plugins: aliases, changelog, downloadonly, kabi, presto, product-id, refresh-packagekit, security, subscription-manager, tmprepo, verify, versionlock<br>  Runlevel: N 3  (default 3)<br>  SELinux:  disabled  (default disabled)<br>  Arch:     mach=x86_64  cpu=x86_64  platform=x86_64<br>  Kernel:<br>    Booted kernel:  2.6.32-358.23.2.el6.x86_64<br>    GRUB default:   2.6.32-358.23.2.el6.x86_64<br>    Build version:<br>      Linux version 2.6.32-358.23.2.el6.x86_64<br>      (mockbuild@x86-022.build.eng.bos.redhat.com) (gcc version 4.4.7 20120313 (Red<br>      Hat 4.4.7-3) (GCC) ) #1 SMP Sat Sep 14 05:32:37 EDT 2013<br>    Booted kernel cmdline:<br>      ro root=UUID=8f6a975b-221b-4fa3-a708-3273180c2de9 rd_NO_LUKS rd_NO_LVM<br>      LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=256M<br>      KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet nmi_watchdog=0<br>      transparent_hugepage=never<br>    GRUB default kernel cmdline:<br>      ro root=UUID=8f6a975b-221b-4fa3-a708-3273180c2de9 rd_NO_LUKS rd_NO_LVM<br>      LANG=en_US.UTF-8 rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=256M<br>      KEYBOARDTYPE=pc KEYTABLE=us rd_NO_DM rhgb quiet nmi_watchdog=0<br>      transparent_hugepage=never<br>    Taint-check: 0  (kernel untainted)<br>    - - - - - - - - - - - - - - - - - - -<br>  Sys time:  Fri Jun 15 15:44:47 KST 2018<br>  Boot time: Sun May 27 10:40:38 KST 2018  (epoch: 1527385238)<br>  Uptime:    19 days,  5:04,  2 users<br>  LoadAvg:   [12 CPU] 3.90 (32%), 6.65 (55%), 12.45 (104%)<br>  /proc/stat:<br>    procs_running: 8   procs_blocked: 2    processes [Since boot]: 26997627<br>    cpu [Utilization since boot]:<br>      us 13%, ni 0%, sys 1%, idle 86%, iowait 0%, irq 0%, sftirq 0%, steal 0%<br><br>  vm.<br>    dirty_ratio =  &quot;20&quot;  (% of total system memory)<br>    dirty_background_ratio =  &quot;10&quot;  (% of total system memory)<br>    dirty_expire_centisecs =  &quot;3000&quot;<br>    dirty_writeback_centisecs =  &quot;500&quot;<br>    swappiness [0-100] =  &quot;60&quot;<br><br>$ cat proc/sys/vm/min_free_kbytes <br>32529<br><br>#define __GFP_HIGHMEM<br>(0x02)<br>#define __GFP_MOVABLE<br>(0x08)  /* Page is movable */<br>#define __GFP_WAIT<br>(0x10)<br>/* Can wait and reschedule? */<br>#define __GFP_IO<br>(0x40)<br>/* Can start physical IO? */<br>#define __GFP_FS<br>(0x80)<br>/* Can call down to low-level FS? */<br>#define __GFP_COLD<br>(0x100)<br>/* Cache-cold page required */<br>#define __GFP_HARDWALL   (0x20000) /* Enforce hardwall cpuset memory allocs */<br><br>Jun  8 16:36:36 SLPSADEL01 kernel: splunkd invoked oom-killer: gfp_mask=0x201da, order=0, oom_adj=0, oom_score_adj=0<br><br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 0 DMA32 free:117692kB min:1616kB low:2020kB high:2424kB active_anon:1919932kB inactive_anon:480060kB active_file:0kB inactive_file:236kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:3288224kB mlocked:0kB dirty:8kB writeback:0kB mapped:24kB shmem:8kB slab_reclaimable:6544kB slab_unreclaimable:2704kB kernel_stack:592kB pagetables:9192kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:1536 all_unreclaimable? no<br><br>메모리 부족시에 커널 메모리 상태가 free &lt; min 가 되어 out of memory 가 발생되고 있습니다.<br><br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 0 Normal free:14552kB min:14624kB low:18280kB high:21936kB active_anon:28000704kB inactive_anon:1749436kB active_file:0kB inactive_file:340kB unevictable:0kB isolated(anon):256kB isolated(file):0kB present:29734400kB mlocked:0kB dirty:28kB writeback:244kB mapped:588kB shmem:8kB slab_reclaimable:16684kB slab_unreclaimable:38548kB kernel_stack:3904kB pagetables:108580kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:3840 all_unreclaimable? no<br><br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 1 Normal free:16280kB min:16276kB low:20344kB high:24412kB active_anon:30892288kB inactive_anon:1816276kB active_file:1072kB inactive_file:1132kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:33095680kB mlocked:0kB dirty:64kB writeback:0kB mapped:1016kB shmem:4kB slab_reclaimable:22980kB slab_unreclaimable:24400kB kernel_stack:2008kB pagetables:107436kB unstable:0kB bounce:0kB writeback_tmp:0kB pages_scanned:5024 all_unreclaimable? no<br><br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 0 DMA: 1*4kB 0*8kB 1*16kB 1*32kB 1*64kB 0*128kB 1*256kB 0*512kB 1*1024kB 1*2048kB 3*4096kB = 15732kB<br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 0 DMA32: 1458*4kB 1206*8kB 589*16kB 242*32kB 84*64kB 55*128kB 16*256kB 6*512kB 24*1024kB 16*2048kB 2*4096kB = 117768kB<br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 0 Normal: 2593*4kB 51*8kB 0*16kB 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 1*4096kB = 14876kB<br>Jun 15 15:30:59 SLPSADEL01 kernel: Node 1 Normal: 3105*4kB 52*8kB 14*16kB 3*32kB 0*64kB 0*128kB 0*256kB 0*512kB 0*1024kB 0*2048kB 1*4096kB = 17252kB<br>Jun 15 15:30:59 SLPSADEL01 kernel: 214759 total pagecache pages<br>Jun 15 15:30:59 SLPSADEL01 kernel: 213514 pages in swap cache<br>Jun 15 15:30:59 SLPSADEL01 kernel: Swap cache stats: add 178527851, delete 178314337, find 180529062/189487551<br>Jun 15 15:30:59 SLPSADEL01 kernel: Free swap  = 0kB<br>Jun 15 15:30:59 SLPSADEL01 kernel: Total swap = 16777208kB<br><br>Jun 15 15:30:59 SLPSADEL01 kernel: [ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name<br>Jun 15 15:30:59 SLPSADEL01 kernel: [11353]  1184 11353  2962377  1739672   5       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [30259]  1184 30259  4126378  1683275   0       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [45028]  1184 45028  2286025  1531935   5       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [45406]  1184 45406  2176969  1435926   9       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [45954]  1184 45954  2013641  1258218  10       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [46401]  1184 46401  2178505  1410155   2       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [ 5117]  1184  5117  3370953  3279641   7       0             0 splunkd<br>Jun 15 15:30:59 SLPSADEL01 kernel: [ 5476]  1184  5476  3800714  3381913   3       0             0 splunkd<br><br>Linux 2.6.32-358.23.2.el6.x86_64 (SLPSADEL01)   06/15/18        _x86_64_        (12 CPU)<br><br>oom 이 발생된 시점에 sys 와 iowait 수치가 급증되었습니다.<br><br>00:00:01        CPU      %usr     %nice      %sys   %iowait    %steal      %irq     %soft    %guest     %idle<br>15:21:01        all     81.89      0.00     17.38      0.02      0.00      0.00      0.11      0.00      0.59<br>15:21:01          0     80.90      0.00     18.70      0.00      0.00      0.00      0.23      0.00      0.17<br>15:21:01          1     80.86      0.00     17.75      0.08      0.00      0.00      0.08      0.00      1.22<br>15:21:01          2     79.93      0.00     19.70      0.00      0.00      0.00      0.20      0.00      0.17<br>15:21:01          3     80.71      0.00     17.99      0.03      0.00      0.00      0.02      0.00      1.25<br>15:21:01          4     79.97      0.00     19.84      0.00      0.00      0.00      0.03      0.00      0.15<br>15:21:01          5     98.42      0.00      1.58      0.00      0.00      0.00      0.00      0.00      0.00<br>15:21:01          6     79.70      0.00     19.91      0.02      0.00      0.00      0.23      0.00      0.13<br>15:21:01          7     80.75      0.00     17.97      0.07      0.00      0.00      0.00      0.00      1.22<br>15:21:01          8     78.90      0.00     20.75      0.00      0.00      0.00      0.18      0.00      0.17<br>15:21:01          9     81.37      0.00     17.37      0.03      0.00      0.00      0.00      0.00      1.23<br>15:21:01         10     79.82      0.00     19.71      0.00      0.00      0.00      0.32      0.00      0.15<br>15:21:01         11     81.36      0.00     17.33      0.02      0.00      0.00      0.02      0.00      1.28<br>15:22:06        all     21.78      0.00      5.79     67.26      0.00      0.00      0.47      0.00      4.70<br>15:22:06          0     15.78      0.00      6.47     75.81      0.00      0.00      0.20      0.00      1.74<br>15:22:06          1     15.60      0.00      6.94     74.94      0.00      0.00      2.45      0.00      0.06<br>15:22:06          2     15.11      0.00      6.57     75.79      0.00      0.00      0.45      0.00      2.07<br>15:22:06          3     40.96      0.00      4.69     51.66      0.00      0.00      0.00      0.00      2.69<br>15:22:06          4     14.39      0.00      6.97     75.11      0.00      0.00      0.86      0.00      2.66<br>15:22:06          5     73.33      0.00      1.54     23.27      0.00      0.00      0.00      0.00      1.86<br>15:22:06          6     15.32      0.00      6.58     73.15      0.00      0.00      0.34      0.00      4.60<br>15:22:06          7     14.65      0.00      5.86     70.99      0.00      0.00      0.00      0.00      8.49<br>15:22:06          8     14.27      0.00      6.75     72.76      0.00      0.00      0.80      0.00      5.42<br>15:22:06          9     14.12      0.00      5.40     72.22      0.00      0.00      0.00      0.00      8.26<br>15:22:06         10     14.08      0.00      6.15     72.94      0.00      0.00      0.53      0.00      6.30<br>15:22:06         11     13.58      0.00      5.52     68.67      0.00      0.00      0.00      0.00     12.22<br><br>15:29:02        all     61.47      0.00     10.40     15.86      0.00      0.00      0.21      0.00     12.06<br>15:29:02          0     63.01      0.00      9.93     15.94      0.00      0.00      0.37      0.00     10.74<br>15:29:02          1     57.58      0.00     11.43     28.11      0.00      0.00      1.01      0.00      1.87<br>15:29:02          2     61.48      0.00     10.84     15.99      0.00      0.00      0.12      0.00     11.58<br>15:29:02          3     56.76      0.00     10.99     21.73      0.00      0.00      0.02      0.00     10.50<br>15:29:02          4     55.46      0.00     11.25     21.35      0.00      0.00      0.27      0.00     11.67<br>15:29:02          5     61.28      0.00     12.09     15.07      0.00      0.00      0.02      0.00     11.54<br>15:29:02          6     77.88      0.00      7.42      8.61      0.00      0.00      0.34      0.00      5.74<br>15:29:02          7     62.14      0.00     11.53     13.85      0.00      0.00      0.00      0.00     12.47<br>15:29:02          8     55.92      0.00     11.40     17.31      0.00      0.00      0.29      0.00     15.08<br>15:29:02          9     58.99      0.00     11.80     13.17      0.00      0.00      0.00      0.00     16.03<br>15:29:02         10     70.44      0.00      5.56      5.88      0.00      0.00      0.10      0.00     18.01<br>15:29:02         11     56.51      0.00     10.53     13.35      0.00      0.00      0.00      0.00     19.61<br>15:30:05        all     23.20      0.00      4.51     53.45      0.00      0.00      0.19      0.00     18.65<br>15:30:05          0     22.99      0.00      5.94     62.50      0.00      0.00      0.25      0.00      8.32<br>15:30:05          1     18.05      0.00      6.10     74.36      0.00      0.00      1.02      0.00      0.48<br>15:30:05          2     16.34      0.00      5.01     64.15      0.00      0.00      0.17      0.00     14.32<br>15:30:05          3     55.30      0.00      3.30     31.85      0.00      0.00      0.00      0.00      9.55<br>15:30:05          4     18.40      0.00      5.38     60.72      0.00      0.00      0.21      0.00     15.29<br>15:30:05          5     14.34      0.00      5.20     60.85      0.00      0.00      0.00      0.00     19.62<br>15:30:05          6     37.54      0.00      2.92     47.41      0.00      0.00      0.19      0.00     11.95<br>15:30:05          7     14.76      0.00      4.48     50.17      0.00      0.00      0.02      0.00     30.57<br>15:30:05          8     19.06      0.00      5.36     66.11      0.00      0.00      0.35      0.00      9.12<br>15:30:05          9     15.39      0.00      3.77     43.98      0.00      0.00      0.00      0.00     36.86<br>15:30:05         10     15.39      0.00      3.98     48.85      0.00      0.00      0.13      0.00     31.66<br>15:30:05         11     30.61      0.00      2.73     30.53      0.00      0.00      0.00      0.00     36.12<br><br>00:00:01     pswpin/s pswpout/s<br>15:21:01         2.34      0.03<br>15:22:06       982.03  26118.98<br>15:23:05      1106.31  28230.56<br>15:24:02      1386.15   9630.45<br>15:25:01      6073.68      0.00<br>15:26:05      1271.71   5433.35<br>15:27:12      2312.58   3382.47<br>15:28:01      2570.95   2700.41<br>15:29:02      4807.89    217.03<br>15:30:05       940.76   4405.29<br>15:31:01       881.23   3731.17<br>15:32:01      5291.26      0.00<br>15:33:01      5885.28      0.00<br>15:34:09      1691.35   1562.03<br>15:35:02      3253.78    611.66<br>15:36:01      4695.31      0.00<br><br>메모리 부족 현상으로 pgscank/s pgscand/s 수치가 상당히 높게 나타나고 있습니다.<br>majflt/s 수치도 높게 나타나고 있습니다.<br><br>00:00:01     pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff<br>15:19:01        14.15  11891.69  47232.32      0.13  32460.14      0.00      0.00      0.00      0.00<br>15:20:01      3966.09   6458.11 134886.82      5.12 104348.45  73613.83    152.66  73238.13     99.28<br>15:21:01      4566.45   9591.89 139806.03      9.96 142964.69  45521.40     60.12  41932.29     91.99<br>15:22:06      8823.49 107931.17  42229.12    174.06  43117.13  34170.91  35007.11  32728.95     47.31<br>15:23:05     11901.20 115884.59  39042.24    219.55  39733.57  23980.74  37564.06  31078.76     50.50<br>15:24:02     21495.88  40059.42  51814.89    393.44  87470.17  14220.54  35930.57  14044.54     28.00<br>15:25:01     36312.17  11716.06 140918.94    952.59 106704.14      0.00      0.00      0.00      0.00<br>15:26:05      7950.74  30522.31 136122.92    208.69 128354.11   2782.30  13578.66   9673.93     59.13<br>15:27:12     22235.28  20024.20 141086.91    328.15 148782.59   5497.79   8027.62   9050.47     66.91<br>15:28:01     23701.18  12856.99 176568.18    400.49 207536.02   6147.57   9356.99   7586.67     48.93<br>15:29:02     28998.68  25665.71 142166.45    698.23 131050.87  13585.29   2605.77   5050.89     31.20<br>15:30:05      8044.20  22442.05  18527.20    143.33  17820.20   8256.08   7310.00  10425.37     66.97<br>15:31:01     19681.71  23228.24  32771.61    191.34  94395.69  18666.87  13721.90  14087.71     43.50<br>15:32:01     56346.19   3370.71  39480.19    758.60  21389.12      0.00      0.00      0.00      0.00<br>15:33:01     31471.73  10111.26  30767.04    745.38  15383.08      0.00      0.00      0.00      0.00<br>15:34:09     18732.05  17113.39  33077.87    230.85  36572.14  21550.24   2863.03  21472.60     87.95<br><br>평소에는 bwrtn 수치가 사용되고 있습니다만,<br>문제 발생 시점에는 bread 수치도 동시에 나타나고, bwrtn 수치가 급증되었습니다.<br><br>00:00:01          tps      rtps      wtps   bread/s   bwrtn/s<br><br>15:16:01      3592.63      0.02   3592.62      0.14  55115.85<br>15:17:01      3668.59     17.48   3651.12    220.74  55590.39<br>15:18:01      2428.98     25.83   2403.15    304.06  32804.16<br>15:19:01      3108.66      1.63   3107.02     53.12  47547.81<br>15:20:01      1934.96    234.28   1700.68  15464.36  25755.72<br>15:21:01      2717.21    199.57   2517.64  17517.14  38041.56<br>15:22:06      4723.42    667.48   4055.94  24865.51 222783.03<br>15:23:05      5438.48   1071.64   4366.84  36080.96 237378.40<br>15:24:02      4090.18   1777.24   2312.94  67065.54  83346.15<br>15:25:01      5951.48   2862.43   3089.06  96509.92  46842.96<br>15:26:05      6007.34    766.16   5241.18  20510.07  78512.58<br>15:27:12      5424.04   1795.08   3628.96  70008.95  52993.48<br>15:28:01      4334.12   2269.30   2064.82  72308.36  29833.84<br>15:29:02      8674.43   2056.40   6618.03  76878.12 100897.82<br>15:30:05      4557.80    777.01   3780.79  23087.20  54434.68<br><br>애플리케이션의 요청에 캐시 반환을 통해 메모리 할당을 하고 있는 것으로 보입니다.<br><br>00:00:01    kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit<br>15:19:01      8734636  57060428     86.72    936016  49616192   2700188      3.27<br>15:20:01       177548  65617516     99.73    193784  30324632   2426484      2.94<br>15:21:01       178268  65616796     99.73    135860   1328764   2559140      3.10<br>15:22:06       167852  65627212     99.74      8288     49484   2857364      3.46<br>15:23:05       166652  65628412     99.75     15220     53968   2688728      3.26<br>15:24:02      8369200  57425864     87.28     50596    131584   3550428      4.30<br>15:25:01      2372384  63422680     96.39    146060    795604   7549996      9.14<br>15:26:05       207056  65588008     99.69     14688     86784   6882192      8.33<br>15:27:12       172664  65622400     99.74      6500     57200   3679856      4.46<br>15:28:01      5009884  60785180     92.39    127132   1011936   3505264      4.25<br>15:29:02       744024  65051040     98.87    104388    621848   2377672      2.88<br>15:30:05       169572  65625492     99.74     10488     60664   2169436      2.63<br><br>00:00:01      runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15<br>15:20:01           24       873     11.33      4.86      3.23<br>15:21:01           24       882     13.02      6.54      3.91<br>15:22:06            6       910     27.96     12.06      5.98<br>15:23:05            1       924     36.97     17.32      8.16<br>15:24:02            3      1147     46.31     23.16     10.68<br>15:25:01           81      2114     47.42     27.27     12.85<br>15:26:05           10      1388     79.35     40.19     18.26<br>15:27:12            1      1045     55.29     40.04     19.65<br>15:28:01            9      1156     42.02     39.04     20.39<br>15:29:02            5       783     23.71     34.57     20.03<br>15:30:05           10       776     21.06     31.58     19.97<br>15:31:01            5       776     26.00     31.31     20.55<br>15:32:01            3       792     16.01     27.49     19.91<br>15:33:01            6       775     10.95     23.95     19.17<br>15:34:09            2       769     15.33     22.34     18.91<br><br>00:00:01          DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util<br>15:29:02       dev8-0   1413.81  39117.56   1768.53     28.92     17.78     12.58      0.72    101.48<br>15:29:02      dev8-16    639.13  11021.62  49523.90     94.73     20.08     31.40      0.99     63.34<br>15:29:02     dev253-2   6575.44  18875.76  49562.89     10.41    939.49    142.77      0.10     63.65<br>15:30:05       dev8-0   2677.01   9093.68  35294.38     16.58    151.87     56.73      0.38    100.88<br>15:30:05      dev8-16    322.50   6633.85   4325.56     33.98      0.67      2.08      0.65     21.05<br>15:30:05     dev253-2   1505.53   6997.01   9573.32     11.01      3.87      2.56      0.16     23.98<br><br>sda                       8:0    0 278.9G  0 disk<br>sdb                       8:16   0 278.9G  0 disk<br>  └─vg1-APP (dm-2)      253:2    0   418G  0 lvm  /APP<br><br>분석 결과 해당 시점에 splunkd 애플리케이션의 메모리 사용량이 많으며,<br>메모리 사용량 증가 및 블럭 write 사용량이 급증되어 스토리지 사용량도 늘어났으며<br>캐시 메모리를 모두 반환하였음에도 메모리가 부족하여 oom 이 발생되었습니다.  <br><br>아래 파라메터가 도움이 될 수 있습니다만, 메모리 부족현상은 물리 메모리 증설이 근본적인 해결책인 것으로 보입니다.<br>애플리케이션의 메모리 요청이 적절한지(애플리케이션 메모리 릭등) 애플리케이션 업체에 추가 분석을 의뢰해보시기 바랍니다.<br><br>[sysctl]<br>vm.min_free_kbytes = 325290<br>vm.swappiness = 10<br><br>만약 본 이슈와 관련하여 추가적인 문의 사항이 있으실 경우 연락 주시기 바랍니다.<br><br>감사합니다.<br><br>Jay Shin,<br>Senior TSE, Brisbane, APAC<br>Red Hat Customer Experience and Engagement<br><br><publishedDate>2018-06-18T00:33:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>해당 서버에 2017년 12월 부터 현재 까지스플렁크 서비스가 KILL되는 현상이 자주 발생하고 있습니다.<br>messages와 sar05를 보면<br>[messages]<br>Jun  5 14:51:08 SLPSADEL01 kernel: Call Trace:<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff810cb641&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111ce40&gt;] ? dump_header+0x90/0x1b0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff810e930e&gt;] ? __delayacct_freepages_end+0x2e/0x30<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8121d4ec&gt;] ? security_real_capable_noaudit+0x3c/0x70<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111d2c2&gt;] ? oom_kill_process+0x82/0x2a0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111d201&gt;] ? select_bad_process+0xe1/0x120<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111d700&gt;] ? out_of_memory+0x220/0x3c0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8112c3dc&gt;] ? __alloc_pages_nodemask+0x8ac/0x8d0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81160c6a&gt;] ? alloc_pages_current+0xaa/0x110<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111a237&gt;] ? __page_cache_alloc+0x87/0x90<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81119c1e&gt;] ? find_get_page+0x1e/0xa0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8111b1d7&gt;] ? filemap_fault+0x1a7/0x500<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff811432c4&gt;] ? __do_fault+0x54/0x530<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81143897&gt;] ? handle_pte_fault+0xf7/0xb50<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8105231d&gt;] ? check_preempt_curr+0x6d/0x90<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff811a2100&gt;] ? mntput_no_expire+0x30/0x110<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff811a2100&gt;] ? mntput_no_expire+0x30/0x110<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff8114452a&gt;] ? handle_mm_fault+0x23a/0x310<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff810474e9&gt;] ? __do_page_fault+0x139/0x480<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81186b94&gt;] ? cp_new_stat+0xe4/0x100<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81513bfe&gt;] ? do_page_fault+0x3e/0xa0<br>Jun  5 14:51:08 SLPSADEL01 kernel: [&lt;ffffffff81510fb5&gt;] ? page_fault+0x25/0x30<br><br>sar05  <br>00:00:01    kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit<br>14:45:01     23174620  42620444     64.78    346356  39616544   2435440      2.95<br>14:46:01     13254484  52540580     79.85    346500  40281324   2571304      3.11<br>14:47:01       197128  65597936     99.70    252984  33242900   2322740      2.81<br>14:48:01       188064  65607000     99.71    143552  12848284   2250528      2.73<br>14:49:09       169308  65625756     99.74      2656     36552   2215572      2.68<br>14:50:06       168012  65627052     99.74     14536     39780   2217528      2.69<br>14:51:08      3291632  62503432     95.00      1552     21108   2362248      2.86<br><br>메모리 부족으로 인해서 oom 발생하여 커널에서 메모리 확보를 위해 프로세스를 죽는것으로 보입니다.<br>그런데 해당 파라메터를 확인해보면<br>1. vm.panic_on_oom = 0 으로 설정이 되어있는데요. 이러한 상황에서도 oom이 발생하는 건가요??<br><br>2. oom이 발생당시 swap을 모두 사용하였습니다. 현재 물리메모리를 증설할수 없는 상황에서 swap 사이즈 변경, vm.swappiness = 60-&gt;10 으로 변경하는 것이 도움이 될까요? 혹시 추가 파라메터 수정으로 해당 문제를 완화할수 있는 방법이 있을까요?<br><br>3. oom이 발생하였다는것은 프로세스의 자원 점유가 높아서 발생한 것으로 판단되는데요. 시스템상의 이슈로 발생할 가능성이 있을까요?<br><br>감사합니다. <br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 김태현 (책임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  82-10-3734-0720<br>- 메일주소 : 김태현 &lt;th0720.kim@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(책임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================</issue><environment>스플렁크 프로세스가 oom이 발생하여 kill됩니다.</environment><periodicityOfIssue>2017년 12월 부터 14시~15시 그리고 야간시간에 자주 발생합니다.</periodicityOfIssue><timeFramesAndUrgency>늦어도 19일까지 답변부탁드리며,  업무영향도는 정확한 파악이 어렵습니다.</timeFramesAndUrgency><cep>false</cep></case>