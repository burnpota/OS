======================<br><b>생성계정 : JIMIN KIM</b><br><b>생성날짜 : 2019-03-05T10:43:35Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2019-04-02T04:35:19Z</b><br><b>id : 5002K00000dNBK7QAO</b><br>======================<br><br><b><font size=15>
제목  : 물리서버 신규 disk 추가 후 scsi-rescan -i 결과에 대한 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>물리 서버에 신규 disk 추가 후 아래와 같이 disk 인식을 위하여<br>scsi-rescan -i를 수행하였는데요.<br><br>lun 3개를 추가하였는데 scsi-rescan -i 결과에서<br>0 new or changed device(s) found.<br>0 remapped or resized device(s) found.<br>0 device(s) removed.<br>신규 disk가 인식되기는 하였는데<br>위와 같이 결과 내용에는 신규 device가 잡히지 않은 것 처럼보여서 문의드립니다.<br><br>root@SLPAFIDL01 /root # scsi-rescan -i<br>Scanning SCSI subsystem for new devices<br>Scanning host 0 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br> Scanning for device 0 2 0 0 ...<br>OLD: Host: scsi0 Channel: 02 Id: 00 Lun: 00<br>      Vendor: DELL     Model: PERC H730 Mini   Rev: 4.28<br>      Type:   Direct-Access                    ANSI SCSI revision: 05<br> Scanning for device 0 2 1 0 ...<br>OLD: Host: scsi0 Channel: 02 Id: 01 Lun: 00<br>      Vendor: DELL     Model: PERC H730 Mini   Rev: 4.28<br>      Type:   Direct-Access                    ANSI SCSI revision: 05<br>Scanning host 1 for  all SCSI target IDs, all LUNs<br>Scanning host 2 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 3 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 4 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 5 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 6 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 7 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 8 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 9 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 10 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 11 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br> Scanning for device 11 0 0 0 ...<br>OLD: Host: scsi11 Channel: 00 Id: 00 Lun: 00<br>      Vendor: PLDS     Model: DVD-ROM DS-8DBSH Rev: MD51<br>      Type:   CD-ROM                           ANSI SCSI revision: 05<br>Scanning host 12 for  all SCSI target IDs, all LUNs<br> Scanning for device 12 0 0 10 ...<br>OLD: Host: scsi12 Channel: 00 Id: 00 Lun: 10<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 12 0 0 11 ...<br>OLD: Host: scsi12 Channel: 00 Id: 00 Lun: 11<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 12 0 0 12 ...<br>=== 생략 ===<br>OLD: Host: scsi13 Channel: 00 Id: 00 Lun: 07<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 13 0 0 8 ...<br>OLD: Host: scsi13 Channel: 00 Id: 00 Lun: 08<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 13 0 0 9 ...<br>OLD: Host: scsi13 Channel: 00 Id: 00 Lun: 09<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br>Scanning host 14 for  all SCSI target IDs, all LUNs<br>0 new or changed device(s) found.<br>0 remapped or resized device(s) found.<br>0 device(s) removed.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPAFIDL01</hostname><br><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-03-18T00:40:02Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-03-18T00:40:02Z</b><br><br>안녕하세요. Red Hat 김마현입니다.<br><br>확인된 내용 업데이트 해 드립니다.<br><br>Q2) scsi-rescan -r 같은 경우에는 LUN을 스토리지에서 먼저 회수 후 OS에서 보이게 되지 않는 상태에서 -r을 수행하면 되는 것인지 문의드리려고 합니다.<br><br><br>A2)<br>기존에 답변 드렸다시피 scsi-rescan 파일은 rescan-scsi-bus.sh 파일을 alias 한 것입니다.<br>&quot;rescan-scsi-bus.sh&quot;스크립트의 코드를 확인해 보면 &quot;-r&quot;옵션을 사용하여 실행 시 매핑되지 않은 LUN을 제거한 다음 HBA를 다시 스캔합니다.<br>아래는 이 스크립트에서 삭제 및 다시 스캔 작업에 사용되는 echo 명령의 순서입니다.<br><br><br>$ less /usr/bin/rescan-scsi-bus.sh<br><br>[...]<br><br><br>  : f $remove s $SCSISTR<br><br>  if test &quot;$remove&quot; -a &quot;$SCSISTR&quot; -o &quot;$remappedlun0&quot; = &quot;1&quot;; then<br><br>    if test $RC != 0 -o ! -z &quot;$forceremove&quot; -o -n &quot;$remappedlun0&quot;; then<br><br>      if test &quot;$remappedlun0&quot; != &quot;1&quot; ; then<br><br><br>echo -en &quot;\r\e[A\e[A\e[A${red}REM: &quot;<br><br><br>echo &quot;$SCSISTR&quot; | head -n1<br><br><br>echo -e &quot;${norm}\e[B\e[B&quot;<br><br>      fi<br><br>      if test -e /sys/class/scsi_device/${host}:${channel}:${id}:${lun}/device; then<br><br>&lt;&lt;----------<br><br><br># have to preemptively do this so we can figure out the mpath device<br>======================<br># Don't do this if we're deleting a well known lun to replace it<br><br><br>if test &quot;$remappedlun0&quot; != &quot;1&quot; ; then<br><br><br>  incrrmvd &quot;$host:$channel:$id:$lun&quot;<br><br><br>fi<br><br><br>echo 1 &gt; /sys/class/scsi_device/${host}:${channel}:${id}:${lun}/device/delete<br><br>&lt;&lt;----------<br><br><br>usleep 20000<br><br>      else<br><br><br>echo &quot;scsi remove-single-device $devnr&quot; &gt; /proc/scsi/scsi<br><br><br>if test $RC -eq 1 -o $lun -eq 0 ; then<br><br><br>  # Try readding, should fail if device is gone<br><br><br>  echo &quot;scsi add-single-device $devnr&quot; &gt; /proc/scsi/scsi<br><br><br>&lt;&lt;----------<br><br><br>fi<br><br>      fi<br><br>    fi<br><br>    if test $RC = 0 -o &quot;$forcerescan&quot; ; then<br><br>      if test -e /sys/class/scsi_device/${host}:${channel}:${id}:${lun}/device; then<br><br><br>echo 1 &gt; /sys/class/scsi_device/${host}:${channel}:${id}:${lun}/device/rescan<br>&lt;&lt;----------<br><br>      fi<br><br>    fi<br><br>    printf &quot;\r\e[A\e[A\e[A${yellow}OLD: $norm&quot;<br><br>[...]<br><br><br>따라서 질문에서 김지민 선임님께서 말씀해 주신것처럼 LUN을 스토리지에서 먼저 회수 후 scsi-rescan -r을 수행하는 것이 절차상 맞습니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-03-18T00:40:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PWZxZQAX"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-03-08T02:30:24Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-03-08T02:30:24Z</b><br><br>안녕하세요. Red Hat 김마현입니다.<br><br>문의주신 내용에 대해 답변 드리겠습니다.<br><br>A1)<br>/usr/bin/scsi-rescan 는 alias file로 rescan-scsi-bus.sh와 동일합니다.<br><br># ls -la /usr/bin/scsi-rescan<br>lrwxrwxrwx 1 root root 18 Dec 19 17:25 /usr/bin/scsi-rescan -&gt; rescan-scsi-bus.sh<br><br><br>A2)<br>해당 내용은 확인 후 업데이트 해 드리겠습니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-03-08T02:30:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PWZU5QAP"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2019-03-08T01:26:53Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2019-03-08T01:26:52Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>답변 감사드립니다.<br><br>확인 후 추가 문의 사항 드립니다.<br><br>1. rescan-scsi-bus.sh 과 scsi-rescan 명령이 동일한 명령인지 문의드리려고 합니다.<br>   diff로 /usr/bin/rescan-scsi-bus.sh과 /usr/bin/scsi-rescan을 비교하였을 때 동일하기는 해서 같은 기능을 하는 명령이 2가지 방식으로 표현이된 것인지 문의드립니다.<br><br>2. solution에서 보면 •Try using the -a option to add devices and the -r to remove ones. 부분이 있습니다.<br>    LUN 추가 시에는 scsi-rescan -a를 하여 인식하고<br>    LUN 제거 시에는 scsi-rescan -r을 하여 제거하는 것 같은데요.<br>    scsi-rescan -r 같은 경우에는 LUN을 스토리지에서 먼저 회수 후 OS에서 보이게 되지 않는 상태에서 -r을 수행하면 되는 것인지 문의드리려고 합니다.<br><br>감사합니다.<br><br><publishedDate>2019-03-08T01:26:52Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PWHsLQAX"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-03-07T03:50:17Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-03-07T03:50:34Z</b><br><br>안녕하세요. Red Hat 김마현입니다.<br><br>문의주신 내용 확인하여 업데이트 드립니다.<br><br>참고문서 :<br>https://access.redhat.com/solutions/1314183<br><br>문서에 의하면 sg3_utils package version 1.28-6 이후부터 장치 추가 시 scsi-rescan -a 옵션을 사용하라는 내용이 확인됩니다.<br>해당 서버는 sg3_utils-1.37-5.el7.x86_64 버전이 설치되어 있습니다.<br>추 후에 LUN 추가 작업 시 -a 옵션을 적용하고 'changed device(s) found' 출력을 확인 부탁드리겠습니다.<br>-a 옵셔을 적용해도 0 으로 디스플레이 된다면 추가 코멘트 부탁드립니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-03-07T03:50:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PVxrkQAD"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2019-03-06T01:56:56Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2019-03-06T01:56:56Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>답변 드립니다.<br><br>- 재부팅 후에도 인식이 안되는지요?<br>  ▶ 재부팅 없이도 scsi-rescan -i 후 정상적으로 인식은 되었습니다.<br>- 스토리지 모델이 무엇인가요?<br>  ▶ Hitachi VSP 입니다.<br>- 서버 모델이 무엇인가요?<br>  ▶ DELL PE R730 입니다.<br>- 해당 서버의 sosreport 업로드 부탁드립니다.<br>  ▶ dropbox 통해서 02330366-sosrepot-호스트네임으로 업로드 하겠습니다.<br><br>정상적으로 disk가 인식은 되었는데요.<br>문의드릴 점은 scsi-rescan -i의 결과에서 아래와 같이 표현이 되어서 문의드렸습니다.<br><br>신규 disk를 인식시켰으면 0이아니라 인식된 개수만큼 표현이 필요할 것 같은데<br>0으로 표현이 되어서 문의드렸습니다.<br><br>0 new or changed device(s) found.<br>0 remapped or resized device(s) found.<br>0 device(s) removed.<br><br>감사합니다.<br><br><publishedDate>2019-03-06T01:56:56Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000PVx1ZQAT"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2019-03-06T00:11:16Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2019-03-06T00:11:16Z</b><br><br>안녕하세요. Red Hat 김마현입니다.<br><br>관련하여 아래 사항들에 대해 확인 요청드립니다.<br><br>- 재부팅 후에도 인식이 안되는지요?<br>- 스토리지 모델이 무엇인가요?<br>- 서버 모델이 무엇인가요?<br>- 해당 서버의 sosreport 업로드 부탁드립니다.<br><br>답변 및 업로드 부탁드립니다.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2019-03-06T00:11:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000PRZAmQAP"><br>======================<br><b>생성계정 : Abbott, Edmund</b><br><b>생성날짜 : 2019-03-05T10:43:59Z</b><br><b>마지막 답변자 : Abbott, Edmund</b><br><b>마지막 수정 일자 : 2019-03-05T10:43:59Z</b><br><br>This comment has been generated via an automated case assistant and is based upon the information provided at case create time.<br>If you have already uploaded or are in the process of creating and uploading a sosreport to this case, please ignore this request.<br><br>Please provide a sosreport.  The lack of a sosreport often impedes our ability to make progress in fully understanding and <br>resolving the reported issue(s) in these types of cases.  If you cannot provide a sosreport for reasons such as its a secure <br>site or other such restrictions, please let us know if not already noted within the case. If this request is not applicable, <br>we do apologize and welcome any feedback or clarifying information you could provide to help us understand the problem. <br><br><br>If the system is or can be booted: <br>======================================================================================  <br><br>  * Create sosreport: ~]# sosreport <br>    Please see the following documentation for more information on the sosreport and how to gather one from the system.<br><br>        What is sosreport and how do I create one in Red Hat Enterprise Linux 4.6 and later?<br>        https://access.redhat.com/knowledge/solutions/3592<br><br>  * Attach to case  : ~]# redhat-support-tool addattachment -c CASE_NUMBER /path/to/sosreport<br>    If needed, an example on attaching a file to a case via the portal UI is available within the following document in <br>    the section entitled &quot;Attaching the file(s) to the ticket and case management through the Customer Portal&quot;.<br><br>        How do I open and manage a support case on the Customer Portal?<br>        https://access.redhat.com/articles/38363#attach<br><br>  * If the sosreport is large in size such that you are not able to upload it into the case, then you can upload it<br>    into the dropbox. For more information on dropbox, please refer the following document.<br><br>        How can I provide large files (such as a vmcore, big log files, or a large sosreport) to Red Hat Support?<br>        https://access.redhat.com/knowledge/solutions/2112<br><br>Please see the following documentation on how to proceed if the system cannot be booted, fails to boot, hangs on boot,<br>crashed during boot, sosreport hangs or otherwise does not complete:<br>====================================================================================== <br><br>  * Additional and alternative steps for gathering a sosreport for Red Hat Enterprise Linux<br>    https://access.redhat.com/articles/2760521<br><br><br>auto-assistant rule reference #:KSOS0150 https://access.redhat.com/articles/2908901<br><br><publishedDate>2019-03-05T10:43:59Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>SDS 김지민 선임입니다.<br><br>물리 서버에 신규 disk 추가 후 아래와 같이 disk 인식을 위하여<br>scsi-rescan -i를 수행하였는데요.<br><br>lun 3개를 추가하였는데 scsi-rescan -i 결과에서<br>0 new or changed device(s) found.<br>0 remapped or resized device(s) found.<br>0 device(s) removed.<br>신규 disk가 인식되기는 하였는데<br>위와 같이 결과 내용에는 신규 device가 잡히지 않은 것 처럼보여서 문의드립니다.<br><br>root@SLPAFIDL01 /root # scsi-rescan -i<br>Scanning SCSI subsystem for new devices<br>Scanning host 0 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br> Scanning for device 0 2 0 0 ...<br>OLD: Host: scsi0 Channel: 02 Id: 00 Lun: 00<br>      Vendor: DELL     Model: PERC H730 Mini   Rev: 4.28<br>      Type:   Direct-Access                    ANSI SCSI revision: 05<br> Scanning for device 0 2 1 0 ...<br>OLD: Host: scsi0 Channel: 02 Id: 01 Lun: 00<br>      Vendor: DELL     Model: PERC H730 Mini   Rev: 4.28<br>      Type:   Direct-Access                    ANSI SCSI revision: 05<br>Scanning host 1 for  all SCSI target IDs, all LUNs<br>Scanning host 2 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 3 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 4 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 5 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 6 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 7 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 8 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 9 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 10 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br>Scanning host 11 for  SCSI target IDs  0 1 2 3 4 5 6 7, all LUNs<br> Scanning for device 11 0 0 0 ...<br>OLD: Host: scsi11 Channel: 00 Id: 00 Lun: 00<br>      Vendor: PLDS     Model: DVD-ROM DS-8DBSH Rev: MD51<br>      Type:   CD-ROM                           ANSI SCSI revision: 05<br>Scanning host 12 for  all SCSI target IDs, all LUNs<br> Scanning for device 12 0 0 10 ...<br>OLD: Host: scsi12 Channel: 00 Id: 00 Lun: 10<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 12 0 0 11 ...<br>OLD: Host: scsi12 Channel: 00 Id: 00 Lun: 11<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 12 0 0 12 ...<br>=== 생략 ===<br>OLD: Host: scsi13 Channel: 00 Id: 00 Lun: 07<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 13 0 0 8 ...<br>OLD: Host: scsi13 Channel: 00 Id: 00 Lun: 08<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br> Scanning for device 13 0 0 9 ...<br>OLD: Host: scsi13 Channel: 00 Id: 00 Lun: 09<br>      Vendor: HITACHI  Model: OPEN-V           Rev: 7006<br>      Type:   Direct-Access                    ANSI SCSI revision: 03<br>Scanning host 14 for  all SCSI target IDs, all LUNs<br>0 new or changed device(s) found.<br>0 remapped or resized device(s) found.<br>0 device(s) removed.<br><br>감사합니다.</issue><cep>false</cep></case>