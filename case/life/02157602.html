======================<br><b>생성계정 : 태현 김</b><br><b>생성날짜 : 2018-08-08T08:38:32Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-08-25T10:14:33Z</b><br><b>id : 500A000000bWRmQIAW</b><br>======================<br><br><b><font size=15>
제목  : Bonding 구성 관련 문ㅇ
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>네트워크 이중화(bonding) 설정관련 문의드립니다.<br><br>저희는 현재 link down 방식을 사용중입니다.<br>이경우 스위치 레벨 hang 발생 시 서비스에 문제가 발생합니다.<br>실제로 문제가 발생했구요.<br><br>그래서, 제가 알기론 ARP Ping 방식이 있습니다.<br>이와 관련하여 문의드립니다.<br>1. ARP Ping 체크 방식을 많이 사용하는 지요?<br>   -&gt; 가능하다면 BP 사례를 알고 싶습니다.<br>2. 안정성 문제 등 고려해야 할 사항이 있을까요?<br>   -&gt; Link down 방식 대비 장, 단점<br>3. ARP ping 체크 방식 사용시 조건은 어떤걸 줄 수 있는지요?<br>   -&gt; time out 등<br><br>4. 두방식을 혼용하여 사용은 불가한건지요?<br><br>5. OS version에 따라서 다른 부분도 있는지 문의드립니다.(6/7 version)<br><br>금일 장애건으로 문의드리는 관계로,<br>빠른 답변부탁드리며<br>조언도 좀 많이 부탁드립니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>PECCAL01SL</hostname><br><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-10T05:48:14Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-10T07:13:17Z</b><br><br>안녕하세요,  <br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>각 문의사항에 대한 답변 드립니다.<br><br>문의사항1) 만약에 ARP monitoring parameters 기반으로 사용하게 되면 아래와 같이 설정할 경우 0.1초마다 arp_ip_target=192.253.142.1과 통신을 감지하여 동작하게 되는 것인지 문의드립니다.<br><br> - 192.253.142.1 은 ARP REQUEST 를 보내는 대상 IP 이며, ARP REQUEST 결과에 따라서 LINK 의 상태를 결정 합니다.<br> - arp_interval=100 은 0.1 초 마다 ARP REQUEST 를 보낼 것 입니다.<br><br><br>문의사항2) arp_validate라는 parameter가 있는데 대략적 설명은 arp requests와 replies를 검증하여 slave의 가동 상태를 결정짓는 것 같은데요. 아래와 같은 의미를 가지는 것 같은데 어떻게 적용이되게 되는 것 인지 문의드리려고 합니다.<br><br> - arp_validate 설정에 관련된 상세 설명이 나와있는 아래 첨부문서 [1] 을 참조 부탁드립니다.<br><br><br>문의사항3) miimon=100과 arp_interval=100의 동작이 다른 것인지 문의드리려고 합니다.<br><br> - 위의 두 파라메터 모두 millisecond 단위이며 지정하신 100 의 수치 자체는 0.1초로 동일합니다. 다만 단순히 물리적인 링크 상태를 확인하는 MIIMON monitoring 과 달리<br>ARP monitoring 은 ARP REQUEST 를 보내고 응답을 받기 때문에 ARP monitoring interval 값이 MIIMON monitoring 값 보다 더 크게 설정되며, 결과적으로 실패 감지가 조금 더 오래 걸릴 것 입니다.<br><br><br>문의사항4) 보내주신 내용 중 ARP monitoring parameters 방식을 적용했을 경우 스위치나 네트워크 구성 방식에 따라서 아래와 같은 문제 상황이 발생할 수 있는 것 처럼 보이는데요. 혹시 구체적으로 스위치나 네트워크 구성이 어떤 상태일 때 발생하는지 문의드리려고 합니다.<br><br> - 모든 slave 가 같은 Layer 2 broadcast domain 에 연결 되어있지 않은 경우를 말합니다. 하나의 slave 가 broadcast ARP 를 발생시켰을 때, 다른 하나가 받을 수 없게 되는 상황입니다.<br>보통 각 각의 slave 가 서로 다른 물리 스위치에 연결된 상태에서 두 스위치중에 하나가 backup mode 이거나 idle 상태일때 발생할 수 있습니다.<br><br>[1] What does the arp_validate bonding module option do and do I need to set it?&quot;<br>https://access.redhat.com/solutions/30732<br><br>감사합니다.<br><br><publishedDate>2018-08-10T05:48:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NLXoZIAX"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2018-08-09T23:53:32Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2018-08-09T23:53:32Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>보내주신 사례 중 (https://access.redhat.com/articles/172483) 부분에 대해서 확인 후<br>추가 문의드리려고 합니다.<br><br>현재 삼성생명 물리 운영 서버들의 경우<br>일반적으로 bonding은 아래와 같이 설정이 되어있습니다.<br><br>mode=1 miimon=100<br><br>mode=1의 경우는 active-backup mode이고 miimon의 경우에 100으로 설정되어 있으면<br>active-backup 운영 상황에서 물리적인 link state를 0.1초마다 감지하는 상태입니다.<br><br>root@DECCCL02SL /etc/sysconfig/network-scripts # cat ifcfg-bond0<br>DEVICE=bond0<br>DEVICETYPE=Bond<br>ONBOOT=yes<br>BOOTPROTO=none<br>IPADDR=192.253.142.122<br>NETMASK=255.255.255.0<br>GATEWAY=192.253.142.1<br>BONDING_OPTS=&quot;mode=1 miimon=100&quot;<br><br> - 문의 사항 1<br><br>만약에 ARP monitoring parameters 기반으로 사용하게 되면 아래와 같이 설정할 경우<br>0.1초마다 arp_ip_target=192.253.142.1과 통신을 감지하여 동작하게 되는 것인지 문의드립니다.<br><br>root@DECCCL02SL /etc/sysconfig/network-scripts # cat ifcfg-bond0<br>DEVICE=bond0<br>DEVICETYPE=Bond<br>ONBOOT=yes<br>BOOTPROTO=none<br>IPADDR=192.253.142.122<br>NETMASK=255.255.255.0<br>GATEWAY=192.253.142.1<br>BONDING_OPTS=&quot;mode=1 arp_interval=100 arp_ip_target=192.253.142.1(gateway)&quot;<br><br> - 문의 사항 2<br>arp_validate라는 parameter가 있는데 대략적 설명은<br>arp requests와 replies를 검증하여 slave의 가동 상태를 결정짓는 것 같은데요.<br><br>아래와 같은 의미를 가지는 것 같은데 어떻게 적용이되게 되는 것 인지 문의드리려고 합니다.<br><br>none : default<br>active : active slave에서만 수행<br>backup : backup slave에서만 수행<br>all : 모든 slave에서 수행<br><br> - 문의 사항 3<br><br>아래와 같이 arp monitoring interval은 일반적으로 miimon monitoring interval 보다 길다고 알려주셨는데<br><br>arp monitoring interval 은 일반적으로 miimon monitoring interval 보다 더 길게 되어있습니다. 따라서 miimon monitoring 방식 보다 fail 을 인지하는데 조금 더 오랜 시간이 걸릴 것입니다.<br><br>miimon=100과 arp_interval=100의 동작이 다른 것인지 문의드리려고 합니다.<br><br> - 문의 사항 4<br><br>보내주신 내용 중 ARP monitoring parameters 방식을 적용했을 경우 <br>스위치나 네트워크 구성 방식에 따라서 아래와 같은 문제 상황이 발생할 수 있는 것 처럼 보이는데요.<br><br>혹시 구체적으로 스위치나 네트워크 구성이 어떤 상태일 때 발생하는지 문의드리려고 합니다.<br><br>It is possible that some switch or network configurations may result in situations wherein the backup slaves do not receive the <br><br>ARP requests;<br><br>감사합니다.<br><br><publishedDate>2018-08-09T23:53:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NLLUGIA5"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-09T09:41:07Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-09T09:41:07Z</b><br><br>안녕하세요,  <br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>문의하신 내용에 대한 답변입니다.<br><br>Q1) ARP Ping 체크 방식을 많이 사용하는 지요? (가능하다면 BP 사례를 알고 싶습니다)<br>A1) 저희가 모든 표본을 가지고 측정할 수 없기 때문에 많거나 적다고 말씀드리기 어렵습니다.<br>다만 제가 진행했던 케이스 기준에서는 arp monitoring 보다는 miimon monitoring 방식을 더 많이 사용하고 있었습니다.<br><br>Q2) 안정성 문제 등 고려해야 할 사항이 있을까요? (Link down 방식 대비 장, 단점)<br>A2) 단순히 다른 두 가지 옵션차이 만으로 안정성을 말씀드리기는 어렵습니다. 대신 arp monitoring 의 특징에 대해서 말씀드리면 아래와 같습니다.<br><br> - 두 개의 스위치를 이용하여 bonding 구성시에 miimon monitoring 은 LAN 수준에서 물리적인 연결상태만으로 파악하기 때문에 실제로 반드시 통신이 가능해야하는 대상 (예: 게이트웨이 등) 과 스위치 간에 문제가 생겨도 인지하지 못합니다.<br>반면 arp monitoring 은 target ip 로 부터 응답을 받기때문에 LAN 수준에서 물리적인 연결상태 이외에도 target ip 로 부터 응답을 받을 수 없다면 실패로 간주하고 failover 됩니다.<br> - arp monitoring 방식을 이용하더라도 MII DOWN state ( 링크 실패 ) 가 감지되면 arp validation 도 성공할 수 없기 때문에 결국 arp monitoring 도 실패하게 됩니다.<br> - arp monitoring interval 은 일반적으로 miimon monitoring interval 보다 더 길게 되어있습니다. 따라서 miimon monitoring 방식 보다 fail 을 인지하는데 조금 더 오랜 시간이 걸릴 것입니다.<br><br>Q3) ARP ping 체크 방식 사용시 조건은 어떤걸 줄 수 있는지요?<br>A3) arp monitoring 에 대한 설명은 아래 첨부 문서 [1], [2], [3] 를 참조하시면 도움이 되실 것입니다.<br><br>Q4) 두방식을 혼용하여 사용은 불가한건지요?<br>A4) 네 그렇습니다. 둘 중에 하나만 사용해야합니다.<br><br>Q5) OS version에 따라서 다른 부분도 있는지 문의드립니다.<br>A5) OS 버전에 따라서 arp monitoring 이 다르게 작동하지는 않습니다.<br><br>[1] How do I configure a bonding device on Red Hat Enterprise Linux (RHEL)?<br>https://access.redhat.com/articles/172483<br><br>[2] While using bonding, what are the link failure detection methods available in RHEL ?<br>https://access.redhat.com/solutions/281063<br><br>[3] What settings should I have for a bond that is going between two switches?<br>https://access.redhat.com/solutions/286983<br><br>감사합니다.<br><br><publishedDate>2018-08-09T09:41:07Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NLHlYIAX"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-09T04:03:53Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-09T04:03:53Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Platform Support 를 담당하고 있는 Technical Support Engineer 박현익 입니다.<br>올려주신 문의내용은 현재 자세히 살펴보고 있는중이며, 관련된 내용이 확인이 되는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-09T04:03:53Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>