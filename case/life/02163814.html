======================<br><b>생성계정 : JIMIN KIM</b><br><b>생성날짜 : 2018-08-17T01:26:15Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-09-06T10:03:21Z</b><br><b>id : 500A000000bR30yIAC</b><br>======================<br><br><b><font size=15>
제목  : physical server 에서 internal disk의 multipath 인식 제외 방ㅂ
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요 <br><br>SDS 상암센터 <br><br>김지민 선임입니다.<br><br>물리 서버의 internal disk 영역(OS)의 multipath 제외 관련 문의드리려고 합니다.<br>현재 아래와 같이 df 상태와 multipath의 결과 부분을 확인한 내역입니다.<br><br>mpathb와 mpatha 부분이 internal disk 영역인데 multipath config에 포함되어 있어서<br>제외시키는 방법 관련해서 문의드리려고 합니다.<br><br>이유는 ReaR backup 수행 시 AUTOEXCLUDE_MULTIPATH=y 옵션을 사용하는데<br>해당 옵션을 사용하면 multipath 구성된 영역이 모두 제외되어서 문의드립니다.<br><br> - 현재 상태<br>root@FLPRSD01 / # df -Ph<br>Filesystem            Size  Used Avail Use% Mounted on<br>/dev/mapper/mpathbp2   30G  9.7G   19G  35% /<br>tmpfs                  63G     0   63G   0% /dev/shm<br>/dev/mapper/mpathbp1 1008M  117M  841M  13% /boot<br>/dev/mapper/mpathbp5  9.9G  198M  9.2G   3% /home<br>/dev/mapper/mpathbp6  9.9G  1.3G  8.2G  14% /var<br>/dev/mapper/vg0-lv_nwadmin  9.9G  3.8G  5.6G  41% /nwadmin<br>/dev/mapper/vg0-lv_Tools   30G  465M   28G   2% /Tools<br>/dev/mapper/vg0-lv_CRASH  148G   11G  130G   8% /CRASH<br>tmpfs                 4.0K     0  4.0K   0% /dev/vx<br>/dev/mapper/vg2-lv_LOG  4.0G  1.7G  2.1G  45% /LOG<br>/dev/mapper/vg2-lv_oracle_PRQS   20G  5.3G   14G  28% /oracle_PRQS<br>/dev/mapper/vg2-lv_ora_resource_PRQS   20G  851M   18G   5% /ora_resource_PRQS<br>/dev/mapper/vg2-lv_orasys_PRQS   20G  9.2G  9.6G  50% /orasys_PRQS<br>/dev/mapper/vg2-lv_oradata_PRQS  133G   11G  116G   9% /oradata_PRQS<br><br> - multipath -ll 결과<br>root@FLPRSD01 / # multipath -ll<br>mpathb (36848f690eb9ff600192e677b04b4dc71) dm-8 DELL,PERC H710<br>size=279G features='0' hwhandler='0' wp=rw<br>`-+- policy='round-robin 0' prio=1 status=active<br>  `- 6:2:0:0   sdg 8:96  active ready running<br>mpatha (36848f690eb9ff600192e678405492f4f) dm-3 DELL,PERC H710<br>size=279G features='0' hwhandler='0' wp=rw<br>`-+- policy='round-robin 0' prio=1 status=active<br>  `- 6:2:1:0   sdh 8:112 active ready running<br>ext2 (360060e8007ddf9000030ddf900006501) dm-1 HITACHI,OPEN-V<br>size=100G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='round-robin 0' prio=1 status=active<br>  |- 2:0:0:1   sdc 8:32  active ready running<br>  `- 5:0:0:1   sdd 8:48  active ready running<br>ext1 (360060e8007ddf9000030ddf900006500) dm-2 HITACHI,OPEN-V<br>size=100G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='round-robin 0' prio=1 status=active<br>  |- 5:0:0:0   sdb 8:16  active ready running<br>  `- 2:0:0:0   sda 8:0   active ready running<br><br>혹시 추가 필요하신 정보 있으면 부탁드립니다.<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.3</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>FLPRSD01</hostname><br><br><br><comment id="a0aA000000LeVTeIAN"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2018-08-21T04:26:16Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2018-08-21T04:26:15Z</b><br><br>안녕하세요<br><br>답변 감사드립니다.<br><br>아직 정확한 조치 날짜는 잡히지 않았지만 조치 후 공유드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-21T04:26:15Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LeG6bIAF"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-20T08:14:14Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-20T08:14:14Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q) /etc/multipath/wwids 파일의 역할에 대해서도 한번 문의드립니다.<br>A) multipath 또는 multipathd 에 의해서 생성된 장치들의 wwid 를 저장하는 곳이며, 여기에 등록된 wwid 를 가지고 있는 장치들은 자동으로 다시 path 를 생성하게 됩니다.<br><br>다음은 문의하신 각 절차에 대한 리뷰입니다.<br><br> - 절차 1 : 올바르게 되었습니다.<br> - 절차 2 : find_multipaths yes 부분은 올바르게 되었습니다.<br> - 절차 2 : find_multipaths yes 옵션을 사용하시는 경우 blacklist 부분에 internal 디스크는 별도로 지정하실 필요는 없습니다. 아래는 multipath 문서의 일부입니다.<br><br>&quot;With the find_multipaths parameter set to yes, you need to blacklist only the devices with multiple paths that you do not want to be multipathed.<br>Because of this, it will generally not be necessary to blacklist devices.&quot;<br><br> - 절차 3 ~ 3-2 : 네 작업 후 리부팅하시면 됩니다.<br><br>테스트 후 결과 공유 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-20T08:14:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LeCgQIAV"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2018-08-20T00:51:35Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2018-08-20T00:51:35Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>알려주신 가이드로 적용하였는데 아래 부분의 절차 확인부탁드리려고 합니다.<br><br>추가로 /etc/multipath/wwids 파일의 역할에 대해서도 한번 문의드립니다.<br><br> 1. /etc/multipath/wwids 파일에 인터널 디스크의 wwid 가 존재한다면 제거합니다.<br> 2. find_multipaths yes 설정을 /etc/multipath.conf 파일의 default 섹션에 추가합니다.<br> 3. 아래의 절차에 따라서 initramfs 를 재생성 합니다.<br> 3-1. 현재 버전의 백업파일을 생성합니다.<br>  # cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).bak.$(date +%m-%d-%H%M%S).img<br> 3-2. initramfs 를 재생성 합니다.<br>  # dracut -f -v<br><br>1. 절차<br>root@FLPRSD01 / # cat /etc/multipath/wwids<br># Multipath wwids, Version : 1.0<br># NOTE: This file is automatically maintained by multipath and multipathd.<br># You should not need to edit this file in normal circumstances.<br>#<br># Valid WWIDs:<br>/360060e8005bc7a000000bc7a00000460/<br>/360060e8005bc7a000000bc7a00000e20/<br>/360060e8005bc7a000000bc7a00000e21/<br>/360060e8005bc7a000000bc7a00000e22/<br>/36848f690eb9ff600192e678405492f4f/ ◀ 제거<br>/360060e8005bc7a000000bc7a00000e0f/<br>/36848f690eb9ff600192e677b04b4dc71/ ◀ 제거<br>/360060e8007ddf9000030ddf900006500/<br>/360060e8007ddf9000030ddf900006501/<br>/360060e8007ddf9000030ddf900005e21/<br>/360060e8007ddf9000030ddf900005e22/<br>/360060e8007ddf9000030ddf900005e20/<br><br>2. 아래 /etc/multipath.conf 내용<br>◀ 부분 확인 부탁드립니다.<br><br>root@FLPRSD01 / # cat /etc/multipath.conf<br># This is a basic configuration file with some examples, for device mapper<br># multipath.<br># For a complete list of the default configuration values, see<br># /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf.defaults<br># For a list of configuration options with descriptions, see<br># /usr/share/doc/device-mapper-multipath-0.4.9/multipath.conf.annotated<br>#<br># REMEMBER: After updating multipath.conf, you must run<br>#<br># service multipathd reload<br>#<br># for the changes to take effect in multipathd<br><br>## By default, devices with vendor = &quot;IBM&quot; and product = &quot;S/390.*&quot; are<br>## blacklisted. To enable mulitpathing on these devies, uncomment the<br>## following lines.<br>#blacklist_exceptions {<br>#       device {<br>#               vendor  &quot;IBM&quot;<br>#               product &quot;S/390.*&quot;<br>#       }<br>#}<br><br>## Use user friendly names, instead of using WWIDs as names.<br>defaults {<br>        user_friendly_names yes<br>        find_multipaths yes ◀ 추가해야하는 부분이 맞는지 문의드립니다.<br>}<br>##<br>## Here is an example of how to configure some standard options.<br>##<br>#<br>#defaults {<br>#       udev_dir                /dev<br>#       polling_interval        10<br>#       selector                &quot;round-robin 0&quot;<br>#       path_grouping_policy    multibus<br>#       getuid_callout          &quot;/lib/udev/scsi_id --whitelisted --device=/dev/%n&quot;<br>#       prio                    alua<br>#       path_checker            readsector0<br>#       rr_min_io               100<br>#       max_fds                 8192<br>#       rr_weight               priorities<br>#       failback                immediate<br>#       no_path_retry           fail<br>#       user_friendly_names     yes<br>#}<br>##<br>## The wwid line in the following blacklist section is shown as an example<br>## of how to blacklist devices by wwid.  The 2 devnode lines are the<br>## compiled in default blacklist. If you want to blacklist entire types<br>## of devices, such as all scsi devices, you should use a devnode line.<br>## However, if you want to blacklist specific devices, you should use<br>## a wwid line.  Since there is no guarantee that a specific device will<br>## not change names on reboot (from /dev/sda to /dev/sdb for example)<br>## devnode lines are not recommended for blacklisting specific devices.<br>##<br>blacklist {<br>#       wwid 26353900f02796769<br>        wwid 36848f690eb9ff600192e677b04b4dc71 # OS   ◀ internal disk 부분이어서 blacklist 처리 하였습니다.<br>        wwid 36848f690eb9ff600192e678405492f4f # DUMP ◀ internal disk 부분이어서 blacklist 처리 하였습니다. <br>        devnode &quot;^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*&quot;<br>        devnode &quot;^hd[a-z]&quot;<br>        wwid 360060e8007ddf9000030ddf900005e20 # fencing device vxvm<br>}<br>#multipaths {<br>#       multipath {<br>#               wwid                    3600508b4000156d700012000000b0000<br>#               alias                   yellow<br>#               path_grouping_policy    multibus<br>#               path_checker            readsector0<br>#               path_selector           &quot;round-robin 0&quot;<br>#               failback                manual<br>#               rr_weight               priorities<br>#               no_path_retry           5<br>#       }<br>#       multipath {<br>#               wwid                    1DEC_____321816758474<br>#               alias                   red<br>#       }<br>#}<br>#devices {<br>#       device {<br>#               vendor                  &quot;COMPAQ  &quot;<br>#               product                 &quot;HSV110 (C)COMPAQ&quot;<br>#               path_grouping_policy    multibus<br>#               getuid_callout          &quot;/lib/udev/scsi_id --whitelisted --device=/dev/%n&quot;<br>#               path_checker            readsector0<br>#               path_selector           &quot;round-robin 0&quot;<br>#               hardware_handler        &quot;0&quot;<br>#               failback                15<br>#               rr_weight               priorities<br>#               no_path_retry           queue<br>#       }<br>#       device {<br>#               vendor                  &quot;COMPAQ  &quot;<br>#               product                 &quot;MSA1000         &quot;<br>#               path_grouping_policy    multibus<br>#       }<br>#}<br>multipaths {<br>        multipath {<br>                wwid                    360060e8005bc7a000000bc7a00000460<br>                alias                   ext0<br>        }<br>        multipath {<br>                wwid                    360060e8007ddf9000030ddf900006500<br>                alias                   ext1<br>        }<br>        multipath {<br>                wwid                    360060e8007ddf9000030ddf900006501<br>                alias                   ext2<br>        }<br>}<br><br>3 ~ 3-2 진행<br><br>진행 후 리부팅까지 하면 되는 것인지 문의드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-20T00:51:35Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LdvFrIAJ"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-17T06:58:28Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-17T06:58:28Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>문의하신 내용과 유사한 사례를 먼저 안내드립니다.<br>유사 사례의 경우 RHEL 6 에서 /etc/multipath.conf 파일에 find_multipaths yes 설정이 되지 않았던 경우입니다.<br>find_multipaths yes 설정이 없는 경우에는 아래와 같은 절차로 조치해보시기 바랍니다.<br><br> 1. /etc/multipath/wwids 파일에 인터널 디스크의 wwid 가 존재한다면 제거합니다.<br> 2. find_multipaths yes 설정을 /etc/multipath.conf 파일의 default 섹션에 추가합니다.<br> 3. 아래의 절차에 따라서 initramfs 를 재생성 합니다.<br> 3-1. 현재 버전의 백업파일을 생성합니다.<br>  # cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).bak.$(date +%m-%d-%H%M%S).img<br> 3-2. initramfs 를 재생성 합니다.<br>  # dracut -f -v<br><br>해당 내용은 아래의 KCS 를 참조하였습니다.<br><br>&quot;Internal disk device is being detected as multipath device&quot;<br>https://access.redhat.com/solutions/66569<br><br>만약 위의 경우에 해당하지 않으신다면 이슈가 발생한 시스템의 sosreport 를 첨부 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-17T06:58:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Ldu3vIAB"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-17T04:46:16Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-17T04:46:16Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Platform Support 를 담당하고 있는 Technical Support Engineer 박현익 입니다.<br>올려주신 문의내용은 현재 자세히 살펴보고 있는중이며, 관련된 내용이 확인이 되는대로 업데이트 드리도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-17T04:46:16Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>