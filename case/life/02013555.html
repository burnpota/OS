======================<br><b>생성계정 : 타임게이트 (주)</b><br><b>생성날짜 : 2018-01-17T02:19:56Z</b><br><b>마지막 답변자 : Workflow Integration</b><br><b>마지막 수정 일자 : 2018-01-29T01:29:12Z</b><br><b>id : 500A000000ZdiNsIAJ</b><br>======================<br><br><b><font size=15>
제목  : [삼성생명]  JBCS2.4 일반계정(wasadm)으로 1024 port 이하 실행 관련
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요 고객사인 삼성생명에서 jbcs24 설정 중 이슈가 발생하여 문의드립니다. <br>## 고객정보 ##<br>고객사 : 삼성생명 정보전략그룹<br>고객명 : 이태우 선임<br>연락처 : 02-772-6652<br>##<br><br>## 파트너사 ##<br>파트너사명 : 타임게이트<br>담당자 : 안상훈 책임<br>연락처 : 010-3957-1209<br>##<br><br>## 환경 ##<br>OS : RHEL6.2<br>WEB : jbcs-httpd24-httpd-2.4.23-RHEL6-x86_64<br>##<br><br>## 참고 URL ##<br>https://access.redhat.com/solutions/18843<br>https://access.redhat.com/articles/1663<br>##<br><br>## 문의 ##<br>
제목과 같이 일반계정으로 1024port 이하의 port binding 관련하여 문의드립니다. <br>설정 시 하기의 에러코드와 같이 발생합니다. <br>/wasadm/httpd24/httpd/sbin/httpd: symbol lookup error: /wasadm/httpd24/httpd/sbin/httpd: undefined symbol: apr_crypto_init<br><br>작업내역은 하기와 같으며 해당 결과역시 전달드립니다 <br>##<br>chown root httpd<br>chmod 750 httpd<br>chmod u+s httpd<br><br><br>[root@localhost sbin]# ls -tla<br>합계 5744<br>drwxr-xr-x  2 wasadm wasadm    4096 2018-01-10 13:17 .<br>drwxr-xr-x 16 wasadm wasadm    4096 2018-01-10 13:10 ..<br>-rwxr-xr-x  1 wasadm wasadm    4037 2018-01-10 13:10 apachectl<br>-rwxr-xr-x  1 wasadm wasadm   55488 2016-12-06 21:50 ab<br>## 중략 ##<br>-rwxr-xr-x  1 wasadm wasadm   18448 2016-12-06 21:50 htpasswd<br>-rwxr-xr-x  1 wasadm wasadm 2796552 2016-12-06 21:50 httpd<br>======================<br><br>[root@localhost sbin]# ls -tla<br>합계 5744<br>drwxr-xr-x  2 wasadm wasadm    4096 2018-01-10 13:17 .<br>drwxr-xr-x 16 wasadm wasadm    4096 2018-01-10 13:10 ..<br>-rwxr-xr-x  1 wasadm wasadm    4037 2018-01-10 13:10 apachectl<br>-rwxr-xr-x  1 wasadm wasadm   55488 2016-12-06 21:50 ab<br>## 중략 ##<br>-rwxr-xr-x  1 wasadm wasadm   18448 2016-12-06 21:50 htpasswd<br>-rwsr-x---  1 root   wasadm 2796552 2016-12-06 21:50 httpd<br>##<br><br>기 첨부드린 사이트에서 확인결과 setuid 변경 시 apachectl상의 LD_LIBRARY_PATH가 보안을 위해 unset 된다고 하는데 일반계정으로 1024 port 이하를 사용하기 위한 가이드를 요청드립니다 <br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat JBoss Web Server</b><br><b>버젼  : 3.1</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000LXzG1IAL"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-29T01:29:12Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-29T01:29:12Z</b><br><br>안녕하세요, <br><br>Red Hat Global Techincal Support Service를 이용해주셔서 감사합니다.<br><br>케이스가 처리 완료되면 고객 설문조사 메일이 발생됩니다. 고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다. 향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다. <br><br>그리고 아래 Red Hat Customer Portal group을 통하여 많은 유용한 정보들을 볼 수 있으니 참고하시기 바랍니다.<br><br>Featured Groups:<br>Red Hat Enterprise Linux - https://access.redhat.com/groups/red-hat-enterprise-linux<br>Red Hat Enterprise Linux 7 Ideas - https://access.redhat.com/groups/red-hat-enterprise-linux-7-ideas<br>Red Hat Enterprise Linux Developer Program (beta) - https://access.redhat.com/groups/red-hat-enterprise-linux-developer-program-beta<br>Red Hat Enterprise Virtualization - https://access.redhat.com/groups/red-hat-enterprise-virtualization<br>Red Hat Storage - https://access.redhat.com/groups/red-hat-storage<br>JBoss Enterprise Middleware - https://access.redhat.com/groups/jboss-enterprise-middleware<br>Red Hat Network Satellite - https://access.redhat.com/groups/red-hat-network-satellite<br><br><br>감사합니다.<br>Best Regards, <br>Ted Won<br>Senior Software Maintenance Engineer<br>Red Hat Global Support Services<br><br><publishedDate>2018-01-29T01:29:12Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LXzCEIA1"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-29T01:20:24Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-29T01:20:24Z</b><br><br>안녕하세요 <br><br>Red Hat Global Support Service를 이용해주셔서 감사합니다. <br><br>업데이트 감사합니다, 의사 결정에 기술 지원 내용이 도움이 되었다면 좋겠습니다. <br><br>추가로 문의하신 사항의 경우는 죄송하지만 새로운 케이스로 생성해주시기 바랍니다. <br>케이스 이슈와 개별적으로 추가적인 조사가 필요한 문의 내용으로써 귀찮으시더라도 새로운 케이스로 분리해서 올려주시면 감사하겠습니다. <br>안내차 추가적으로 코멘트드리면, 케이스당 하나의 이슈를 처리하는 것을 정책으로 하고 있습니다. 왜냐하면 케이스마다 하나의 KCS(solution article) 생성을 해야 하고, 히스토리 관리 및 이슈 진행 중 엔지니어팀 컨택이 필요한 경우 2가지 이상의 이슈가 하나의 케이스에 있는 경우 진행이 잘 되지 않습니다. <br>귀찮으시더라도 이슈별로 케이스를 분리해서 올려주시면 감사하겠습니다. <br><br>해당 이슈 관련 더 필요한 사항이 있으신지요? 이번 케이스 건에 대한 더 궁금한 사항이 없으시거나 지원이 필요하지 않다면 케이스를 close 해도 될까요? <br><br>감사합니다.<br><br><publishedDate>2018-01-29T01:20:24Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LXz1VIAT"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-29T00:54:33Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-29T00:54:33Z</b><br><br>안녕하세요<br>해당 건은 RHEL7의 번들 http server를 사용하는 것으로 의사결정이 되어 테스트 진행할 예정입니다 .<br><br>다만, 번들 httpd server와 jbcs의 차이점이 있을까요?<br><br>확인요청드립니다. <br><br>감사합니다.<br><br><publishedDate>2018-01-29T00:54:33Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LX7E1IAL"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-24T06:50:39Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-24T06:50:39Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>&gt; 2. setuid를 설정하여 apache 자체 내장된 library가 아닌 system library를 사용하게 된다면<br>    jbcs의 기술지원이 가능한지 확인 부탁 드립니다.<br><br>확인 결과 문의하신 구성의 경우에 대해서는 기술 지원이 불가합니다.<br>해당 구성이 Red Hat에 의해 테스트된 configuration이 아니며 side-effect 유무등의 보증을 할 수 없기 때문입니다. 또한 차후 업그레이드시 그리고 설치가능한 다른 Apache 버전들과 RPM 설치 벙법등과 여러가지 케이스로 충돌 이슈가 발생할 수 있는 단점이 존재한다고 합니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-24T06:50:39Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LX4JpIAL"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-24T01:59:30Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-24T01:59:29Z</b><br><br>안녕하세요<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br>  <br>문의 사항 1번&quot;OS RedHat 7.x 에서 Jbcs 사용 가능 여부&quot;의 경우는 케이스 이슈와 개별적으로 추가적인 조사가 필요한 개별적인 문의 내용으로써 귀찮으시더라도 새로운 케이스로 분리해서 올려주시면 감사하겠습니다.<br>안내차 추가적으로 코멘트드리면, 케이스당 하나의 이슈를 처리하는 것을 정책으로 하고 있습니다. 왜냐하면 케이스마다 하나의 KCS(solution article) 생성을 해야 하고, 히스토리 관리 및 이슈 진행 중 엔지니어팀 컨택이 필요한 경우 2가지 이상의 이슈가 하나의 케이스에 있는 경우 진행이 잘 되지 않습니다.<br><br>귀찮으시더라도 이슈별로 케이스를 분리해서 올려주시면 감사하겠습니다.<br><br>먼저 문의 사항 2번&quot;setuid를 설정하여 apache 자체 내장된 library가 아닌 system library&quot; 대해서 확인이 되는 데로 업데이트하도록 하겠습니다.<br><br>다시 추가로 문의 주신 내용에 관해서는:<br>&gt; 1.OS RedHat 7.x에서 JBCS에 대한 &quot;일반계정 사용&quot;과 &quot;1024 이하 포트 사용&quot; 두개의 조건이 동시에 만족하여 사용이 가능한지요?<br>해당 내용은 RHEL 6와 7 모두 동일하게 적용되는 내용으로써 이미 답변드린 내용이 동일하게 적용됩니다.<br>~~~<br>결론적으로 말씀드리면, 자체 내장 library를 사용하는 Apache HTTP Server 2.4 에서는 해당 요건이 보안 제약 사항과 충돌되어 &quot;일반계정 사용&quot;과 &quot;1024 이하 port 사용&quot; 두 조건을 동시에 모두 만족하여 실행 할 수 없습니다.<br>대신 동일한 목적 구현을 위해 대안으로써, 문서[2]에서 언급된 내용과 같이 &quot;Using Port forwarding&quot; 을 활용하여 일반계정 사용자를 이용하여 8080과 같은 port 로 Apache를 실행하고 이를 80 port로 forwarding하여 서비스하는 방법 적용을 권고 드립니다.<br>~~~<br><br>감사합니다.<br><br><publishedDate>2018-01-24T01:59:29Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LX430IAD"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-24T01:33:47Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-24T01:33:47Z</b><br><br>안녕하세요.<br>아래의 추가 문의에 대한 추가 문의가 있습니다.<br><br>1.OS RedHat 7.x에서 JBCS에 대한 &quot;일반계정 사용&quot;과 &quot;1024 이하 포트 사용&quot; 두개의 조건이 동시에 만족하여 사용이 가능한지요?<br><br>2. 위 환경에서도 안된다면,<br>    만약 setuid를 설정하여 apache 차제 내장된 library가 아닌 system library를 사용하게 된다면 jbcs 기술 지원이 가능한지요?<br><br>이상입니다.<br>수고하세요.<br><br><publishedDate>2018-01-24T01:33:47Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LX3u3IAD"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-24T01:14:10Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-24T01:14:10Z</b><br><br>안녕하세요.<br>고객의 요청으로 추가 문의 드립니다.<br><br>1. OS RedHat 7.x 에서 Jbcs 사용 가능 여부<br>    제가 찾아본 &quot;Red Hat JBoss Enterprise Application Platform (EAP) 7 Supported Configurations&quot; 문서에서<br>    RedHat 7 버전에서  JBCS Apache HTTP Server 테스트 된 것을 확이 되었습니다.<br>   (참조 URL : https://access.redhat.com/articles/2026253)<br><br>   해당 문서에 나오듯 RedHat 7.x에서 JBCS를 사용가능한지 추가로 SR을 통해 공식 답변을 요청 합니다.<br><br>2. setuid를 설정하여 apache 자체 내장된 library가 아닌 system library를 사용하게 된다면<br>    jbcs의 기술지원이 가능한지 확인 부탁 드립니다.<br><br><br>감사합니다.<br>수고하세요.<br><br><publishedDate>2018-01-24T01:14:10Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LWW58IAH"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T08:30:57Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T08:30:57Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>문서[1]의 iptables 명령을 내리면 어딘가 파일시스템에 기록되지 않고, 커널의 netfilter라는 모듈에서 명령을 실행한 결과를 메모리에 보관하고 있습니다. 그래서 찾을 수가 없는 것입니다. <br>하지만 확인 결과 iptables-save 명령을 사용하면 기록시킬 수 있다고 합니다. 자세한 내용은 문서[2]를 참조하시기 바라겠습니다.<br> <br>[1] How to bind ports below 1024 with non-root privilege https://access.redhat.com/solutions/18843 <br>[2] How can I save iptables rules? https://access.redhat.com/node/9014<br><br>감사합니다.<br><br><publishedDate>2018-01-22T08:30:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWUgLIAX"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-22T06:20:58Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-22T06:20:58Z</b><br><br>안녕하세요<br>빠른 확인에 감사드립니다. <br><br>우선 확인하여 주신 것과 같이 하기의 명령어로 적용됨은 확인을 하였습니다. <br>iptables -t nat -L <br>##<br>Chain PREROUTING (policy ACCEPT)<br>target     prot opt source               destination         <br>DNAT       tcp  --  anywhere             anywhere            tcp dpt:http to::8080 <br><br>Chain INPUT (policy ACCEPT)<br>target     prot opt source               destination         <br><br>Chain OUTPUT (policy ACCEPT)<br>target     prot opt source               destination         <br>REDIRECT   tcp  --  anywhere             anywhere            tcp dpt:http redir ports 8080 <br><br>Chain POSTROUTING (policy ACCEPT)<br>target     prot opt source               destination   <br>##<br><br>다만, 해당 변경내용이 특정파일(/etc/sysconfig/iptables)에 적용이 되어서 확인할 수 있는지 여부를 요청드린 것입니다 <br>확인 요청드립니다 <br><br>마지막으로 해당 내용은 현재 고객인 삼성생명 정보전략그룹에 전달하여 현재 추가문의를 기다리고 있는 중이며 <br>말씀하신 것과 같이 iptables KB article 관련 문의는 별도 OS팀을 통해 문의하도록 하겠습니다 <br><br>감사합니다.<br><br><publishedDate>2018-01-22T06:20:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LWUGDIA5"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T05:40:31Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T05:40:31Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>혹시 아래의 명령을 먼저 수행하셨는지요? 이 명령을 먼저 수행하지 않으면 iptables 명령이 적용되지 않는다고 합니다.<br><br>Enable the IP forward kernel parameter:<br># sysctl -w net.ipv4.ip_forward=1<br><br>How to bind ports below 1024 with non-root privilege [1]:<br>~~~<br>sysctl -w net.ipv4.ip_forward=1<br>iptables -F -t nat<br>iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to :8080<br>iptables -t nat -A OUTPUT -o lo -p tcp --dport 80 -j REDIRECT --to-ports 8080<br>~~~<br><br>적용 후 확인 명령은 아래와 같습니다:<br>~~~ <br>iptables -t nat -L PREROUTING -v<br>iptables -t nat -L OUTPUT -v<br>~~~<br><br>참고로 위 명령 중 'iptables -F -t nat' 명령은 주의가 필요하며 선택적이라고 합니다. 기존 포트 포워딩 구성을 제거하는 명령이라고 합니다.<br>그리고 RHEL reboot 시 초기화 된다고 합니다. Reboot 후에도 적용되는 persistent 설정을 원하면서 KB article [2] 문서를 참조하셔서 설정 하실 수 있습니다. <br>KB article [2] 상세 설정 관련 추가로 궁금하신 사항은 sosreport와 함께 새로운 kernel Case로 오픈해주시면 감사하겠습니다.<br><br>[1] How to bind ports below 1024 with non-root privilege https://access.redhat.com/solutions/18843 <br>[2] How to make Iptables persistent across reboots ? https://access.redhat.com/solutions/60562<br><br>감사합니다.<br><br><publishedDate>2018-01-22T05:40:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWU5FIAX"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T05:15:49Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T05:15:49Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>말씀처럼 이슈 최초 분석시에 jbcs-httpd24-httpd-2.4.23 버전에서 발생하는 버그[1]로써 Known Issue[2]로 판단되었었습니다. 그리고 Service Pack 적용 테스트도 진행했었습니다.<br>그러나 이슈가 해결되지 않아서 앞서 말씀드린 분석 및 결과에 도달하게 되었었습니다. 참고로 버그[1]의 발생 조건은 root 계정으로 실행시에 재현되는 이슈입니다.<br>~~~<br>JBCS-252 - httpd fails to start if apr/apr-util is installed prior to installing jbcs-httpd24-httpd<br>When installing jbcs-httpd24-httpd on a system that already has apr or apr-util installed httpd will be unable to start, and instead throw the following error:<br><br>Starting httpd: /opt/rh/jbcs-httpd24/root/usr/sbin/httpd: symbol lookup error: /opt/rh/jbcs-httpd24/root/usr/sbin/httpd: undefined symbol: apr_crypto_init<br>                                                           [FAILED]<br>This is a known issue in JBoss Core Services {JBCSRevision}. To workaround this issue install jbcs-httpd24-httpd-devel, as it contains the necessary linked libraries.<br>~~~<br><br>[1] https://issues.jboss.org/browse/JBCS-252<br>[2] https://access.redhat.com/documentation/en-us/red_hat_jboss_core_services/2.4.23/html/apache_http_server_2.4.23_release_notes/known_issues<br><br>추가문의 주신 iptable 관련해서 확인 중이며, 확인되는데로 업데이트하도록 하겠습니다.<br> <br>감사합니다.<br><br><publishedDate>2018-01-22T05:15:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWTvPIAX"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T04:52:26Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T04:52:26Z</b><br><br>[Red Hat Internal Collaboration Note]<br><br>Hi sbr-kernel experts,<br><br>&gt;&gt; 가이드 주신 port forwarding 명령어를 root 실행 시 해당 설정내역이 어떤 파일에 명시가 되는지요?<br>&gt;&gt; 로컬 VM 테스트 시 /etc/sysconfig 경로에 iptables 파일에  적재(반영)가 되지 않아 문의드립니다. <br>Customer wants to do below commands according to the KCS[1]:<br>~~~<br>Make iptables rules to redirect packets heading for 80 port to 8080 port which the program will listen.<br>iptables -F -t nat<br>iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to :8080<br>iptables -t nat -A OUTPUT -o lo -p tcp --dport 80 -j REDIRECT --to-ports 8080<br>Then, run the program with a normal user.<br>~~~<br>Questions:<br>1. Should iptables command run by non-root privilege or root user ?<br>2. Where we can view the changes by these iptables commands ? The Customer already checked out &quot;/etc/sysconfig&quot; path, however, they couldn't find any changes.<br><br>Can someone provide any ideas on this case?<br>Thanks in advanced<br><br>[1] How to bind ports below 1024 with non-root privilege https://access.redhat.com/solutions/18843<br><br><publishedDate>2018-01-22T04:52:26Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWTuvIAH"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-22T04:51:34Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-22T04:51:34Z</b><br><br>추가로 문의드립니다 <br><br>REDHAT DOCs의 유사로그 확인결과 하기와 같이 jbcs-httpd24-httpd-devel 의 파일을 설치 시  apr 또는 apr-util 관련 라이브러리를 이미 가지고 있어서<br>해당 이슈에 대한 work-around로 확인되는데 확인 요청드립니다. <br>또한 만약 가능하다면 저희 subscrioption으로 해당 zip파일을 다운로드에서 확인할 수가 없는데 해당 파일 첨부가 가능하신지요?<br><br>JBCS-252 - httpd fails to start if apr/apr-util is installed prior to installing jbcs-httpd24-httpd<br>When installing jbcs-httpd24-httpd on a system that already has apr or apr-util installed httpd will be unable to start, and instead throw the following error:<br>##<br>Starting httpd: /opt/rh/jbcs-httpd24/root/usr/sbin/httpd: symbol lookup error: /opt/rh/jbcs-httpd24/root/usr/sbin/httpd: undefined symbol: apr_crypto_init<br>                                                         [FAILED]<br>##<br>This is a known issue in JBoss Core Services {JBCSRevision}. To workaround this issue install jbcs-httpd24-httpd-devel, as it contains the necessary linked libraries.<br><br>참고 URL : https://access.redhat.com/documentation/en-us/red_hat_jboss_core_services/2.4.23/html/apache_http_server_2.4.23_release_notes/known_issues<br><br>확인 요청드립니다.<br><br><publishedDate>2018-01-22T04:51:34Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LWTqoIAH"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T04:42:07Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T04:42:06Z</b><br><br>안녕하세요,<br> <br>현재 추가 문의 주신 내용을 자세히 살펴보는 중이며, 확인이 되는 데로 업데이트하도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-22T04:42:06Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWTmmIAH"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-22T04:29:00Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-22T04:29:00Z</b><br><br>안녕하세요<br>정확한 답변에 감사드립니다. <br>추가 문의가 있어 SR 업데이트 드립니다. <br><br>가이드 주신 port forwarding 명령어를 root 실행 시 해당 설정내역이 어떤 파일에 명시가 되는지요?<br>로컬 VM 테스트 시 /etc/sysconfig 경로에 iptables 파일에  적재(반영)가 되지 않아 문의드립니다. <br><br>확인 요청드립니다.<br><br><publishedDate>2018-01-22T04:29:00Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LWTIDIA5"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T02:56:57Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T02:56:57Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>추가로 올려주신 코멘트에 관해 확인 업데이트 드립니다. 아래 내용과 같이 JBoss Web Server 2.1.0 버전에서는 library가 system library로 symbolic link 되어 있어 말씀하신 바와 같이 실행이 가능합니다. 하지만 jws3.0.3에서는 자체 library로 구성되어 있어 setuid로 실행시 이슈가 발생할 것입니다.<br><br><br>jws2.1 버젼 =&gt; jboss-ews-httpd-2.1.0-RHEL6-x86_64.zip (Red Hat JBoss Web Server 2.1.0 Apache HTTP Server for RHEL 6 x86_64)<br>https://access.redhat.com/jbossnetwork/restricted/softwareDetail.html?softwareId=32743&amp;product=webserver&amp;version=2.1.0&amp;downloadType=distributions<br>~~~<br>➜  lib pwd<br>/Users/tedwon/Downloads/jboss-ews-2.1/httpd/lib<br>➜  lib ls -al<br>total 0<br>drwxr-xr-x@ 11 tedwon  staff  352 Jan 22 11:50 .<br>drwxr-xr-x@ 21 tedwon  staff  672 Aug  9  2014 ..<br>drwxr-xr-x@ 11 tedwon  staff  352 Jul 18  2014 build<br>lrwxr-xr-x@  1 tedwon  staff   22 Jan 22 11:50 libapr-1.la -&gt; /usr/lib64/libapr-1.la<br>lrwxr-xr-x@  1 tedwon  staff   22 Jan 22 11:50 libapr-1.so -&gt; /usr/lib64/libapr-1.so<br>lrwxr-xr-x@  1 tedwon  staff   24 Jan 22 11:50 libapr-1.so.0 -&gt; /usr/lib64/libapr-1.so.0<br>lrwxr-xr-x@  1 tedwon  staff   28 Jan 22 11:50 libapr-1.so.0.3.9 -&gt; /usr/lib64/libapr-1.so.0.3.9<br>lrwxr-xr-x@  1 tedwon  staff   26 Jan 22 11:50 libaprutil-1.la -&gt; /usr/lib64/libaprutil-1.la<br>lrwxr-xr-x@  1 tedwon  staff   26 Jan 22 11:50 libaprutil-1.so -&gt; /usr/lib64/libaprutil-1.so<br>lrwxr-xr-x@  1 tedwon  staff   28 Jan 22 11:50 libaprutil-1.so.0 -&gt; /usr/lib64/libaprutil-1.so.0<br>lrwxr-xr-x@  1 tedwon  staff   32 Jan 22 11:50 libaprutil-1.so.0.3.9 -&gt; /usr/lib64/libaprutil-1.so.0.3.9<br>~~~<br>======================<br>jws3.0.3 =&gt; jws-httpd-3.0.3-RHEL6-x86_64.zip (Red Hat JBoss Web Server 3.0.3 Apache HTTP Server for RHEL 6 x86_64)<br>https://access.redhat.com/jbossnetwork/restricted/softwareDetail.html?softwareId=44311&amp;product=webserver&amp;version=3.0.3&amp;downloadType=distributions<br>~~~<br>➜  lib pwd<br>/Users/tedwon/Downloads/jws-3.0/httpd/lib<br>➜  lib ls -al<br>total 3008<br>drwxr-xr-x@ 40 tedwon  staff    1280 Apr  1  2016 .<br>drwxr-xr-x@ 22 tedwon  staff     704 Apr  1  2016 ..<br>-rwxr-xr-x@  1 tedwon  staff   14232 Apr  1  2016 apr_crypto_nss-1.so<br>-rw-r--r--@  1 tedwon  staff   13340 Apr  1  2016 apr_crypto_nss.a<br>-rwxr-xr-x@  1 tedwon  staff    1059 Apr  1  2016 apr_crypto_nss.la<br>-rwxr-xr-x@  1 tedwon  staff   14232 Apr  1  2016 apr_crypto_nss.so<br>-rwxr-xr-x@  1 tedwon  staff   13992 Apr  1  2016 apr_crypto_openssl-1.so<br>-rw-r--r--@  1 tedwon  staff   12668 Apr  1  2016 apr_crypto_openssl.a<br>-rwxr-xr-x@  1 tedwon  staff    1030 Apr  1  2016 apr_crypto_openssl.la<br>-rwxr-xr-x@  1 tedwon  staff   13992 Apr  1  2016 apr_crypto_openssl.so<br>-rwxr-xr-x@  1 tedwon  staff   22152 Apr  1  2016 apr_dbd_mysql-1.so<br>-rw-r--r--@  1 tedwon  staff   24030 Apr  1  2016 apr_dbd_mysql.a<br>-rwxr-xr-x@  1 tedwon  staff    1062 Apr  1  2016 apr_dbd_mysql.la<br>-rwxr-xr-x@  1 tedwon  staff   22152 Apr  1  2016 apr_dbd_mysql.so<br>-rwxr-xr-x@  1 tedwon  staff   28848 Apr  1  2016 apr_dbd_odbc-1.so<br>-rw-r--r--@  1 tedwon  staff   33708 Apr  1  2016 apr_dbd_odbc.a<br>-rwxr-xr-x@  1 tedwon  staff     993 Apr  1  2016 apr_dbd_odbc.la<br>-rwxr-xr-x@  1 tedwon  staff   28848 Apr  1  2016 apr_dbd_odbc.so<br>-rwxr-xr-x@  1 tedwon  staff   20336 Apr  1  2016 apr_dbd_pgsql-1.so<br>-rw-r--r--@  1 tedwon  staff   25494 Apr  1  2016 apr_dbd_pgsql.a<br>-rwxr-xr-x@  1 tedwon  staff     998 Apr  1  2016 apr_dbd_pgsql.la<br>-rwxr-xr-x@  1 tedwon  staff   20336 Apr  1  2016 apr_dbd_pgsql.so<br>-rwxr-xr-x@  1 tedwon  staff   15696 Apr  1  2016 apr_dbd_sqlite3-1.so<br>-rw-r--r--@  1 tedwon  staff   17424 Apr  1  2016 apr_dbd_sqlite3.a<br>-rwxr-xr-x@  1 tedwon  staff    1004 Apr  1  2016 apr_dbd_sqlite3.la<br>-rwxr-xr-x@  1 tedwon  staff   15696 Apr  1  2016 apr_dbd_sqlite3.so<br>-rwxr-xr-x@  1 tedwon  staff    9616 Apr  1  2016 apr_ldap-1.so<br>-rw-r--r--@  1 tedwon  staff   12088 Apr  1  2016 apr_ldap.a<br>-rwxr-xr-x@  1 tedwon  staff     961 Apr  1  2016 apr_ldap.la<br>-rwxr-xr-x@  1 tedwon  staff    9616 Apr  1  2016 apr_ldap.so<br>drwxr-xr-x@ 12 tedwon  staff     384 Apr  1  2016 build<br>drwxr-xr-x@  2 tedwon  staff      64 Jan 28  2016 httpd<br>-rwxr-xr-x@  1 tedwon  staff     977 Apr  1  2016 libapr-jws3-1.la<br>-rwxr-xr-x@  1 tedwon  staff  188008 Apr  1  2016 libapr-jws3-1.so<br>-rwxr-xr-x@  1 tedwon  staff  188008 Apr  1  2016 libapr-jws3-1.so.0<br>-rwxr-xr-x@  1 tedwon  staff  188008 Apr  1  2016 libapr-jws3-1.so.0.4.8<br>-rwxr-xr-x@  1 tedwon  staff    1039 Apr  1  2016 libaprutil-jws3-1.la<br>-rwxr-xr-x@  1 tedwon  staff  164232 Apr  1  2016 libaprutil-jws3-1.so<br>-rwxr-xr-x@  1 tedwon  staff  164232 Apr  1  2016 libaprutil-jws3-1.so.0<br>-rwxr-xr-x@  1 tedwon  staff  164232 Apr  1  2016 libaprutil-jws3-1.so.0.5.2<br>~~~<br><br>감사합니다.<br><br><publishedDate>2018-01-22T02:56:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWTEVIA5"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T02:46:34Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T02:46:34Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br><br>해당 이슈에 대해 확인 결과 말씀하신바와 같이 보안 이슈 방지를 위해 setuid 또는 setcap 사용시 실행중(runtime) LD_LIBRARY_PATH가 강제로 unset 되어 결국 Apache 자체 내장 library(/wasadm/httpd24/httpd/lib)를 로딩하지 못하고 system library(/usr/lib64)를 참조하게 되어 해당 이슈와 같은 현상이 발생하게 됩니다.<br>This is **the reason** that the LD_LIBRARY_PATH environment variable unset in runtime with setuid or setgid bit set in RHEL: [1]<br>~~~<br>So it is possible to override default system shared libraries for a given executable by using this path variable.<br><br>This can be a grave security risk for executables running with elevated privileges i.e. with setuid or setgid bit set. It could mean that the caller could override almost all of the functions called by the executable by custom and probably malicious code, which would then execute with elevated privileges.<br><br>For security reasons, LD_LIBRARY_PATH is ignored (unset) at runtime for executables that have their setuid or setgid bit set.<br>~~~<br><br><br>결론적으로 말씀드리면, 자체 내장 library를 사용하는 Apache HTTP Server 2.4 에서는 해당 요건이 보안 제약 사항과 충돌되어 &quot;일반계정 사용&quot;과 &quot;1024 이하 port 사용&quot; 두 조건을 동시에 모두 만족하여 실행 할 수 없습니다.<br>대신 동일한 목적 구현을 위해 대안으로써, 문서[2]에서 언급된 내용과 같이 &quot;Using Port forwarding&quot; 을 활용하여 일반계정 사용자를 이용하여 8080과 같은 port 로 Apache를 실행하고 이를 80 port로 forwarding하여 서비스하는 방법 적용을 권고 드립니다.<br>~~~<br>For example,<br>Enable the IP forward kernel parameter:<br># sysctl -w net.ipv4.ip_forward=1<br><br>Make iptables rules to redirect packets heading for 80 port to 8080 port which the program will listen.<br>$ iptables -F -t nat<br>$ iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to :8080<br>$ iptables -t nat -A OUTPUT -o lo -p tcp --dport 80 -j REDIRECT --to-ports 8080<br>Then, run the program with a normal user.<br>~~~<br><br>[1] Why does the LD_LIBRARY_PATH variable get cleared for setuid/setgid binaries in Red Hat Enterprise Linux? https://access.redhat.com/articles/1663<br>[2] How to bind ports below 1024 with non-root privilege https://access.redhat.com/solutions/18843 <br><br>감사합니다.<br><br><publishedDate>2018-01-22T02:46:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWTBMIA5"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-22T02:36:58Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-22T02:36:58Z</b><br><br>안녕하세요 추가로 업데이트 드립니다 <br>기 유선상 말씀드린 것과 같이 현재 jws2.1 버젼에서는 일반계정으로 setuid 설정을 하여 정상 기동/ 운영하고 있습니다. <br><br>##<br><br>OS 버전 정보<br>w3sli@ITHPSAP1 /app1/web/jboss-ews-2.1 # grep . /etc/*-release<br>/etc/redhat-release:Red Hat Enterprise Linux Server release 6.3 (Santiago)<br> <br>파일 정보 <br>w3sli@ITHPSAP1 /app1/web/jboss-ews-2.1/httpd/sbin # ll /app1/web/jboss-ews-2.1/httpd/sbin/httpd.worker<br>-rwsr-x--- 1 root w3slibg 1274974 2015-11-05 23:49 /app1/web/jboss-ews-2.1/httpd/sbin/httpd.worker<br><br>Listen address 정보 (setuid 기동이라 PID/Program name 확인불가)<br>tcp        0      0 xx.xx.xx.xx:80           0.0.0.0:*                   LISTEN      -<br> <br>apachectl 기동 정보 <br>HTTPD='/app1/web/jboss-ews-2.1/httpd/sbin/httpd.worker -f /supp1/jbossews/all_domain/conf/all_domain.httpd.conf'<br> <br>config 내 Listen 정보 및 Virtual Host 내용<br># samsunglife.com<br>Listen xx.xx.xx.xx:80<br>Listen xx.xx.xx.xx:443<br>...<br>&lt;VirtualHost xx.xx.xx.xx:80&gt;<br>        ServerName tpcxxx.saxxxglixxe.com<br>        DocumentRoot /suxxx/xxx/xxxmain/pcyber<br>        DirectoryIndex index.html<br>        ErrorLog &quot;|/app1/web/jboss-ews-2.1/httpd/sbin/rotatelogs /supp1/log/web/all_domain/pcyber/error_pcyber_log_%Y_%m_%d 86400&quot;<br>        CustomLog &quot;/supp1/log/web/all_domain/pcyber/access_pcyber_01&quot; combined env=!NOT_LOG<br>        Include /supp1/jbossews/all_domain/conf/weblogic_pcyber.conf<br>        ErrorDocument 403 &quot;/pcyber/error/error01.html&quot;<br>        ErrorDocument 404 &quot;/pcyber/error/error02.html&quot;<br>&lt;/VirtualHost&gt;<br>##<br><br>또한 로컬 VM장비에 jws3.0.3에 대한 setuid 테스트로 동일하게 하기의 에러와 함께 정상실행이 안됨을 확인하였습니다 <br>/wasadm/jws3/httpd/sbin/httpd: error while loading shared libraries: libaprutil-jws3-1.so.0: cannot open shared object file: No such file or directory<br><br>참고하여 주시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2018-01-22T02:36:58Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LWSxtIAH"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-22T02:02:32Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-22T02:02:32Z</b><br><br>안녕하세요,<br> <br>업데이트 감사합니다. 현재 답변을 준비 중이며 오전까지 업데이트하도록 하겠습니다.<br><br> <br>감사합니다.<br><br><publishedDate>2018-01-22T02:02:32Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LWSthIAH"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-22T01:55:08Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-22T01:55:08Z</b><br><br>확인요청드립니다.<br><br><publishedDate>2018-01-22T01:55:08Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LN8iqIAD"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-17T07:16:50Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-17T07:16:49Z</b><br><br>안녕하세요,<br>  <br>Red Hat Global Support Service를 이용해주셔서 감사합니다.<br><br>담당 영업분께서 확인 중에 있습니다. 답변을 받는데로 업데이트 드리도록 하겠습니다.<br><br> <br>감사합니다.<br><br><publishedDate>2018-01-17T07:16:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LN8KjIAL"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-17T06:39:28Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-17T06:39:28Z</b><br><br>안녕하세요,<br>  <br>현재 확인 중에 있습니다. 확인 후 전화 드리겠습니다.<br> <br><br>감사합니다.<br><br><publishedDate>2018-01-17T06:39:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LN80AIAT"><br>======================<br><b>생성계정 : (주), 타임게이트</b><br><b>생성날짜 : 2018-01-17T06:08:41Z</b><br><b>마지막 답변자 : (주), 타임게이트</b><br><b>마지막 수정 일자 : 2018-01-17T06:08:41Z</b><br><br>안녕하세요 지난 2017년 12월 22일 SR 문의 시 확인하여 주신 내용입니다. <br><br>JBCS 및 JWS에 대한 subscription이 존재한다고 확인하여 진행하였는데 해당 서브스크립션이 없다는 것이 이해가 안갑니다. <br>빠른 확인 요청드립니다. <br><br><br>##<br>지난 SR : 기술 문의 01998899<br>##<br><br>## SR 일부 ##<br>Park, Min Woo 날짜: Dec 22 2017 시간: 03:50 PM +09:00<br>안녕하세요,  <br>  <br>Red Hat Global Support Services를 이용해주셔서 감사합니다.  <br><br>문의1. 현 삼성생명 subscription 상 EWS와 JBCS 둘중 어느 솔루션을 설치해도 관계가 없는지요?<br>==&gt;<br>JWS 3.x, JBCS Apache HTTP Server 모두 사용이 가능하십니다.<br>참고로, 케이스 생성에 사용하신 Account 01998899 에는 JBoss EAP, EWS subscription이 모두 존재합니다.<br>## 이하 생략 ##<br><br><publishedDate>2018-01-17T06:08:41Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LN7wIIAT"><br>======================<br><b>생성계정 : Won, Ted</b><br><b>생성날짜 : 2018-01-17T06:02:14Z</b><br><b>마지막 답변자 : Won, Ted</b><br><b>마지막 수정 일자 : 2018-01-17T06:02:14Z</b><br><br>안녕하세요,<br> <br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>요청하신 Red Hat JBoss Core Services (JBCS) Apache HTTP Server 지원을 위해서는 JBoss Middleware subscription 이 필요합니다. [1][2]<br>jbcs-httpd24-httpd-2.4.23-RHEL6-x86_64<br><br>~~~<br>Red Hat JBoss Core Services (JBCS) Apache HTTP Server provide specific version of httpd which is supported under JBoss Enterprise Application Platform (EAP) subscription.<br>~~~<br><br>CASE에 사용하신 Account 1648604에는 지원가능한 JBoss EAP 서브스크립션이 존재하지 않습니다.<br><br>서브스크립션 확인이 되어야 답변을 드릴 수 있으니 서브스크립션 확인 부탁드리겠습니다.<br> <br>서브스크립션 관련된 문의 사항은은 레드햇 Sales팀(080-708-0880) 또는 Customer Service팀(02-3490-5252)으로 연락하시기 바랍니다.<br><br>감사합니다.<br>Ted Won<br>Senior Software Maintenance Engineer<br>Red Hat Global Support Services<br><br><br>[1] https://access.redhat.com/articles/2294961<br>[2] https://access.redhat.com/collections/red-hat-jboss-core-services-collection<br><br><publishedDate>2018-01-17T06:02:14Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>