======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-08-30T01:56:52Z</b><br><b>마지막 답변자 : Ying Huang</b><br><b>마지막 수정 일자 : 2017-10-04T10:01:20Z</b><br><b>id : 500A000000Xz550IAB</b><br>======================<br><br><b><font size=15>
제목  : pcs 강제 리부팅으로 인한 lvm partial  관련
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하십니까 타임게이트 오선우입니다<br><br>8월 27일 08~09시경에  기술 문의 01919490 해당 이슈로 인하여 <br>블랙리스트 devnode 적용을 하던중에 <br>SLPIBADL01SL, SLPIBADL02SL  두 호스트를 클러스터가 on 되어 있는 상태에서<br>두장비를 shutdown 시키게 되었습니다<br><br>서버를 다시 부팅하여 PCS를  start --all을 진행하였지만 lvm이 partial이 나있는 상태로 <br>하기 두가지 작업으로 복구는 진행하였습니다<br># vgextend --restoremissing  VG이름  PV장치경로<br># pvscan --cache<br><br>여기서 몇가지 궁금한 사항이 있어서 분석 및 문의 드립니다<br><br>1.  해당 디스크가 partial 이 발생한 이유가 무엇인지요?<br><br>2.  vgextend --restoremissing  과 pvscan --cache 명령어로 처리를 하였는데 이렇게 하는 것이 맞는 조치였는지 확인 부탁드립니다<br><br>3.  기술 문의 케이스 01919490 를 적용 진행중이였기때문에 혹시 이것으로 해당 증상이 발생한것은 아닌지요 연관성이 있는지 확인 부탁드립니다<br><br>dropbox에 파일 첨부하였습니다<br>sosreport-SLPIBADL01SL-20170827????.tar.xz<br>sosreport-SLPIBADL02SL-20170827????.tar.xz<br><br>분석하시는데 더 필요하신 부분이나 궁금하신 부분 있으시면 연락(010-4630-3171) 부탁드립니다<br><br>감사합니다<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPIBADL01SL, SLPIBADL02SL</hostname><br><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-09-18T06:29:43Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-09-18T06:29:38Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>확인시 말씀한 작업중 tagging 작업은 pacemaker가 진행한 것이고 vgchange 명령어는 부팅시 아래와 같은 unit가<br>실행한것으로 확인됩니다.<br>    _CMDLINE=/usr/sbin/lvm vgchange -aay --ignoreskippedcluster<br>    _SYSTEMD_CGROUP=/system.slice/lvm2-activation-early.service<br>    _SYSTEMD_UNIT=lvm2-activation-early.service<br><br>해당 이슈에 관하여 로그가 없어 추가적인 분석이 어려우나 아래와 같은 racing 이슈로 VG가 partial mode에<br>진입하는 버그가 확인 되었습니다.<br>LVM2 volume group in partial mode whenever the node gets fence or reboot occur<br>https://access.redhat.com/solutions/3120531<br><br>가능하시면 업그레이드 작업 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-09-18T06:29:38Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KWvLWIA1"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-09-15T10:22:56Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-09-15T10:22:56Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>pcs 강제 리부팅으로 인한 lvm partial  관련 case 관련해서 시간대 별 수행한 내역은 아래와 같았는데요.<br><br> - pcs start 되어있는 정상 상태(SLPIBADL01/SLPIBADL02)<br> - 2017/8/27 12:33 SLPIBADL02 서버 init6 수행<br> - 2017/8/27 12:34 SLPIBADL01 서버 init6 수행<br><br>해당 시간 대 vgcfgrestore list를 확인해보면 아래와 같은 부분이 있어서 해당 부분이 pacemaker를 통해서 동작한 것 처럼 보여서 추가 문의드리려고 합니다.<br><br>root@SLPIBADL02 / # vgcfgrestore --list SRPIBADATVG<br>=== 생략 ===<br>  File:         /etc/lvm/archive/SRPIBADATVG_00037-965081144.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange -aay --ignoreskippedcluster'<br>  Backup Time:  Sun Aug 27 12:38:25 2017<br>  File:         /etc/lvm/archive/SRPIBADATVG_00038-1801426534.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange -aay --ignoreskippedcluster'<br>  Backup Time:  Sun Aug 27 12:38:25 2017<br>=== 생략 ===<br><br>root@SLPIBADL01 /root # vgcfgrestore --list SRPIBADATVG<br>=== 생략 ===<br>  File:         /etc/lvm/archive/SRPIBADATVG_00043-2044823857.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange --deltag pacemaker SRPIBADATVG'<br>  Backup Time:  Sun Aug 27 12:34:24 2017<br>  File:         /etc/lvm/archive/SRPIBADATVG_00044-734905806.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange -aay --ignoreskippedcluster'<br>  Backup Time:  Sun Aug 27 12:39:04 2017<br>  File:         /etc/lvm/archive/SRPIBADATVG_00045-1069907603.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange -aay --ignoreskippedcluster'<br>  Backup Time:  Sun Aug 27 12:39:04 2017<br>  File:         /etc/lvm/archive/SRPIBADATVG_00046-313063702.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange --addtag pacemaker SRPIBADATVG'<br>  Backup Time:  Sun Aug 27 12:40:53 2017<br>  File:         /etc/lvm/archive/SRPIBADATVG_00047-1394150736.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgchange --deltag pacemaker SRPIBADATVG'<br>  Backup Time:  Sun Aug 27 12:40:54 2017<br>  File:         /etc/lvm/archive/SRPIBADATVG_00048-774947468.vg<br>  VG name:      SRPIBADATVG<br>  Description:  Created *before* executing 'vgscan'<br>  Backup Time:  Sun Aug 27 12:42:56 2017<br>=== 생략 ===<br><br><br>root@SLPIBADL02 / # history | grep -i init<br>  967  2017-08-24 [17:39:1503563955]cp /boot/initramfs-3.10.0-327.53.1.el7.x86_64.img /boot/initramfs-3.10.0-327.53.1.el7.x86_64.img_$(date +%y%m%d)<br>  996  2017-08-27 [12:33:1503804812]init 6<br> 1106  2017-08-27 [15:31:1503815466]history | grep -i init<br><br>root@SLPIBADL01 /root # history | grep -i init<br>  461  2017-08-24 [17:38:1503563936]cp /boot/initramfs-3.10.0-327.53.1.el7.x86_64.img /boot/initramfs-3.10.0-327.53.1.el7.x86_64.img_$(date +%y%m%d)<br>  621  2017-08-27 [12:34:1503804862]init 6<br>  841  2017-08-27 [14:36:1503812210]init 6<br>  941  2017-08-27 [15:05:1503813941]history | grep -i init<br> 1001  2017-08-27 [15:30:1503815445]history | grep -i init<br><br><publishedDate>2017-09-15T10:22:56Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KHJnfIAH"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-08-31T03:22:49Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-08-31T03:22:49Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>lvm 로그 확인시 Aug 27 12:34:24 시점 SRPIBADATVG의 pv DAT100G003가 missing되어 발생된 이슈입니다.<br>현 상황은 이슈 발생시 상황은 아니지만 만일 아래와 같은 경우 blacklist 설정이 있어도 DAT100G003 디바이스를<br>정상적으로 사용하실수 있으십니다.<br><br>DAT100G003 (360060e8007c809000030c80900000ba9) dm-5 HITACHI ,OPEN-V<br>size=100G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 1:0:0:8 sdj  8:144  active ready running<br>  |- 1:0:1:8 sdad 65:208 active ready running<br>  |- 4:0:0:8 sdac 65:192 active ready running<br>  `- 4:0:1:8 sdan 66:112 active ready running<br><br>현재로는 로그가 존재하지 않아 해당 시점 어떤 이슈가 발생 되었는지 확인하기 어려워 원인 분석이 어렵습니다.<br>기존사례에 의하면 해당 이슈는 일시적으로 스토리지와의 연결이 끊겨 발생 되었을 가능성이 있습니다.<br><br>감사합니다.<br><br><publishedDate>2017-08-31T03:22:49Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KH6p9IAD"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-08-30T08:45:20Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-08-30T08:45:20Z</b><br><br>답변 감사합니다<br>우선 시간은 8시에 작업을 시작해서 오후 2시에 시스템을 올린것이 맞다는 담당자와 확인하였습니다<br>혼선을 드려 죄송합니다<br><br>클러스터가 on되어 있는 상태에서 양쪽을 shutdown 하였고  오후 2시 이후에 서버가 부팅되어 클러스터를 start 하였을때 정상적으로 올라오지 않는 증상이 있었습니다 원인이 무엇인지 확인 부탁드립니다<br><br>감사합니다<br><br><publishedDate>2017-08-30T08:45:20Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KH6LAIA1"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-08-30T08:09:52Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-08-30T08:09:52Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>2.  vgextend --restoremissing  과 pvscan --cache 명령어로 처리를 하였는데 이렇게 하는 것이 맞는 조치였는지 확인 부탁드립니다<br><br>만일 서버에서 일부 PV가 알수 없는 원인으로 인식이 되지 않고 원래 VG에 속해 있던 PV를 알고 있는 상황이시다면<br>아래의 문서에 따라 복구 작업을 진행하실수 있으십니다.<br>How do I restore a volume group in Red Hat Enterprise Linux if one of the physical volumes that constitutes the volume group has failed?<br>https://access.redhat.com/solutions/3334<br><br>감사합니다.<br><br><publishedDate>2017-08-30T08:09:52Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KH6FnIAL"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-08-30T08:01:46Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-08-30T08:01:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>해당 두 서버에서 rsyslog가 정상적으로 실행이 되지 않아 작업 실행시 로그가 확인이 되지 않습니다.<br>8월 27일 오후 2시 이후의 로그에 의하면 아래와 같은 에러가 확인됩니다.<br><br>Aug 27 14:59:11 SLPIBADL02 Filesystem(LV_oradata_PIBA)[94239]: WARNING: Couldn't find device [/dev/mapper/SRPIBADATVG-oradata_PIBA]. Expected /dev/??? to exist<br><br>상기 출력 결과에 의하면 SRPIBADATVG VG가 인식이 되지 않고 있으며 이는 리소스 initiate시<br>발생되는 로그입니다.<br>다만 이는 앞서 실행된 blacklist 멀티패스 설정 이슈가 아닌것으로 확인됩니다.<br>이는 SRPIBADATVG에 속해 있는 멀티패스 디바이스는 sda*로 시작되는 패스외에 다른 패스도<br>포함하고 있기 때문입니다.<br><br>DAT100G001 (360060e8007c809000030c80900000ba7) dm-0 HITACHI ,OPEN-V<br>size=100G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 1:0:0:6 sdh  8:112  active ready running<br>  |- 1:0:1:6 sdy  65:128 active ready running<br>  |- 4:0:0:6 sdx  65:112 active ready running<br>  `- 4:0:1:6 sdal 66:80  active ready running<br>DAT100G002 (360060e8007c809000030c80900000ba8) dm-1 HITACHI ,OPEN-V<br>size=100G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 1:0:0:7 sdi  8:128  active ready running<br>  |- 1:0:1:7 sdaa 65:160 active ready running<br>  |- 4:0:0:7 sdz  65:144 active ready running<br>  `- 4:0:1:7 sdam 66:96  active ready running<br>DAT100G003 (360060e8007c809000030c80900000ba9) dm-3 HITACHI ,OPEN-V<br>size=100G features='1 queue_if_no_path' hwhandler='0' wp=rw<br>`-+- policy='service-time 0' prio=1 status=active<br>  |- 1:0:0:8 sdj  8:144  active ready running<br>  |- 1:0:1:8 sdac 65:192 active ready running<br>  |- 4:0:0:8 sdab 65:176 active ready running<br>  `- 4:0:1:8 sdan 66:112 active ready running<br><br>현재 /dev/SRPIBADATVG/oradata_PIBA 파일시스템이 SLPIBADL01에 정상적으로<br>마운트되어 사용중인것으로 보입니다.<br><br>Aug 27 14:59:41 SLPIBADL01 Filesystem(LV_oradata_PIBA)[14681]: INFO: Running start for /dev/mapper/SRPIBADATVG-oradata_PIBA on /oradata_PIBA<br><br>따라서 이슈 발생시 어떤 원인으로 파일시스템이 정상적으로 사용할수 없는지를<br>확인할수 없는 상황입니다.<br><br>rsyslog가 로그를 기록하지 않는 이슈는 rsyslog의 버그로 확인되며<br>아래의 문서에 따라 rsyslog 버전을 rsyslog-8.24.0-12.el7 으로<br>올리셔야 합니다.<br><br>참고문서:<br>imjournal: fscanf on state file `/var/lib/rsyslog/imjournal.state' failed<br>https://access.redhat.com/solutions/1599223<br><br>감사합니다.<br><br><publishedDate>2017-08-30T08:01:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KH4q1IAD"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-08-30T05:40:49Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-08-30T05:40:49Z</b><br><br>파일명 다시한번 보내드립니다<br><br>다시 한번 확인 부탁드립니다<br><br>sosreport-SLPIBADL01-20170827150312.tar.xz<br>sosreport-SLPIBADL01-20170827150312.tar.xz.md5<br>sosreport-SLPIBADL02-20170827150344.tar.xz<br>sosreport-SLPIBADL02-20170827150344.tar.xz.md5<br><br>케이스 01919490 로 인해 이 서버(SLPBADL01,SLPBADL02)에도 적용을 하려다 발생한 이슈입니다<br><br>기술 문의 케이스 01919490 를 적용 진행중이였기때문에 혹시 이것으로 해당 증상이 발생한것은 아닌지요 연관성이 있는지 확인 부탁드립니다<br><br><publishedDate>2017-08-30T05:40:49Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000KH404IAD"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-08-30T02:47:36Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-08-30T02:47:35Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>원인 분석에는 로그 분석이 필요합니다. 다만 dropbox에 아래와 같은<br>파일들이 존재하지 않으며 케이스 01919490에 업로드된 sosreport는<br>다른 서버에서 수집된 것으로 확인됩니다.<br><br>sosreport-SLPIBADL01SL-20170827????.tar.xz<br>sosreport-SLPIBADL02SL-20170827????.tar.xz<br><br>파일이 정상적으로 업로드 되었는지 확인 부탁 드립니다.<br><br>감사합니다.<br><br><publishedDate>2017-08-30T02:47:35Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>