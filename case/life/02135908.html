======================<br><b>생성계정 : HyunYick Park</b><br><b>생성날짜 : 2018-07-06T08:17:18Z</b><br><b>마지막 답변자 : HyunYick Park</b><br><b>마지막 수정 일자 : 2018-07-24T06:02:35Z</b><br><b>id : 500A000000bBFbWIAW</b><br>======================<br><br><b><font size=15>
제목  : scsi_fence 테스트 방법이 맞는지 확인해주세요
</font></b><br><br>======================<br><b>사전문의<br></b><br>아래의 cluster.conf 설정에서보면 scsi fence를 사용중인데요.<br>현재 fence-agents 낮은 버전이 간혹 패닉 이슈가 있다는 이야기를 들어서 최신 버전 fence-agents-4.0.15-13.el6_9.2.x86_64 로 업데이트를 계획중입니다. GFS관련 이슈로 보여서 업데이트를 진행하지 않아도 될것으로 판단되는데 맞는지요?<br>https://access.redhat.com/solutions/290333<br><br>1. 최신 버전 업데이트 후에 기존 fence_scsi_check.pl삭제<br><br>2. ln -s /usr/share/cluster/fence_scsi_check_hardreboot.pl /etc/watchdog.d/<br><br>3. kernel.watchdog = 1 설정<br><br>4. service watchdog start <br><br>5. 펜싱테스트<br>ex) fence_node [node명]<br><br>으로 진행하면 될까요??<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Feature / Enhancement Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000NHkDIIA1"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-24T06:02:34Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-24T06:02:34Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service를 이용해 주셔서 감사합니다.<br><br>해당 케이스를 close 처리해주셔서 감사합니다.<br>케이스가 처리 완료되면 고객 설문조사 메일이 발송됩니다.<br>고객님께서 남기신 의견은 보다 나은 서비스를 위해 지속적으로 반영될 것입니다.<br>향후 기술 지원 서비스의 품질 향상을 위해, 소중한 시간을 내어 주시면 대단히 감사드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-07-24T06:02:34Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCbA6IAL"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-19T04:42:58Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-19T04:42:57Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>아래의 명령어를 통하여 정상적으로 설정이 되어있는지 확인하실 수 있습니다.<br><br>1. 장치의 소유자 목록 조회 명령어 입니다.<br> # sg_persist -n -i -r -d /dev/mapper/mpathX<br><br>2. 등록된 장치에 대한 키값 목록 조회 명령어 입니다. 장치가 가진 PATH 의 개수 만큼 key 값이 표기되어야 합니다.<br> # sg_persist -n -i -k -d /dev/mapper/mpathX<br><br>위의 명령어로 조회시 reservation 또는 registration 이 존재하지 않는다면 정상적으로 unfencing 될 수 없습니다.<br>좀 더 자세한 정보는 아래의 KCS 에서 확인 하실 수 있습니다.<br><br>&quot;Using SCSI Persistent Reservation Fencing (fence_scsi) with pacemaker in a RHEL 6 or 7 High Availability cluster&quot;<br>https://access.redhat.com/articles/530533<br><br>감사합니다.<br><br><publishedDate>2018-07-19T04:42:57Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NCJoTIAX"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-18T06:51:38Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-18T06:51:38Z</b><br><br>답변 감사합니다.<br>ence_scsi.key, fence_scsi.dev 가 등록이 되었는지 확을 위해서 아래와 같은 명령어로 확인이 가능할까요??<br>sg_persist --in --read-keys --device=[장치명]<br><br>감사합니다.<br><br><publishedDate>2018-07-18T06:51:38Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NA7a5IAD"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-07T02:27:42Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-07T02:27:42Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>문의하신 kernel.watchdog = 1 설정은 scsi_fence 설정시 요구사항이 아닙니다.<br>아래는 이미 알고 계시겠지만 RHEL 6 에서 scsi_fence 설정 하는 방법입니다.<br><br>1. watchdog 패키지를 설치합니다.<br> <br> # yum -y install watchdog<br><br><br>2. 아래의 두 스크립트 중 하나를 /etc/watchdog.d/ 디렉토리에 link 합니다. fence_scsi_check_hardreboot.pl 파일은 &quot;hard&quot; reboot을 제공하는 스크립트 파일이며 fecne_agents-3.1.5-48.el6 버전 부터 제공 됩니다.<br>KCS 에 따르면 fence_scsi_check_hardreboot.pl 이 좀 더 안정적일 것으로 보입니다.<br> <br> # ln -s /usr/share/cluster/fence_scsi_check.pl /etc/watchdog.d/<br> # ln -s /usr/share/cluster/fence_scsi_check_hardreboot.pl /etc/watchdog.d/     &lt;== 권장 설정입니다.<br><br>3. watchdog service 를 시작합니다.<br><br> # chkconfig watchdog on<br> # service watchdog start<br><br>4. cman service 를 재시작 합니다. <br><br> # service cman start<br><br>성공적인 unfencing 을 위해서 노드는 적절한 장치와 함께 register 되어야 합니다.<br>local 노드의 key는 fence_scsi.key 파일에 반드시 저장되며, 정상적으로 register 된 장치 리스트는 fence_scsi.dev 에 저장됩니다.<br>만약 위의 두 파일 (fence_scsi.key, fence_scsi.dev) 이 존재하지 않거나 비어있다면, fence_scsi_check 스크립트가 종료되고 reboot 이 발생할 수 없게 됩니다.<br><br><br>5. 클러스터 노드가 fence_scsi 로부터 성공적으로 fenced 될 때, fence_scsi_check.pl 또는 fence_scsi_check_hardreboot.pl 스크립트는 reboot 을 발생시키는 역할을 합니다.<br>정상적으로 fence 가 되는지 테스트 해보기 위해서는 아래의 명령어를 사용할 수 있습니다.<br> # fence_node &lt;nodename&gt;<br><br>다음은 도움이 되실만한 추가 설명과 KCS 입니다.<br><br> - watchdog 패키지는 시스템 자원을 주기적으로 모니터링하는 timer service 입니다. fence agent 는 watchdog service 와  fence_scsi 를 이용하여 노드를 fencing 합니다.<br> - watchdog 스크립트(fence_scsi_check) 의 목적은 fence_scsi 로 부터 fenced 될 때 노드 스스로 reboot 되게 하는 것입니다.<br><br>&quot;Is there a watchdog script for fence_scsi to reboot a RHEL High Availability or Resilient Storage cluster node?&quot;<br>https://access.redhat.com/solutions/65187<br><br>감사합니다.<br><br><publishedDate>2018-07-07T02:27:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>