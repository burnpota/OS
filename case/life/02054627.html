======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-03-14T01:25:02Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-03-30T10:07:13Z</b><br><b>id : 500A000000a8237IAA</b><br>======================<br><br><b><font size=15>
제목  : Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요. <br>3대의 서버에서 동일하게 <br>Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>에러메세지가 발생하고 있습니다.<br>해당 파일시스템을 umount후 xfs_repair 을하여 현재는 발생하고 있는 않는데요.<br><br>총 5대중 3대에만 발생하였고<br>담당자가<br>3대는 lvm생성 후 파일시스템을 만들고 나서 잘못만들어 vgremove&gt;pvremove 로 제거를 한 후 다시 볼륨을 생성하였고<br>2대는 lvremove&gt;vgremove&gt;pvremove를 한 후 볼륨을 다시 생성하였다고 합니다.<br><br>Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>에러가 발생하는 원인이 3대는 lvremove를 하지 않아서 발생한것과 관계가 있는지 확인 부탁드립니다.<br><br>감사합니다.<br><br>==============================================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 김경희 (선임)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  +82-10-3049-1440 <br>- 메일주소 : 김경희 &lt;khsds.kim@samsung.com&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 송기호(책임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 01036209917<br>- 메일주소 : kh.song@time-gate.com<br>==============================================================================<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPCHTAL</hostname><br><br><br><comment id="a0aA000000KtRNDIA3"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-03-15T05:02:33Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-03-15T05:02:33Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>XFS 파일시스템으로 포맷한 블록장치는 아래와 같은 내용으로 보실 수 있습니다. 출력 내용 오른쪽에 XFS 라는 문자열이 나타납니다.<br><br># hexdump -C /dev/vgname/lvname | head<br>00000000  58 46 53 42 00 00 10 00  00 00 00 00 00 50 00 00  |XFSB.........P..|<br>00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|<br>00000020  5c 16 5e f3 77 df 4b 2f  88 37 82 4b 9c 39 b7 98  |\.^.w.K/.7.K.9..|<br>00000030  00 00 00 00 00 40 00 04  00 00 00 00 00 00 00 40  |.....@.........@|<br>00000040  00 00 00 00 00 00 00 41  00 00 00 00 00 00 00 42  |.......A.......B|<br>00000050  00 00 00 01 00 14 00 00  00 00 00 04 00 00 00 00  |................|<br>00000060  00 00 0a 00 b4 a5 02 00  02 00 00 08 00 00 00 00  |................|<br>00000070  00 00 00 00 00 00 00 00  0c 09 09 03 15 00 00 19  |................|<br>00000080  00 00 00 00 00 00 00 40  00 00 00 00 00 00 00 3d  |.......@.......=|<br>00000090  00 00 00 00 00 4f f5 e8  00 00 00 00 00 00 00 00  |.....O..........|<br><br>말씀하신 방법으로 지워지기는 하지만, 1 MiB 만큼이 메타데이터로 사용됩니다.<br><br>512 * 2048 = 1048576 byte = 1 MiB<br>      ~~~~<br><br>아래와 같이 count를 2048로 늘여서 명령을 수행하시면 해당 블록장치에 기록된 xfs 파일시스템의 메타데이터가 0으로 채워지게 됩니다.<br><br>dd if=/dev/zero of=[블락장치명] bs=512 count=2048<br><br>고맙습니다.<br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><br>(In reply to 타임게이트, 타임게이트)<br>&gt; 답변감사합니다.<br>&gt; 해당 내용관련해서 <br>&gt; 가상에서 재현해본 결과<br>&gt; 디바이스를 정상적으로 포멧하지 않은 상태에서 재사용하면 이와같은 현상을 발생하는것으로 판단됩니다.<br>&gt; <br>&gt; 디바이스를 재상용하기위해서는 포멧을 권장하지만<br>&gt; 포멧을 하지 않고 디바이스를 사용하기 위해서<br>&gt; dd if=/dev/zero of=[블락장치명] bs=512 count=20<br>&gt; 하면 metadata가 모두 삭제 될까요?<br>&gt; <br>&gt; 답변 부탁드립니다.<br><br><publishedDate>2018-03-15T05:02:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000KtAmCIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-03-14T09:21:10Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-03-14T09:21:10Z</b><br><br>답변감사합니다.<br>해당 내용관련해서 <br>가상에서 재현해본 결과<br>디바이스를 정상적으로 포멧하지 않은 상태에서 재사용하면 이와같은 현상을 발생하는것으로 판단됩니다.<br><br>디바이스를 재상용하기위해서는 포멧을 권장하지만<br>포멧을 하지 않고 디바이스를 사용하기 위해서<br>dd if=/dev/zero of=[블락장치명] bs=512 count=20<br>하면 metadata가 모두 삭제 될까요?<br><br>답변 부탁드립니다.<br><br><publishedDate>2018-03-14T09:21:10Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Kt9R3IAJ"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-03-14T07:48:55Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-03-14T07:48:55Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>3대 시스템 모두 아래와 같이 동일한 로그 패턴을 보이고 있는 것을 확인하였습니다.<br>로그에 나와 있는데로 메타데이터 버퍼의 데이터가 아무것도 없는 것을 알 수 있습니다. <br><br>Mar 13 10:20:49 SLPCHTAL02 kernel: XFS (dm-4): Metadata CRC error detected at xfs_agi_read_verify+0x5e/0x110 [xfs], xfs_agi block 0x2<br>Mar 13 10:20:49 SLPCHTAL02 kernel: XFS (dm-4): Unmount and run xfs_repair<br>Mar 13 10:20:49 SLPCHTAL02 kernel: XFS (dm-4): First 64 bytes of corrupted metadata buffer:<br>Mar 13 10:20:49 SLPCHTAL02 kernel: ffff88072bfb2200: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Mar 13 10:20:49 SLPCHTAL02 kernel: ffff88072bfb2210: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Mar 13 10:20:49 SLPCHTAL02 kernel: ffff88072bfb2220: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br>Mar 13 10:20:49 SLPCHTAL02 kernel: ffff88072bfb2230: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................<br><br>아마도 vgremove, pvremove 과정에서 xfs 파일시스템의 메타데이터가 있던 부분이 지워졌을 것으로 생각됩니다.<br><br>작업하신 내용을 좀 더 상세히 알려주시면 확인에 도움이 될 것 같습니다. 알려주신 내용으로는 이 부분을 명쾌하게 알 수 없습니다.<br><br>&gt; 3대는 lvm생성 후 파일시스템을 만들고 나서 잘못만들어 vgremove&gt;pvremove 로 제거를 한 후 다시 볼륨을 생성하였고<br><br>lvm이 생성된 상태에서 파일시스템을 만들고 vgremove, pvremove로 제거 하셨다고 했는데, vgremove 명령을 내리게 되면 그 안에 속해있는 lv도 제거할 것인지 묻게되어 있습니다. 만약 lv를 제거하지 않으면 vg와 pv도 정상적으로 제거되지 않습니다. vg와 pv가 제거된지를 확인하셨었나요?<br><br>lvm을 생성하였을 때 생성한 lvm에 파일시스템을 생성한 것인지 아니면 lvm을 생성했던 파티션에 파일시스템을 생성한 것인지가 명확하지 않습니다.<br>다시 볼륨을 생성했다는 것은 lv를 의미하시는 것인가요? 아니면 pv를 생성했던 block device에 xfs 파일시스템을 했다는 뜻인가요? <br><br>&gt; 2대는 lvremove&gt;vgremove&gt;pvremove를 한 후 볼륨을 다시 생성하였다고 합니다.<br><br>문제가 발생하지 않은 시스템에서는 파일시스템을 어디에 생성하신 것인가요?<br>pvremove된 block device 인지 아니면 lv를 다시 만들어서 lv에 생성한 것인지가 명확하지 않습니다.<br><br>작업하신 내용을 좀 더 상세히 알려주시기 바랍니다.<br><br>고맙습니다.<br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-03-14T07:48:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000Kt7PXIAZ"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-03-14T05:04:33Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-03-14T05:04:33Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br>Red Hat 기술지원 서비스를 이용해 주셔서 감사합니다.<br><br>문의하신 내용에 대해서 확인한 후 업데이트 드리겠습니다.<br><br>고맙습니다.<br>허 경 드림.<br><br>Regards,<br>Kyung Huh<br>Sr. Technical Account Manager<br>Customer Experience &amp; Engagement<br><br><publishedDate>2018-03-14T05:04:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>