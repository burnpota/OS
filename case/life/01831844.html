======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-04-17T01:53:53Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2017-05-05T10:05:51Z</b><br><b>id : 500A000000Wmsr9IAB</b><br>======================<br><br><b><font size=15>
제목  : [장애]시스템 hang 이슈
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>시스템 2대에서 hang 상태가 발생하여서 시스템 분석 부탁드립니다.<br>coredump 생성을 위해서 vmware 콘솔에서 매직키를 사용하였지만 실행이 안되었습니다. <br>kernel.sysrq = 1 상태였으며 Alt+PrintScreen+c 또는 Alt + SysRq + C 를 시도했습니다. <br>sosreport 첨부합니다.감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.4</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000JJcQyIAL"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-04-20T02:10:43Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-04-20T02:10:43Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>&gt; oom이 발생시  [Alt + PrintScreen + c] 를 시도 하였으나 정상적으로 vmcore 발생하지 않았습니다.<br>&gt; 이와 같은 방법이 가상 물리 상관없이 되어야 하는것이 맞나요??<br><br>매직키는 키보드가 사용가능할 경우 가상, 물리 서버 상관없이 vmcore 수집이 됩니다.<br>다만 키보드가 먹히지 않을 경우가 있는데 해당 경우에는 관련 커널 파라미터(vm.panic_on_oom)를 추가하셔서<br>이슈 발생시 서버가 강제로 패닉되어 vmcore 수집을 진행하실수 있으십니다.<br><br>&gt; 만약 위의 방법이 되지 않는다면, 말씀하신데로 vm호스트에서 강제 vmcore를 발생하면 되는건가요??<br>네, 맞습니다.<br><br>감사합니다.<br><br><publishedDate>2017-04-20T02:10:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JJPFkIAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-04-19T07:44:44Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-04-19T07:44:44Z</b><br><br>답변감사합니다.<br>oom이 발생시  [Alt + PrintScreen + c] 를 시도 하였으나 정상적으로 vmcore 발생하지 않았습니다.<br>이와 같은 방법이 가상 물리 상관없이 되어야 하는것이 맞나요??<br><br>만약 위의 방법이 되지 않는다면, 말씀하신데로 vm호스트에서 강제 vmcore를 발생하면 되는건가요??<br><br><publishedDate>2017-04-19T07:44:44Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JJMR3IAP"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-04-19T01:34:31Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-04-19T01:34:30Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>만일 guest VM을 text 콘솔 모드에서 사용하셨다면 매직키 [Alt + PrintScreen + c]으로 vmcore 수집이<br>가능한걸로 알고 있습니다. 혹시 해당 서버들에서 vmcore 생성 테스트를 진행해 보셨는지요? 테스트시 매직키로<br>vmcore 수집이 가능하신지요? 확인 부탁 드립니다.<br><br>참고문서:<br>What is the key combination for triggering SysRq to force a manual crash of a Red Hat Enterprise Linux Guest running over VMware Hypervisor?<br>https://access.redhat.com/solutions/427373<br><br>out of memory 이슈는 현재 행업이 발생될 때 vmcore가 수집되지 않아 이슈 발생시 어떤 프로세스가 많은 메모리를 사용하였는지를 확인할수 없어<br>추가적인 분석이 어려운 상황입니다.<br><br>서버 IDETSWB1에서는 행 이슈 발생전 out of memory 로그가 기록되었지만 더 자세한 정보는 확인이 되지 않습니다.<br>Apr 16 13:21:54 IDETSWB1 kernel: java invoked oom-killer: gfp_mask=0x200da, order=0, oom_adj=0, oom_score_adj=0<br>Apr 16 13:21:54 IDETSWB1 kernel: java cpuset=/ mems_allowed=0<br>Apr 16 13:21:54 IDETSWB1 kernel: Pid: 5820, comm: java Tainted: P           --------------- H  2.6.32-358.18.1.el6.x86_64 #1<br>Apr 16 13:21:54 IDETSWB1 kernel: Call Trace:<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff810cb641&gt;] ? cpuset_print_task_mems_allowed+0x91/0xb0<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff8111ce40&gt;] ? dump_header+0x90/0x1b0<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff8121d49c&gt;] ? security_real_capable_noaudit+0x3c/0x70<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff8111d2c2&gt;] ? oom_kill_process+0x82/0x2a0<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff8111d201&gt;] ? select_bad_process+0xe1/0x120<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff8111d700&gt;] ? out_of_memory+0x220/0x3c0<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff8112c3ac&gt;] ? __alloc_pages_nodemask+0x8ac/0x8d0<br>Apr 16 13:21:54 IDETSWB1 kernel: [&lt;ffffffff81160d3a&gt;] ? alloc_pages_vma+0x9a/0xApr 16 13:43:46 IDETSWB1 kernel: imklog 5.8.10, log source = /proc/kmsg started.<br>Apr 16 13:43:46 IDETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;2414&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br><br>다만 해당 서버에서 아래와 같은 메시지가 지속적으로 로깅되는것으로 확인되는데 정상적인지 확인해 보시기 바랍니다.<br>Apr 13 06:44:48 IDETSWB1 [19618]: 13-Apr-2017 06.44.48 KST pid = 19618 Warning: Could not obtain lock on /APP/pkg/Webgate_instances/apache/INST01/webgate/config/polltracking.lck<br><br><br>또한 서버 IBETSWB1에서는 정상적인 리부팅 작업만 확인이 되며 행 이슈가 확인이 되지 않고 있습니다.<br>Jul 16 09:51:22 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;1977&quot; x-info=&quot;http://www.rsyslog.com&quot;] exiting on signal 15.<br>Jul 16 09:51:45 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;1973&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>Nov  6 10:51:04 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;1973&quot; x-info=&quot;http://www.rsyslog.com&quot;] exiting on signal 15.<br>Nov  6 11:40:31 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;1980&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>Mar 12 10:04:49 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;1980&quot; x-info=&quot;http://www.rsyslog.com&quot;] exiting on signal 15.<br>Mar 12 11:52:44 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;2165&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br>Apr 16 11:38:32 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;2165&quot; x-info=&quot;http://www.rsyslog.com&quot;] exiting on signal 15.<br>Apr 16 11:38:50 IBETSWB1 rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.10&quot; x-pid=&quot;2052&quot; x-info=&quot;http://www.rsyslog.com&quot;] start<br><br><br>감사합니다.<br><br><publishedDate>2017-04-19T01:34:30Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JJ6VBIA1"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-04-18T04:24:48Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-04-18T04:24:48Z</b><br><br>안녕하세요.<br>그러면 vmware 게스트일 경우는 매직키가 설정되어있더라도<br>사용이 불가능한것인가요??<br><br>꼭 vmExi 호스트에서 core를 발생시키는 작업을 해야 하는것인가요??<br><br>outofmemory 가 왜 발생 한것인지도 확인 부탁드립니다.<br><br><publishedDate>2017-04-18T04:24:48Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JIuMTIA1"><br>======================<br><b>생성계정 : Huang, Ying</b><br><b>생성날짜 : 2017-04-17T05:46:21Z</b><br><b>마지막 답변자 : Huang, Ying</b><br><b>마지막 수정 일자 : 2017-04-17T05:46:21Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해 주셔서 감사합니다.<br><br>vmware위에 있는 게스트일 경우 vmss2core 툴로 vmcore 수집이 가능한것으로 알고 있습니다.<br>상세한 정보는 아래의 문서를 참고하시기 바랍니다.<br><br>How to capture a vmcore of hung Red Hat Enterprise Linux VMware® guest system using VMware® &quot;vmss2core&quot; tool ?<br>https://access.redhat.com/solutions/411653<br><br>만일 oom 이슈를 분석하시려면 커널 파라미터 vm.panic_on_oom 를 1로 설정하셔서<br>이슈 발생시 vmcore를 자동으로 수집하실수 있으십니다.<br><br># cat /etc/sysctl.conf<br>vm.panic_on_oom = 1<br><br># sysctl -p<br><br>감사합니다.<br><br><publishedDate>2017-04-17T05:46:21Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JItNQIA1"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-04-17T02:31:21Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-04-17T02:31:21Z</b><br><br>추가내용첨부드립니다.<br>OS콘솔상에서 out of memory가 발생해서 행업이 발생한 상황에서<br>매직키를 실행하였고 정상적으로 core 발생되지 않았습니다.<br><br>만약 위와같은 상황에서는 어떠한 방법으로 core 파일을 발생하는것이 가장 권장방안인지 알고 싶습니다.<br><br><publishedDate>2017-04-17T02:31:21Z</publishedDate><createdByType>Customer</createdByType><br>======================<br></comments><br>