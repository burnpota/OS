======================<br><b>생성계정 : 타임게이트 (주)</b><br><b>생성날짜 : 2017-11-28T06:47:39Z</b><br><b>마지막 답변자 : 타임게이트 (주)</b><br><b>마지막 수정 일자 : 2017-11-30T02:10:32Z</b><br><b>id : 500A000000Z4F6uIAF</b><br>======================<br><br><b><font size=15>
제목  : [삼성생명] 번들 http server (70007), (70008), (70014) 이슈 문의2  (SAP netweaver 연동)
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br>삼생생명 차세대 ERP 관련 이슈에 대하여 하기와 같이 문의가 요청되어 SR 생성드립니다. <br><br>## 고객정보 ##<br>고객사 : 삼성생명<br>고객명 : 박현우 선임<br>연락처 : 010-9104-2853<br>##<br><br>## 환경 ##<br>-OS : RHEL7<br>-WEB : 번들 HTTP<br>rpm -qf /usr/sbin/httpd<br>httpd-2.4.6-40.el7.x86_64<br>-WAS : SAP netweaver 7.x<br><br>##  협력사정보 ##<br>회사명 : 타임게이트<br>담당자 : 안상훈 책임<br>연락처 : 010-3957-1209<br>##<br><br>## 지난 SR 정보 ##<br>기술 문의 01974863<br>##<br><br>## 문의사항 ##<br>보내주신 답변의 내용은 <br>    - WEB에서 WAS로 Data를 요청하는 경우<br>      RequestReadTimeout(Defaul 20초) 안에 Data가 전송되지 못하는 경우<br>      http 400의 결과로 timeout이 발생한다는 것으로 이해가 됩니다.<br> <br>이런 가정하에 Test를 진행하였습니다.<br>    - 시나리오는 WAS쪽에 Test 페이지를 설정하고 로그 확인<br>       * Test 페이지 : 540초 동안 Web서버 요청에 대해 응답 대기하도록 구현<br> <br>답변의 내용으로 유추한 것은<br>540초 동안 응답대기하는 Test 페이지를 호출하는 경우에는<br>위의 답변에 따라 RequestReadTimeout(Defaul 20초)이 발생하여 http 400에러가 발생할 것으로 판단하였으나,<br>아래와 같은 Access Log가 발생하였습니다.<br>  * 참고로 Timeout관련 config는 timeout 600 밖에 없습니다<br>##<br> 100.119.87.73 - uid=3000032792,ou=People,dc=samsunglife,dc=com [27/Nov/2017:13:53:43 +0900] 540 &quot;POST /portal/dataService.do HTTP/1.1&quot; 200 10 &quot;https://ep.ap1.t.samsunglife.kr:8443/irj/servlet/prt/portal/prtroot/request.Dispatcher?pid=&amp;id=MNU31218150303041122105B8549A3&amp;type=MENU&amp;hkey=&amp;reqStartTime=1511758421034&amp;logType=&amp;IS_POPUP=&amp;noticeYn=N&quot; &quot;Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko&quot; &quot;_ga=GA1.2.2037614991.1509070247; OAMAuthnHintCookie=1; MYSAPSSO2=AjExMDAgABFwb3J0YWw6MzAwMDAzMjc5MogAE2Jhc2ljYXV0aGVudGljYXRpb24BAAozMDAwMDMyNzkyAgADMDAwAwADVEVQBAAMMjAxNzExMjcwNDI2BQAEAAAAEAoACjMwMDAwMzI3OTL%2FAW4wggFqBgkqhkiG9w0BBwKgggFbMIIBVwIBATELMAkGBSsOAwIaBQAwCwYJKoZIhvcNAQcBMYIBNjCCATICAQEweDBsMQswCQYDVQQGEwJLUjEOMAwGA1UECRMFU2VvdWwxDDAKBgNVBAoTA0VSUDEQMA4GA1UEBxMHSnVuZy1ndTEfMB0GA1UECxMWU2Ftc3VuZyBMaWZlIEluc3VyYW5jZTEMMAoGA1UEAxMDVEVQAggKIBYIFgASBDAJBgUrDgMCGgUAoF0wGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkqhkiG9w0BCQUxDxcNMTcxMTI3MDQyNjA4WjAjBgkqhkiG9w0BCQQxFgQUxfQ4v3ZWqWiwPuQmB%2FEsDPd4t!swCQYHKoZIzjgEAwQ!MDwCHFZDbsT5nauZTK8eCkBJmlBqmBrUHrrVfR8nxfQCHHXiX!ZIEJTspb5I9qV6oNxXO4vmhLbZRbAdOoY%3D; ROUTEID=.ep1; PortalAlias=portal; saplb_*=(J2EE5696420)5696450; JSESSIONID=p1arfw3pn0qS9-ZkKQv4-aVGo7n7XwHC61YA_SAP2-TnTt6Ui0Qu4nrMsFVIOMwd; JSESSIONMARKID=EvUE3wIsnwxSAZEDPCi1dyD-GgzuvGVFMF1sLrVgA&quot;<br> ##<br>이에,<br>다음 3가지 에러 로그 Case의 발생 원인에 대해 <br>내용을 다시 정리하여 문의드립니다.<br> <br>[Apache Config]<br>    timeout 600<br> <br>[Error Log Case]<br>Case1. (70007)The timeout specified has expired: [client ****] AH01102<br>    - 해당 error log의 access log를 보면 <br>      **** - unknown [16/Nov/2017:10:46:15 +0900] 600 &quot;POST /portal/dataService.do HTTP/1.1&quot; 502 774 &quot;https://~~<br>Case2. (70007)The timeout specified has expired: [client ****] AH01095<br>    - 해당 error log의 access log를 보면 <br>      **** - unknown [16/Nov/2017:13:57:10 +0900] 20 &quot;POST /portal/dataService.do?info=l HTTP/1.1&quot; 400 774 &quot;https://~~<br>Case3. (70008)Partial results are valid but processing is incomplete: [client ****] AH01095<br>    - 해당 error log의 access log를 보면 <br>      **** - unknown [16/Nov/2017:18:57:03 +0900] 0 &quot;POST /portal/dataService.do HTTP/1.1&quot; 400 774 &quot;https://~~<br> <br>문의사항<br>1) Case1 AH01102의 경우, 600초가 지나 Timeout이 찍힌 것은 로그로 나와 있는데<br>   어떤 원인으로 600초가 지나 http 502로 timeout이 발생하였는지요?<br>   WAS에서 응답이 없어서인지...아니면 다른 원인으로 인하여 발생하는지요?<br> <br>2) Case2 AH01095의 경우, 20초가 지나 Timeout이 찍힌 것은 로그로 나와 있는데<br>   어떤 원인으로 20초가 지나 http 400으로 timeout이 발생하였는지요?<br>   WAS에서 응답이 없어서인지...WAS에서 응답이 없었다면 Case1과는 어떻게 다른지?<br>   http 400은 Client의 잘못한 요청으로 발생한다면,<br>   Case2와 Case3는 왜 차이가 발생하는 것인지??<br> <br> <br>3가지 유형에 대해 전반적으로 발생원인에 대해 파악한 후에<br>전체적인 답변을 주시길 부탁드립니다.<br><br><br>확인요청드립니다. <br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><enhancedSLA>false</enhancedSLA><contactIsPartner>false</contactIsPartner><tags/><br><br><comment id="a0aA000000L5M6KIAV"><br>======================<br><b>생성계정 : Park, Min Woo</b><br><b>생성날짜 : 2017-11-29T00:53:20Z</b><br><b>마지막 답변자 : Park, Min Woo</b><br><b>마지막 수정 일자 : 2017-11-29T00:53:20Z</b><br><br>안녕하세요<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.  <br><br>보내주신 답변의 내용은 <br>    - WEB에서 WAS로 Data를 요청하는 경우<br>      RequestReadTimeout(Defaul 20초) 안에 Data가 전송되지 못하는 경우<br>      http 400의 결과로 timeout이 발생한다는 것으로 이해가 됩니다.<br> <br>이런 가정하에 Test를 진행하였습니다.<br>    - 시나리오는 WAS쪽에 Test 페이지를 설정하고 로그 확인<br>       * Test 페이지 : 540초 동안 Web서버 요청에 대해 응답 대기하도록 구현<br><br>====&gt;<br>RequestReadTimeout의 의미는 &quot;Set timeout values for receiving request headers and body from client.&quot; 입니다.<br>즉, client 로부터 http request를 받는데 걸리는 timeout 으로, client -&gt; Web 구간이며 이는 request header / request body로 나뉘어서 볼 수 있습니다.<br><br>http 400은 'bad request'로써 RequestReadTimeout 동안 정상적인 request를 전송받지 못하거나, request 포멧이 비정상인 경우에 발생할 수 있습니다.<br>http 400 을 재연은 쉽지 않을 것으로 보이는데요, &quot;540초 동안 Web서버 요청에 대해 응답 대기하도록 구현&quot;은 어떤식으로 하신 건가요?<br>단순히 540초동안 Thread.sleep 등으로 응답을 주지 않는 것인가요?<br>이것은 request는 정상적으로 다 받아져서 WAS까지 전달이 되어 WAS에서 응답을 못주는 형태로써, http 400의 내용과는 다른 시나리오로 보입니다.<br><br>access_log에서 아래와 같이 540초 이후에 정상적으로 http 200을 return 받은것을 보실 수 있을 겁니다.<br>100.119.87.73 - uid=3000032792,ou=People,dc=samsunglife,dc=com [27/Nov/2017:13:53:43 +0900] 540 &quot;POST /portal/dataService.do HTTP/1.1&quot; 200 10 <br>======<br> <br>[Apache Config]<br>    timeout 600<br> <br>[Error Log Case]<br>Case1. (70007)The timeout specified has expired: [client ****] AH01102<br>    - 해당 error log의 access log를 보면 <br>      **** - unknown [16/Nov/2017:10:46:15 +0900] 600 &quot;POST /portal/dataService.do HTTP/1.1&quot; 502 774 &quot;https://~~<br><br>Case2. (70007)The timeout specified has expired: [client ****] AH01095<br>    - 해당 error log의 access log를 보면 <br>      **** - unknown [16/Nov/2017:13:57:10 +0900] 20 &quot;POST /portal/dataService.do?info=l HTTP/1.1&quot; 400 774 &quot;https://~~<br><br>Case3. (70008)Partial results are valid but processing is incomplete: [client ****] AH01095<br>    - 해당 error log의 access log를 보면 <br>      **** - unknown [16/Nov/2017:18:57:03 +0900] 0 &quot;POST /portal/dataService.do HTTP/1.1&quot; 400 774 &quot;https://~~<br> <br>문의사항<br>1) Case1 AH01102의 경우, 600초가 지나 Timeout이 찍힌 것은 로그로 나와 있는데<br>   어떤 원인으로 600초가 지나 http 502로 timeout이 발생하였는지요?<br>   WAS에서 응답이 없어서인지...아니면 다른 원인으로 인하여 발생하는지요?<br> <br>====&gt;<br>The HTTP 502 Bad Gateway : server error response code indicates that the server, while acting as a gateway or proxy, received an invalid response from the upstream server.<br><br>[client]       [Proxy]      [Application Server]<br>           -request-&gt;    -forward-&gt;<br>            &lt;--502--    &lt;-response- ERROR (or delay in response)<br><br>위와 같이 backend server에서 ProxyTimeout(600) 까지 정상적인 response를 return하지 못해서 발생하는 것으로, 원인은 backend server에서 체크해보셔야 합니다.<br>======<br><br>2) Case2 AH01095의 경우, 20초가 지나 Timeout이 찍힌 것은 로그로 나와 있는데<br>   어떤 원인으로 20초가 지나 http 400으로 timeout이 발생하였는지요?<br>   WAS에서 응답이 없어서인지...WAS에서 응답이 없었다면 Case1과는 어떻게 다른지?<br>   http 400은 Client의 잘못한 요청으로 발생한다면,<br>   Case2와 Case3는 왜 차이가 발생하는 것인지??<br>====&gt;<br>timeout의 원인은 apache 로그로 확인 불가능합니다. tcpdump를 통한 패킷 분석 및 apache debug를 통해 분석을 시도해볼 수 있습니다.<br>위에서 말씀드린 것처럼 WAS의 응답이 없는 것이 아니고 client 로부터 http request를 받는데 걸리는 timeout 입니다.<br>Case 3의 경우에는 request header 전송 완료후 request body에 대해 prefetch를 시도했으나 fail이 된 경우로, request body data가 전송이 완료되지 않았거나 비정상적인 경우에 발생힐 수 있습니다.<br>======<br><br><br>3가지 유형에 대해 전반적으로 발생원인에 대해 파악한 후에 전체적인 답변을 주시길 부탁드립니다.<br>====&gt;<br>현재 RHEL의 httpd package를 SAP Netweaver에 연동하여 사용하고 계십니다.<br>apache 로그의 내용 및 설정값에 대한 설명은 가능하나, 에러의 발생 원인 파악은 Red Hat에서 지원 불가능 합니다.<br>특히나 현재 사용하시는 apache에는 webgatessl_apache24.so 등과 같이 3rd party 모듈을 사용하고 있기 때문에, Red Hat으로부터 원인 분석을 진행할 수 없습니다.<br>======<br><br>감사합니다.<br>Minwoo Park<br><br><publishedDate>2017-11-29T00:53:20Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>