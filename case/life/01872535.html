======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2017-06-19T02:23:02Z</b><br><b>마지막 답변자 : Jack, Jmoon</b><br><b>마지막 수정 일자 : 2017-08-05T10:02:37Z</b><br><b>id : 500A000000XOHSJIA5</b><br>======================<br><br><b><font size=15>
제목  : [기술]ReaR 기술 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.<br>ReaR 관련 문의 드립니다.<br><br>1.ReaR 백업시 LVM 볼륨을 제외 시키고 백업을 하는 방법이 있을까요? 여러 서버의 LVM name 은 <br> 서로 다릅니다.일괄적으로 적용 가능한 방법을 알려주세요.<br><br>2.ReaR 복원시 동기종,이기종,Physical TO Virtual 상관없이 가능 한가요? <br><br>3.ReaR 백업 success or fail 여부를 알수 있는 방법이 있을까요?<br><br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 6.8</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPFTEAL01</hostname><br><br><br><comment id="a0aA000000Jw6KsIAJ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-07-20T02:03:34Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-07-20T02:03:33Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q1) 리어추가 문의합니다. 리어 설치후 cron.d/rear 파일을보면 아래의 내용이 있는데 해당 내용 부분을 주석 처리 해되 되나요?<br>       30 1 * * * root /usr/sbin/rear checklayout || /usr/sbin/rear mkrescue<br>A1) 자동으로 rear mkrescue 가 trigger 되지 않기를 원하신다면, 주석처리하셔서 무방합니다.<br><br>Q2) checklayout &amp; mkrescue 부분은 mkbackup을 시행하면 자동적으로 체크후 리어에서 백업을 실행하는건지 알고 싶습니다<br>A2) rear checklayout 은 가장 최근의 rescue 환경이 스토리지 설정과 다른지를 확인하고, 만약 다르다면 rear mkresuce 를 실행<br>      하여 rescue 이미지를 자동으로 생성하는 스크립트라고 이해하실 수 있습니다.  좀 더 자세한 내용은 아래의 원문을 참고하십시오.<br><br>-   원  문<br><br>Monitoring integration<br><br>Relax-and-Recover integrates with your monitoring. The rear checklayout command will tell you if the most recent rescue environment deviates from your storage configuration (e.g. LVM changes, filesystem resized, …)<br>In good Unix tradition rear checklayout returns 0 if your system is in sync with your rescue image. A return code of 1 should lead to a red light in your monitoring screen because a new rescue image is needed. Create a rescue image and the next time rear checklayout runs, it will return 0 again, and your monitoring will switch to green.<br><br>You can also automate the creation of rescue images by adding a cron job for /usr/sbin/rear checklayout || /usr/sbin/rear mkrescue. And make sure the OUTPUT_URL points to a central location for storing your rescue images. By default, a rear installation via a package manager will automatically install a cron entry - see:<br><br> # cat /etc/cron.d/rear<br> 30 1 * * * root /usr/sbin/rear checklayout || /usr/sbin/rear mkrescue<br><br>Furthermore, rear will write an exit code to the /var/log/messages file which you could use to search via an integrated monitoring system (search for the rear keyword).<br><br>감사합니다.<br><br><publishedDate>2017-07-20T02:03:33Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JvrUOIAZ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-07-19T05:31:32Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-07-19T05:31:32Z</b><br><br>안녕하세요. <br>리어추가 문의합니다.<br>리어 설치후 cron.d/rear 파일을보면 <br>30 1 * * * root /usr/sbin/rear checklayout || /usr/sbin/rear mkrescue<br>의 내용이 있는데<br>1. 해당 내용 부분을 주석 처리 해되 되나요?<br><br>2. checklayout &amp; mkrescue 부분은<br>mkbackup을 시행하면 자동적으로 체크후 리어에서 백업을 실행하는건지 알고 싶습니다.<br><br><publishedDate>2017-07-19T05:31:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JmbKCIAZ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-06-23T04:40:03Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-06-23T06:06:31Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q) NFS 서버는 ReaR 백업시에만 mount 되며 백업이 끝나면 umount 되는 상태 입니다. 공유디렉토리는 없는 상태 입니다.<br>A) NFS 서버가 RHEL 기반에 구성이 되어 있고, rsyslog 를 사용가능하다면 참고문서[1]을 활용하여 NFS 서버를 rsyslog 서<br>     버로 구성하고 Rear 를 실행하는 시스템을 rsyslog 클라이언트로 구성하여 이전에 안내드렸던 아래의 rsyslog.conf 를<br>     NFS 서버에 적용하신다면 가능할것입니다.<br><br>$ vi /etc/rsyslog.conf<br>~~ 생략<br>if $syslogtag contains 'rear' and $msg contains &quot;DONE: rc=&quot; then /&lt;nfs_share_dir&gt;/backup_outcome.txt<br>if $syslogtag contains 'rear' and $msg contains &quot;DONE: rc=&quot; then ~<br>~~ 생략<br><br><br>[ 참고문서 ]<br><br>[1]  How to configure remote logging with rsyslog<br>- https://access.redhat.com/solutions/54363<br><br>[2]  How do I send logs to a different location based on the name of the application? <br>- https://access.redhat.com/solutions/737873<br><br>감사합니다.<br><br><publishedDate>2017-06-23T04:40:02Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JmaYsIAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-23T02:19:18Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-23T02:19:18Z</b><br><br>안녕하세요.<br>NFS 서버는 ReaR 백업시에만 mount 되며 백업이 끝나면 umount 되는 상태 입니다.<br>공유디렉토리는 없는 상태 입니다.<br>답변 감사합니다.<br><br><publishedDate>2017-06-23T02:19:18Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JmaUjIAJ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-06-23T02:05:17Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-06-23T02:05:17Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q) 여러 ReaR 백업 파일을 NFS 서버로 수집하는데 백업이 success 되면 발생하는 DONE: rc=0 로그를 NFS 서버의 ReaR 백업 폴더에서 생성되게 하는 방법이 있나요?<br>     백업 success or fail 여부를 NFS 서버 한곳에서 파악하고 싶습니다.<br><br>A) 백업을 수행하는 시스템내에 NFS 공유디렉토리가 마운트 되어 있다면, /etc/rsyslog.conf 에 아래와 같은 설정을 추가 한 다음 rsyslog 서비스를 재시작하시면 가능할것입니다.<br><br>$ vi /etc/rsyslog.conf<br>~~ 생략<br>if $syslogtag contains 'rear' and $msg contains &quot;DONE: rc=&quot; then /&lt;nfs_share_dir&gt;/backup_outcome.txt<br>if $syslogtag contains 'rear' and $msg contains &quot;DONE: rc=&quot; then ~<br>~~ 생략<br><br><br>[ 참고문서 ]<br><br>[1]  How do I send logs to a different location based on the name of the application? <br>- https://access.redhat.com/solutions/737873<br><br>감사합니다.<br><br><publishedDate>2017-06-23T02:05:17Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JmZskIAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-23T00:16:40Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-23T00:16:40Z</b><br><br>안녕하세요.<br>여러 ReaR 백업 파일을 NFS 서버로 수집하는데 백업이 success 되면 발생하는 DONE: rc=0 로그를<br><br>NFS 서버의 ReaR 백업 폴더에서 생성되게 하는 방법이 있나요?<br><br>백업 success or fail 여부를 NFS 서버 한곳에서 파악하고 싶습니다.<br><br>감사합니다.<br><br><publishedDate>2017-06-23T00:16:40Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Jm1XcIAJ"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-06-21T01:09:44Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-06-21T01:09:44Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q1) 각 서버에 원하는 LVM 과 마운트포인트를 대입하여 일일이 해당 옵션에 기입하는데 어려움이 있어서<br>        VG name 이 vg1 , vg2 경우 <br><br>        # ONLY_INCLUDE_VG=( &quot;vg&quot; ) <br><br>        명칭을 올바르게 넣지 않는 방법으로 LVM 볼륨 제외를 하려고 합니다.<br><br>A1) 만약, ONLY_INCLUDE_VG=(&quot;vg*&quot;) 라고 설정하시게 되면 VG 이름이 vg 로 시작하는것들만 포함하게 될것입니다.<br><br>감사합니다.<br><br><publishedDate>2017-06-21T01:09:44Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JlmaJIAR"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2017-06-20T08:15:14Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2017-06-20T08:15:14Z</b><br><br>안녕하세요.<br>각 서버에 원하는 LVM 과 마운트포인트를 대입하여 일일이 해당 옵션에 기입하는데 어려움이 있어서<br>VG name 이 vg1 , vg2 경우 <br><br># ONLY_INCLUDE_VG=( &quot;vg&quot; )  <br><br>명칭을 올바르게 넣지 않는 방법으로 LVM 볼륨 제외를 하려고 합니다.<br><br><publishedDate>2017-06-20T08:15:14Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000JlWGQIA3"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-06-19T08:06:00Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-06-19T08:07:08Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>Q1) ReaR 백업시 LVM 볼륨을 제외 시키고 백업을 하는 방법이 있을까요? 여러 서버의 LVM name 은 <br>       서로 다릅니다.일괄적으로 적용 가능한 방법을 알려주세요.<br><br>A1) 아래의 /etc/rear/default.conf 의 설명과 같이  EXCLUDE_VG 를 사용해서 제외가 가능하나, 반드<br>       시 해당 LVM 에 매핑된 마운트 포인터들을 EXCLUDE_MOUNTS 에 기입을 해야 합니다.<br><br>       그래서, 제각기 이름이 다른 LVM 을 가진 서버들을 일괄로 적용시키기는 어려울것이며, 각 서버에<br>       원하는 LVM 과 마운트포인트를 대입하여 일일이 해당 옵션에 기입을 해야 할것입니다.<br><br># How to exclude something ----- EXCLUDES -------<br>#<br># You cannot exclude a device (e.g. /dev/sdg) directly. Instead you have to exclude everything<br># ON that device and then the dependancy tracker will automaticall exclude the device from the<br># recovery (because there won't be any recovery information for that &quot;unnecessary&quot; device).<br>#<br># Furthermore, you have to exclude MD devices and LVM2 volume groups separately as there is no<br># automatic detection of these dependancies (yet, please write and submit it !)<br> <br># Exclude filesystems by specifying their mountpoints. Will be automatically added to the<br># $BACKUP_PROG_EXCLUDE array during backup to prevent the excluded filesystems' data to<br># be backed up<br># examples: /tmp<br>#           /media/bigdisk<br>EXCLUDE_MOUNTPOINTS=()<br> <br># Exclude MD devices<br># examples: /dev/md0<br>#           /dev/md/0<br>EXCLUDE_MD=()<br> <br># Exclude LVM2 volume groups. This will automatically exclude also the creation of the corresponding<br># physical and logical volumes that belong to the excluded volume group.<br>#<br># NOTE: YOU MUST ALSO EXCLUDE THE CORRESPONDING MOUNTPOINTS IN EXCLUDE_MOUNTPOINTS (see above)<br>#       OTHERWISE THE RECOVERY ***WILL*** TRY TO RECREATE THE FILESYSTEMS ONTO NON-EXISTING LVs<br>#<br>#       Y O U   H A V E   B E E N   W A R N E D  ! ! !<br>EXCLUDE_VG=()<br><br><br>Q2) ReaR 복원시 동기종,이기종,Physical TO Virtual 상관없이 가능 한가요? <br><br>A2) OS가 Physical 과 Virtual 환경에서 사용하던 디바이스 드라이버 ( Network, Storage, Disk, Graphic 등등 ) 가 달려져서 Recovery<br>       수행은 가능할지 모르나, 부팅 이후에는 여러가지 예상치 못한 오류를 접하게 될것이므로, 아직까지는 공식적인 지원언급이 없는 상태<br>       입니다. 가능한 Physical to Physical 또는 Virtual to Virtual 가 최선의 방법일것입니다.<br><br><br>Q3) ReaR 백업 success or fail 여부를 알수 있는 방법이 있을까요?<br><br>A3) success 가 되면 아래와 같이 DONE: rc=0 가 /var/log/messages 파일에서 보여질것이고,<br>       fail 이 되면 rc=1 또는 rc=2 나 나타날 것입니다.<br><br>       Mar 10 10:22:20 &lt;my_hostname&gt; rear[20947]: DONE: rc=0<br>       <br>       그래서, 아래의 쉘스크립트를 활용해서 backup 의 성공 및 실패여부를 email 로 전송이나 별도의 log  파일로 기록도 가능할것입니다.<br><br>       rear mkbackup<br>       rc=$?<br>       if [ -n &quot;${rc}&quot; ]<br>       then<br>       send an email indicating rear failed, or logger to syslog<br>       fi<br><br><br>감사합니다.<br><br><publishedDate>2017-06-19T08:06:00Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000JlUTqIAN"><br>======================<br><b>생성계정 : Moon, Jack, Jong Young</b><br><b>생성날짜 : 2017-06-19T05:09:46Z</b><br><b>마지막 답변자 : Moon, Jack, Jong Young</b><br><b>마지막 수정 일자 : 2017-06-19T05:09:46Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>현재 올려주신 문의내용을 자세히 살펴보고 있는중이며, 확인이 되는대로 업데이트를 남기도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2017-06-19T05:09:46Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>