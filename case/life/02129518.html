======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-06-27T09:21:01Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-07-24T10:04:12Z</b><br><b>id : 500A000000bA1rHIAS</b><br>======================<br><br><b><font size=15>
제목  : [생명] crontab 이슈 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요. crontab rear 예약작업이 수행 되지가 않습니다.<br><br># OS_BACKUP<br>5 2 1-7 * * (test `date +\%a` = Sat &amp;&amp; /sysadmin/BACKUP/osbackup.sh)<br><br>#cat /sysadmin/BACKUP/osbackup.sh <br>$(which rear) -c /etc/rear/regular -d -v mkbackup<br><br>crontab 에 있는 다른 예약작업들은 정상 수행되며 <br>osbackup.sh 를 수동 수행시 rear 백업이 정상 작동 합니다. <br>다른 서버와 crontab 설정 방법이 동일한 상태입니다.<br>sosreport 첨부 합니다.<br>감사합니다.<br><br>======================================================<br>* 고객 정보 (필수) - 실제 레드햇 서브스크립션을 소유하고 시스템에 사용 중인 엔드 유저<br>- 성함(직급) : 정종욱 (사원)<br>- 회사명(부서명) : 삼성SDS<br>- 전화번호 :  82-10-2831-7377 <br>- 메일주소 : 정종욱 &lt;jjw1103.jung@samsung.com'&gt;<br><br>* 파트너 정보 (옵션) - 실제 고객의 시스템을 유지보수하는 업체<br>- 성함(직급) : 진성민(책임)<br>- 회사명(부서명) : 타임게이트(오픈소스팀)<br>- 전화번호 : 010-7676-1313<br>- 메일주소 : sm.jin@time-gate.com''<br>======================================================<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLDBMAWL0A</hostname><br><br><br><comment id="a0aA000000NAGezIAH"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-09T09:06:43Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-09T09:06:43Z</b><br><br>안녕하세요,  <br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>해당 작업이 실패한 원인은 cron 이 수행될 때 rear 명령어를 찾지 못해서 발생한 것으로 보입니다.<br><br>cron-env.log 파일의 PATH 항목을 보시면 /usr/bin:/bin 을 확인하실 수 있습니다.<br>이 PATH 가 cron 이 실행될 때의 환경 변수 입니다.<br>하지만 rear 명령어는 기본적으로 /usr/sbin/ 에 존재하며 cron 실행시 PATH 에 존재하지 않기 때문에 $(which rear) 명령이 실패한 것입니다.<br>아래와 같이 osbackup.sh 의 $(which rear) 을 절대 경로로 변경하신 후 수행해보시기 바랍니다.<br>이와 같은 이유료 가급적 추후 cron 설정 시 절대경로를 권장 드립니다.<br><br>&lt; 변경 전 &gt;<br>$(which rear) -c /etc/rear/regular -d -v mkbackup<br><br>&lt; 변경 후 예시 &gt;<br>/usr/sbin/rear -c /etc/rear/regular -d -v mkbackup<br><br>감사합니다.<br><br><publishedDate>2018-07-09T09:06:43Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NAEueIAH"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-09T07:04:59Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-09T07:04:59Z</b><br><br>안녕하세요. <br>요청하신 로그정보 업로드 합니다. osbackup.sh 정보가 다른관계로 같이 올립니다.<br>rear 자체가 실행이 안되는거 같습니다.<br><br>[root@SLDBMAWL0A:/root] cat /sysadmin/BACKUP/osbackup.sh<br>$(which rear) -c /etc/rear/regular -d -v mkbackup<br>sleep 60<br>sh -x /sysadmin/BACKUP/osbackup_log.sh<br>sleep 60<br>HOSTNAME=`hostname | awk '{print $1}'`<br>REARLOG=`grep &quot;rm -Rf /tmp/rear&quot; /var/log/rear/rear-${HOSTNAME}.log |awk '{print $NF}'`<br>rm -Rf ${REARLOG}<br><br>[root@SLDBMAWL0A:/tmp] cat cron-env.log<br>XDG_SESSION_ID=232650<br>SHELL=/bin/sh<br>USER=root<br>PATH=/usr/bin:/bin<br>PWD=/root<br>LANG=en_US.UTF-8<br>SHLVL=1<br>HOME=/root<br>LOGNAME=root<br>XDG_RUNTIME_DIR=/run/user/0<br>_=/usr/bin/env<br><br>[root@SLDBMAWL0A:/tmp] cat cron-rear.log<br>++ which rear<br>which: no rear in (/usr/bin:/bin)<br>+ -c /etc/rear/regular -d -v mkbackup<br>/sysadmin/BACKUP/osbackup.sh: line 1: -c: command not found<br>+ sleep 60<br>+ sh -x /sysadmin/BACKUP/osbackup_log.sh<br>+ MASTER_LOG_DIR=/nwadmin/AFS/OSBackup_MasterLog<br>+ BACKUP_DIR=/REAR/regular/<br>++ hostname<br>++ awk '{print $1}'<br>+ HOSTNAME=SLDBMAWL0A<br>++ awk '{print $(NF-1)}'<br>++ awk -F. '{print $1}'<br>++ cat /etc/redhat-release<br>+ RELEASH=7<br>+ REAR_CONF_DIR=/etc/rear/regular/<br>++ awk '-F&quot;' '{ print $(NF-1) }'<br>++ awk -F:// '{ print $NF }'<br>++ grep BACKUP_URL /etc/rear/regular/local.conf<br>++ awk -F/ '{ print $1 }'<br>+ NFS_IP=211.189.85.158<br>++ awk -F:// '{ print $NF }'<br>++ awk '-F&quot;' '{ print $(NF-1) }'<br>++ awk -F/ '{ print $2 }'<br>++ grep BACKUP_URL /etc/rear/regular/local.conf<br>+ FIR_DIR=Backup<br>++ grep BACKUP_URL /etc/rear/regular/local.conf<br>++ awk -F/ '{ print $3 }'<br>++ awk '-F&quot;' '{ print $(NF-1) }'<br>++ awk -F:// '{ print $NF }'<br>+ SEC_DIR=REAR<br>++ awk '{print $1 &quot;,&quot; $2}'<br>++ awk -F: '{print $1&quot;:&quot; $2}'<br>++ cat /var/log/rear/rear-SLDBMAWL0A.log<br>++ head -n 1<br>+ START_TIME=2018-06-26,13:39<br>++ awk '{print $1 &quot;,&quot; $2}'<br>++ awk -F: '{print $1&quot;:&quot; $2}'<br>++ cat /var/log/rear/rear-SLDBMAWL0A.log<br>++ tail -n 1<br>+ END_TIME=2018-06-26,13:40<br>++ grep rc= /var/log/messages<br>++ awk '{print $(NF-1) $NF}'<br>++ tail -n 1<br>+ R6_RESULT=<br>++ awk -F: '{print $(NF)}'<br>++ sed 's/ //g'<br>++ tail -n 1<br>++ grep rear /var/log/messages<br>+ R5_RESULT='(root)CMD((test`date+%a`=Sat&amp;&amp;/bin/bash-x/sysadmin/BACKUP/osbackup.sh&amp;&gt;/tmp/cron-rear.log))'<br>+ R6_DONE=DONE:rc=0<br>+ R5_DONE=rearmkbackupfinishedwithzeroexitcode<br>++ awk '{print $4}'<br>++ tail -n 1<br>++ grep -e Archived -e MiB /var/log/rear/rear-SLDBMAWL0A.log<br>+ MEGA_USED=<br>++ expr / 1024<br>expr: syntax error<br>+ GIGA_USED=G<br>+ SCHEDULE=R<br>+ mount -t nfs -o vers=3,nolock 211.189.85.158:/Backup/REAR/regular/SLDBMAWL0A /mnt<br>+ '[' 7 = 5 ']'<br>+ '[' DONE:rc=0 = ']'<br>+ echo SLDBMAWL0A,R,2018-06-26,13:39,2018-06-26,13:40,N<br>+ echo SLDBMAWL0A,G,/REAR/regular/SLDBMAWL0A,2018-06-26,13:40<br>+ umount /mnt<br>+ sleep 60<br>++ hostname<br>++ awk '{print $1}'<br>+ HOSTNAME=SLDBMAWL0A<br>++ grep 'rm -Rf /tmp/rear' /var/log/rear/rear-SLDBMAWL0A.log<br>++ awk '{print $NF}'<br>+ REARLOG=/tmp/rear.kr6Q7YHzwQV8nXC<br>+ rm -Rf /tmp/rear.kr6Q7YHzwQV8nXC<br>rm: cannot remove ??tmp/rear.kr6Q7YHzwQV8nXC/outputfs?? Device or resource busy<br><br><publishedDate>2018-07-09T07:04:59Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000N91pCIAR"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-07-03T09:15:47Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-07-03T09:15:47Z</b><br><br>안녕하세요,  <br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>cron 및 osbackup.sh 실행 결과 수집을 위해서 아래와 같이 변경 후 cron-rear.log 파일과 cron-env.log 파일을  업로드 부탁드립니다.<br><br>&lt; 기존 &gt;<br>5 2 1-7 * * (test `date +\%a` = Sat &amp;&amp; /sysadmin/BACKUP/osbackup.sh)<br><br>&lt; 변경 &gt;<br>5 2 1-7 * * (test `date +\%a` = Sat &amp;&amp; /bin/bash -x /sysadmin/BACKUP/osbackup.sh &amp;&gt; /tmp/cron-rear.log)<br>5 2 1-7 * * (test `date +\%a` = Sat &amp;&amp; /usr/bin/env &amp;&gt; /tmp/cron-env.log)<br><br>추가로 동작하는 시스템과 동작하지 않는 시스템의 PATH 관련 환경 변수 값에 차이가 있는지 확인 부탁드립니다. 예를 들면 아래와 같은 파일이 있습니다.<br><br><br> - /root/.bash_profile<br> - /root/.bashrc<br> - /etc/profile<br><br>감사합니다.<br><br><publishedDate>2018-07-03T09:15:47Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000N9091IAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-03T07:21:52Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-03T07:21:51Z</b><br><br>안녕하세요.요청하신 local.conf 올립니다.<br><br>[root@SLDBMAWL0A:/etc/rear/regular] cat local.conf<br>OUTPUT=ISO<br>BACKUP=NETFS<br>BACKUP_URL=nfs://211.189.85.158/Backup/REAR/regular/SLDBMAWL0A<br>OUTPUT_URL=nfs://211.189.85.158/Backup/REAR/regular/SLDBMAWL0A<br>BACKUP_PROG_EXCLUDE=('/tmp/*' '/dev/shm/*' '/var/tmp/*' '/var/crash/*' '/CRASH/*' '/LOG/*' '/APP/*' '/sysadmin/*' '/nwadmin/*' '/home/*')<br>ONLY_INCLUDE_VG=(&quot;vg&quot;)<br>NETFS_KEEP_OLD_BACKUP_COPY=y<br> <br>[root@SLDBMAWL0A:/etc/rear/irregular] cat local.conf<br>OUTPUT=ISO<br>BACKUP=NETFS<br>BACKUP_URL=nfs://211.189.85.158/Backup/REAR/irregular/SLDBMAWL0A<br>OUTPUT_URL=nfs://211.189.85.158/Backup/REAR/irregular/SLDBMAWL0A<br>BACKUP_PROG_EXCLUDE=('/tmp/*' '/dev/shm/*' '/var/tmp/*' '/var/crash/*' '/CRASH/*' '/LOG/*' '/APP/*' '/sysadmin/*' '/nwadmin/*' '/home/*')<br>ONLY_INCLUDE_VG=(&quot;vg&quot;)<br>NETFS_KEEP_OLD_BACKUP_COPY=y<br><br>감사합니다.<br><br><publishedDate>2018-07-03T07:21:51Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MwMp7IAF"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-07-03T01:30:26Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-07-03T01:30:26Z</b><br><br>안녕하세요.sosreport 업로드 하였습니다.<br>IBHPSWB1 - nfs server<br>SLPSLOAL01 - rear client<br>감사합니다.<br><br><publishedDate>2018-07-03T01:30:26Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000Mvl2lIAB"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-06-29T04:11:32Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-06-29T04:11:32Z</b><br><br>sosreport 는 금일 담당자 부재로 내일 업로드 하겠습니다.<br>감사합니다.<br><br><publishedDate>2018-06-29T04:11:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000MvTTNIA3"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-06-28T06:39:29Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-06-28T06:39:28Z</b><br><br>안녕하세요,  <br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>보내주신 sosreport 에서는 cron 동작에 관련된 문제점을 찾을 수 없었습니다.<br>통화내용에 대하여 정리하여 드립니다.<br><br> - backup data 는 별도의 nfs server ( RHEL ) 에 저장되고 있습니다.<br> - 동일한 설정과 스크립트를 사용하는 다른 rear client 는 잘 작동됩니다.<br><br>rear 수행시 백업 목적지가 nfs server 임을 확인하였으며, cronjob 수행시 nfs server 연결 상태에 대하여 파악하고자 합니다.<br>따라서 번거로우시겠지만 아래와 같은 추가 자료를 요청드립니다.<br><br> - nfs server 의 sosreport<br> - 정상적으로 잘 작동되는 다른 rear client 의 sosreport<br> - SLDBMAWL0A 의 rear log 파일이 존재하는지 다시한번 확인 부탁드립니다.<br><br>두 서버의 sosreport 확인 후 업데이트 드리겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-28T06:39:28Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000MvRdRIAV"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-06-28T02:40:45Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-06-28T02:40:45Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services를 이용해주셔서 감사합니다.<br><br>현재 올려주신 케이스의 내용을 확인하고 있습니다.<br>정리되는대로 업데이트 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-06-28T02:40:45Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>