======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-08-19T11:30:19Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2018-09-08T10:04:30Z</b><br><b>id : 500A000000bRIfdIAG</b><br>======================<br><br><b><font size=15>
제목  : pacemaker에서 lsb resource 등록 시, 각 프로세스 별 모니터링 감지 방법 설정 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>어떤 문제/오류/결함이 발생했습니까? 기대하시는 결과는 무엇입니까?<br><br>안녕하세요. pacemaker 관련하여 구성 문의 드립니다.<br><br>고객사에서 다음과 같이 클러스터 리소스 추가 작업을 하려 합니다.<br>프로세스 및 파일 이름은 라인이 길어 단순하게 예로 들겠습니다.<br><br>서비스 구동 및 중지 스크립트는<br> - TEST_start.sh<br> - TEST_stop.sh<br><br>첫 서비스 구동 시 아래 A~F 프로세스가 뜨며, <br>status 체크에는 각각의 프로세스에 대해 조치 및 재기동을 별개로 합니다.<br><br>A 프로세스<br> - 5분이내 3회 재시작 시, Standby로 절체<br> - 실행 스크립트 : TEST_start.sh, TEST_stop.sh<br>B 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : BB.sh<br>C 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : CC.sh<br>D 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : DD.sh<br>E 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : EE.sh<br>F 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : FF.sh<br>======================<br>1. &quot;5분이내 3회 재시작 시, Standby로 절체&quot; 내용을 하기와 같이 설정하였을 때<br>  # pcs property set cluster-recheck-interval=5min<br>  # pcs resource meta RESOURCE_NAME failure-timeout=N<br>  # pcs resource defaults migration-threshold=3<br>   - 위 값 변경들이 클러스터 구동에 문제가 없는지, 그리고 올바른 방법인가요???<br>   - failure-timeout 값을 활성화 시키는것이 서비스 운영에 문제가 없는 사항인가요??<br>   - 또한, 위 방법 말고 &quot;5분이내 3회 재시작 시, Standby로 절체&quot; 를 충족시킬 수 있는 설정 방법이 있는지요??<br><br>2.  해당 리소스는 lsb 로 등록하려고 합니다.<br>     interval값에 따른 한번의 모니터링에 6개의 프로세스들을 순차적으로 체크하는것이 cluster 동작에 지장이 있는지 확인 부탁드립니다.<br><br>3. 중지 스크립트를 실행하면 다시한번 되묻는 질의가 포함되어 있습니다.<br>    스크립트 내용안에서 exec 커맨드로 실행 파일을 수행하는데, 혹시 질의를 생략할 수 있는 방법이 있는지요?<br><br><br>확인 부탁드립니다.<br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Configuration issue</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br>======================<br><comment id="a0aA000000NUDFIIA5"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-08-22T14:45:02Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-08-22T14:45:01Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>문의하신 내용에 대하여 확인한 결과,<br>failure-timeout 가 지원하는 시간 단위는 다음과 같습니다.<br><br>s (seconds),m (minutes), h (hours).<br><br>이상 업무에 도움이 되시기 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-22T14:45:01Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000NU6MwIAL"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-08-22T06:50:26Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-08-22T06:50:26Z</b><br><br>답변 감사합니다.<br><br>failure-timeout값은 기본단위가 &quot;초&quot; 인것으로 알고 있는데, <br>&quot;시간&quot; 혹은 &quot;일&quot; 단위로 변경이 가능한가요??<br><br><publishedDate>2018-08-22T06:50:26Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000NU403IAD"><br>======================<br><b>생성계정 : Park, HyunYick</b><br><b>생성날짜 : 2018-08-22T01:40:04Z</b><br><b>마지막 답변자 : Park, HyunYick</b><br><b>마지막 수정 일자 : 2018-08-22T01:40:03Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Service 를 이용해주셔서 감사합니다.<br><br>문의 하신 내용에 대한 답변입니다.<br><br>Q1) failure-timeout 값에 적용할 수 있는 최대값이 어떻게 되는지요?<br>A1) 별도로 지정된 최대값은 없습니다. 다른 말로하면 python data type 의 최대치가 실제로 제한된 값이라고 말씀드릴 수 있습니다.<br>그 값을 시간으로 환산하면 대략 68년 정도 입니다.<br><br>Q2) cluster-recheck-interval 값의 역할이 무엇인지, 해당 값을 15min -&gt; 5min 으로 변경할 경우 클러스터 동작에 문제가 없는건지 확인 부탁드립니다.<br>A2) cluster-recheck-interval 은 클러스터의 상태를 주기적으로 확인하는 시간 간격을 지정하는 옵션입니다.<br>초 단위의 아주 낮은 값이나 비정상적인 큰 값으로 설정할 경우는 문제가 될 수 있지만 5 min 정도로 문제가 발생하지는 않을 것입니다.<br>아래는 공식 문서에 표기된 해당 옵션에 대한 설명입니다.<br><br>&quot;cluster-recheck-interval&quot;<br>Default : 15 minutes<br>Description : Polling interval for time-based changes to options, resource parameters and constraints.<br>Allowed values: Zero disables polling, positive values are an interval in seconds (unless other SI units are specified, such as 5min).<br><br>감사합니다.<br><br><publishedDate>2018-08-22T01:40:03Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LeUlTIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-08-21T02:43:32Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-08-21T02:43:32Z</b><br><br>답변 감사합니다. <br>추가 문의가 있는데요,<br><br>1, failure-timeout 값에 적용할 수 있는 최대값이 어떻게 되는지요?<br><br>2. cluster-recheck-interval 값의 역할이 무엇인지,<br>  해당 값을 15min -&gt; 5min 으로 변경할 경우 클러스터 동작에 문제가 없는건지 확인 부탁드립니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-21T02:43:32Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LeUP8IAN"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-08-21T02:00:49Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-08-21T02:28:41Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>문의하신 내용에 대하여 안내를 드리면 다음과 같습니다.<br><br>&gt; 1. &quot;5분이내 3회 재시작 시, Standby로 절체&quot; 내용을 하기와 같이 설정하였을 때<br>&gt;   # pcs property set cluster-recheck-interval=5min<br>&gt;   # pcs resource meta RESOURCE_NAME failure-timeout=N<br>&gt;   # pcs resource defaults migration-threshold=3<br>&gt;    - 위 값 변경들이 클러스터 구동에 문제가 없는지, 그리고 올바른 방법인가요???<br>&gt;    - failure-timeout 값을 활성화 시키는것이 서비스 운영에 문제가 없는 사항인가요??<br>&gt;    - 또한, 위 방법 말고 &quot;5분이내 3회 재시작 시, Standby로 절체&quot; 를 충족시킬 수 있는 설정 방법이 있는지요??<br><br>정확히는 3회 상태 체크 실패시 passive 노드로의 절체는 가능합니다만, 5분 이내 3회 실패라는 옵션은 확인하기 어렵습니다.<br>상태 체크에 3회 실패하면 migration-threshold 에 따라 바로 절체 됩니다.<br>다만, 언급하신 것과 같이 5분 간격으로 cluster-recheck 이 발생하므로 5분 후 2회의 실패내용(3회 실패하면 이미 절체되므로)이 리셋되었다면<br>5분이 지나서 3회째 실패한 것이 다시 1회 실패한 것으로 간주되므로 5 분안에 3회 연속으로 실패하지 않을 경우 절체를 방지하는 효과는 있어 보입니다.<br><br>상기 설정 중 , failure-timeout 의 경우, 알고 계시는 바와 같이 사용자 개입없이 자동으로 에러 정보를 지워줍니다.<br>다만 이러한 경우, 사용자가 잠재적인 문제를 인식하지 못하게 할 수 있으므로 일시적인 사용이 아닌 경우 주의가 필요합니다. <br>====<br>관련문구(예로서 stonith 가 언급되지만 다른 resource 에도 동일):<br><br>If a stonith resource has presented errors, they can be cleared by setting the meta attribute failure-timeout on the stonith resource.<br><br>This setting will cause those errors and the associated failcount to be automatically expired after a certain amount of time.<br>It is recommended to only set this temporarily and then unset it again once the errors are cleared, so that future errors will not auto-expire. Having them auto-expire may prevent the administrator from seeing them, and thus it may not be clear that corrective action needs to be taken. <br>====<br><br>추가로 failure-timeout 를 반영구 등 높은 수치로 바꾸면 fail-count 도 실패 history 도 해당 수치에 따라 함께 리셋되지 않을 것입니다. <br><br>&gt; 2.  해당 리소스는 lsb 로 등록하려고 합니다.<br>&gt;      interval값에 따른 한번의 모니터링에 6개의 프로세스들을 순차적으로 체크하는것이 cluster 동작에 지장이 있는지 확인 부탁드립니다.<br>&gt; 3. 중지 스크립트를 실행하면 다시한번 되묻는 질의가 포함되어 있습니다.<br>&gt;     스크립트 내용안에서 exec 커맨드로 실행 파일을 수행하는데, 혹시 질의를 생략할 수 있는 방법이 있는지요?<br><br>유저 커스텀 스크립트 동작 및 작성과 관련된 지원은 저희 기술지원 범위가 아닙니다.<br>저희가 말씀드릴 수 있는 내용은 클러스터에 등록하실 lsb 스크립트의 경우 다음 모든 테스트를 반드시 통과해야 합니다.<br><br>http://www.linux-ha.org/wiki/LSB_Resource_Agents<br><br>또는<br><br>https://clusterlabs.org/pacemaker/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/ap-lsb.html<br><br>감사합니다.<br><br><publishedDate>2018-08-21T02:00:48Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LeG9LIAV"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-08-20T08:18:24Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-08-20T08:18:24Z</b><br><br>이현석 / 010-3332-2259 입니다<br><br><publishedDate>2018-08-20T08:18:24Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0aA000000LeG3XIAV"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-08-20T08:09:25Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-08-20T08:09:25Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>상황 확인차 연락드리고 싶습니다만 어디로 연락드리면 될지<br>성함과 연락처를 남겨주시길 바랍니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-20T08:09:25Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0aA000000LeD3uIAF"><br>======================<br><b>생성계정 : Shin, Jake Jaewook</b><br><b>생성날짜 : 2018-08-20T01:54:04Z</b><br><b>마지막 답변자 : Shin, Jake Jaewook</b><br><b>마지막 수정 일자 : 2018-08-20T01:54:04Z</b><br><br>안녕하세요,<br><br>Red Hat Global Support Services 를 이용해주셔서 감사합니다.<br><br>저는 Platform Support 를 담당하고 있는<br>Senior Technical Support Engineer 신재욱입니다.<br><br>현재 올려주신 문의내용은 자세히 살펴보고 있는중이며,<br>곧 관련된 내용을 업데이트 하도록 하겠습니다.<br><br>감사합니다.<br><br><publishedDate>2018-08-20T01:54:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br><br>고객사에서 다음과 같이 클러스터 리소스 추가 작업을 하려 합니다.<br>프로세스 및 파일 이름은 라인이 길어 단순하게 예로 들겠습니다.<br><br>서비스 구동 및 중지 스크립트는<br> - TEST_start.sh<br> - TEST_stop.sh<br><br>첫 서비스 구동 시 아래 A~F 프로세스가 뜨며, <br>status 체크에는 각각의 프로세스에 대해 조치 및 재기동을 별개로 합니다.<br><br>A 프로세스<br> - 5분이내 3회 재시작 시, Standby로 절체<br> - 실행 스크립트 : TEST_start.sh, TEST_stop.sh<br>B 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : BB.sh<br>C 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : CC.sh<br>D 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : DD.sh<br>E 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : EE.sh<br>F 프로세스<br> - 다운시 재시작<br> - 실행 스크립트 : FF.sh<br>======================<br>1. &quot;5분이내 3회 재시작 시, Standby로 절체&quot; 내용을 하기와 같이 설정하였을 때<br>  # pcs property set cluster-recheck-interval=5min<br>  # pcs resource meta RESOURCE_NAME failure-timeout=N<br>  # pcs resource defaults migration-threshold=3<br>   - 위 값 변경들이 클러스터 구동에 문제가 없는지, 그리고 올바른 방법인가요???<br>   - failure-timeout 값을 활성화 시키는것이 서비스 운영에 문제가 없는 사항인가요??<br>   - 또한, 위 방법 말고 &quot;5분이내 3회 재시작 시, Standby로 절체&quot; 를 충족시킬 수 있는 설정 방법이 있는지요??<br><br>2.  해당 리소스는 lsb 로 등록하려고 합니다.<br>     interval값에 따른 한번의 모니터링에 6개의 프로세스들을 순차적으로 체크하는것이 cluster 동작에 지장이 있는지 확인 부탁드립니다.<br><br>3. 중지 스크립트를 실행하면 다시한번 되묻는 질의가 포함되어 있습니다.<br>    스크립트 내용안에서 exec 커맨드로 실행 파일을 수행하는데, 혹시 질의를 생략할 수 있는 방법이 있는지요?<br><br><br>확인 부탁드립니다.<br>감사합니다.</issue><cep>false</cep></case>