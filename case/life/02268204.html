======================<br><b>생성계정 : 타임게이트 타임게이트</b><br><b>생성날짜 : 2018-12-05T06:02:19Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2019-01-16T11:00:44Z</b><br><b>id : 5002K00000cvz5KQAQ</b><br>======================<br><br><b><font size=15>
제목  : [생명] NFS 응답지연 이슈
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요.타임게이트 입니다.<br>금일 13:30  nfs : server not responding still trying 메세지가 발생되면서<br>nfs hang 상태가 발생 하였으며 gateway 에 ping 또한 나가지 않았습니다.<br>드롭박스에 sosreport, messages, sar 파일 업로드 해놓았습니다.<br>파일명: sosreport-DPMSAL06SL-20181205141429.tar.xz, messages-181205, DPMSAL06_sar.tar<br>다운 받을수 있게 드롭박스에 있는 sosreport, messages, sar 파일링크 부탁드립니다.<br>감사합니다.<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.2</b><br><b>타입  : Account / Customer Service Request</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>DPMSAL06SL</hostname><br><br><br><comment id="a0a2K00000Ok0hFQAR"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2018-12-20T09:37:32Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2018-12-20T09:49:43Z</b><br><br>안녕하세요. 레드햇 김마현 입니다.<br><br>문의 주신 내용에 대해 답변 드립니다.<br><br>언급해 주신 레드햇 솔루션 문서에 나온 스크립트는 사용해도 괜찮습니다.<br><br>참조 문서:<br>https://access.redhat.com/solutions/544883#intermittent<br><br>각 스크립트는 /tmp 디렉토리에 각각 아래 정보들을 수집합니다.<br>tcpdump-watch_8.sh<br>: tcpdump, messages log, mount 정보를 수집<br><br>nfs-client-performance.sh<br>: tcpdump, iostat, strace, nfs_cpu, nfsiostat, nfs_meminfo, mount 정보를 수집<br><br>tcpdump-fs.sh<br>: tcpdump, nfs_meminfo 정보를 수집<br><br>각각의 사용법은 아래와 같습니다.<br>1) ./tcpdump-watch_8.sh 02268204 100.253.144.203<br>   * 위 스크립트는 케이스넘버를 입력해야 합니다.<br>2) ./nfs-client-performance.sh 100.253.144.203<br>3) ./tcpdump-fs.sh 100.253.144.203<br><br>실행 가능하도록 퍼미션을 조정 후, root 권한으로 실행하십시오.<br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2018-12-20T09:37:31Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OjzPAQAZ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-12-20T07:51:50Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-12-20T07:51:50Z</b><br><br>안녕하세요.빠른 답변 감사합니다.<br>아래와 같은 방법을 사용해도 되는지 문의 드립니다.<br>https://access.redhat.com/solutions/544883#intermittent<br>감사합니다.<br><br><publishedDate>2018-12-20T07:51:50Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000Ojz2LQAR"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2018-12-20T07:18:42Z</b><br><b>마지막 답변자 : Kim, Mahyun</b><br><b>마지막 수정 일자 : 2018-12-20T07:38:40Z</b><br><br>안녕하세요. 레드햇 김마현 입니다.<br><br>문의 주신 내용에 대해 답변 드립니다.<br><br>&gt;&gt; nfs not responding 발생시 tcpdump 생성방법 문의 드립니다.<br><br>아래와 같이 패킷 캡쳐를 하면 됩니다.<br># tcpdump -nni bond0 &gt;&gt; /tmp/&quot;`hostname`-`date`.pcap&quot;<br><br>추가적으로 이슈 발생시 아래와 같이 ping 응답 로그(이슈 NFS 서버로 ping)도 작성하면 원인 파악을 하는데 도움이 될것으로 판단됩니다.<br># while :; do sleep 1 ; ping 100.253.144.203 -c 1 -D &gt;&gt; /tmp/&quot;`hostname`-`date`.ping&quot; ; done;<br><br><br>감사합니다.<br>김마현 드림.<br><br><publishedDate>2018-12-20T07:18:42Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OjxRvQAJ"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-12-20T04:46:11Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-12-20T04:46:11Z</b><br><br>안녕하세요.타임게이트 진성민 입니다.<br>답변 감사합니다~<br>패킷 손실되는 원인을 파악하기 위해서 해당 메세지가 발생할시 tcpdump 생성을 하고 싶은데요<br><br>&lt;메세지&gt;<br>Dec  5 13:53:51 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br><br>nfs not responding 발생시 tcpdump 생성방법 문의 드립니다.<br>감사합니다.<br><br><publishedDate>2018-12-20T04:46:11Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000OQYYcQAP"><br>======================<br><b>생성계정 : Kim, Mahyun</b><br><b>생성날짜 : 2018-12-07T08:18:55Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-12-10T03:56:34Z</b><br><br>안녕하세요. 레드햇 김마현 차장입니다.<br><br>분석 결과<br>- NFS 연결 이슈 시간대(13시39분 ~ 14시05분)를 포함한 전후의 sar 데이터를 분석한 결과 CPU, Memory 및 Page In/Out 에서는 별다른 특이사항이 보이지 않습니다.<br>  다만, 이슈 시간대 bond0 NIC의 Packet In/Out 량이 현저히 줄어 드는것이 확인되며,<br>  동시간대에 같은 bond0 NIC로 통신되는 100.253.144.202 NFS 서버와의 연결에는 문제가 없었던 것으로 보입니다.<br>  따라서 레이어상에서 서버 외부적인 요인, 즉 100.253.144.203 NFS 서버와 연결되는 네트워크 이슈로 인해 이슈가 발생했던 것으로 판단됩니다.<br>======================<br>아래는 분석 내용입니다.<br>- 서버 네트워크 환경 구성 상 NFS 서버와의 통신은 bond0 NIC를 통하여 통신됩니다.<br>[makim@localhost sosreport-DPMSAL06SL-20181205141429]$ cat route | grep ^100.253<br>100.253.142.0   0.0.0.0         255.255.255.0   U     0      0        0 bond0<br>100.253.145.0   100.253.142.11  255.255.255.0   UG    0      0        0 bond0<br><br>[makim@localhost sosreport-DPMSAL06SL-20181205141429]$ cat ip_addr<br>1: lo    inet 127.0.0.1/8 scope host lo\       valid_lft forever preferred_lft forever<br>22: bond0    inet 100.253.142.36/24 brd 100.253.142.255 scope global bond0\       valid_lft forever preferred_lft forever<br>22: bond0    inet 100.253.142.236/24 brd 100.253.142.255 scope global secondary bond0\       valid_lft forever preferred_lft forever<br>23: bond1    inet 172.19.12.36/24 brd 172.19.12.255 scope global bond1\       valid_lft forever preferred_lft forever<br><br><br>-  bond0 NIC를 통해 100.253.144.203, 100.253.144.202 서버 2개로 연결됨이 확인됩니다.<br>[makim@localhost sosreport-DPMSAL06SL-20181205141429]$ cat ./etc/fstab | grep 100.253.144<br>100.253.144.203:/PMS_usr_sap_trans_PP      /usr/sap/trans        nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br>100.253.144.203:/PMS_sapmnt_PPM_PP         /sapmnt/RPM           nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br>100.253.144.203:/PMS_SAPP_PP               /SAPP                 nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br>100.253.144.203:/PMS_MIG_PP                /MIG                  nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br>100.253.144.203:/PMS_ARCHIVE_PP            /ARCHIVE              nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br>100.253.144.202:/BATCH_bat_sam_SAM_work_PP /batch_sam/SAM/work   nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br>100.253.144.202:/BATCH_bat_sam_SAM_bak_PP  /batch_sam/SAM/backup nfs vers=3,proto=tcp,intr,hard,timeo=300,retrans=2,wsize=65536,rsize=65536,bg,_netdev 0 0<br><br>[makim@localhost sosreport-DPMSAL06SL-20181205141429]$ cat netstat | grep 100.253.144<br>tcp        0      0 100.253.142.36:847      100.253.144.203:2049    ESTABLISHED 0          43069      -                    keepalive (22.48/0/0)<br>tcp        0      0 100.253.142.36:765      100.253.144.202:2049    ESTABLISHED 0          27308631   -                    keepalive (5.84/0/0)<br><br><br>- message log 확인시 100.253.144.203 로의 연결에만 문제가 있었던 것으로 판단됩니다.<br>[makim@localhost sosreport-DPMSAL06SL-20181205141429]$ cat var/log/messages|grep -i -e nfs -e responding | more<br>Dec  5 13:39:56 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:40:18 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:40:25 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>~~ snip ~~<br>Dec  5 13:53:20 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:53:44 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:53:51 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>~~ snip ~~<br>======================<br>- NFS client - server간 연결 도식도<br>+----------------------------------------------+                       +----------------------------------------------+<br>|Client                                        |                       |SERVER                                        |<br>|                                              |                       |                                              |<br>|          +----------------------+            |                       |          +----------------------+            |<br>|          |                      |            |                       |          |                      |            |<br>|          |  System call layer   |            |                       |          |  System call layer   |            |<br>|          |                      |            |                       |          |                      |            |<br>|          +-----------+----------+            |                       |          +----------------------+            |<br>|                      |                       |                       |                                              |<br>|                      |                       |                       |                                              |<br>|          +-----------v----------+            |                       |          +----------------------+            |<br>|          | Virtual file system  |            |                       |          | Virtual file system  |            |<br>|          |   (VFS) layer        |            |                       |          |   (VFS) layer        |            |<br>|          |                      |            |                       |          |                      |            |<br>|          +----+--------------+--+            |                       |          +--^-----------------+-+            |<br>|               |              |               |                       |             |                 |              |<br>|               |              |               |                       |             |                 |              |<br>|  +------------v----+   +-----v-----------+   |                       |  +----------+------+    +-----v-----------+  |<br>|  |   Local file    |   |       NFS       |   |                       |  |       NFS       |    |   Local file    |  |<br>|  | system interface|   |     client      |   |                       |  |      Server     |    | system interface|  |<br>|  +------------+----+   +-----+-----------+   |                       |  +--------^--------+    +------+----------+  |<br>|               |              |               |                       |           |                    |             |<br>|               |              |               |                       |           |                    |             |<br>|  +------------v----+   +-----v------------+  |                       |  +--------+---------+   +------v----------+  |<br>|  |                 |   |  RPC client      |  |                       |  |  RPC  Server     |   |                 |  |<br>|  |      DISK       |   |     stub         |  |      RPC Protocol     |  |     stub         |   |     DISK        |  |<br>|  |                 |   |      +         +-|-----------------------------|-+      ^         |   |                 |  |<br>|  +-----------------+   +------|-----------+  |                       |  +--------|---------+   +-----------------+  |<br>|                               |              |                       |           |                                  |<br>+----------------------+--------|--------------+                       +-----------|-----------+----------------------+<br>                       |        |                                                  |           |<br>                       |        |                                                  |           |<br>                       |     +--v-------------------------+                        |           |<br>                       |     | XDR||    ||    ||    ||    +------------------------+           |<br>                       |     +----------------------------+                                    |<br>               +-------+-----------------------------------------------------------------------+--------------+<br>               Network ---&gt; *장애 포인트로 판단됨<br><br><br>감사합니다.<br>김마현 드림<br><br><publishedDate>2018-12-07T08:18:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OQXHrQAP"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-12-07T06:23:55Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-12-07T06:23:55Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>올려주신 sar 데이터 파일 분석 후 업데이트 드리겠습니다.<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2018-12-07T06:23:55Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OQWUkQAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-12-07T04:41:00Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-12-07T04:41:00Z</b><br><br>안녕하세요.<br>DPMSAL06SL_sa05 링크 부탁드립니다.<br>감사합니다.<br><br><publishedDate>2018-12-07T04:41:00Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000OQDWnQAP"><br>======================<br><b>생성계정 : 타임게이트, 타임게이트</b><br><b>생성날짜 : 2018-12-06T02:30:43Z</b><br><b>마지막 답변자 : 타임게이트, 타임게이트</b><br><b>마지막 수정 일자 : 2018-12-06T02:30:43Z</b><br><br>안녕하세요. 답변 감사합니다.<br>dropbox 에 파일명 : DPMSAL06SL_sa05 업로드 했습니다.<br>감사합니다.<br><br><publishedDate>2018-12-06T02:30:43Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000OQD9jQAH"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-12-06T01:50:05Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-12-06T01:50:04Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>1. sosreport를 수집한 시각<br>[sosreport-DPMSAL06SL-20181205141429]$ cat sos_commands/general/uptime<br>14:14:45 up 9 days, 22:11,  9 users,  load average: 0.49, 17.92, 43.80<br><br>2. sosreport 수집 당시 nfs 서버와 연결 상태<br>[sosreport-DPMSAL06SL-20181205141429]$ cat netstat | grep 100.253.144.203 <br>tcp        0      0 100.253.142.36:847      100.253.144.203:2049    ESTABLISHED 0          43069      -                    keepalive (22.48/0/0)<br><br>3. message 상의 nfs 로그. <br>[makim@localhost sosreport-DPMSAL06SL-20181205141429]$ cat var/log/messages|grep -i -e nfs -e responding | more<br>Dec  5 13:39:56 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:40:18 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:40:25 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>~~ snip ~~<br>Dec  5 13:53:20 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:53:44 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 13:53:51 DPMSAL06SL kernel: nfs: server 100.253.144.203 not responding, still trying<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>Dec  5 14:05:16 DPMSAL06SL kernel: nfs: server 100.253.144.203 OK<br>~~ snip ~~<br><br>로그상으로 볼 때 Dec  5 13:39:56 ~ 13:53:51 사이에 연결이 끊어 졌고, Dec  5 14:05:16 시각에 연결이 복구되어 sosreport를 수집한 14:14:45에도 연결이 되어 있는 상태로 확인됩니다.<br><br>sar 파일 분석을 위해 DPMSAL06_sar.tar.gz 파일을 압축 해제했으나 내용이 없는 싱볼릭링크 파일만 있어 확인이 안됩니다.<br><br>sar 데이터 파일을 다시 전달부탁드립니다.<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2018-12-06T01:50:04Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>