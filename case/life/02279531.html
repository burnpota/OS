======================<br><b>생성계정 : JIMIN KIM</b><br><b>생성날짜 : 2018-12-20T11:11:59Z</b><br><b>마지막 답변자 : GSS Tools</b><br><b>마지막 수정 일자 : 2019-01-22T11:03:06Z</b><br><b>id : 5002K00000czgOUQAY</b><br>======================<br><br><b><font size=15>
제목  : 현재 운영 중인 서버에서 vgrename 절차 문의
</font></b><br><br>======================<br><b>사전문의<br></b><br>안녕하세요<br><br>SDS 김지민 선임입니다. <br><br>현재 운영 중인 서버에서 vgrename 절차 문의드리려고 합니다.<br>서버의 파일시스템과 pv / vg / lv 상태는 아래와 같습니다.<br><br><br>root@SLPTSSAL01 /root # df -Ph | grep LLPT<br>/dev/mapper/LLPTSSAPPVG-LOG   30G  2.7G   28G   9% /LOG<br>/dev/mapper/LLPTSSAPPVG-APP   50G   17G   34G  33% /APP<br><br>root@SLPTSSAL01 /root # pvs<br>  PV         VG          Fmt  Attr PSize   PFree<br>  /dev/sda7  vg0         lvm2 a--    6.99g     0<br>  /dev/sdb   vg9         lvm2 a--  225.00g     0<br>  /dev/sdc   LLPTSSAPPVG lvm2 a--  100.00g 20.00g<br><br>root@SLPTSSAL01 /root # vgs<br>  VG          #PV #LV #SN Attr   VSize   VFree<br>  LLPTSSAPPVG   1   2   0 wz--n- 100.00g 20.00g<br>  vg0           1   1   0 wz--n-   6.99g     0<br>  vg9           1   2   0 wz--n- 225.00g     0<br><br>root@SLPTSSAL01 /root # lvs<br>  LV       VG          Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  APP      LLPTSSAPPVG -wi-ao----  50.00g<br>  LOG      LLPTSSAPPVG -wi-ao----  30.00g<br>  sysadmin vg0         -wi-ao----   6.99g<br>  CRASH    vg9         -wi-ao---- 114.00g<br>  DUMP     vg9         -wi-a----- 111.00g<br><br>■ 절차 문의<br><br>1. 해당 vg의 파일시스템 umount 수행<br>   umount /LOG<br>   umount /APP<br>2. VG rename 수행<br>   vgrename LLPTSSAPPVG LRPTSSAPPVG<br>3. mount 수행<br>=======================<br><b>상태 : Closed</b><br><b>제품명  : Red Hat Enterprise Linux</b><br><b>버젼  : 7.4</b><br><b>타입  : Other</b><br><b>계정 번호  : 1648604</b><br><b>심각도  : 3 (Normal)</b><br><hostname>SLPTSSAL01</hostname><br><br><br><comment id="a0a2K00000Oki1xQAB"><br>======================<br><b>생성계정 : Song, Chang-An</b><br><b>생성날짜 : 2018-12-26T02:25:50Z</b><br><b>마지막 답변자 : Song, Chang-An</b><br><b>마지막 수정 일자 : 2018-12-26T04:35:08Z</b><br><br>안녕하세요? Red Hat 송 창 안 입니다.<br><br>문의 주신 내용에 대해서 확인된 내용을 업데이트 하도록 하겠습니다.<br><br>&gt;문서를 참고해보니 LV에 대해서는 lvol이 new name으로 변경이 될 경우 lvrename이 되는 것 처럼보여서<br>&gt;vg만 변경될 경우에는 vgrename만 하고 lv는 유지하면 되는 것인지 한번 더 문의드립니다.<br><br>이전에 답변 드린 내용과 같이 아래의  KCS를 통해, 볼륨 그룹 이름에 대해서 바꾸는 과정을 진행 할 수 있습니다.<br>&quot;How to rename a volume group or logical volume in Red Hat Enterprise Linux 5 or 6?&quot;<br> https://access.redhat.com/solutions/208953<br><br>예제에는 vg와 lv에 대해서 다 바꾸는 내용이 언급되었으며, 이는 필수 사항은 아닙니다.<br>전문 엔지니어는 다음과 같이 설명 해주었습니다.<br>But if there is a requirement to change the volume group name as well, then you could also use &quot;vgrename&quot; command as shown above.<br>While changing a volume group name, it is not mandatory to change the name of lvm volumes present within it. This is because even with the  change in VG name, each lvm volume in the volume group will have a unique device path.<br><br>For example, you could have 2 lvm volumes with name lv1, lv2 in both the volume groups testvg1 and testvg2, and all of these lvm volumes would have unique path:<br><br>/dev/testvg1/lv1<br><br>/dev/testvg1/lv2<br><br><br>/dev/testvg2/lv1<br><br>/dev/testvg2/lv2<br><br>그리하여, 저는 문의사항에서 한가지 예제로 vg 의 이름이 &quot;LLPTSSAPPVG-LOG&quot;를 &quot;LRPTSSAPPVG-LOG&quot; 바꾸는 절차에 대해서 테스트 하였으며,  <br>테스트 전체 내용과 결과에 대해서 업데이트 공유 하도록 하겠습니다.<br><br>1. pv 정보를 확인 합니다.<br><br># pvs<br>  PV         VG              Fmt  Attr PSize  PFree <br>  /dev/vda2  rhel            lvm2 a--  19.51g 40.00m<br>  /dev/vdb1  LLPTSSAPPVG-LOG lvm2 a--  20.00g 18.00g<br><br>2. vg 정보를 확인 합니다.<br># vgs<br>  VG              #PV #LV #SN Attr   VSize  VFree <br>  LLPTSSAPPVG-LOG   1   1   0 wz--n- 20.00g 18.00g<br>  rhel              1   2   0 wz--n- 19.51g 40.00m<br><br>3. lv 정보를 확인 합니다.<br># lvs<br>  LV   VG              Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  LOG  LLPTSSAPPVG-LOG -wi-ao----  2.00g                                                    <br>  root rhel            -wi-ao---- 17.47g                                                    <br>  swap rhel            -wi-ao----  2.00g  <br><br>4. vgchange 를 통해 현재 deactive vg 볼륨에 대해서 확인을 합니다.<br>현재 deactive 되지 않는 vg 볼륨 그룹의 정보를 확인 합니다.<br># vgchange -an LLPTSSAPPVG-LOG<br>  Logical volume LLPTSSAPPVG-LOG/LOG contains a filesystem in use.<br>  Can't deactivate volume group &quot;LLPTSSAPPVG-LOG&quot; with 1 open logical volume(s)<br><br>5. 해당 vg volume 에 대해서 umount를 진행 합니다.<br># umount /dev/LLPTSSAPPVG-LOG/LOG<br><br>6. vgchange 를 통해 현재 deactive vg 볼륨에 대해서 확인을 합니다.<br># vgchange -an LLPTSSAPPVG-LOG<br>  0 logical volume(s) in volume group &quot;LLPTSSAPPVG-LOG&quot; now active<br><br>7. vgrename 을 통해 LLPTSSAPPVG-LOG 볼륨에 대해서 LRPTSSAPPVG-LOG를 진행 합니다.<br># vgrename LLPTSSAPPVG-LOG LRPTSSAPPVG-LOG<br>  Volume group &quot;LLPTSSAPPVG-LOG&quot; successfully renamed to &quot;LRPTSSAPPVG-LOG&quot;<br><br>8. vgchange 를 통해서 바뀐 LRPTSSAPPVG-LOG에 대해서 active 를 진행 합니다.<br># vgchange -ay LRPTSSAPPVG-LOG<br>  1 logical volume(s) in volume group &quot;LRPTSSAPPVG-LOG&quot; now active<br><br>9. systmed를 통해 demon-reload를 진행 합니다.<br># systemctl daemon-reload<br><br>10. LOG.mount에서 문제가 발생 한것을 확인 하였습니다.<br># systemctl --all | grep \\.mount<br>  -.mount                                                                                                        loaded    active   mounted   /<br>  boot.mount                                                                                                     loaded    active   mounted   /boot<br>  dev-hugepages.mount                                                                                            loaded    active   mounted   Huge Pages File System<br>  dev-mqueue.mount                                                                                               loaded    active   mounted   POSIX Message Queue File System<br>● LOG.mount                                                                                                      loaded    failed   failed    /LOG   &lt;---------- <br>  proc-sys-fs-binfmt_misc.mount                                                                                  loaded    inactive dead      Arbitrary Executable File Formats File System<br>  run-user-0.mount                                                                                               loaded    active   mounted   /run/user/0<br>  sys-fs-fuse-connections.mount                                                                                  loaded    inactive dead      FUSE Control File System<br>  sys-kernel-config.mount                                                                                        loaded    active   mounted   Configuration File System<br>  sys-kernel-debug.mount                                                                                         loaded    active   mounted   Debug File System<br><br>11. journal 정보를 통해 에러 정보를 파악 합니다.<br># journalctl -xn<br>-- Logs begin at Tue 2018-12-25 20:58:22 EST, end at Tue 2018-12-25 21:04:59 EST. --<br>Dec 25 21:04:47 localhost.localdomain mount[10396]: mount: special device /dev/LLPTSSAPPVG-LOG/LOG does not exist   &lt;---------- 에러 정보 확인<br>Dec 25 21:04:47 localhost.localdomain systemd[1]: LOG.mount mount process exited, code=exited status=32             &lt;---------- 에러 코드 확인<br>Dec 25 21:04:47 localhost.localdomain systemd[1]: Failed to mount /LOG.                                             &lt;---------- systemd로 부터 error 확인<br>-- Subject: Unit LOG.mount has failed<br>-- Defined-By: systemd<br>-- Support: http://lists.freedesktop.org/mailman/listinfo/systemd-devel<br>-- <br>-- Unit LOG.mount has failed.<br>-- <br>-- The result is failed.<br>Dec 25 21:04:47 localhost.localdomain systemd[1]: Unit LOG.mount entered failed state.                               <br>....<br><br>12. 실제로 mount 명령을 통해, 동일한 에러가 나오는 지 확인 합니다.<br># mount -a<br>mount: special device /dev/LLPTSSAPPVG-LOG/LOG does not exist                                                      &lt;---------- 존재 하지 않는 볼륨이며, 이전에 바뀌기전 볼륨 이름으로 기입되어 있습니다.<br><br>13. fstab 내용을 확인 합니다.<br># cat /etc/fstab <br>...<br>#<br># /etc/fstab<br># Created by anaconda on Wed Aug 29 03:46:08 2018<br>#<br># Accessible filesystems, by reference, are maintained under '/dev/disk'<br># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info<br>#<br>/dev/mapper/rhel-root   /                       xfs     defaults        0 0<br>UUID=cfdd1d6e-3858-4a11-8f47-9cb29dd8aca5 /boot                   xfs     defaults        0 0<br>/dev/mapper/rhel-swap   swap                    swap    defaults        0 0                                      &lt;---------- 이전에 명시된 voulum 명으로 기입되어 있는 것을 확인 하였습니다.<br>/dev/LLPTSSAPPVG-LOG/LOG /LOG<br><br><br>xfs<br>defaults<br>0 0                                                     <br><br>14. 바뀐 볼륨 그룹 정보인 LRPTSSAPPVG-LOG으로 이름을 수정합니다.<br># cat /etc/fstab <br>...<br>#<br># /etc/fstab<br># Created by anaconda on Wed Aug 29 03:46:08 2018<br>#<br># Accessible filesystems, by reference, are maintained under '/dev/disk'<br># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info<br>#<br>/dev/mapper/rhel-root   /                       xfs     defaults        0 0<br>UUID=cfdd1d6e-3858-4a11-8f47-9cb29dd8aca5 /boot                   xfs     defaults        0 0<br>/dev/mapper/rhel-swap   swap                    swap    defaults        0 0<br>/dev/LRPTSSAPPVG-LOG/LOG /LOG<br><br><br>xfs<br>defaults<br>0 0<br><br>15. 다시 mount를 시도 합니다.<br># mount -a<br>(아무런 에러가 발생 하지 않습니다)<br><br>16. systemd 정보를 다시 확인 합니다.<br># systemctl daemon-reload<br><br>17. 아래에 ● 마킹된 정보가 없는 것을 확인 합니다.<br># systemctl --all | grep \\.mount<br>  -.mount                                                                                                        loaded    active   mounted   /<br>  boot.mount                                                                                                     loaded    active   mounted   /boot<br>  dev-hugepages.mount                                                                                            loaded    active   mounted   Huge Pages File System<br>  dev-mqueue.mount                                                                                               loaded    active   mounted   POSIX Message Queue File System<br>  LOG.mount                                                                                                      loaded    active   mounted   /LOG<br>  proc-sys-fs-binfmt_misc.mount                                                                                  loaded    inactive dead      Arbitrary Executable File Formats File System<br>  run-user-0.mount                                                                                               loaded    active   mounted   /run/user/0<br>  sys-fs-fuse-connections.mount                                                                                  loaded    inactive dead      FUSE Control File System<br>  sys-kernel-config.mount                                                                                        loaded    active   mounted   Configuration File System<br>  sys-kernel-debug.mount  <br><br>18. journalctl를 통해 특별한 에러가 없음을 확인 합니다.<br># journalctl -xn<br>-- Logs begin at Tue 2018-12-25 20:58:22 EST, end at Tue 2018-12-25 21:13:23 EST. --<br>Dec 25 21:10:41 localhost.localdomain systemd[1]: Configuration file /usr/lib/systemd/system/wpa_supplicant.service is marked executable. Please remove executable permission bits. Proceeding anyway.<br>Dec 25 21:10:41 localhost.localdomain polkitd[741]: Unregistered Authentication Agent for unix-process:10491:73964 (system bus name :1.22, object path /org/freedesktop/PolicyKit1/AuthenticationAgent, locale en_US.UTF-8) (disc<br>Dec 25 21:12:55 localhost.localdomain polkitd[741]: Registered Authentication Agent for unix-process:10510:87341 (system bus name :1.23 [/usr/bin/pkttyagent --notify-fd 5 --fallback], object path /org/freedesktop/PolicyKit1/A<br>Dec 25 21:12:55 localhost.localdomain systemd[1]: Reloading.<br><br>19. df 정보를 통해 해당 마운트에 대한 정보를 확인 합니다.<br># df -k | grep LRPTSSAPPVG<br>/dev/mapper/LRPTSSAPPVG--LOG-LOG   2086912  32928   2053984   2% /LOG<br><br>20. 최종적으로 pv 정보를 확인 합니다.<br># pvs<br>  PV         VG              Fmt  Attr PSize  PFree <br>  /dev/vda2  rhel            lvm2 a--  19.51g 40.00m<br>  /dev/vdb1  LRPTSSAPPVG-LOG lvm2 a--  20.00g 18.00g<br><br>21. 최종적으로 vg 정보를 확인 합니다.<br># vgs<br>  VG              #PV #LV #SN Attr   VSize  VFree <br>  LRPTSSAPPVG-LOG   1   1   0 wz--n- 20.00g 18.00g<br>  rhel              1   2   0 wz--n- 19.51g 40.00m<br><br>22. 최종적으로 lv 정보를 확인 합니다.<br># lvs<br>  LV   VG              Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert<br>  LOG  LRPTSSAPPVG-LOG -wi-a-----  2.00g                                                    <br>  root rhel            -wi-ao---- 17.47g                                                    <br>  swap rhel            -wi-ao----  2.00g                                                    <br><br><br>감사합니다.<br>송 창 안 드림.<br><br><publishedDate>2018-12-26T02:25:50Z</publishedDate><createdByType>Associate</createdByType><br>======================<br><comment id="a0a2K00000OkU88QAF"><br>======================<br><b>생성계정 : KIM, JIMIN</b><br><b>생성날짜 : 2018-12-24T02:46:05Z</b><br><b>마지막 답변자 : KIM, JIMIN</b><br><b>마지막 수정 일자 : 2018-12-24T02:46:05Z</b><br><br>안녕하세요<br><br>SDS 김지민 선임입니다.<br><br>답변 감사합니다. <br><br>문서를 참고해보니 LV에 대해서는 lvol이 new name으로 변경이 될 경우 lvrename이 되는 것 처럼보여서<br>vg만 변경될 경우에는 vgrename만 하고 lv는 유지하면 되는 것인지 한번 더 문의드립니다.<br><br> - 문서 참고 내역<br><br>1. https://access.redhat.com/solutions/208953<br>lvrename /dev/vg02/lvold /dev/vg02/lvnew<br><br>2. https://access.redhat.com/solutions/1573673<br>lvrename /dev/newvg/oldlv  /dev/newvg/newlv<br><br>감사합니다.<br><br><publishedDate>2018-12-24T02:46:05Z</publishedDate><createdByType>Customer</createdByType><br>======================<br><comment id="a0a2K00000OkCMZQA3"><br>======================<br><b>생성계정 : Huh, Kyung</b><br><b>생성날짜 : 2018-12-21T02:23:41Z</b><br><b>마지막 답변자 : Huh, Kyung</b><br><b>마지막 수정 일자 : 2018-12-21T02:23:41Z</b><br><br>안녕하세요? 레드햇 허경입니다.<br><br>VG rename 후에 해당 VG에 있던 LV에 대해서도 lvrename 명령으로 적절하게 변경하신 후 다시 마운트하셔야 합니다.<br><br>아래 두 문서 참고하시기 바랍니다.<br><br>https://access.redhat.com/solutions/208953<br>https://access.redhat.com/solutions/1573673<br><br>고맙습니다.<br>허 경 드림.<br><br><publishedDate>2018-12-21T02:23:41Z</publishedDate><createdByType>Associate</createdByType><br>======================<br></comments><br>